<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx配置详解 | 青山</title>
    <meta name="description" content="Nginx配置详解">
    <link rel="stylesheet" href="/assets/style.c15f451f.css">
    <link rel="modulepreload" href="/assets/app.3e2fef08.js">
    <link rel="modulepreload" href="/assets/code_front-end_linux_nginx.md.c17b0251.lean.js">
    
    <meta name="theme-color" content="#646cff">
  <link rel="image/x-icon" href="/favicon.ico">
  <meta property="og:type" content="website">
  <link rel="icon" type="image/svg+xml" href="/logo.svg">
  <link rel="manifest" href="/manifest.json">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="baidu-site-verification" content="code-5BMDhSDgSq">
  <meta name="baidu_union_verify" content="acd0eb90461e19817cabd1140c8ffd54">
  <script type="async" src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  <meta name="keywords" content="Linux Ubuntu CentOS Nginx Nginx配置">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-a8edf159><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c7c7b3f6></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c7c7b3f6> Skip to content </a><!--]--><!----><header class="VPNav" data-v-a8edf159 data-v-07852ba7><div class="VPNavBar has-sidebar" data-v-07852ba7 data-v-c73c758c><div class="container" data-v-c73c758c><div class="VPNavBarTitle has-sidebar" data-v-c73c758c data-v-4c49188d><a class="title" href="/" data-v-4c49188d><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.svg" data-v-435e0d77><!--]--><!--[-->青山<!--]--><!--[--><!--]--></a></div><div class="content" data-v-c73c758c><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-c73c758c data-v-c19016fc><span id="main-nav-aria-label" class="visually-hidden" data-v-c19016fc>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-c19016fc data-v-f4f67f7a><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-f4f67f7a><span class="text" data-v-f4f67f7a><!----> 编程 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-f4f67f7a><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-f4f67f7a><div class="VPMenu" data-v-f4f67f7a data-v-58b9fc9b><div class="items" data-v-58b9fc9b><!--[--><!--[--><div class="VPMenuLink" data-v-58b9fc9b data-v-77ffe7b6><a class="VPLink link" href="/code/front-end/blog-build/" data-v-77ffe7b6 data-v-6b1661fb><!--[-->前端<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-58b9fc9b data-v-77ffe7b6><a class="VPLink link" href="/code/algorithm/leetcode.html" data-v-77ffe7b6 data-v-6b1661fb><!--[-->算法<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-58b9fc9b data-v-77ffe7b6><a class="VPLink link" href="/code/cesium/clb.html" data-v-77ffe7b6 data-v-6b1661fb><!--[-->Cesium<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-58b9fc9b data-v-77ffe7b6><a class="VPLink link" href="/code/devops/jira.html" data-v-77ffe7b6 data-v-6b1661fb><!--[-->DevOps<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-58b9fc9b data-v-77ffe7b6><a class="VPLink link" href="/code/other/30-seconds-of-code.html" data-v-77ffe7b6 data-v-6b1661fb><!--[-->其他<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/book/front-end/you-dont-know-js.html" data-v-c19016fc data-v-b22d726d data-v-6b1661fb><!--[-->书籍<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/money/" data-v-c19016fc data-v-b22d726d data-v-6b1661fb><!--[-->理财<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/video/" data-v-c19016fc data-v-b22d726d data-v-6b1661fb><!--[-->短视频<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-c73c758c data-v-920a68cb><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-920a68cb data-v-45050f65 data-v-759a5122><span class="check" data-v-759a5122><span class="icon" data-v-759a5122><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-45050f65><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-45050f65><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-c73c758c data-v-1921dd0b data-v-a53125da><!--[--><a class="VPSocialLink" href="https://github.com/QiYoe/c-blog" target="_blank" rel="noopener" data-v-a53125da data-v-6c4051b8><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-c73c758c data-v-f263859b data-v-f4f67f7a><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-f4f67f7a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-f4f67f7a><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-f4f67f7a><div class="VPMenu" data-v-f4f67f7a data-v-58b9fc9b><!----><!--[--><!--[--><!----><div class="group" data-v-f263859b><div class="item appearance" data-v-f263859b><p class="label" data-v-f263859b>Appearance</p><div class="appearance-action" data-v-f263859b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-f263859b data-v-45050f65 data-v-759a5122><span class="check" data-v-759a5122><span class="icon" data-v-759a5122><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-45050f65><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-45050f65><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-f263859b><div class="item social-links" data-v-f263859b><div class="VPSocialLinks social-links-list" data-v-f263859b data-v-a53125da><!--[--><a class="VPSocialLink" href="https://github.com/QiYoe/c-blog" target="_blank" rel="noopener" data-v-a53125da data-v-6c4051b8><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-c73c758c data-v-52f01f79><span class="container" data-v-52f01f79><span class="top" data-v-52f01f79></span><span class="middle" data-v-52f01f79></span><span class="bottom" data-v-52f01f79></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-a8edf159 data-v-e4f5bfed><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-e4f5bfed><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-e4f5bfed><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-e4f5bfed>Menu</span></button><a class="top-link" href="#" data-v-e4f5bfed> Return to top </a></div><aside class="VPSidebar" data-v-a8edf159 data-v-ab3b062b><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-ab3b062b><span class="visually-hidden" id="sidebar-aria-label" data-v-ab3b062b> Sidebar Navigation </span><!--[--><div class="group" data-v-ab3b062b><section class="VPSidebarGroup collapsible" data-v-ab3b062b data-v-0f8cdf96><div class="title" role="button" data-v-0f8cdf96><h2 class="title-text" data-v-0f8cdf96>博客相关</h2><div class="action" data-v-0f8cdf96><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0f8cdf96><!--[--><a class="VPLink link link" href="/code/front-end/blog-build/" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>博客搭建</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/blog-build/baidu-include.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>百度收录</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/blog-build/seo-optimize.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>SEO优化</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/blog-build/aliyun-domin.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>阿里云域名</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-ab3b062b><section class="VPSidebarGroup collapsible collapsed" data-v-ab3b062b data-v-0f8cdf96><div class="title" role="button" data-v-0f8cdf96><h2 class="title-text" data-v-0f8cdf96>前端代码风格规范</h2><div class="action" data-v-0f8cdf96><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0f8cdf96><!--[--><a class="VPLink link link" href="/code/front-end/lint/" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>介绍</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/lint/husky.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Husky</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/lint/commitlint.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Commitlint</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/lint/commitizen.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Commitizen</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/lint/lint-staged.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Lint-staged</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-ab3b062b><section class="VPSidebarGroup collapsible collapsed" data-v-ab3b062b data-v-0f8cdf96><div class="title" role="button" data-v-0f8cdf96><h2 class="title-text" data-v-0f8cdf96>SwaggerHub</h2><div class="action" data-v-0f8cdf96><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0f8cdf96><!--[--><a class="VPLink link link" href="/code/front-end/swagger-hub/" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>SwaggerHub使用教程</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/swagger-hub/curl.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Curl</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-ab3b062b><section class="VPSidebarGroup collapsible" data-v-ab3b062b data-v-0f8cdf96><div class="title" role="button" data-v-0f8cdf96><h2 class="title-text" data-v-0f8cdf96>Linux相关</h2><div class="action" data-v-0f8cdf96><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0f8cdf96><!--[--><a class="VPLink link link" href="/code/front-end/linux/" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Linux启动Nginx服务</span><!----><!--]--><!----></a><a class="VPLink link link active" href="/code/front-end/linux/nginx.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Nginx</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/linux/docker.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Docker</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/linux/jenkins.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Jenkins</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/linux/kubernetes.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Kubernetes</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-ab3b062b><section class="VPSidebarGroup collapsible collapsed" data-v-ab3b062b data-v-0f8cdf96><div class="title" role="button" data-v-0f8cdf96><h2 class="title-text" data-v-0f8cdf96>Vue</h2><div class="action" data-v-0f8cdf96><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0f8cdf96><!--[--><a class="VPLink link link" href="/code/front-end/vue/" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Vue3学习笔记</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/vue/axios.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Axios学习笔记</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/vue/vue-router.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>VueRouter学习笔记</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/vue/typescript.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>TS学习笔记</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/vue/vite.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Vite学习笔记</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/vue/nuxt.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Nuxt学习笔记</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-ab3b062b><section class="VPSidebarGroup collapsible collapsed" data-v-ab3b062b data-v-0f8cdf96><div class="title" role="button" data-v-0f8cdf96><h2 class="title-text" data-v-0f8cdf96>AST</h2><div class="action" data-v-0f8cdf96><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0f8cdf96><!--[--><a class="VPLink link link" href="/code/front-end/ast/" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>AST详解</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/ast/the-super-tiny-compiler.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>The-Super-Tiny-Compiler</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-ab3b062b><section class="VPSidebarGroup collapsible collapsed" data-v-ab3b062b data-v-0f8cdf96><div class="title" role="button" data-v-0f8cdf96><h2 class="title-text" data-v-0f8cdf96>CSS</h2><div class="action" data-v-0f8cdf96><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0f8cdf96><!--[--><a class="VPLink link link" href="/code/front-end/css/" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>PostCSS</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/css/tailwind.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>TailWind</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/css/sass.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Sass</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-ab3b062b><section class="VPSidebarGroup collapsible collapsed" data-v-ab3b062b data-v-0f8cdf96><div class="title" role="button" data-v-0f8cdf96><h2 class="title-text" data-v-0f8cdf96>Git</h2><div class="action" data-v-0f8cdf96><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0f8cdf96><!--[--><a class="VPLink link link" href="/code/front-end/git/" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>git入门指南</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/git/advance.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>git进阶</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/front-end/git/flight-rules.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>git飞行规则</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-ab3b062b><section class="VPSidebarGroup collapsible collapsed" data-v-ab3b062b data-v-0f8cdf96><div class="title" role="button" data-v-0f8cdf96><h2 class="title-text" data-v-0f8cdf96>WebSocket</h2><div class="action" data-v-0f8cdf96><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0f8cdf96><!--[--><a class="VPLink link link" href="/code/front-end/websocket/" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>WebSocket</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-ab3b062b><section class="VPSidebarGroup collapsible collapsed" data-v-ab3b062b data-v-0f8cdf96><div class="title" role="button" data-v-0f8cdf96><h2 class="title-text" data-v-0f8cdf96>WebContainer</h2><div class="action" data-v-0f8cdf96><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0f8cdf96><!--[--><a class="VPLink link link" href="/code/front-end/web-container/" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>webContainer详解</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-ab3b062b><section class="VPSidebarGroup collapsible" data-v-ab3b062b data-v-0f8cdf96><div class="title" role="button" data-v-0f8cdf96><h2 class="title-text" data-v-0f8cdf96>算法</h2><div class="action" data-v-0f8cdf96><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0f8cdf96><!--[--><a class="VPLink link link" href="/code/algorithm/leetcode.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>LeetCode</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/algorithm/lodash.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Lodash</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-ab3b062b><section class="VPSidebarGroup collapsible" data-v-ab3b062b data-v-0f8cdf96><div class="title" role="button" data-v-0f8cdf96><h2 class="title-text" data-v-0f8cdf96>Cesium</h2><div class="action" data-v-0f8cdf96><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0f8cdf96><!--[--><a class="VPLink link link" href="/code/cesium/clb.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Cesium 离线加载</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/cesium/examples/tutorials.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>Cesium 用例</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-ab3b062b><section class="VPSidebarGroup collapsible" data-v-ab3b062b data-v-0f8cdf96><div class="title" role="button" data-v-0f8cdf96><h2 class="title-text" data-v-0f8cdf96>算法</h2><div class="action" data-v-0f8cdf96><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0f8cdf96><!--[--><a class="VPLink link link" href="/code/devops/jira.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>DevOps</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-ab3b062b><section class="VPSidebarGroup collapsible" data-v-ab3b062b data-v-0f8cdf96><div class="title" role="button" data-v-0f8cdf96><h2 class="title-text" data-v-0f8cdf96>其他</h2><div class="action" data-v-0f8cdf96><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0f8cdf96><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0f8cdf96><!--[--><a class="VPLink link link" href="/code/other/smart-tools.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>markdown</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/other/computer-tech.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>计算机基础知识</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/other/30-seconds-of-code.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>30 seconds of code</span><!----><!--]--><!----></a><a class="VPLink link link" href="/code/other/vanillawebprojects.html" data-v-0f8cdf96 data-v-7f1c5a9e data-v-6b1661fb><!--[--><span class="link-text" data-v-7f1c5a9e>vanillawebprojects</span><!----><!--]--><!----></a><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-a8edf159 data-v-320d9e68><div class="VPDoc has-sidebar has-aside" data-v-320d9e68 data-v-2b65cce9><div class="container" data-v-2b65cce9><div class="aside" data-v-2b65cce9><div class="aside-curtain" data-v-2b65cce9></div><div class="aside-container" data-v-2b65cce9><div class="aside-content" data-v-2b65cce9><div class="VPDocAside" data-v-2b65cce9 data-v-673c2157><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline has-outline" data-v-673c2157 data-v-ab8bcbaa><div class="content" data-v-ab8bcbaa><div class="outline-marker" data-v-ab8bcbaa></div><div class="outline-title" data-v-ab8bcbaa>大纲</div><nav aria-labelledby="doc-outline-aria-label" data-v-ab8bcbaa><span class="visually-hidden" id="doc-outline-aria-label" data-v-ab8bcbaa> Table of Contents for current page </span><ul class="root" data-v-ab8bcbaa><!--[--><li data-v-ab8bcbaa><a class="outline-link" href="#为什么nginx？" data-v-ab8bcbaa>为什么Nginx？</a><!----></li><li data-v-ab8bcbaa><a class="outline-link" href="#安装" data-v-ab8bcbaa>安装</a><!----></li><li data-v-ab8bcbaa><a class="outline-link" href="#在docker上部署nginx" data-v-ab8bcbaa>在Docker上部署NGINX</a><!----></li><li data-v-ab8bcbaa><a class="outline-link" href="#基本功能" data-v-ab8bcbaa>基本功能</a><!----></li><li data-v-ab8bcbaa><a class="outline-link" href="#http-load-balancing（负载均衡）" data-v-ab8bcbaa>HTTP Load Balancing（负载均衡）</a><!----></li><li data-v-ab8bcbaa><a class="outline-link" href="#tcp-and-udp-load-balancing" data-v-ab8bcbaa>TCP and UDP Load Balancing</a><!----></li><li data-v-ab8bcbaa><a class="outline-link" href="#http-health-checks" data-v-ab8bcbaa>HTTP Health Checks</a><!----></li><li data-v-ab8bcbaa><a class="outline-link" href="#web-server" data-v-ab8bcbaa>Web Server</a><!----></li><li data-v-ab8bcbaa><a class="outline-link" href="#security-controls" data-v-ab8bcbaa>Security Controls</a><!----></li><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-673c2157></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-2b65cce9><div class="content-container" data-v-2b65cce9><!--[--><!--]--><main class="main" data-v-2b65cce9><div style="position:relative;" class="vp-doc _code_front-end_linux_nginx" data-v-2b65cce9><div><h1 id="nginx配置详解" tabindex="-1">Nginx配置详解 <a class="header-anchor" href="#nginx配置详解" aria-hidden="true">#</a></h1><h2 id="为什么nginx？" tabindex="-1">为什么Nginx？ <a class="header-anchor" href="#为什么nginx？" aria-hidden="true">#</a></h2><p>官方版：Nginx时轻量级Web服务器，它不仅时一个高性能的HTTP和反向代理服务器，同时也是一个IMAP/POPS/SMTP代理服务器。</p><p>通俗版：轻量、简单、流行</p><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-hidden="true">#</a></h2><h3 id="centos（安装nginx预生成包版）" tabindex="-1">CentOS（安装nginx预生成包版） <a class="header-anchor" href="#centos（安装nginx预生成包版）" aria-hidden="true">#</a></h3><p>两种安装方式：</p><ul><li>Installing a Prebuilt CentOS/RHEL Package from an OS Repository（使用yum更新源安装）</li></ul><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;"># 安装 EPEL 存储库</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo yum install epel-release</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 更新存储库</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo yum update</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 安装 NGINX 开放源码</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo yum install nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 验证安装</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo nginx -v</span></span>
<span class="line"></span></code></pre></div><ul><li>Installing a Prebuilt CentOS/RHEL Package from the Official NGINX Repository（源码直接编译之后安装）</li></ul><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;"># 通过在/etc/yum.repop.d 中创建 nginx.repo 文件，为 CentOS 设置 yum 存储库，例如使用 vi</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo vi /etc/yum.repos.d/nginx.repo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 在 nginx.repo 中添加以下行</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">nginx</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">name=nginx repo</span></span>
<span class="line"><span style="color:#A6ACCD;">baseurl=https://nginx.org/packages/mainline/centos/7/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">basearch/</span></span>
<span class="line"><span style="color:#A6ACCD;">gpgcheck=0</span></span>
<span class="line"><span style="color:#A6ACCD;">enabled=1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 保存更改并退出 vi (按 ESC 并在提示符处:键入 wq)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 更新存储库</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo yum update</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 启动NGINX</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 确认 NGINX 开放源码已经启动并运行</span></span>
<span class="line"><span style="color:#A6ACCD;">curl -I 127.0.0.1</span></span>
<span class="line"></span></code></pre></div><h3 id="ubuntu（安装nginx预生成包版）" tabindex="-1">Ubuntu（安装nginx预生成包版） <a class="header-anchor" href="#ubuntu（安装nginx预生成包版）" aria-hidden="true">#</a></h3><p>两种安装方式：</p><ul><li>Installing a Prebuilt Ubuntu Package from an Ubuntu Repository（使用apt-get更新源安装）</li></ul><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;"># 更新 Ubuntu 存储库</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo apt-get update</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 安装软件包</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo apt-get install nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 验证安装</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo nginx -v</span></span>
<span class="line"></span></code></pre></div><ul><li>Installing a Prebuilt Ubuntu Package from the Official NGINX Repository（源码直接编译之后安装）</li></ul><p>要为稳定版 nginx 包设置合适的存储库，运行以下命令：</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;"># 下载用于签署 NGINX 包和存储库的密钥，并将其添加到 apt 程序的密钥环</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo wget https://nginx.org/keys/nginx_signing.key</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo apt-key add nginx_signing.key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 编辑/etc/apt/source.list 文件，例如使用 vi</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo vi /etc/apt/sources.list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 添加这些行 Source.list 来命名可以获得 NGINX 开放源码的存储库</span></span>
<span class="line"><span style="color:#A6ACCD;">deb https://nginx.org/packages/mainline/ubuntu/ trusty nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">deb-src https://nginx.org/packages/mainline/ubuntu/ trusty nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 保存更改并退出 vi (按 ESC 并在提示符处:键入 wq)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 安装 NGINX 开放源码</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo apt-get install nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 启动 NGINX</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 确认 NGINX 开放源码已经启动并运行</span></span>
<span class="line"><span style="color:#A6ACCD;">curl -I 127.0.0.1</span></span>
<span class="line"></span></code></pre></div><h3 id="从源代码编译和安装（更灵活，安装操作也更繁琐，但后面使用非常便利）" tabindex="-1">从源代码编译和安装（更灵活，安装操作也更繁琐，但后面使用非常便利） <a class="header-anchor" href="#从源代码编译和安装（更灵活，安装操作也更繁琐，但后面使用非常便利）" aria-hidden="true">#</a></h3><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;"># 安装依赖库</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">## PCRE-支持 NGINX 核心和重写模块所需的正则表达式</span></span>
<span class="line"><span style="color:#A6ACCD;">wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.44.tar.gz</span></span>
<span class="line"><span style="color:#A6ACCD;">tar -zxf pcre-8.44.tar.gz</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> pcre-8.44</span></span>
<span class="line"><span style="color:#A6ACCD;">./configure</span></span>
<span class="line"><span style="color:#A6ACCD;">make</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo make install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">## Zlib-支持头部压缩。 NGINX Gzip 模块要求</span></span>
<span class="line"><span style="color:#A6ACCD;">wget http://zlib.net/zlib-1.2.11.tar.gz</span></span>
<span class="line"><span style="color:#A6ACCD;">tar -zxf zlib-1.2.11.tar.gz</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> zlib-1.2.11</span></span>
<span class="line"><span style="color:#A6ACCD;">./configure</span></span>
<span class="line"><span style="color:#A6ACCD;">make</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo make install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">## OpenSSL-支持 HTTPS 协议。 NGINX SSL 模块和其他模块要求的</span></span>
<span class="line"><span style="color:#A6ACCD;">wget http://www.openssl.org/source/openssl-1.1.1g.tar.gz</span></span>
<span class="line"><span style="color:#A6ACCD;">tar -zxf openssl-1.1.1g.tar.gz</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> openssl-1.1.1g</span></span>
<span class="line"><span style="color:#A6ACCD;">./Configure darwin64-x86_64-cc --prefix=/usr</span></span>
<span class="line"><span style="color:#A6ACCD;">make</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo make install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 下载NGINX源码</span></span>
<span class="line"><span style="color:#A6ACCD;">wget https://nginx.org/download/nginx-1.19.0.tar.gz</span></span>
<span class="line"><span style="color:#A6ACCD;">tar zxf nginx-1.19.0.tar.gz</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> nginx-1.19.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 配置构建选项</span></span>
<span class="line"><span style="color:#A6ACCD;">./configure</span></span>
<span class="line"><span style="color:#A6ACCD;">--sbin-path=/usr/local/nginx/nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">--conf-path=/usr/local/nginx/nginx.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">--pid-path=/usr/local/nginx/nginx.pid</span></span>
<span class="line"><span style="color:#A6ACCD;">--with-pcre=../pcre-8.44</span></span>
<span class="line"><span style="color:#A6ACCD;">--with-zlib=../zlib-1.2.11</span></span>
<span class="line"><span style="color:#A6ACCD;">--with-http_ssl_module</span></span>
<span class="line"><span style="color:#A6ACCD;">--with-stream</span></span>
<span class="line"><span style="color:#A6ACCD;">--with-mail=dynamic</span></span>
<span class="line"><span style="color:#A6ACCD;">--add-module=/usr/build/nginx-rtmp-module</span></span>
<span class="line"><span style="color:#A6ACCD;">--add-dynamic-module=/usr/build/3party_module</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 编译并安装构建</span></span>
<span class="line"><span style="color:#A6ACCD;">make</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo make install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># --prefix=&lt;PATH&gt; NGINX 文件的目录。默认值:/usr/local/nginx</span></span>
<span class="line"><span style="color:#676E95;"># --sbin-path=&lt;PATH&gt; 可执行文件的名称。仅在安装过程中使用。默认值:&lt;prefix&gt;/sbin/nginx</span></span>
<span class="line"><span style="color:#676E95;"># --conf-path=&lt;PATH&gt; NGINX 配置文件的名称。默认值:&lt;prefix&gt;conf/nginx.conf</span></span>
<span class="line"><span style="color:#676E95;"># --pid-path=&lt;PATH&gt; NGINX 进程ID文件。默认值:&lt;prefix&gt;/logs/nginx.pid</span></span>
<span class="line"><span style="color:#676E95;"># --with-pcre=&lt;PATH&gt; PCRE 库的源路径，该库需要在位置指令和重写模块中进行常规表达式支持。（支持location、rewrite功能）</span></span>
<span class="line"><span style="color:#676E95;"># --with-zlib=&lt;PATH&gt; zlib 库的源路径，支持Gzip模块</span></span>
<span class="line"><span style="color:#676E95;"># -- with-mail 启用邮件代理功能</span></span>
<span class="line"><span style="color:#676E95;"># -- with-mail=dynamic 启用邮件代理功能，将其编译为一个单独的动态模块</span></span>
<span class="line"><span style="color:#676E95;"># -- with-stream 开启TCP、UDP代理功能</span></span>
<span class="line"><span style="color:#676E95;"># -- with-stream=dynamic 开启TCP、UDP代理功能，将其编译为一个单独的动态模块</span></span>
<span class="line"><span style="color:#676E95;"># --with-http_ssl_module 支持HTTPS支持。需要SSL库，比如OpenSSL</span></span>
<span class="line"><span style="color:#676E95;"># --add-module=&lt;PATH&gt; 静态链接模块：在编译时构建在 NGINX 开源中，并静态链接到 NGINX 二进制文件</span></span>
<span class="line"><span style="color:#676E95;"># --add-dynamic-module=&lt;PATH&gt; 动态链接模块：运行时动态加载到 NGINX 开放源码</span></span>
<span class="line"><span style="color:#676E95;"># with对应without：禁用模块</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 启动NGINX</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx</span></span>
<span class="line"></span></code></pre></div><h2 id="在docker上部署nginx" tabindex="-1">在Docker上部署NGINX <a class="header-anchor" href="#在docker上部署nginx" aria-hidden="true">#</a></h2><h3 id="在docker上运行nginx" tabindex="-1">在Docker上运行NGINX <a class="header-anchor" href="#在docker上运行nginx" aria-hidden="true">#</a></h3><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;"># 启动运行在容器中的 NGINX 实例，使用缺省的 NGINX 配置，并执行以下命令</span></span>
<span class="line"><span style="color:#A6ACCD;">docker run --name mynginx1 -p 80:80 -d nginx</span></span>
<span class="line"><span style="color:#676E95;"># mynginx1 是基于 NGINX 映像创建的容器的名称</span></span>
<span class="line"><span style="color:#676E95;"># -d 选项指定容器以分离模式运行: 容器继续运行，直到停止，但不响应命令行上运行的命令</span></span>
<span class="line"><span style="color:#676E95;"># -p 第一个参数指定 Docker 主机中的端口（nginx端口），第二个参数映射到容器中公开的端口（客户端端口）</span></span>
<span class="line"><span style="color:#676E95;"># 该命令返回容器 ID 的长格式: fcd1fb01b14557c7c9d991238f2558ae2704d129cf9fb97bb4fadf673a58580d。这种形式的 ID 用于日志文件的名称。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 验证容器是否已经创建并且正在使用</span></span>
<span class="line"><span style="color:#A6ACCD;">docker ps</span></span>
<span class="line"></span></code></pre></div><h3 id="管理内容和配置文件" tabindex="-1">管理内容和配置文件 <a class="header-anchor" href="#管理内容和配置文件" aria-hidden="true">#</a></h3><ul><li>在Doker主机上维护内容和配置文件</li></ul><p>在创建容器时，可以将 Docker 主机上的本地目录挂载到容器中的目录中。NGINX 映像使用默认的 NGINX 配置，它使用/usr/share/nginx/html 作为容器的根目录，并将配置文件放入/etc/nginx 中。对于Docker主机内容在本地目录/var/www 中、配置文件在/var/nginx/conf 中的 Docker 主机，运行以下命令：</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">docker run --name mynginx2 --mount type=bind,source=/var/www,target=/usr/share/nginx/html,readonly --mount source=/var/nginx/conf,target=/etc/nginx/conf,readonly -p 80:80 -d nginx</span></span>
<span class="line"></span></code></pre></div><p>对 Docker 主机上的本地目录/var/www 和/var/nginx/conf 中的文件所做的任何更改都反映在容器中的目录/usr/share/nginx/html 和/etc/nginx 中。Readonly 选项意味着只能在 Docker 主机上更改这些目录，而不能从容器内更改</p><ul><li>从 Docker 主机复制内容和配置文件</li></ul><p>在容器创建期间，Docker 可以从 Docker 主机上的本地目录复制内容和配置文件。一旦创建了一个容器，文件将通过在文件更改时创建一个新容器或通过修改容器中的文件来维护。</p><p>复制文件的一个简单方法是创建一个 Dockerfile，其中包含在基于 NGINX 映像生成新的 Docker 映像期间运行的命令。对于 Dockerfile 中的 file-COPY (COPY)命令，本地目录路径相对于 Dockerfile 所在的构建上下文。</p><p>假设内容目录是<code>content</code>，配置文件目录是 <code>conf</code>，这两个子目录都是 Dockerfile 所在的目录。NGINX 映像在<code>/etc/nginx/conf.d</code> 目录中有缺省的 NGINX 配置文件，包括 <code>default.conf</code>。要只使用 Docker 主机上的配置文件，请使用 RUN 命令删除默认文件:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">FROM nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN rm /etc/nginx/conf.d/default.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY content /usr/share/nginx/html</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY conf /etc/nginx</span></span>
<span class="line"></span></code></pre></div><p>通过在 Dockerfile 所在的目录中运行命令创建 NGINX 映像。句号(&quot;.&quot;)在命令的末尾将工作目录文件定义为构建上下文，其中包含 Dockerfile 和要复制的目录:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">docker build -t mynginx_image1 </span><span style="color:#82AAFF;">.</span></span>
<span class="line"></span></code></pre></div><p>基于 mynginx image1映像创建一个容器 mynginx3:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">docker run --name mynginx3 -p 80:80 -d mynginx_image1</span></span>
<span class="line"></span></code></pre></div><ul><li>在容器中维护内容和配置文件</li></ul><p>由于 SSH 不能用于访问 NGINX 容器，因此要直接编辑内容或配置文件，您需要创建一个具有 shell 访问权限的辅助容器。要让 helper 容器能够访问这些文件，创建一个新的映像，其中包含为映像定义的适当的 Docker 数据卷:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;"># 复制 nginx 内容和配置文件，用 Dockerfile 定义映像的音量:</span></span>
<span class="line"><span style="color:#A6ACCD;">FROM nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY content /usr/share/nginx/html</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY conf /etc/nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">VOLUME /usr/share/nginx/html</span></span>
<span class="line"><span style="color:#A6ACCD;">VOLUME /etc/nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 通过运行以下命令创建新的 NGINX 映像:</span></span>
<span class="line"><span style="color:#A6ACCD;">docker build -t mynginx_image2 </span><span style="color:#82AAFF;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 基于 mynginx image2映像创建一个 NGINX 容器 mynginx4:</span></span>
<span class="line"><span style="color:#A6ACCD;">docker run --name mynginx4 -p 80:80 -d mynginx_image2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 启动一个带有 shell 的 helper 容器 mynginx4文件，提供对我们刚刚创建的 mynginx4容器的内容和配置目录的访问:</span></span>
<span class="line"><span style="color:#A6ACCD;">docker run -i -t --volumes-from mynginx4 --name mynginx4_files debian /bin/bash</span></span>
<span class="line"><span style="color:#676E95;"># 新的mynginx4_files帮助器容器在前台运行，带有一个持久的标准输入(-i选项)和一个tty (-t选项)。mynginx4中定义的所有卷都作为helper容器中的本地目录挂载。</span></span>
<span class="line"><span style="color:#676E95;"># debian参数意味着帮助容器使用来自Docker Hub的debian映像。因为NGINX映像也使用Debian，所以最有效的方法是使用Debian作为辅助容器，而不是让Docker加载另一个操作系统</span></span>
<span class="line"><span style="color:#676E95;"># /bin/bash参数意味着bash shell在helper容器中运行，显示一个shell提示符，您可以根据需要使用该提示符修改文件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 要启动和停止容器，请运行以下命令:</span></span>
<span class="line"><span style="color:#A6ACCD;">docker start mynginx4_files</span></span>
<span class="line"><span style="color:#A6ACCD;">docker stop mynginx4_files</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 要退出 shell 但保持容器运行，请按 Ctrl + p，然后按 Ctrl + q 组合键恢复对正在运行的容器的 shell 访问，运行以下命令:</span></span>
<span class="line"><span style="color:#A6ACCD;">docker attach mynginx4_files</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 要退出 shell 并终止容器，请运行 exit 命令。</span></span>
<span class="line"></span></code></pre></div><h3 id="管理日志" tabindex="-1">管理日志 <a class="header-anchor" href="#管理日志" aria-hidden="true">#</a></h3><ul><li>使用默认日志记录</li></ul><p>默认情况下，NGINX 映像配置为向 Docker 日志收集器发送 NGINX 访问日志和错误日志。这是通过将它们链接到 stdout 和 stderr 来实现的: 然后将来自这两个日志的所有消息写入文件/var/lib/docker/containers/container-ID/container-ID-json。登录 Docker 主机。Container-ID 是创建容器时返回的长形式 ID。要显示长表单 ID，请运行以下命令:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">docker inspect --format </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{{ .Id }}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> container-name</span></span>
<span class="line"></span></code></pre></div><p>可以使用 Docker 命令行和 Docker 引擎 API 提取日志消息:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;"># 要从命令行提取日志消息，请运行以下命令:</span></span>
<span class="line"><span style="color:#A6ACCD;">docker logs container-name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 要使用 Docker Remote API 提取日志消息，请使用 Docker Unix sock 发送一个 GET 请求:</span></span>
<span class="line"><span style="color:#A6ACCD;">curl --unix-sock /var/run/docker-sock http://localhost/containers/container-name/logs</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">stdout=1</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">stderr=1</span></span>
<span class="line"><span style="color:#676E95;"># 若要在输出中只包含访问日志消息，请只包含 stdout = 1。要将输出限制为错误日志消息，只包含 stderr = 1</span></span>
<span class="line"></span></code></pre></div><ul><li>使用定制的日志记录</li></ul><p>如果希望为某些配置块(如服务器{}和位置{})以不同的方式配置日志记录，请为容器中存储日志文件的目录定义 Docker 卷，创建一个帮助容器来访问日志文件，并使用任何日志记录工具。要实现这一点，请创建一个新映像，其中包含日志文件的卷或卷。</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;"># 例如，为了配置 NGINX 将日志文件存储在/var/log/NGINX/log 中，在 Dockerfile 中添加该目录的 VOLUME 定义(前提是内容和配置文件在容器中进行管理) :</span></span>
<span class="line"><span style="color:#A6ACCD;">FROM nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY content /usr/share/nginx/html</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY conf /etc/nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">VOLUME /var/log/nginx/log</span></span>
<span class="line"><span style="color:#676E95;"># 然后，您可以创建一个映像，并使用它创建一个 NGINX 容器和一个可以访问日志目录的 helper 容器。助手容器可以安装任何所需的日志记录工具。</span></span>
<span class="line"></span></code></pre></div><h3 id="控制-nginx" tabindex="-1">控制 NGINX <a class="header-anchor" href="#控制-nginx" aria-hidden="true">#</a></h3><p>由于不能直接访问 NGINX 容器的命令行，因此不能直接将 NGINX 命令发送到容器。相反，信号可以通过 Docker kill 命令发送到容器</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;"># 要重新加载 NGINX 配置，请向 Docker 发送 HUP 信号:</span></span>
<span class="line"><span style="color:#A6ACCD;">docker </span><span style="color:#82AAFF;">kill</span><span style="color:#A6ACCD;"> -s HUP container-name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 要重新启动 NGINX，运行以下命令重新启动容器:</span></span>
<span class="line"><span style="color:#A6ACCD;">docker restart container-name</span></span>
<span class="line"></span></code></pre></div><h2 id="基本功能" tabindex="-1">基本功能 <a class="header-anchor" href="#基本功能" aria-hidden="true">#</a></h2><h3 id="master-and-worker-processes" tabindex="-1">Master and Worker Processes <a class="header-anchor" href="#master-and-worker-processes" aria-hidden="true">#</a></h3><p>NGINX 有一个主进程和一个或多个辅助进程。如果启用了缓存，缓存加载器和缓存管理器进程也会在启动时运行。</p><p>主进程的主要目的是读取和评估配置文件，以及维护辅助进程。</p><p>辅助进程执行请求的实际处理。NGINX 依靠依赖于操作系统的机制在工作进程之间有效地分配请求。辅助进程的数量由 nginx.conf 配置文件中的 worker_processes 指令定义，可以设置为固定数量，也可以配置为自动调整可用 CPU 内核的数量。</p><h3 id="控制-nginx-命令" tabindex="-1">控制 NGINX 命令 <a class="header-anchor" href="#控制-nginx-命令" aria-hidden="true">#</a></h3><p>要重新加载配置，可以停止或重新启动 NGINX，或者向主进程发送信号。可以通过运行带有-s 参数的 NGINX 命令(调用 NGINX 可执行文件)来发送信号。</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">nginx</span><span style="color:#A6ACCD;"> -s &lt;SIGNAL&gt;</span></span>
<span class="line"></span></code></pre></div><p>其中 <code>&lt;signal&gt;</code> 可以是以下任何一个:</p><ul><li>quit – 优雅关闭</li><li>reload – 重新加载配置文件</li><li>reopen – 重新打开日志文件</li><li>stop – 立即关闭(快速关闭)</li></ul><p>Kill 实用程序也可用于直接向主进程发送信号。默认情况下，主进程的进程 ID 被写入 nginx.pid 文件，该文件位于/usr/local/nginx/logs 或/var/run 目录中。</p><h3 id="创建-nginx-配置文件" tabindex="-1">创建 NGINX 配置文件 <a class="header-anchor" href="#创建-nginx-配置文件" aria-hidden="true">#</a></h3><p>默认情况下，配置文件名为 nginx.conf。它通常是/usr/local/nginx/conf、/etc/nginx 或/usr/local/etc/nginx 之一</p><ul><li>Directives</li></ul><p>配置文件由指令及其参数组成。简单(单行)指令的每个末尾都有一个分号。其他指令充当“容器”，将相关指令组合在一起，并用花括号括起来({}) ; 这些指令通常称为块。下面是一些简单指令的例子。</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">user </span><span style="color:#A6ACCD;">            nobody</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">error_log </span><span style="color:#A6ACCD;">       logs/error.log</span><span style="color:#89DDFF;"> notice;</span></span>
<span class="line"><span style="color:#89DDFF;">worker_processes </span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><ul><li>特定功能的配置文件</li></ul><p>为了使配置更易于维护，我们建议您将其分割为一组特定于特性的文件，存储在/etc/nginx/conf.d 目录中，并使用 nginx.conf 主文件中的头文件文件来引用特定于特性的文件的内容。</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">include </span><span style="color:#A6ACCD;">conf.d/http</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">include </span><span style="color:#A6ACCD;">conf.d/stream</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">include </span><span style="color:#A6ACCD;">conf.d/exchange-enhanced</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><ul><li>Contexts(称为上下文)</li></ul><p>一些顶级指令(称为上下文)将适用于不同流量类型的指令组合在一起:</p><ul><li>events – 一般连接处理</li><li>http - HTTP 传输</li><li>mail - 邮件通信</li><li>stream - TCP 和 UDP 通信</li></ul><p>置于这些Contexts之外的指令被认为是<code>main context</code></p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">user </span><span style="color:#A6ACCD;">nobody</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># a directive in the &#39;main&#39; context</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">events</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># configuration of connection processing</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">http</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># Configuration specific to HTTP and affecting all virtual servers  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># configuration of HTTP virtual server 1       </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/one </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#676E95;"># configuration for processing URIs starting with &#39;/one&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/two </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#676E95;"># configuration for processing URIs starting with &#39;/two&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  } </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># configuration of HTTP virtual server 2</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">stream</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># Configuration specific to TCP/UDP and affecting all virtual servers</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># configuration of TCP virtual server 1 </span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="http-load-balancing（负载均衡）" tabindex="-1">HTTP Load Balancing（负载均衡） <a class="header-anchor" href="#http-load-balancing（负载均衡）" aria-hidden="true">#</a></h2><h3 id="overview（概览）" tabindex="-1">Overview（概览） <a class="header-anchor" href="#overview（概览）" aria-hidden="true">#</a></h3><p>负载均衡指的是在多个后端服务器之间有效地分配网络流量</p><p>跨多个应用程序实例的负载平衡是一种常用的技术，用于优化资源利用率、最大化吞吐量、减少延迟并确保容错配置。</p><h3 id="proxying-http-traffic-to-a-group-of-servers" tabindex="-1">Proxying HTTP Traffic to a Group of Servers <a class="header-anchor" href="#proxying-http-traffic-to-a-group-of-servers" aria-hidden="true">#</a></h3><p>要开始使用 NGINX Open Source 来平衡一组服务器的 HTTP 流量，首先需要使用<code>upstream</code>指令定义该组。该指令被放置在 http 上下文中。</p><p>例如，下面的配置定义了一个名为 backend 的组，由三个服务器配置组成(可以在三个以上的实际服务器中解析) :</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">http</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">backend </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend1.example.com </span><span style="color:#A6ACCD;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">; </span><span style="color:#676E95;"># 运行同一应用程序的实例</span></span>
<span class="line"><span style="color:#A6ACCD;">    server backend2.example.com; </span><span style="color:#676E95;"># 运行同一应用程序的实例</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.0.0.1 backup; </span><span style="color:#676E95;"># 备份服务器</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://backend</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># NGINX 上运行的虚拟服务器将所有请求传递给前面例子中定义的备份服务器</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#676E95;"># 因为在upstream中没有指定负载平衡算法，所以 NGINX 使用默认算法 Round Robin:</span></span>
<span class="line"></span></code></pre></div><h3 id="选择负载平衡方法" tabindex="-1">选择负载平衡方法 <a class="header-anchor" href="#选择负载平衡方法" aria-hidden="true">#</a></h3><p>NGINX 开源支持四种负载平衡方法:</p><ul><li>Round Robin - 请求均匀地分布在服务器上，并考虑服务器权重。默认情况下使用此方法(没有启用它的指令)</li></ul><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">backend </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># no load balancing method is specified for Round Robin</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend1.example.com;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend2.example.com;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><ul><li>Least Connections - 最少的连接——向服务器发送的请求中活动连接的数量最少，同样要考虑服务器权重:</li></ul><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">backend </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">least_conn;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend1.example.com;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend2.example.com;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><ul><li>IP Hash - 发送请求的服务器是由客户端 IP 地址决定的。在这种情况下，使用 IPv4地址的前三个八位元组或整个 IPv6地址来计算散列值。该方法保证来自相同地址的请求到达相同的服务器，除非它不可用。</li></ul><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">backend </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">ip_hash;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend1.example.com;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend2.example.com;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># 如果某个服务器需要暂时从负载平衡旋转中删除，可以用 down 参数对其进行标记，以便保留当前客户端 IP 地址的散列。由此服务器处理的请求将自动发送到组中的下一个服务器:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend3.example.com down;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><ul><li>Hash - 请求是从用户定义的关键，可以是一个文本字符串，变量，或一个组合确定。例如，密钥可能是一个成对的源 IP 地址和端口，或者是一个 URI，如下例所示:</li></ul><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">backend </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> hash $</span><span style="color:#A6ACCD;">request_uri consistent</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend1.example.com;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend2.example.com;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>Hash 指令的可选的 consistent 参数启用 ketama consistent-hash 负载平衡。根据用户定义的散列键值，请求均匀地分布在所有上游服务器上。如果将上游服务器添加到上游组或从上游组移除，则只需重新映射少量密钥，从而在负载平衡缓存服务器或其他累积状态的应用程序的情况下，最大限度地减少缓存丢失。</p><h3 id="server-weights" tabindex="-1">Server Weights <a class="header-anchor" href="#server-weights" aria-hidden="true">#</a></h3><p>默认情况下，NGINX 使用 Round Robin 方法根据请求的权重在组中的服务器之间分发请求。服务器指令的 weight 参数设置服务器的权重; 默认值是1:</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">backend </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend1.example.com </span><span style="color:#A6ACCD;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  server backend2.example.com;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.0.0.1 backup;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 在本例中， backend1.example.com 服务器的权重为5; 其他两个服务器的默认权重为1，但 IP 地址为192.0.0.1的服务器被标记为备份服务器，除非其他两个服务器都不可用，否则不会接收请求。使用这种权重配置，每6个请求中，5个发送到 backend1.example.com ，1个发送到 backend2.example.com。</span></span>
<span class="line"></span></code></pre></div><h2 id="tcp-and-udp-load-balancing" tabindex="-1">TCP and UDP Load Balancing <a class="header-anchor" href="#tcp-and-udp-load-balancing" aria-hidden="true">#</a></h2><h3 id="配置反向代理" tabindex="-1">配置反向代理 <a class="header-anchor" href="#配置反向代理" aria-hidden="true">#</a></h3><p>首先，您需要配置反向代理，以便 NGINX Open Source 可以将客户机的 TCP 连接或 UDP 数据报转发到upstream组或代理服务器</p><p>打开 NGINX 配置文件并执行以下步骤:</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;"># 创建一个顶级 stream {} 块:</span></span>
<span class="line"><span style="color:#C792EA;">stream</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># 为 stream {}上下文中的每个虚拟服务器定义一个或多个 server {} 配置块</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># 在每个服务器的 server {}配置块中，包含 listen 指令来定义服务器侦听的 IP 地址和/或端口</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># 使用 proxy_ pass 指令来定义被代理的服务器或者服务器转发流量的upstream组</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># TCP 是 stream 上下文的默认协议，所以 listen 指令没有 TCP 参数</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">12345</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#TCP traffic will be forwarded to the &quot;stream_backend&quot; upstream group</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">stream_backend</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># ...</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># 对于 UDP 流量，还包括 UDP 参数</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">53 udp</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#TCP traffic will be forwarded to the specified server</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">backend.example.com:12346</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># ...</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">53</span><span style="color:#A6ACCD;"> udp</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#UDP traffic will be forwarded to the &quot;dns_servers&quot; upstream group</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">dns_servers</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># 如果代理服务器有多个网络接口，您可以选择配置 NGINX，使其在连接到上游服务器时使用特定的源 IP 地址。如果 NGINX 后面的代理服务器配置为接受来自特定 IP 网络或 IP 地址范围的连接，这可能会很有用</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">    127.0.0.1:12345</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">backend.example.com:12345</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># 包括 proxy _ bind 指令和适当网络接口的 IP 地址</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_bind </span><span style="color:#A6ACCD;">127.0.0.1:12345</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># 还可以选择调整两个内存缓冲区的大小，NGINX 可以在这两个缓冲区中放置来自客户端和上游连接的数据。如果数据量很小，可以减少缓冲区，从而节省内存资源。如果存在大量数据，则可以增加缓冲区大小，以减少套接字读/写操作的数量。一旦在一个连接上接收到数据，NGINX 就会读取数据并通过另一个连接将其转发。缓冲区由 proxy _ buffer _ size 指令控制</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_buffer_size </span><span style="color:#A6ACCD;">16k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># ...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="configuring-tcp-or-udp-load-balancing" tabindex="-1">Configuring TCP or UDP Load Balancing <a class="header-anchor" href="#configuring-tcp-or-udp-load-balancing" aria-hidden="true">#</a></h3><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;"># 创建一组服务器，或者一个负载均衡的上游组。在upsteam{}上下文中定义一个或多个upsteam {}配置块，并设置上游组的名称，例如，TCP 服务器的 stream_backend 和 UDP 服务器的 dns_servers</span></span>
<span class="line"><span style="color:#C792EA;">stream</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># 确保 proxy_pass 指令引用了上游组的名称，就像上面为反向代理配置的那些指令一样</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">stream_backend </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># 用上游服务器填充上游组。在上游{}块中，为每个上游服务器添加一个服务器指令，指定它的 IP 地址或主机名(可以解析为多个 IP 地址)和一个必需的端口号。请注意，您没有为每个服务器定义协议，因为这是通过您在服务器块中的 listen 指令上包含的参数为整个上游组定义的，该参数是您前面创建的</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend1.example.com:12345;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend2.example.com:12345;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend3.example.com:12346;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># ...</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dns_servers </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.136.130:53;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.136.131:53;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># ...</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># ...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>配置上游组使用的负载平衡方法:</p><ul><li>Round Robin - 默认情况下，NGINX 使用 Round Robin 算法来平衡负载流量，并将其顺序指向配置的上游组中的服务器</li><li>Least Connections - 最少连接-NGINX 选择当前活动连接数较少的服务器</li><li>Hash - Hash-NGINX 基于用户定义的密钥选择服务器，例如，源 IP 地址($remote_addr)</li><li>Random - 每个连接将被传递到一个随机选择的服务器。如果指定了这个<code>two</code>参数，首先，NGINX 随机选择两个服务器并考虑服务器权重，然后使用指定的方法选择其中一个服务器: <ul><li>least_conn - 活动连接的最少数量</li></ul></li><li>对于每个上游服务器，可以选择指定特定于服务器的参数，包括最大连接数、服务器重量等</li></ul><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">stream_backend </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> hash </span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr consistent</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend1.example.com:12345 </span><span style="color:#A6ACCD;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  server backend2.example.com:12345;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend3.example.com:12346 max_conns=3;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dns_servers </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">least_conn;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.136.130:53;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.136.131:53;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># ...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><ul><li>另一种方法是代理流量到单个服务器，而不是上游组。如果您通过主机名识别服务器，并配置主机名以解析为多个 IP 地址，那么 NGINX 负载使用 Round Robin 算法平衡 IP 地址之间的流量。在这种情况下，您必须在 proxy _ pass 指令中指定服务器端口号，并且不能在 IP 地址或主机名之前指定协议</li></ul><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">stream</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># ...</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">12345</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">backend.example.com:12345</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="example-of-tcp-and-udp-load-balancing-configuration" tabindex="-1">Example of TCP and UDP Load-Balancing Configuration <a class="header-anchor" href="#example-of-tcp-and-udp-load-balancing-configuration" aria-hidden="true">#</a></h3><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">stream</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">stream_backend </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">least_conn;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend1.example.com:12345 </span><span style="color:#A6ACCD;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    server backend2.example.com:12345 </span><span style="color:#A6ACCD;">max_fails</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> fail_timeout=30s;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend3.example.com:12345 max_conns=3;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dns_servers </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">least_conn;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.136.130:53;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.136.131:53;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.136.132:53;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># 服务器监听端口12345，并将所有 TCP 连接代理到上游服务器的 stream _ backend 组。注意，在流模块的上下文中定义的 proxy _ pass 指令不能包含协议</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">       </span><span style="color:#F78C6C;">12345</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">   stream_backend</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_timeout </span><span style="color:#A6ACCD;">3s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_connect_timeout </span><span style="color:#A6ACCD;">1s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># 服务器监听端口53，并将所有 UDP 数据报(listen 指令的 UDP 参数)代理到名为 dns _ servers 的上游组。如果未指定 udp 参数，套接字将侦听 TCP 连接。</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">53</span><span style="color:#A6ACCD;"> udp</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">dns_servers</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># 虚拟服务器监听端口12346并将 TCP 连接代理到 backend4.example.com 服务器，该服务器可以解析几个 IP 地址，这些 IP 地址通过 Round Robin 方法实现负载平衡</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">12346</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">backend4.example.com:12346</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="http-health-checks" tabindex="-1">HTTP Health Checks <a class="header-anchor" href="#http-health-checks" aria-hidden="true">#</a></h2><h3 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-hidden="true">#</a></h3><p>NGINX 可以不断地测试上游服务器，避免出现故障的服务器，并优雅地将恢复的服务器添加到负载平衡组中。</p><h3 id="passive-health-checks（被动健康检查）" tabindex="-1">Passive Health Checks（被动健康检查） <a class="header-anchor" href="#passive-health-checks（被动健康检查）" aria-hidden="true">#</a></h3><p>对于被动健康检查，NGINX 会在事务发生时进行监视，并尝试恢复失败的连接。如果事务仍然不能恢复，NGINX 开放源码将服务器标记为不可用，并暂时停止向它发送请求，直到它再次被标记为活动</p><ul><li>fail_timeout - 设置服务器被标记为不可用的时间，以及服务器被标记为不可用的时间(默认为10秒)</li><li>max_fails - 服务器被标记为不可用(默认为1次尝试)</li></ul><p>在下面的例子中，如果 NGINX 无法向服务器发送请求，或者在30秒内3次没有收到服务器的响应，它将服务器标记为30秒内不可用:</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">backend </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend1.example.com;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend2.example.com </span><span style="color:#A6ACCD;">max_fails</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> fail_timeout=30s;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>最近恢复的服务器很容易被连接压垮，这可能导致服务器再次被标记为不可用。缓慢启动允许上游服务器逐渐恢复其重量从零到其名义值后，它已恢复或成为可用。这可以通过上游服务器指令的 slow _ start 参数来完成</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">backend </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend1.example.com </span><span style="color:#A6ACCD;">slow_start</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">30s</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  server backend2.example.com;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.0.0.1 backup;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">提醒</p><p>注意，如果组中只有一个服务器，fail_timeout 和 max_fails 参数将被忽略，服务器永远不会被标记为不可用。</p></div><h3 id="tcp-health-checks" tabindex="-1">TCP Health Checks <a class="header-anchor" href="#tcp-health-checks" aria-hidden="true">#</a></h3><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">stream</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">stream_backend </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend1.example.com:12345 </span><span style="color:#A6ACCD;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    server backend2.example.com:12345 </span><span style="color:#A6ACCD;">max_fails</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> fail_timeout=30s;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> backend3.example.com:12345 max_conns=3;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">12345</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">stream_backend</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="udp-health-checks" tabindex="-1">UDP Health Checks <a class="header-anchor" href="#udp-health-checks" aria-hidden="true">#</a></h3><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">stream</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dns_upstream </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 192.168.136.130:53 </span><span style="color:#A6ACCD;">fail_timeout</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">60s</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    server 192.168.136.131:53 </span><span style="color:#A6ACCD;">fail_timeout</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">60s</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    server 192.168.136.132:53 </span><span style="color:#A6ACCD;">fail_timeout</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">60s</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">  server {</span></span>
<span class="line"><span style="color:#A6ACCD;">    listen          </span><span style="color:#F78C6C;">53</span><span style="color:#A6ACCD;"> udp;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">     dns_upstream</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_timeout </span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">1s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_responses </span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">      logs/dns.log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="web-server" tabindex="-1">Web Server <a class="header-anchor" href="#web-server" aria-hidden="true">#</a></h2><h3 id="setting-up-virtual-servers" tabindex="-1">Setting Up Virtual Servers <a class="header-anchor" href="#setting-up-virtual-servers" aria-hidden="true">#</a></h3><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">http</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># 服务器配置块通常包括一个 listen 指令，用于指定服务器侦听请求的 IP 地址和端口(或 Unix domain socket 和路径)。IPv4和 IPv6地址均可接受，请将 IPv6地址放在方括号内</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">127.0.0.1:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># Additional server configuration</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>如果忽略某个端口，则使用标准端口。同样，如果省略了一个地址，服务器将侦听所有地址。如果未包含 listen 指令，“标准”端口为80/tcp，“缺省”端口为8000/tcp，具体取决于超级用户权限。</p><p>如果有多个服务器与请求的 IP 地址和端口匹配，NGINX 将在服务器块中根据 server_name 指令测试请求的 Host 头字段。Server_name 的参数可以是完整的(精确的)名称、通配符或正则表达式。通配符是一个字符串，其开头、结尾或两者都包含星号(*) ; 星号匹配任何字符序列。NGINX Plus 对正则表达式使用 Perl 语法; 在它们之前加上波浪号(~)。这个例子说明了一个确切的名称。</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">     </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">example.org www.example.org</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>如果 Host header 字段与服务器名称不匹配，NGINX Plus 将请求路由到请求到达的端口的默认服务器。缺省服务器是 nginx.conf 文件中列出的第一个服务器，除非在 listen 指令中包含 default _ server 参数，以显式地将服务器指定为缺省服务器。</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">80</span><span style="color:#89DDFF;"> default_server;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="configuring-locations" tabindex="-1">Configuring Locations <a class="header-anchor" href="#configuring-locations" aria-hidden="true">#</a></h3><p>Location 指令有两种类型的参数: 前缀字符串(路径名)和正则表达式。要使请求 URI 匹配前缀字符串，它必须以前缀字符串开头。</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;"># 以下带有路径名参数的示例位置匹配以/some/path/开头的请求 uri，如/some/path/document. html。(它不匹配/my-site/some/path，因为/some/path 不会出现在 URI 的开头。)</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/some/path/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 正则表达式前面带有用于区分大小写匹配的波浪号(~) ，或者用于不区分大小写匹配的波浪号星号(~*)。下面的示例匹配包含字符串的 uri的 .html 或 .htm在任何位置。</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\.html? </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># = 修饰符的典型用例是对/(正斜杠)的请求。如果频繁地请求/，则将 =/指定为 location 指令的参数可以加快处理速度，因为在第一次比较之后将停止搜索匹配项。</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># location上下文可以包含定义如何解析请求的指令——服务于静态文件或将请求传递给代理服务器。在下面的示例中，匹配第一个location上下文的请求是来自/data 目录的服务文件，匹配第二个location上下文的请求被传递给承载 www.example. com 域内容的代理服务器。</span></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/images/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/data</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://www.example.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#676E95;"># root 指令指定用于搜索要服务的静态文件的文件系统路径。</span></span>
<span class="line"><span style="color:#676E95;"># 在上面的示例中，所有以/images/开头的 uri 请求都被传递到代理服务器</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 有些网站 uri 要求立即返回带有特定错误的响应或重定向代码，例如当页面被临时或永久移动时。最简单的方法是使用 return 指令</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/wrong/url </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">404</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 返回的第一个参数是响应代码。可选的第二个参数可以是重定向(代码301、302、303和307)的 URL，也可以是在响应主体中返回的文本</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/permanently/moved/url </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">301</span><span style="color:#A6ACCD;"> http://www.example.com/moved/here;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 在请求处理期间，可以通过使用 rewrite 指令多次修改请求 URI，该指令有一个可选参数和两个必需参数。第一个(必需的)参数是请求 URI 必须匹配的正则表达式。第二个参数是用于替换匹配 URI 的 URI。可选的第三个参数是一个标志，它可以停止进一步重写指令的处理，或者发送重定向(代码301或302)</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/users/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^/users/(.*)$</span><span style="color:#A6ACCD;"> /show?user=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1 </span><span style="color:#F78C6C;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 下面的示例显示重写指令与 return 指令的组合</span></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^(/download/.*)/media/(\w+)\.?.*$</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1/mp3/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">2.mp3</span><span style="color:#89DDFF;"> last;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">rewrite</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">^(/download/.*)/audio/(\w+)\.?.*$</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1/mp3/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">2.ra </span><span style="color:#89DDFF;"> last;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">403</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#676E95;"># break——像break指令一样，停止当前上下文中对重写指令的处理，并取消对匹配新URI位置的搜索。不执行新位置中的重写指令。</span></span>
<span class="line"><span style="color:#676E95;"># last——停止当前服务器或位置上下文中重写指令的执行，但是NGINX Plus搜索与重写的URI匹配的位置，并且应用新位置中的任何重写指令(意味着URI可以再次更改)。</span></span>
<span class="line"></span></code></pre></div><h3 id="rewriting-http-responses" tabindex="-1">Rewriting HTTP Responses <a class="header-anchor" href="#rewriting-http-responses" aria-hidden="true">#</a></h3><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;"># 可以更改引用代理以外的服务器的绝对链接:</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> sub_filter </span><span style="color:#A6ACCD;">     /blog/ /blog-staging/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> sub_filter_once </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 另一个示例将方案从 http://更改为 https://，并将本地主机地址替换为请求头字段中的主机名。子过滤器 once 指令告诉 NGINX 在一个位置内连续应用子过滤器指令</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> sub_filter </span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">&#39;href=&quot;http://127.0.0.1:8080/&#39;</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">&#39;href=&quot;https://</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">host</span><span style="color:#C3E88D;">/&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> sub_filter </span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">&#39;img src=&quot;http://127.0.0.1:8080/&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&#39;img src=&quot;https://</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">host</span><span style="color:#C3E88D;">/&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> sub_filter_once </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="handling-errors" tabindex="-1">Handling Errors <a class="header-anchor" href="#handling-errors" aria-hidden="true">#</a></h3><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;"># error _ page 指定要返回的页面(/404. html)和404错误代码。</span></span>
<span class="line"><span style="color:#89DDFF;">error_page </span><span style="color:#A6ACCD;">404 /404.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 在下面的例子中，当 NGINX Plus 找不到一个页面时，它用代码301代替代码404，并将客户端重定向到 http:/example.com/new/path.html。当客户机仍然试图访问旧 URI 上的页面时，此配置非常有用。301代码告诉浏览器页面已经永久移动，并且需要在返回时自动用新地址替换旧地址。</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/old/path.html </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_page </span><span style="color:#A6ACCD;">404 </span><span style="color:#F78C6C;">=301</span><span style="color:#A6ACCD;"> http:/example.com/new/path.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 下面的配置是在找不到文件时向后端传递请求的示例。因为在 error _ page 指令的等号后面没有指定状态代码，所以对客户端的响应包含由代理服务器返回的状态代码(不一定是404)</span></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  ...</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/images/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># Set the root directory to search for the file</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/data/www</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># Disable logging of errors related to file existence</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> open_file_cache_errors </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># Make an internal redirect if the file is not found</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> error_page </span><span style="color:#A6ACCD;">404 = /fetch</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/fetch/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://backend/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="root-directory-and-index-files-根目录和索引文件" tabindex="-1">Root Directory and Index Files(根目录和索引文件) <a class="header-anchor" href="#root-directory-and-index-files-根目录和索引文件" aria-hidden="true">#</a></h3><p><code>root</code>指令指定用于搜索文件的根目录，该指令可以放置在 <code>http {}</code>、<code>server {}</code>或 <code>location {}</code>上下文中的任何级别上</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;"># 在这里，NGINX 在文件系统中的/www/data/images/目录中搜索以/images/开头的 URI。但是如果 URI 以.Mp3或.Mp4扩展名，NGINX 将在/www/media/目录中搜索文件，因为它是在匹配的位置块中定义的。</span></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/www/data</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/data</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># 按照指定的顺序搜索文件并返回它找到的第一个文件</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># 这里使用的 $geo 变量是通过 geo 指令设置的自定义变量。变量的值取决于客户端的 IP 地址。</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> index </span><span style="color:#A6ACCD;">index.</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">geo.html index.htm index.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/images/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># 返回一个自动生成的目录列表</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> autoindex </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\.(mp3|mp4) </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/www/media</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># 在这里，如果请求中的 URI 为/path/，并且/data/path/index. html 不存在，但是/data/path/index.php 存在，则内部重定向到/path/index.php 将映射到第二个位置。因此，请求被代理。</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\.php </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> fastcgi_pass </span><span style="color:#A6ACCD;">localhost:8000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="trying-several-options-尝试几种选择" tabindex="-1">Trying Several Options (尝试几种选择) <a class="header-anchor" href="#trying-several-options-尝试几种选择" aria-hidden="true">#</a></h3><p>可以使用 <code>try_files</code> 指令检查指定的文件或目录是否存在; 如果存在，NGINX 将进行内部重定向; 如果不存在，则返回指定的状态代码。</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/www/data</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># 最后一个参数也可以是状态码(前面直接有等号)或位置的名称。在下面的示例中，如果 try _ files 指令的所有参数都没有解析为现有文件或目录，则返回404错误。</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> try_files $</span><span style="color:#A6ACCD;">uri </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri/ </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri.html </span><span style="color:#F78C6C;">=404</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># 该文件以 URI 的形式指定，使用当前位置或虚拟服务器上下文中设置的根指令或别名指令处理该文件。在这种情况下，如果与原始 URI 对应的文件不存在，NGINX 将内部重定向到最后一个参数指定的 URI，返回/www/data/images/default.gif。</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/images/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> try_files $</span><span style="color:#A6ACCD;">uri /images/default.gif</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>如果原始 URI 和带有斜杠解析符的 URI 都没有被引导到现有的文件或目录中，那么请求就会被重定向到指定的位置，然后被传递到一个代理服务器。</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> try_files $</span><span style="color:#A6ACCD;">uri </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">uri/ @backend</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">@backend </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://backend.example.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="passing-request-headers" tabindex="-1">Passing Request Headers <a class="header-anchor" href="#passing-request-headers" aria-hidden="true">#</a></h3><p>默认情况下，NGINX 在代理请求中重新定义两个头字段，“ Host”和“ Connection”，并消除值为空字符串的头字段。“ Host”设置为 $proxy _ Host 变量，“ Connection”设置为 close。</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/some/path/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># 在这种配置中，“ Host”字段设置为 $Host 变量。</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Host </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Real-IP </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://localhost:8000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 为了防止头字段被传递给代理服务器，将其设置为空字符串，如下所示:</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/some/path/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Accept-Encoding </span><span style="color:#C3E88D;">&quot;&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://localhost:8000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="configuring-buffers-配置缓冲区" tabindex="-1">Configuring Buffers(配置缓冲区) <a class="header-anchor" href="#configuring-buffers-配置缓冲区" aria-hidden="true">#</a></h3><p>默认情况下，NGINX 缓冲区响应来自代理服务器。响应存储在内部缓冲区中，在收到整个响应之前不会发送到客户机。缓冲区有助于优化缓慢客户机的性能，如果响应同步地从 NGINX 传递到客户机，则会浪费代理服务器的时间。然而，当缓冲启用 NGINX 时，代理服务器可以快速处理响应，而 NGINX 将响应存储的时间与客户端下载响应所需的时间一样长。</p><p>负责启用和禁用缓冲的指令是 proxy _ buffering。默认情况下，它设置为 on 并启用缓冲。</p><p><code>Proxy_buffers</code> 指令控制为请求分配的缓冲区的数量和大小。来自代理服务器的响应的第一部分存储在一个单独的缓冲区中，其大小由 <code>proxy_buffer_size</code> 指令设置。</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;"># 在下面的示例中，增加了缓冲区的默认数量，并且响应的第一部分的缓冲区的大小小于默认值。</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/some/path/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_buffers </span><span style="color:#A6ACCD;">16 </span><span style="color:#F78C6C;">4k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_buffer_size </span><span style="color:#A6ACCD;">2k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://localhost:8000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 若要在特定位置禁用缓冲，请将 proxy _ buffering 指令放在带有 off 参数的位置，如下所示:</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/some/path/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_buffering </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://localhost:8000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="choosing-an-outgoing-ip-address-选择传出-ip-地址" tabindex="-1">Choosing an Outgoing IP Address(选择传出 IP 地址) <a class="header-anchor" href="#choosing-an-outgoing-ip-address-选择传出-ip-地址" aria-hidden="true">#</a></h3><p>如果您的代理服务器有多个网络接口，有时您可能需要选择一个特定的源 IP 地址来连接到代理服务器或上行服务器。如果 NGINX 后面的代理服务器配置为接受来自特定 IP 网络或 IP 地址范围的连接，这可能会很有用。</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;"># 指定 proxy _ bind 指令和必要网络接口的 IP 地址:</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/app1/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_bind </span><span style="color:#A6ACCD;">127.0.0.1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://example.com/app1/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/app2/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_bind </span><span style="color:#A6ACCD;">127.0.0.2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://example.com/app2/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 还可以用变量指定 IP 地址。例如，$server _ addr 变量传递接受请求的网络接口的 IP 地址:</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/app3/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_bind $</span><span style="color:#A6ACCD;">server_addr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;">http://example.com/app3/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="enabling-compression-启用压缩功能" tabindex="-1">Enabling Compression(启用压缩功能) <a class="header-anchor" href="#enabling-compression-启用压缩功能" aria-hidden="true">#</a></h3><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">gzip </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 默认情况下，NGINX 只使用 text/html 的 MIME 类型压缩响应。要使用其他 MIME 类型压缩响应，请包含 gzip _ types 指令并列出其他类型。</span></span>
<span class="line"><span style="color:#89DDFF;">gzip_types </span><span style="color:#A6ACCD;">text/plain application/xml</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 若要指定要压缩的响应的最小长度，请使用 gzip _ min _ length 指令。默认值是20字节(这里调整为1000) :</span></span>
<span class="line"><span style="color:#89DDFF;">gzip_min_length </span><span style="color:#A6ACCD;">1000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>默认情况下，NGINX 不压缩对代理请求(来自代理服务器的请求)的响应。请求来自代理服务器的事实取决于请求中 <code>Via</code> 头字段的存在。要配置这些响应的压缩，请使用 <code>gzip_proxied</code> 指令。该指令有许多参数指定 NGINX 应该压缩哪些类型的代理请求。例如，只对不会在代理服务器上缓存的请求压缩响应是合理的。为此，<code>gzip_proxied</code> 指令具有一些参数，这些参数指示 NGINX 在响应中检查 <code>Cache-Control</code> 头字段，如果值为无缓存、无存储或私有，则压缩该响应。此外，必须包含过期参数才能检查 <code>Expires</code> 头字段的值。这些参数在下面的示例中设置，以及 <code>auth</code> 参数，该参数检查 <code>Authorization header</code> 字段的存在(授权响应特定于最终用户，通常不会被缓存) :</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">gzip_proxied </span><span style="color:#A6ACCD;">no-cache no-store private expired auth</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>与大多数其他指令一样，用于配置压缩的指令可以包含在 <code>http</code> 上下文中，也可以包含在<code>server</code>或<code>location</code>配置块中。</p><h3 id="enabling-decompression-启用解压缩" tabindex="-1">Enabling Decompression(启用解压缩) <a class="header-anchor" href="#enabling-decompression-启用解压缩" aria-hidden="true">#</a></h3><p>有些客户端不支持 gzip 编码方法的响应。同时，可能希望存储压缩数据，或动态压缩响应并将其存储在缓存中。为了成功地为接受压缩数据和不接受压缩数据的客户机提供服务，NGINX 可以在将数据发送到后一种类型的客户机时动态地对数据进行解压缩。</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/storage/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gunzip </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_min_length </span><span style="color:#A6ACCD;">1000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gunzip </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  ...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意</p><p>请注意，这个指令是在一个单独的模块中定义的，默认情况下 NGINX 开放源码构建中可能不包含这个模块。</p></div><h2 id="security-controls" tabindex="-1">Security Controls <a class="header-anchor" href="#security-controls" aria-hidden="true">#</a></h2><h3 id="setting-up-an-https-server" tabindex="-1">Setting up an HTTPS Server <a class="header-anchor" href="#setting-up-an-https-server" aria-hidden="true">#</a></h3><p>要建立一个 HTTPS 服务器，在 nginx.conf 文件中包含服务器块中 listen 指令的 ssl 参数，然后指定服务器证书和私钥文件的位置:</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">             </span><span style="color:#F78C6C;">443</span><span style="color:#A6ACCD;"> ssl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">        www.example.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_certificate </span><span style="color:#A6ACCD;">    www.example.com.crt</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_certificate_key </span><span style="color:#A6ACCD;">www.example.com.key</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_protocols </span><span style="color:#A6ACCD;">      TLSv1 TLSv1.1 TLSv1.2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_ciphers </span><span style="color:#A6ACCD;">        HIGH:!aNULL:!MD5</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#使用 ssl_protocols和 ssl_ciphers指令要求客户端在建立连接时只使用 SSL/TLS 的强版本和加密器。</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="ocsp-validation-of-client-certificates-客户端证书的-ocsp-验证" tabindex="-1">OCSP Validation of Client Certificates(客户端证书的 OCSP 验证) <a class="header-anchor" href="#ocsp-validation-of-client-certificates-客户端证书的-ocsp-验证" aria-hidden="true">#</a></h3><p>NGINX 可以配置为使用联机证书状态协议(Online Certificate Status Protocol，OCSP)来检查呈现的 x. 509客户机证书的有效性。一个关于客户端证书状态的 OCSP 请求被发送到一个 OCSP 响应器，该响应器检查证书的有效性并返回带有证书状态的响应:</p><ul><li><code>Good</code> - the certificate is not revoked - 证书不会被撤销</li><li><code>Revoked</code> - the certificate is revoked - 证书被撤销</li><li><code>Unknown</code> - no information is available about the client certificate - 没有有关客户端证书的资料</li></ul><p>要启用 SSL 客户端证书的 OCSP 验证，请指定 <code>SSL_OCSP</code> 指令以及 <code>SSL_verify_client</code> 指令，这将启用证书验证:</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">443 ssl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_certificate </span><span style="color:#A6ACCD;">    /etc/ssl/foo.example.com.crt</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_certificate_key </span><span style="color:#A6ACCD;">/etc/ssl/foo.example.com.key</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_verify_client </span><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;"> on;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_trusted_certificate </span><span style="color:#A6ACCD;">/etc/ssl/cachain.pem</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_ocsp </span><span style="color:#A6ACCD;">              </span><span style="color:#89DDFF;"> on;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># Enable OCSP validation</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="https-server-optimization-服务器优化" tabindex="-1">HTTPS Server Optimization(服务器优化) <a class="header-anchor" href="#https-server-optimization-服务器优化" aria-hidden="true">#</a></h3><p>会话存储在工作进程之间共享的 SSL 会话缓存中，并由 <code>SSL_session_cache</code> 指令进行配置。一兆字节的高速缓存包含大约4000个会话。默认的缓存超时时间为5分钟。这个超时可以使用 <code>ssl_session_timeout</code> 指令来增加。下面是一个为10mb 共享会话缓存的多核系统优化的示例配置:</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">worker_processes </span><span style="color:#A6ACCD;">auto</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">http</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_session_cache </span><span style="color:#A6ACCD;">  shared:SSL:10m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_session_timeout </span><span style="color:#A6ACCD;">10m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">             </span><span style="color:#F78C6C;">443</span><span style="color:#A6ACCD;"> ssl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">        www.example.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> keepalive_timeout </span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">70</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_certificate </span><span style="color:#A6ACCD;">    www.example.com.crt</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_certificate_key </span><span style="color:#A6ACCD;">www.example.com.key</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_protocols </span><span style="color:#A6ACCD;">      TLSv1 TLSv1.1 TLSv1.2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssl_ciphers </span><span style="color:#A6ACCD;">        HIGH:!aNULL:!MD5</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="ssl-certificate-chains-ssl-证书链" tabindex="-1">SSL Certificate Chains(SSL 证书链) <a class="header-anchor" href="#ssl-certificate-chains-ssl-证书链" aria-hidden="true">#</a></h3><p>有些浏览器可能会抱怨由知名证书颁发机构签署的证书，而其他浏览器则可能毫无问题地接受该证书。发生这种情况的原因是，发出证书的机构已经使用中间证书对服务器证书进行了签名，而中间证书并不存在于众所周知的可信证书机构的基础中，这些可信证书机构分布在特定的浏览器中。在这种情况下，中心提供了一个链接证书包，它应该连接到签名的服务器证书。服务器证书必须出现在合并文件中的链接证书之前:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">cat www.example.com.crt bundle.crt </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> www.example.com.chained.crt</span></span>
<span class="line"></span></code></pre></div><p>结果文件应该在 <code>ssl_certificate</code> 指令中使用:</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">             </span><span style="color:#F78C6C;">443</span><span style="color:#A6ACCD;"> ssl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">        www.example.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_certificate </span><span style="color:#A6ACCD;">    www.example.com.chained.crt</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_certificate_key </span><span style="color:#A6ACCD;">www.example.com.key</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>浏览器通常存储它们接收并由受信任的授权机构签名的中间证书。因此，主动使用的浏览器可能已经具有所需的中间证书，并且可能不会抱怨发送的证书没有链接包。为了确保服务器发送完整的证书链，可以使用 openssl 命令行工具:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">openssl s_client -connect www.godaddy.com:443</span></span>
<span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">Certificate chain</span></span>
<span class="line"><span style="color:#A6ACCD;"> 0 s:/C=US/ST=Arizona/L=Scottsdale/1.3.6.1.4.1.311.60.2.1.3=US</span></span>
<span class="line"><span style="color:#A6ACCD;">     /1.3.6.1.4.1.311.60.2.1.2=AZ/O=GoDaddy.com, Inc</span></span>
<span class="line"><span style="color:#A6ACCD;">     /OU=MIS Department/CN=www.GoDaddy.com</span></span>
<span class="line"><span style="color:#A6ACCD;">     /serialNumber=0796928-7/2.5.4.15=V1.0, Clause 5.</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   i:/C=US/ST=Arizona/L=Scottsdale/O=GoDaddy.com, Inc.</span></span>
<span class="line"><span style="color:#A6ACCD;">     /OU=http://certificates.godaddy.com/repository</span></span>
<span class="line"><span style="color:#A6ACCD;">     /CN=Go Daddy Secure Certification Authority</span></span>
<span class="line"><span style="color:#A6ACCD;">     /serialNumber=07969287</span></span>
<span class="line"><span style="color:#A6ACCD;"> 1 s:/C=US/ST=Arizona/L=Scottsdale/O=GoDaddy.com, Inc.</span></span>
<span class="line"><span style="color:#A6ACCD;">     /OU=http://certificates.godaddy.com/repository</span></span>
<span class="line"><span style="color:#A6ACCD;">     /CN=Go Daddy Secure Certification Authority</span></span>
<span class="line"><span style="color:#A6ACCD;">     /serialNumber=07969287</span></span>
<span class="line"><span style="color:#A6ACCD;">   i:/C=US/O=The Go Daddy Group, Inc.</span></span>
<span class="line"><span style="color:#A6ACCD;">     /OU=Go Daddy Class 2 Certification Authority</span></span>
<span class="line"><span style="color:#A6ACCD;"> 2 s:/C=US/O=The Go Daddy Group, Inc.</span></span>
<span class="line"><span style="color:#A6ACCD;">     /OU=Go Daddy Class 2 Certification Authority</span></span>
<span class="line"><span style="color:#A6ACCD;">   i:/L=ValiCert Validation Network/O=ValiCert, Inc.</span></span>
<span class="line"><span style="color:#A6ACCD;">     /OU=ValiCert Class 2 Policy Validation Authority</span></span>
<span class="line"><span style="color:#A6ACCD;">     /CN=http://www.valicert.com//emailAddress=info@valicert.com</span></span>
<span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"></span></code></pre></div><p>在这个示例中，www.godaddy. com 服务器证书 # 0的主题(“ s”)由发行者(“ i”)签名，而发行者本身就是证书 # 1的主题。Certificate # 1由发行人签署，发行人本身也是 Certificate # 2的主体。但是，这个证书是由著名的颁发者 ValiCert，inc. 签署的，该公司的证书存储在浏览器本身中。</p><h3 id="a-single-http-https-server" tabindex="-1">A Single HTTP/HTTPS Server <a class="header-anchor" href="#a-single-http-https-server" aria-hidden="true">#</a></h3><p>通过在同一个虚拟服务器中放置一个带 ssl 参数的 listen 指令和一个不带 ssl 参数的 listen 指令，可以配置一个同时处理 HTTP 和 HTTPS 请求的服务器:</p><div class="language-nginx"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">             </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">             </span><span style="color:#F78C6C;">443</span><span style="color:#A6ACCD;"> ssl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">        www.example.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_certificate </span><span style="color:#A6ACCD;">    www.example.com.crt</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> ssl_certificate_key </span><span style="color:#A6ACCD;">www.example.com.key</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p><a href="https://github.com/digitalocean/nginxconfig.io" target="_blank" rel="noreferrer">可视化配置 nginx 提供了多个基础模板</a></p><div class="warning custom-block"><p class="custom-block-title">提示</p><p>上述内容过程在<a href="https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/" target="_blank" rel="noreferrer"><strong><u>Nginx文档官网</u></strong></a>可查看。更多内容请看<a href="http://nginx.org/en/" target="_blank" rel="noreferrer"><strong><u>Nginx官网</u></strong></a></p></div></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-2b65cce9 data-v-3c38fa48><div class="edit-info" data-v-3c38fa48><div class="edit-link" data-v-3c38fa48><a class="VPLink link edit-link-button" href="https://github.com/QiYoe/c-blog/edit/master/code/front-end/linux/nginx.md" target="_blank" rel="noreferrer" data-v-3c38fa48 data-v-6b1661fb><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" data-v-3c38fa48><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> 在 GitHub 上编辑此页<!--]--><!----></a></div><div class="last-updated" data-v-3c38fa48><p class="VPLastUpdated" data-v-3c38fa48 data-v-19756385>最新更新时间: <time datatime="2022-09-01T09:42:35.000Z" data-v-19756385></time></p></div></div><div class="prev-next" data-v-3c38fa48><div class="pager" data-v-3c38fa48><a class="pager-link prev" href="/code/front-end/linux/" data-v-3c38fa48><span class="desc" data-v-3c38fa48>上一页</span><span class="title" data-v-3c38fa48>Linux启动Nginx服务</span></a></div><div class="has-prev pager" data-v-3c38fa48><a class="pager-link next" href="/code/front-end/linux/docker.html" data-v-3c38fa48><span class="desc" data-v-3c38fa48>下一页</span><span class="title" data-v-3c38fa48>Docker</span></a></div></div></footer><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-a8edf159 data-v-0797d3dd><div class="container" data-v-0797d3dd><p class="message" data-v-0797d3dd>根据 MIT 许可证发布。</p><p class="copyright" data-v-0797d3dd>Copyright © 2022-present QiYoe</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"readme.md\":\"534b5360\",\"book_front-end_css-tricks.md\":\"db4aefc0\",\"book_front-end_docker-practice.md\":\"0517fa41\",\"book_front-end_everything-curl.md\":\"59e6e4b1\",\"book_front-end_grokking-algorithms.md\":\"09e81aa2\",\"book_front-end_js-advice.md\":\"b4b00a6f\",\"book_front-end_pro-git.md\":\"ba06e970\",\"book_front-end_typescript-deep-dive.md\":\"40450f3e\",\"book_front-end_typescript-tutorial.md\":\"b8be3cbf\",\"book_front-end_you-dont-know-js.md\":\"64c673ee\",\"book_quotations.md\":\"0cc2e514\",\"code_algorithm_leetcode.md\":\"73967810\",\"code_algorithm_lodash.md\":\"bf26edd2\",\"code_cesium_clb.md\":\"139eff1e\",\"code_cesium_examples_3dtiles.md\":\"58e54c2e\",\"code_cesium_examples_3dtilesnext.md\":\"589dae3e\",\"code_cesium_examples_beginner.md\":\"eedaba22\",\"code_cesium_examples_czml.md\":\"253f19e0\",\"code_cesium_examples_datasources.md\":\"a7190857\",\"code_cesium_examples_geometries.md\":\"5d1a2acc\",\"code_cesium_examples_imageryprovider.md\":\"feab5864\",\"code_cesium_examples_ionassets.md\":\"84e47ef6\",\"code_cesium_examples_newin1.91.md\":\"e5feefd6\",\"code_cesium_examples_postprocessing.md\":\"02811dd2\",\"code_cesium_examples_tutorials.md\":\"ef862a46\",\"code_devops_jira.md\":\"fddfdf14\",\"code_front-end_ast_index.md\":\"21fca3ca\",\"code_front-end_ast_the-super-tiny-compiler.md\":\"746d99fb\",\"code_front-end_blog-build_aliyun-domin.md\":\"578f4193\",\"code_front-end_blog-build_baidu-include.md\":\"4a2b3c7f\",\"code_front-end_blog-build_index.md\":\"09aed29a\",\"code_front-end_blog-build_seo-optimize.md\":\"cdf7a5f1\",\"code_front-end_css_index.md\":\"f81594e8\",\"code_front-end_css_sass.md\":\"730b32cf\",\"code_front-end_css_tailwind.md\":\"82da8d13\",\"code_front-end_git_advance.md\":\"f914d6c8\",\"code_front-end_git_flight-rules.md\":\"68d39457\",\"code_front-end_git_index.md\":\"a36545ea\",\"code_front-end_lint_commitizen.md\":\"372c7311\",\"code_front-end_lint_commitlint.md\":\"9128d548\",\"code_front-end_lint_husky.md\":\"9e768a79\",\"code_front-end_lint_index.md\":\"c394a008\",\"code_front-end_lint_lint-staged.md\":\"5168a985\",\"code_front-end_linux_docker.md\":\"5b9a3a78\",\"code_front-end_linux_index.md\":\"4c3aa3a4\",\"code_front-end_linux_jenkins.md\":\"2b07b792\",\"code_front-end_linux_kubernetes.md\":\"21f17b1f\",\"code_front-end_linux_nginx.md\":\"c17b0251\",\"code_front-end_swagger-hub_curl.md\":\"151196ce\",\"code_front-end_swagger-hub_index.md\":\"b5a4b31e\",\"code_front-end_vue_axios.md\":\"7b114661\",\"code_front-end_vue_index.md\":\"14b2d9ae\",\"code_front-end_vue_nuxt.md\":\"b97cd114\",\"code_front-end_vue_typescript.md\":\"0d265bd9\",\"code_front-end_vue_vite.md\":\"0c4c6570\",\"code_front-end_vue_vue-router.md\":\"f4c9a240\",\"code_front-end_web-container_index.md\":\"6d3e27d0\",\"code_front-end_websocket_index.md\":\"802be973\",\"code_other_30-seconds-of-code.md\":\"95215a72\",\"code_other_computer-tech.md\":\"ce0f405b\",\"code_other_smart-tools.md\":\"9c8f8949\",\"code_other_vanillawebprojects.md\":\"c1ada06d\",\"index.md\":\"b22f3f59\",\"money_index.md\":\"c8140da9\",\"video_index.md\":\"bf5fe5ca\"}")</script>
    <script type="module" async src="/assets/app.3e2fef08.js"></script>
    
  </body>
</html>