---
title: æ·±å…¥ç†è§£ TypeScript
head:
  - - meta
    - name: description
      content: TypeScript æ·±å…¥ç†è§£ TS
  - - meta
    - name: keywords
      content: TypeScript æ·±å…¥ç†è§£ TS
---

## TypeScript é¡¹ç›®

### ç¼–è¯‘ä¸Šä¸‹æ–‡

ç¼–è¯‘ä¸Šä¸‹æ–‡ç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒèŠ±å“¨çš„æœ¯è¯­ï¼Œå¯ä»¥ç”¨å®ƒæ¥ç»™æ–‡ä»¶åˆ†ç»„ï¼Œå‘Šè¯‰ TypeScript å“ªäº›æ–‡ä»¶æ˜¯æœ‰æ•ˆçš„ï¼Œå“ªäº›æ˜¯æ— æ•ˆçš„ã€‚é™¤äº†æœ‰æ•ˆæ–‡ä»¶æ‰€æºå¸¦ä¿¡æ¯å¤–ï¼Œç¼–è¯‘ä¸Šä¸‹æ–‡è¿˜åŒ…å«æœ‰æ­£åœ¨è¢«ä½¿ç”¨çš„ç¼–è¯‘é€‰é¡¹çš„ä¿¡æ¯ã€‚å®šä¹‰è¿™ç§é€»è¾‘åˆ†ç»„ï¼Œä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨ `tsconfig.json` æ–‡ä»¶ã€‚

#### tsconfig.json

##### åŸºç¡€

å¼€å§‹ä½¿ç”¨ `tsconfig.json` æ˜¯ä¸€ä»¶æ¯”è¾ƒå®¹æ˜“çš„äº‹ï¼Œä½ ä»…ä»…éœ€è¦å†™ä¸‹ï¼š
```json
{}
```

ä¾‹å¦‚ï¼Œåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç©º JSON æ–‡ä»¶ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒTypeScript å°† ä¼šæŠŠæ­¤ç›®å½•å’Œå­ç›®å½•ä¸‹çš„æ‰€æœ‰ .ts æ–‡ä»¶ä½œä¸ºç¼–è¯‘ä¸Šä¸‹æ–‡çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒè¿˜ä¼šåŒ…å«ä¸€éƒ¨åˆ†é»˜è®¤çš„ç¼–è¯‘é€‰é¡¹ã€‚

##### ç¼–è¯‘é€‰é¡¹

ä½ å¯ä»¥é€šè¿‡ `compilerOptions` æ¥å®šåˆ¶ä½ çš„ç¼–è¯‘é€‰é¡¹ï¼š
```json
{
  "compilerOptions": {

    /* åŸºæœ¬é€‰é¡¹ */
    "target": "es5",                       // æŒ‡å®š ECMAScript ç›®æ ‡ç‰ˆæœ¬: 'ES3' (default), 'ES5', 'ES6'/'ES2015', 'ES2016', 'ES2017', or 'ESNEXT'
    "module": "commonjs",                  // æŒ‡å®šä½¿ç”¨æ¨¡å—: 'commonjs', 'amd', 'system', 'umd' or 'es2015'
    "lib": [],                             // æŒ‡å®šè¦åŒ…å«åœ¨ç¼–è¯‘ä¸­çš„åº“æ–‡ä»¶
    "allowJs": true,                       // å…è®¸ç¼–è¯‘ javascript æ–‡ä»¶
    "checkJs": true,                       // æŠ¥å‘Š javascript æ–‡ä»¶ä¸­çš„é”™è¯¯
    "jsx": "preserve",                     // æŒ‡å®š jsx ä»£ç çš„ç”Ÿæˆ: 'preserve', 'react-native', or 'react'
    "declaration": true,                   // ç”Ÿæˆç›¸åº”çš„ '.d.ts' æ–‡ä»¶
    "sourceMap": true,                     // ç”Ÿæˆç›¸åº”çš„ '.map' æ–‡ä»¶
    "outFile": "./",                       // å°†è¾“å‡ºæ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶
    "outDir": "./",                        // æŒ‡å®šè¾“å‡ºç›®å½•
    "rootDir": "./",                       // ç”¨æ¥æ§åˆ¶è¾“å‡ºç›®å½•ç»“æ„ --outDir.
    "removeComments": true,                // åˆ é™¤ç¼–è¯‘åçš„æ‰€æœ‰çš„æ³¨é‡Š
    "noEmit": true,                        // ä¸ç”Ÿæˆè¾“å‡ºæ–‡ä»¶
    "importHelpers": true,                 // ä» tslib å¯¼å…¥è¾…åŠ©å·¥å…·å‡½æ•°
    "isolatedModules": true,               // å°†æ¯ä¸ªæ–‡ä»¶ä½œä¸ºå•ç‹¬çš„æ¨¡å— ï¼ˆä¸ 'ts.transpileModule' ç±»ä¼¼ï¼‰.

    /* ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥é€‰é¡¹ */
    "strict": true,                        // å¯ç”¨æ‰€æœ‰ä¸¥æ ¼ç±»å‹æ£€æŸ¥é€‰é¡¹
    "noImplicitAny": true,                 // åœ¨è¡¨è¾¾å¼å’Œå£°æ˜ä¸Šæœ‰éšå«çš„ anyç±»å‹æ—¶æŠ¥é”™
    "strictNullChecks": true,              // å¯ç”¨ä¸¥æ ¼çš„ null æ£€æŸ¥
    "noImplicitThis": true,                // å½“ this è¡¨è¾¾å¼å€¼ä¸º any ç±»å‹çš„æ—¶å€™ï¼Œç”Ÿæˆä¸€ä¸ªé”™è¯¯
    "alwaysStrict": true,                  // ä»¥ä¸¥æ ¼æ¨¡å¼æ£€æŸ¥æ¯ä¸ªæ¨¡å—ï¼Œå¹¶åœ¨æ¯ä¸ªæ–‡ä»¶é‡ŒåŠ å…¥ 'use strict'

    /* é¢å¤–çš„æ£€æŸ¥ */
    "noUnusedLocals": true,                // æœ‰æœªä½¿ç”¨çš„å˜é‡æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯
    "noUnusedParameters": true,            // æœ‰æœªä½¿ç”¨çš„å‚æ•°æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯
    "noImplicitReturns": true,             // å¹¶ä¸æ˜¯æ‰€æœ‰å‡½æ•°é‡Œçš„ä»£ç éƒ½æœ‰è¿”å›å€¼æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯
    "noFallthroughCasesInSwitch": true,    // æŠ¥å‘Š switch è¯­å¥çš„ fallthrough é”™è¯¯ã€‚ï¼ˆå³ï¼Œä¸å…è®¸ switch çš„ case è¯­å¥è´¯ç©¿ï¼‰

    /* æ¨¡å—è§£æé€‰é¡¹ */
    "moduleResolution": "node",            // é€‰æ‹©æ¨¡å—è§£æç­–ç•¥ï¼š 'node' (Node.js) or 'classic' (TypeScript pre-1.6)
    "baseUrl": "./",                       // ç”¨äºè§£æéç›¸å¯¹æ¨¡å—åç§°çš„åŸºç›®å½•
    "paths": {},                           // æ¨¡å—ååˆ°åŸºäº baseUrl çš„è·¯å¾„æ˜ å°„çš„åˆ—è¡¨
    "rootDirs": [],                        // æ ¹æ–‡ä»¶å¤¹åˆ—è¡¨ï¼Œå…¶ç»„åˆå†…å®¹è¡¨ç¤ºé¡¹ç›®è¿è¡Œæ—¶çš„ç»“æ„å†…å®¹
    "typeRoots": [],                       // åŒ…å«ç±»å‹å£°æ˜çš„æ–‡ä»¶åˆ—è¡¨
    "types": [],                           // éœ€è¦åŒ…å«çš„ç±»å‹å£°æ˜æ–‡ä»¶ååˆ—è¡¨
    "allowSyntheticDefaultImports": true,  // å…è®¸ä»æ²¡æœ‰è®¾ç½®é»˜è®¤å¯¼å‡ºçš„æ¨¡å—ä¸­é»˜è®¤å¯¼å…¥ã€‚

    /* Source Map Options */
    "sourceRoot": "./",                    // æŒ‡å®šè°ƒè¯•å™¨åº”è¯¥æ‰¾åˆ° TypeScript æ–‡ä»¶è€Œä¸æ˜¯æºæ–‡ä»¶çš„ä½ç½®
    "mapRoot": "./",                       // æŒ‡å®šè°ƒè¯•å™¨åº”è¯¥æ‰¾åˆ°æ˜ å°„æ–‡ä»¶è€Œä¸æ˜¯ç”Ÿæˆæ–‡ä»¶çš„ä½ç½®
    "inlineSourceMap": true,               // ç”Ÿæˆå•ä¸ª soucemaps æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å°† sourcemaps ç”Ÿæˆä¸åŒçš„æ–‡ä»¶
    "inlineSources": true,                 // å°†ä»£ç ä¸ sourcemaps ç”Ÿæˆåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¦æ±‚åŒæ—¶è®¾ç½®äº† --inlineSourceMap æˆ– --sourceMap å±æ€§

    /* å…¶ä»–é€‰é¡¹ */
    "experimentalDecorators": true,        // å¯ç”¨è£…é¥°å™¨
    "emitDecoratorMetadata": true          // ä¸ºè£…é¥°å™¨æä¾›å…ƒæ•°æ®çš„æ”¯æŒ
  }
}
```

å…³äºè¿™äº›ï¼ˆæˆ–è€…æ›´å¤šï¼‰ç¼–è¯‘é€‰é¡¹ï¼Œç¨åå°†ä¼šè®¨è®ºã€‚

##### TypeScript ç¼–è¯‘

å¥½çš„ IDE æ”¯æŒå¯¹ TypeScript çš„å³æ—¶ç¼–è¯‘ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³åœ¨ä½¿ç”¨ `tsconfig.json` æ—¶ä»å‘½ä»¤è¡Œæ‰‹åŠ¨è¿è¡Œ TypeScript ç¼–è¯‘å™¨ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š

è¿è¡Œ tscï¼Œå®ƒä¼šåœ¨å½“å‰ç›®å½•æˆ–è€…æ˜¯çˆ¶çº§ç›®å½•å¯»æ‰¾ `tsconfig.json` æ–‡ä»¶ã€‚
è¿è¡Œ `tsc -p ./path-to-project-directory` ã€‚å½“ç„¶ï¼Œè¿™ä¸ªè·¯å¾„å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹äºå½“å‰ç›®å½•çš„ç›¸å¯¹è·¯å¾„ã€‚
ä½ ç”šè‡³å¯ä»¥ä½¿ç”¨ `tsc -w` æ¥å¯ç”¨ TypeScript ç¼–è¯‘å™¨çš„è§‚æµ‹æ¨¡å¼ï¼Œåœ¨æ£€æµ‹åˆ°æ–‡ä»¶æ”¹åŠ¨ä¹‹åï¼Œå®ƒå°†é‡æ–°ç¼–è¯‘ã€‚

#### åˆ¶å®šæ–‡ä»¶

ä½ ä¹Ÿå¯ä»¥æ˜¾å¼æŒ‡å®šéœ€è¦ç¼–è¯‘çš„æ–‡ä»¶ï¼š
```json
{
  "files": [
    "./some/file.ts"
  ]
}
```

ä½ è¿˜å¯ä»¥ä½¿ç”¨ `include` å’Œ `exclude` é€‰é¡¹æ¥æŒ‡å®šéœ€è¦åŒ…å«çš„æ–‡ä»¶å’Œæ’é™¤çš„æ–‡ä»¶ï¼š
```json
{
  "include": [
    "./folder"
  ],
  "exclude": [
    "./folder/**/*.spec.ts",
    "./folder/someSubFolder"
  ]
}
```

:::tip
ä½¿ç”¨ `globs`ï¼š`**/*` ï¼ˆä¸€ä¸ªç¤ºä¾‹ç”¨æ³•ï¼š`some/folder/**/*`ï¼‰æ„å‘³ç€åŒ¹é…æ‰€æœ‰çš„æ–‡ä»¶å¤¹å’Œæ‰€æœ‰æ–‡ä»¶ï¼ˆæ‰©å±•åä¸º `.ts/.tsx`ï¼Œå½“å¼€å¯äº† `allowJs: true` é€‰é¡¹æ—¶ï¼Œæ‰©å±•åå¯ä»¥æ˜¯ `.js/.jsx`ï¼‰ã€‚
:::

### å£°æ˜ç©ºé—´

åœ¨ TypeScript é‡Œå­˜åœ¨ä¸¤ç§å£°æ˜ç©ºé—´ï¼šç±»å‹å£°æ˜ç©ºé—´ä¸å˜é‡å£°æ˜ç©ºé—´ã€‚ä¸‹æ–‡å°†åˆ†åˆ«è®¨è®ºè¿™ä¸¤ä¸ªæ¦‚å¿µã€‚

#### ç±»å‹å£°æ˜ç©ºé—´

ç±»å‹å£°æ˜ç©ºé—´åŒ…å«ç”¨æ¥å½“åšç±»å‹æ³¨è§£çš„å†…å®¹ï¼Œä¾‹å¦‚ä¸‹é¢çš„ç±»å‹å£°æ˜ï¼š
```ts
class Foo {}
interface Bar {}
type Bas = {};
```

ä½ å¯ä»¥å°† `Foo`, `Bar`, `Bas` ä½œä¸ºç±»å‹æ³¨è§£ä½¿ç”¨ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š
```ts
class Foo {}
interface Bar {}
type Bas = {};
```

æ³¨æ„ï¼Œå°½ç®¡ä½ å®šä¹‰äº† interface Barï¼Œå´å¹¶ä¸èƒ½å¤ŸæŠŠå®ƒä½œä¸ºä¸€ä¸ªå˜é‡æ¥ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å®šä¹‰åœ¨å˜é‡å£°æ˜ç©ºé—´ä¸­ã€‚
```ts
interface Bar {}
const bar = Bar; // Error: "cannot find name 'Bar'"
```

å‡ºç°é”™è¯¯æç¤ºï¼š `cannot find name 'Bar'` çš„åŸå› æ˜¯åç§° `Bar` å¹¶æœªå®šä¹‰åœ¨å˜é‡å£°æ˜ç©ºé—´ã€‚è¿™å°†å¸¦é¢†æˆ‘ä»¬è¿›å…¥ä¸‹ä¸€ä¸ªä¸»é¢˜ -- å˜é‡å£°æ˜ç©ºé—´ã€‚

#### å˜é‡å£°æ˜ç©ºé—´

å˜é‡å£°æ˜ç©ºé—´åŒ…å«å¯ç”¨ä½œå˜é‡çš„å†…å®¹ï¼Œåœ¨ä¸Šæ–‡ä¸­ `Class Foo` æä¾›äº†ä¸€ä¸ªç±»å‹ `Foo` åˆ°ç±»å‹å£°æ˜ç©ºé—´ï¼Œæ­¤å¤–å®ƒåŒæ ·æä¾›äº†ä¸€ä¸ªå˜é‡ Foo åˆ°å˜é‡å£°æ˜ç©ºé—´ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
class Foo {}
const someVar = Foo;
const someOtherVar = 123;
```

è¿™å¾ˆæ£’ï¼Œå°¤å…¶æ˜¯å½“ä½ æƒ³æŠŠä¸€ä¸ªç±»æ¥å½“åšå˜é‡ä¼ é€’æ—¶ã€‚

:::warning
æˆ‘ä»¬å¹¶ä¸èƒ½æŠŠä¸€äº›å¦‚ `interface` å®šä¹‰çš„å†…å®¹å½“ä½œå˜é‡ä½¿ç”¨ã€‚
:::

ä¸æ­¤ç›¸ä¼¼ï¼Œä¸€äº›ç”¨ `var` å£°æ˜çš„å˜é‡ï¼Œä¹Ÿåªèƒ½åœ¨å˜é‡å£°æ˜ç©ºé—´ä½¿ç”¨ï¼Œä¸èƒ½ç”¨ä½œç±»å‹æ³¨è§£ã€‚
```ts
const foo = 123;
let bar: foo; // ERROR: "cannot find name 'foo'"
```

æç¤º `ERROR: "cannot find name 'foo'"` åŸå› æ˜¯ï¼Œåç§° foo æ²¡æœ‰å®šä¹‰åœ¨ç±»å‹å£°æ˜ç©ºé—´é‡Œã€‚

### æ¨¡å—

#### å…¨å±€æ¨¡å—

åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä½ å¼€å§‹åœ¨ä¸€ä¸ªæ–°çš„ TypeScript æ–‡ä»¶ä¸­å†™ä¸‹ä»£ç æ—¶ï¼Œå®ƒå¤„äºå…¨å±€å‘½åç©ºé—´ä¸­ã€‚å¦‚åœ¨ foo.ts é‡Œçš„ä»¥ä¸‹ä»£ç ã€‚
```ts
const foo = 123;
```

å¦‚æœä½ åœ¨ç›¸åŒçš„é¡¹ç›®é‡Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ–‡ä»¶ bar.tsï¼ŒTypeScript ç±»å‹ç³»ç»Ÿå°†ä¼šå…è®¸ä½ ä½¿ç”¨å˜é‡ fooï¼Œå°±å¥½åƒå®ƒåœ¨å…¨å±€å¯ç”¨ä¸€æ ·ï¼š
```ts
const bar = foo; // allowed
```

æ¯‹åº¸ç½®ç–‘ï¼Œä½¿ç”¨å…¨å±€å˜é‡ç©ºé—´æ˜¯å±é™©çš„ï¼Œå› ä¸ºå®ƒä¼šä¸æ–‡ä»¶å†…çš„ä»£ç å‘½åå†²çªã€‚æˆ‘ä»¬æ¨èä½¿ç”¨ä¸‹æ–‡ä¸­å°†è¦æåˆ°çš„æ–‡ä»¶æ¨¡å—ã€‚

#### æ–‡ä»¶æ¨¡å—

æ–‡ä»¶æ¨¡å—ä¹Ÿè¢«ç§°ä¸ºå¤–éƒ¨æ¨¡å—ã€‚å¦‚æœåœ¨ä½ çš„ TypeScript æ–‡ä»¶çš„æ ¹çº§åˆ«ä½ç½®å«æœ‰ `import` æˆ–è€… `export`ï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªæœ¬åœ°çš„ä½œç”¨åŸŸã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä¸Šæ–‡ `foo.ts` æ”¹æˆå¦‚ä¸‹æ–¹å¼ï¼ˆæ³¨æ„ `export` ç”¨æ³•ï¼‰ï¼š
```ts
export const foo = 123;
```

åœ¨å…¨å±€å‘½åç©ºé—´é‡Œï¼Œæˆ‘ä»¬ä¸å†æœ‰ `foo`ï¼Œè¿™å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ `bar.ts` æ¥è¯æ˜ï¼š
```ts
const bar = foo; // ERROR: "cannot find name 'foo'"
```

å¦‚æœä½ æƒ³åœ¨ `bar.ts` é‡Œä½¿ç”¨æ¥è‡ª `foo.ts` çš„å†…å®¹ï¼Œä½ å¿…é¡»æ˜¾å¼åœ°å¯¼å…¥å®ƒï¼Œæ›´æ–°åçš„ `bar.ts` å¦‚ä¸‹æ‰€ç¤ºã€‚
```ts
import { foo } from './foo';
const bar = foo; // allow
```

åœ¨ `bar.ts` æ–‡ä»¶é‡Œä½¿ç”¨ `import` æ—¶ï¼Œå®ƒä¸ä»…å…è®¸ä½ ä½¿ç”¨ä»å…¶ä»–æ–‡ä»¶å¯¼å…¥çš„å†…å®¹ï¼Œè¿˜ä¼šå°†æ­¤æ–‡ä»¶ `bar.ts` æ ‡è®°ä¸ºä¸€ä¸ªæ¨¡å—ï¼Œæ–‡ä»¶å†…å®šä¹‰çš„å£°æ˜ä¹Ÿä¸ä¼šâ€œæ±¡æŸ“â€å…¨å±€å‘½åç©ºé—´

#### æ–‡ä»¶æ¨¡å—è¯¦æƒ…

æ–‡ä»¶æ¨¡å—æ‹¥æœ‰å¼ºå¤§çš„åŠŸèƒ½å’Œè¾ƒå¼ºçš„å¯ç”¨æ€§ã€‚ä¸‹é¢æˆ‘ä»¬æ¥è®¨è®ºå®ƒçš„åŠŸèƒ½åŠä¸€äº›ç”¨æ³•ã€‚

##### æ¾„æ¸…: commonjs, amd, esmodules, others

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ¾„æ¸…è¿™äº›æ¨¡å—ç³»ç»Ÿçš„ä¸ä¸€è‡´æ€§ã€‚æˆ‘å°†ä¼šæä¾›ç»™ä½ æˆ‘å½“å‰çš„å»ºè®®ï¼Œä»¥åŠæ¶ˆé™¤ä¸€äº›ä½ çš„é¡¾è™‘ã€‚

ä½ å¯ä»¥æ ¹æ®ä¸åŒçš„ `module` é€‰é¡¹æ¥æŠŠ TypeScript ç¼–è¯‘æˆä¸åŒçš„ JavaScript æ¨¡å—ç±»å‹ï¼Œè¿™æœ‰ä¸€äº›ä½ å¯ä»¥å¿½ç•¥çš„ä¸œè¥¿ï¼š
- AMDï¼šä¸è¦ä½¿ç”¨å®ƒï¼Œå®ƒä»…èƒ½åœ¨æµè§ˆå™¨å·¥ä½œï¼›
- SystemJSï¼šè¿™æ˜¯ä¸€ä¸ªå¥½çš„å®éªŒï¼Œå·²ç»è¢« ES æ¨¡å—æ›¿ä»£ï¼›
- ES æ¨¡å—ï¼šå®ƒå¹¶æ²¡æœ‰å‡†å¤‡å¥½ã€‚

ä½¿ç”¨ `module: commonjs` é€‰é¡¹æ¥æ›¿ä»£è¿™äº›æ¨¡å¼ï¼Œå°†ä¼šæ˜¯ä¸€ä¸ªå¥½çš„ä¸»æ„ã€‚

æ€ä¹ˆä¹¦å†™ TypeScript æ¨¡å—å‘¢ï¼Ÿï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä»¶è®©äººå›°æƒ‘çš„äº‹ã€‚åœ¨ä»Šå¤©æˆ‘ä»¬åº”è¯¥è¿™ä¹ˆåšï¼š

- æ”¾å¼ƒä½¿ç”¨ `import/require` è¯­æ³•å³ `import foo = require('foo')` å†™æ³•
- æ¨èä½¿ç”¨ ES æ¨¡å—è¯­æ³•

è¿™å¾ˆé…·ï¼Œæ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ ES æ¨¡å—è¯­æ³•ã€‚

:::tip
ä½¿ç”¨ `module: commonjs` é€‰é¡¹ä»¥åŠä½¿ç”¨ ES æ¨¡å—è¯­æ³•å¯¼å…¥ã€å¯¼å‡ºã€ç¼–å†™æ¨¡å—ã€‚
:::

##### ES æ¨¡å—è¯­æ³•

- ä½¿ç”¨ `export` å…³é”®å­—å¯¼å‡ºä¸€ä¸ªå˜é‡æˆ–ç±»å‹
```ts
// foo.ts
export const someVar = 123;
export type someType = {
  foo: string;
};
```

- `export` çš„å†™æ³•é™¤äº†ä¸Šé¢è¿™ç§ï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§ï¼š
```ts
// foo.ts
const someVar = 123;
type someType = {
  type: string;
};

export { someVar, someType };
```

- ä½ ä¹Ÿå¯ä»¥ç”¨é‡å‘½åå˜é‡çš„æ–¹å¼å¯¼å‡ºï¼š
```ts
// foo.ts
const someVar = 123;
export { someVar as aDifferentName };
```

- ä½¿ç”¨ `import` å…³é”®å­—å¯¼å…¥ä¸€ä¸ªå˜é‡æˆ–è€…æ˜¯ä¸€ä¸ªç±»å‹ï¼š
```ts
// bar.ts
import { someVar, someType } from './foo';
```

- é€šè¿‡é‡å‘½åçš„æ–¹å¼å¯¼å…¥å˜é‡æˆ–è€…ç±»å‹ï¼š
```ts
// bar.ts
import { someVar as aDifferentName } from './foo';
```

- é™¤äº†æŒ‡å®šåŠ è½½æŸä¸ªè¾“å‡ºå€¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ•´ä½“åŠ è½½ï¼Œå³ç”¨æ˜Ÿå·ï¼ˆ*ï¼‰æŒ‡å®šä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€æœ‰è¾“å‡ºå€¼éƒ½åŠ è½½åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šé¢ï¼š
```ts
// bar.ts
import * as foo from './foo';
// ä½ å¯ä»¥ä½¿ç”¨ `foo.someVar` å’Œ `foo.someType` ä»¥åŠå…¶ä»–ä»»ä½•ä» `foo` å¯¼å‡ºçš„å˜é‡æˆ–è€…ç±»å‹
```

- åªå¯¼å…¥æ¨¡å—ï¼š
```ts
import 'core-js'; // ä¸€ä¸ªæ™®é€šçš„ polyfill åº“
```

- ä»å…¶ä»–æ¨¡å—å¯¼å…¥åæ•´ä½“å¯¼å‡ºï¼š
```ts
export * from './foo';
```

- ä»å…¶ä»–æ¨¡å—å¯¼å…¥åï¼Œéƒ¨åˆ†å¯¼å‡ºï¼š
```ts
export { someVar } from './foo';
```

- é€šè¿‡é‡å‘½åï¼Œéƒ¨åˆ†å¯¼å‡ºä»å¦ä¸€ä¸ªæ¨¡å—å¯¼å…¥çš„é¡¹ç›®ï¼š
```ts
export { someVar as aDifferentName } from './foo';
```

###### é»˜è®¤å¯¼å…¥ï¼å¯¼å‡º

æˆ‘å¹¶ä¸å–œæ¬¢ç”¨é»˜è®¤å¯¼å‡ºï¼Œè™½ç„¶æœ‰é»˜è®¤å¯¼å‡ºçš„è¯­æ³•ï¼š
- ä½¿ç”¨ export default
  - åœ¨ä¸€ä¸ªå˜é‡ä¹‹å‰ï¼ˆä¸éœ€è¦ä½¿ç”¨ let/const/varï¼‰ï¼›
  - åœ¨ä¸€ä¸ªå‡½æ•°ä¹‹å‰ï¼›
  - åœ¨ä¸€ä¸ªç±»ä¹‹å‰ã€‚
```ts
// some var
export default (someVar = 123);

// some function
export default function someFunction() {}

// some class
export default class someClass {}
```

- å¯¼å…¥ä½¿ç”¨ `import someName from 'someModule'` è¯­æ³•ï¼ˆä½ å¯ä»¥æ ¹æ®éœ€è¦ä¸ºå¯¼å…¥å‘½åï¼‰ï¼š
```ts
import someLocalNameForThisFile from './foo';
```

##### æ¨¡å—è·¯å¾„

:::tip
å¦‚æœä½ éœ€è¦ä½¿ç”¨ `moduleResolution: node` é€‰é¡¹ï¼Œä½ åº”è¯¥å°†æ­¤é€‰é¡¹æ”¾å…¥ä½ çš„é…ç½®æ–‡ä»¶ä¸­ã€‚å¦‚æœä½ ä½¿ç”¨äº† `module: commonjs` é€‰é¡¹ï¼Œ `moduleResolution: node` å°†ä¼šé»˜è®¤å¼€å¯ã€‚
:::

è¿™é‡Œå­˜åœ¨ä¸¤ç§æˆªç„¶ä¸åŒçš„æ¨¡å—ï¼š
- ç›¸å¯¹æ¨¡å—è·¯å¾„ï¼ˆè·¯å¾„ä»¥ `.` å¼€å¤´ï¼Œä¾‹å¦‚ï¼š`./someFile` æˆ–è€… `../../someFolder/someFile` ç­‰ï¼‰ï¼›
- å…¶ä»–åŠ¨æ€æŸ¥æ‰¾æ¨¡å—ï¼ˆå¦‚ï¼š`core-js`ï¼Œ`typestyle`ï¼Œ`react` æˆ–è€…ç”šè‡³æ˜¯ `react/core` ç­‰ï¼‰ã€‚

å®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºç³»ç»Ÿå¦‚ä½•è§£ææ¨¡å—ã€‚

:::tip
æˆ‘å°†ä¼šä½¿ç”¨ä¸€ä¸ªæ¦‚å¿µæ€§æœ¯è¯­ï¼Œ`place` -- å°†åœ¨æåŠæŸ¥æ‰¾æ¨¡å¼åè§£é‡Šå®ƒã€‚
:::

###### ç›¸å¯¹æ¨¡å—è·¯å¾„

è¿™å¾ˆç®€å•ï¼Œä»…ä»…æ˜¯æŒ‰ç…§ç›¸å¯¹è·¯å¾„æ¥å°±å¯ä»¥äº†ï¼š
- å¦‚æœæ–‡ä»¶ `bar.ts` ä¸­å«æœ‰ `import * as foo from './foo'`ï¼Œé‚£ä¹ˆ `foo` æ–‡ä»¶å¿…é¡»ä¸ `bar.ts` æ–‡ä»¶å­˜åœ¨äºç›¸åŒçš„æ–‡ä»¶å¤¹ä¸‹
- å¦‚æœæ–‡ä»¶ `bar.ts` ä¸­å«æœ‰ `import * as foo from '../foo'`ï¼Œé‚£ä¹ˆ `foo` æ–‡ä»¶æ‰€å­˜åœ¨çš„åœ°æ–¹å¿…é¡»æ˜¯ `bar.ts` çš„ä¸Šä¸€çº§ç›®å½•ï¼›
- å¦‚æœæ–‡ä»¶ `bar.ts` ä¸­å«æœ‰ `import * as foo from '../someFolder/foo'`ï¼Œé‚£ä¹ˆ `foo` æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹ someFolder å¿…é¡»ä¸ `bar.ts` æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹åœ¨ç›¸åŒçš„ç›®å½•ä¸‹ã€‚

ä½ è¿˜å¯ä»¥æ€è€ƒä¸€ä¸‹å…¶ä»–ç›¸å¯¹è·¯å¾„å¯¼å…¥çš„åœºæ™¯ã€‚ğŸ˜ƒ

###### åŠ¨æ€æŸ¥æ‰¾

å½“å¯¼å…¥è·¯å¾„ä¸æ˜¯ç›¸å¯¹è·¯å¾„æ—¶ï¼Œæ¨¡å—è§£æå°†ä¼šæ¨¡ä»¿ [Node æ¨¡å—è§£æç­–ç•¥](https://nodejs.org/api/modules.html#modules_all_together)ï¼Œä¸‹é¢æˆ‘å°†ç»™å‡ºä¸€ä¸ªç®€å•ä¾‹å­ï¼š
- å½“ä½ ä½¿ç”¨ `import * as foo from 'foo'`ï¼Œå°†ä¼šæŒ‰å¦‚ä¸‹é¡ºåºæŸ¥æ‰¾æ¨¡å—ï¼š
  - `./node_modules/foo`
  - `../node_modules/foo`
  - `../../node_modules/foo`
  - ç›´åˆ°ç³»ç»Ÿçš„æ ¹ç›®å½•
- å½“ä½ ä½¿ç”¨ `import * as foo from 'something/foo'`ï¼Œå°†ä¼šæŒ‰ç…§å¦‚ä¸‹é¡ºåºæŸ¥æ‰¾å†…å®¹
  - `./node_modules/something/foo`
  - `../node_modules/something/foo`
  - `../../node_modules/something/foo`
  - ç›´åˆ°ç³»ç»Ÿçš„æ ¹ç›®å½•

##### ä»€ä¹ˆæ˜¯ `place`

å½“æˆ‘æåŠè¢«æ£€æŸ¥çš„ `place` æ—¶ï¼Œæˆ‘æƒ³è¡¨è¾¾çš„æ˜¯åœ¨è¿™ä¸ª `place` ä¸Šï¼ŒTypeScript å°†ä¼šæ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼ˆä¾‹å¦‚ä¸€ä¸ª `foo` çš„ `place`ï¼‰ï¼š
- å¦‚æœè¿™ä¸ª `place` è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ï¼š`foo.ts`ï¼Œæ¬¢å‘¼ï¼
- å¦åˆ™ï¼Œå¦‚æœè¿™ä¸ª `place` æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ `foo/index.ts`ï¼Œæ¬¢å‘¼ï¼
- å¦åˆ™ï¼Œå¦‚æœè¿™ä¸ª `place` æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”å­˜åœ¨ä¸€ä¸ª `foo/package.json` æ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­æŒ‡å®š `types` çš„æ–‡ä»¶å­˜åœ¨ï¼Œé‚£ä¹ˆå°±æ¬¢å‘¼ï¼
- å¦åˆ™ï¼Œå¦‚æœè¿™ä¸ª `place` æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”å­˜åœ¨ä¸€ä¸ª `package.json` æ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­æŒ‡å®š `main` çš„æ–‡ä»¶å­˜åœ¨ï¼Œé‚£ä¹ˆå°±æ¬¢å‘¼ï¼

ä»æ–‡ä»¶ç±»å‹ä¸Šæ¥è¯´ï¼Œæˆ‘å®é™…ä¸Šæ˜¯æŒ‡ `.ts`ï¼Œ `.d.ts` æˆ–è€… `.js`

å°±æ˜¯è¿™æ ·ï¼Œç°åœ¨ä½ å·²ç»æ˜¯ä¸€ä¸ªæ¨¡å—æŸ¥æ‰¾ä¸“å®¶ï¼ˆè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå°å°çš„æˆåŠŸï¼‰ã€‚

##### é‡å†™ç±»å‹çš„åŠ¨æ€æŸ¥æ‰¾

åœ¨ä½ çš„é¡¹ç›®é‡Œï¼Œä½ å¯ä»¥é€šè¿‡ `declare module 'somePath'` å£°æ˜ä¸€ä¸ªå…¨å±€æ¨¡å—çš„æ–¹å¼ï¼Œæ¥è§£å†³æŸ¥æ‰¾æ¨¡å—è·¯å¾„çš„é—®é¢˜ã€‚
```ts
// global.d.ts
declare module 'foo' {
  // some variable declarations
  export var bar: number;
}
```

æ¥ç€ ï¼š
```ts
// anyOtherTsFileInYourProject.ts
import * as foo from 'foo';
// TypeScript å°†å‡è®¾ï¼ˆåœ¨æ²¡æœ‰åšå…¶ä»–æŸ¥æ‰¾çš„æƒ…å†µä¸‹ï¼‰
// foo æ˜¯ { bar: number }
```

##### import/require ä»…ä»…æ˜¯å¯¼å…¥ç±»å‹

ä»¥ä¸‹å¯¼å…¥è¯­æ³•ï¼š
```ts
import foo = require('foo');
```

å®ƒå®é™…ä¸Šåªåšäº†ä¸¤ä»¶äº‹ï¼š
- å¯¼å…¥ foo æ¨¡å—çš„æ‰€æœ‰ç±»å‹ä¿¡æ¯ï¼›
- ç¡®å®š foo æ¨¡å—è¿è¡Œæ—¶çš„ä¾èµ–å…³ç³»ã€‚

ä½ å¯ä»¥é€‰æ‹©ä»…åŠ è½½ç±»å‹ä¿¡æ¯ï¼Œè€Œæ²¡æœ‰è¿è¡Œæ—¶çš„ä¾èµ–å…³ç³»ã€‚åœ¨ç»§ç»­ä¹‹å‰ï¼Œä½ å¯èƒ½éœ€è¦é‡æ–°é˜…è¯»æœ¬ä¹¦ [å£°æ˜ç©ºé—´éƒ¨åˆ†](#å£°æ˜ç©ºé—´)ã€‚

å¦‚æœä½ æ²¡æœ‰æŠŠå¯¼å…¥çš„åç§°å½“åšå˜é‡å£°æ˜ç©ºé—´æ¥ç”¨ï¼Œåœ¨ç¼–è¯‘æˆ JavaScript æ—¶ï¼Œå¯¼å…¥çš„æ¨¡å—å°†ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚è¿™æœ€å¥½ç”¨ä¾‹å­æ¥è§£é‡Šï¼Œä¸‹é¢æˆ‘ä»¬å°†ä¼šç»™å‡ºä¸€äº›ç¤ºä¾‹ã€‚

###### ä¾‹å­ 1
```ts
import foo = require('foo');
```

å°†ä¼šç¼–è¯‘æˆ JavaScriptï¼š
```js
```

è¿™æ˜¯æ­£ç¡®çš„ï¼Œä¸€ä¸ªæ²¡æœ‰è¢«ä½¿ç”¨çš„ç©ºæ–‡ä»¶ã€‚

###### ä¾‹å­ 2
```ts
import foo = require('foo');
var bar: foo;
```

å°†ä¼šè¢«ç¼–è¯‘æˆï¼š
```js
let bar;
```

è¿™æ˜¯å› ä¸º foo ï¼ˆæˆ–è€…å…¶ä»–ä»»ä½•å±æ€§å¦‚ï¼š`foo.bas`ï¼‰æ²¡æœ‰è¢«å½“åšä¸€ä¸ªå˜é‡ä½¿ç”¨ã€‚

###### ä¾‹å­ 3
```ts
import foo = require('foo');
const bar = foo;
```

å°†ä¼šè¢«ç¼–è¯‘æˆï¼ˆå‡è®¾æ˜¯ commonjsï¼‰ï¼š
```js
const foo = require('foo');
const bar = foo;
```

è¿™æ˜¯å› ä¸º `foo` è¢«å½“åšå˜é‡ä½¿ç”¨äº†ã€‚

###### ä½¿ç”¨ä¾‹å­ï¼šæ‡’åŠ è½½

ç±»å‹æ¨æ–­éœ€è¦æå‰å®Œæˆï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœä½ æƒ³åœ¨ `bar` æ–‡ä»¶é‡Œï¼Œä½¿ç”¨ä»å…¶ä»–æ–‡ä»¶ `foo` å¯¼å‡ºçš„ç±»å‹ï¼Œä½ å°†ä¸å¾—ä¸è¿™ä¹ˆåšï¼š
```ts
import foo = require('foo');
let bar: foo.SomeType;
```

ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…æ™¯ä¸‹ï¼Œä½ åªæƒ³åœ¨éœ€è¦æ—¶åŠ è½½æ¨¡å— `foo`ï¼Œæ­¤æ—¶ä½ éœ€è¦ä»…åœ¨ç±»å‹æ³¨è§£ä¸­ä½¿ç”¨å¯¼å…¥çš„æ¨¡å—åç§°ï¼Œè€Œ**ä¸**æ˜¯åœ¨å˜é‡ä¸­ä½¿ç”¨ã€‚åœ¨ç¼–è¯‘æˆ JavaScript æ—¶ï¼Œè¿™äº›å°†ä¼šè¢«ç§»é™¤ã€‚æ¥ç€ï¼Œä½ å¯ä»¥æ‰‹åŠ¨å¯¼å…¥ä½ éœ€è¦çš„æ¨¡å—ã€‚

ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œè€ƒè™‘ä»¥ä¸‹åŸºäº `commonjs` çš„ä»£ç ï¼Œæˆ‘ä»¬ä»…åœ¨ä¸€ä¸ªå‡½æ•°å†…å¯¼å…¥ `foo` æ¨¡å—ï¼š
```ts
import foo = require('foo');

export function loadFoo() {
  // è¿™æ˜¯æ‡’åŠ è½½ fooï¼ŒåŸå§‹çš„åŠ è½½ä»…ä»…ç”¨æ¥åšç±»å‹æ³¨è§£
  const _foo: typeof foo = require('foo');
  // ç°åœ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ `_foo` æ›¿ä»£ `foo` æ¥ä½œä¸ºä¸€ä¸ªå˜é‡ä½¿ç”¨
}
```

ä¸€ä¸ªåŒæ ·ç®€å•çš„ `amd` æ¨¡å—ï¼ˆä½¿ç”¨ requirejsï¼‰ï¼š
```ts
import foo = require('foo');

export function loadFoo() {
  // è¿™æ˜¯æ‡’åŠ è½½ fooï¼ŒåŸå§‹çš„åŠ è½½ä»…ä»…ç”¨æ¥åšç±»å‹æ³¨è§£
  require(['foo'], (_foo: typeof foo) => {
    // ç°åœ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ `_foo` æ›¿ä»£ `foo` æ¥ä½œä¸ºä¸€ä¸ªå˜é‡ä½¿ç”¨
  });
}
```

è¿™äº›é€šå¸¸åœ¨ä»¥ä¸‹æƒ…æ™¯ä½¿ç”¨ï¼š
- åœ¨ web app é‡Œï¼Œ å½“ä½ åœ¨ç‰¹å®šè·¯ç”±ä¸ŠåŠ è½½ JavaScript æ—¶ï¼›
- åœ¨ node åº”ç”¨é‡Œï¼Œå½“ä½ åªæƒ³åŠ è½½ç‰¹å®šæ¨¡å—ï¼Œç”¨æ¥åŠ å¿«å¯åŠ¨é€Ÿåº¦æ—¶ã€‚

###### ä½¿ç”¨ä¾‹å­ï¼šæ‰“ç ´å¾ªç¯ä¾èµ–

ç±»ä¼¼äºæ‡’åŠ è½½çš„ä½¿ç”¨ç”¨ä¾‹ï¼ŒæŸäº›æ¨¡å—åŠ è½½å™¨ï¼ˆcommonjs/node å’Œ amd/requirejsï¼‰ä¸èƒ½å¾ˆå¥½çš„å¤„ç†å¾ªç¯ä¾èµ–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€æ–¹é¢æˆ‘ä»¬ä½¿ç”¨å»¶è¿ŸåŠ è½½ä»£ç ï¼Œå¹¶åœ¨å¦ä¸€æ–¹é¢é¢„å…ˆåŠ è½½æ¨¡å—æ˜¯å¾ˆå®ç”¨çš„ã€‚

###### ä½¿ç”¨ä¾‹å­ï¼šç¡®ä¿å¯¼å…¥

å½“ä½ åŠ è½½ä¸€ä¸ªæ¨¡å—ï¼Œåªæ˜¯æƒ³å¼•å…¥å…¶é™„åŠ çš„ä½œç”¨ï¼ˆå¦‚ï¼šæ¨¡å—å¯èƒ½ä¼šæ³¨å†Œä¸€äº›åƒ [CodeMirror addons](https://codemirror.net/doc/manual.html#addons)ï¼‰æ—¶ï¼Œç„¶è€Œï¼Œå¦‚æœä½ ä»…ä»…æ˜¯ `import/require` ï¼ˆå¯¼å…¥ï¼‰ä¸€äº›å¹¶æ²¡æœ‰ä¸ä½ çš„æ¨¡å—æˆ–è€…æ¨¡å—åŠ è½½å™¨æœ‰ä»»ä½•ä¾èµ–çš„ JavaScript ä»£ç ï¼Œï¼ˆå¦‚ï¼šwebpackï¼‰ï¼Œç»è¿‡ TypeScript ç¼–è¯‘åï¼Œè¿™äº›å°†ä¼šè¢«å®Œå…¨å¿½è§†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª `ensureImport` å˜é‡ï¼Œæ¥ç¡®ä¿ç¼–è¯‘çš„ JavaScript ä¾èµ–ä¸æ¨¡å—ã€‚å¦‚ï¼š
```ts
import foo = require('./foo');
import bar = require('./bar');
import bas = require('./bas');

const ensureImport: any = foo || bar || bas;
```

#### global.d.ts

åœ¨ä¸Šæ–‡ä¸­ï¼Œå½“æˆ‘ä»¬è®¨è®ºæ–‡ä»¶æ¨¡å—æ—¶ï¼Œæ¯”è¾ƒäº†å…¨å±€å˜é‡ä¸æ–‡ä»¶æ¨¡å—ï¼Œå¹¶ä¸”æˆ‘ä»¬æ¨èä½¿ç”¨åŸºäºæ–‡ä»¶çš„æ¨¡å—ï¼Œè€Œä¸æ˜¯é€‰æ‹©æ±¡æŸ“å…¨å±€å‘½åç©ºé—´ã€‚

ç„¶è€Œï¼Œå¦‚æœä½ çš„å›¢é˜Ÿé‡Œæœ‰ TypeScript åˆå­¦è€…ï¼Œä½ å¯ä»¥æä¾›ä»–ä»¬ä¸€ä¸ª `global.d.ts` æ–‡ä»¶ï¼Œç”¨æ¥å°†ä¸€äº›æ¥å£æˆ–è€…ç±»å‹æ”¾å…¥å…¨å±€å‘½åç©ºé—´é‡Œï¼Œè¿™äº›å®šä¹‰çš„æ¥å£å’Œç±»å‹èƒ½åœ¨ä½ çš„æ‰€æœ‰ TypeScript ä»£ç é‡Œä½¿ç”¨ã€‚

:::tip
å¯¹äºä»»ä½•éœ€è¦ç¼–è¯‘æˆ `JavaScript` çš„ä»£ç ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ æ”¾å…¥æ–‡ä»¶æ¨¡å—é‡Œã€‚
:::

- `global.d.ts` æ˜¯ä¸€ç§æ‰©å…… `lib.d.ts` å¾ˆå¥½çš„æ–¹å¼ï¼Œå¦‚æœä½ éœ€è¦çš„è¯ã€‚
- å½“ä½ ä» `JS` è¿ç§»åˆ° `TS` æ—¶ï¼Œå®šä¹‰ `declare module "some-library-you-dont-care-to-get-defs-for"` èƒ½è®©ä½ å¿«é€Ÿå¼€å§‹ã€‚

### å‘½åç©ºé—´

åœ¨ JavaScript ä½¿ç”¨å‘½åç©ºé—´æ—¶ï¼Œ è¿™æœ‰ä¸€ä¸ªå¸¸ç”¨çš„ã€æ–¹ä¾¿çš„è¯­æ³•ï¼š
```js
(function(something) {
  something.foo = 123;
})(something || (something = {}));
```

`something || (something = {})` å…è®¸åŒ¿åå‡½æ•° `function (something) {}` å‘ç°æœ‰å¯¹è±¡æ·»åŠ å†…å®¹ï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œç„¶åå‘è¯¥å¯¹è±¡æ·»åŠ å†…å®¹ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥æ‹¥æœ‰ä¸¤ä¸ªç”±æŸäº›è¾¹ç•Œæ‹†æˆçš„å—ã€‚
```js
(function(something) {
  something.foo = 123;
})(something || (something = {}));

console.log(something);
// { foo: 123 }

(function(something) {
  something.bar = 456;
})(something || (something = {}));

console.log(something); // { foo: 123, bar: 456 }
```

åœ¨ç¡®ä¿åˆ›å»ºçš„å˜é‡ä¸ä¼šæ³„æ¼è‡³å…¨å±€å‘½åç©ºé—´æ—¶ï¼Œè¿™ç§æ–¹å¼åœ¨ JavaScript ä¸­å¾ˆå¸¸è§ã€‚å½“åŸºäºæ–‡ä»¶æ¨¡å—ä½¿ç”¨æ—¶ï¼Œä½ æ— é¡»æ‹…å¿ƒè¿™ç‚¹ï¼Œä½†æ˜¯è¯¥æ¨¡å¼ä»ç„¶é€‚ç”¨äºä¸€ç»„å‡½æ•°çš„é€»è¾‘åˆ†ç»„ã€‚å› æ­¤ TypeScript æä¾›äº† `namespace` å…³é”®å­—æ¥æè¿°è¿™ç§åˆ†ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚
```ts
namespace Utility {
  export function log(msg) {
    console.log(msg);
  }
  export function error(msg) {
    console.log(msg);
  }
}

// usage
Utility.log('Call me');
Utility.error('maybe');
```

`namespace` å…³é”®å­—ç¼–è¯‘åçš„ JavaScript ä»£ç ï¼Œä¸æˆ‘ä»¬æ—©äº›æ—¶å€™çœ‹åˆ°çš„ JavaScript ä»£ç ä¸€æ ·ã€‚
```js
var Utility;
(function (Utility) {
  // æ·»åŠ å±æ€§è‡³ Utility
})(Utility || Utility = {});
```

å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå‘½åç©ºé—´æ˜¯æ”¯æŒåµŒå¥—çš„ã€‚å› æ­¤ï¼Œä½ å¯ä»¥åšä¸€äº›ç±»ä¼¼äºåœ¨ `Utility` å‘½åç©ºé—´ä¸‹åµŒå¥—ä¸€ä¸ªå‘½åç©ºé—´ `Messaging` çš„äº‹æƒ…ã€‚

å¯¹äºå¤§å¤šæ•°é¡¹ç›®ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨å¤–éƒ¨æ¨¡å—å’Œå‘½åç©ºé—´ï¼Œæ¥å¿«é€Ÿæ¼”ç¤ºå’Œç§»æ¤æ—§çš„ JavaScript ä»£ç ã€‚

### åŠ¨æ€å¯¼å…¥è¡¨è¾¾å¼

åŠ¨æ€å¯¼å…¥è¡¨è¾¾å¼æ˜¯ ECMAScript çš„ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ åœ¨ç¨‹åºçš„ä»»æ„ä½ç½®å¼‚æ­¥åŠ è½½ä¸€ä¸ªæ¨¡å—ï¼ŒTC39 JavaScript å§”å‘˜ä¼šæœ‰ä¸€ä¸ªææ¡ˆï¼Œç›®å‰å¤„äºç¬¬å››é˜¶æ®µï¼Œå®ƒè¢«ç§°ä¸º [import() proposal for JavaScript](https://github.com/tc39/proposal-dynamic-import)ã€‚

æ­¤å¤–ï¼Œ**webpack** bundler æœ‰ä¸€ä¸ª `Code Splitting` åŠŸèƒ½ï¼Œå®ƒèƒ½å…è®¸ä½ å°†ä»£ç æ‹†åˆ†ä¸ºè®¸å¤šå—ï¼Œè¿™äº›å—åœ¨å°†æ¥å¯è¢«å¼‚æ­¥ä¸‹è½½ã€‚å› æ­¤ï¼Œä½ å¯ä»¥åœ¨ç¨‹åºä¸­é¦–å…ˆæä¾›ä¸€ä¸ªæœ€å°çš„ç¨‹åºå¯åŠ¨åŒ…ï¼Œå¹¶åœ¨å°†æ¥å¼‚æ­¥åŠ è½½å…¶ä»–æ¨¡å—ã€‚

è¿™å¾ˆè‡ªç„¶å°±ä¼šè®©äººæƒ³åˆ°ï¼ˆå¦‚æœæˆ‘ä»¬å·¥ä½œåœ¨ webpack dev çš„å·¥ä½œæµç¨‹ä¸­ï¼‰[TypeScript 2.4 dynamic import expressions](https://github.com/Microsoft/TypeScript/wiki/What%27s-new-in-TypeScript#dynamic-import-expressions) å°†ä¼šæŠŠä½ æœ€ç»ˆç”Ÿæˆçš„ JavaScript ä»£ç è‡ªåŠ¨åˆ†å‰²æˆå¾ˆå¤šå—ã€‚ä½†æ˜¯è¿™ä¼¼ä¹å¹¶ä¸å®¹æ˜“å®ç°ï¼Œå› ä¸ºå®ƒä¾èµ–äºæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„ `tsconfig.json` é…ç½®æ–‡ä»¶ã€‚

webpack å®ç°ä»£ç åˆ†å‰²çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šä½¿ç”¨ `import()` ï¼ˆé¦–é€‰ï¼ŒECMAScript çš„ææ¡ˆï¼‰å’Œ `require.ensure()` ï¼ˆæœ€åè€ƒè™‘ï¼Œwebpack å…·ä½“å®ç°ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æœŸæœ› TypeScript çš„è¾“å‡ºæ˜¯ä¿ç•™ `import()` è¯­å¥ï¼Œè€Œä¸æ˜¯å°†å…¶è½¬åŒ–ä¸ºå…¶ä»–ä»»ä½•ä»£ç ã€‚

è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†å¦‚ä½•é…ç½® webpack å’Œ TypeScript 2.4 +ã€‚

åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘å¸Œæœ›æ‡’åŠ è½½ `moment` åº“ï¼ŒåŒæ—¶æˆ‘ä¹Ÿå¸Œæœ›ä½¿ç”¨ä»£ç åˆ†å‰²çš„åŠŸèƒ½ï¼Œè¿™æ„å‘³ `moment` ä¼šè¢«åˆ†å‰²åˆ°ä¸€ä¸ªå•ç‹¬çš„ JavaScript æ–‡ä»¶ï¼Œå½“å®ƒè¢«ä½¿ç”¨æ—¶ï¼Œä¼šè¢«å¼‚æ­¥åŠ è½½ã€‚
```ts
import(/* webpackChunkName: "momentjs" */ 'moment')
  .then(moment => {
    // æ‡’åŠ è½½çš„æ¨¡å—æ‹¥æœ‰æ‰€æœ‰çš„ç±»å‹ï¼Œå¹¶ä¸”èƒ½å¤ŸæŒ‰æœŸå·¥ä½œ
    // ç±»å‹æ£€æŸ¥ä¼šå·¥ä½œï¼Œä»£ç å¼•ç”¨ä¹Ÿä¼šå·¥ä½œ  :100:
    const time = moment().format();
    console.log('TypeScript >= 2.4.0 Dynamic Import Expression:');
    console.log(time);
  })
  .catch(err => {
    console.log('Failed to load moment', err);
  });
```

è¿™æ˜¯ `tsconfig.json` çš„é…ç½®æ–‡ä»¶ï¼š
```json
{
  "compilerOptions": {
    "target": "es5",
    "module": "esnext",
    "lib": [
      "dom",
      "es5",
      "scripthost",
      "es2015.promise"
    ],
    "jsx": "react",
    "declaration": false,
    "sourceMap": true,
    "outDir": "./dist/js",
    "strict": true,
    "moduleResolution": "node",
    "typeRoots": [
      "./node_modules/@types"
    ],
    "types": [
      "node",
      "react",
      "react-dom"
    ]
  }
}
```

:::danger
- ä½¿ç”¨ `"module": "esnext"` é€‰é¡¹ï¼šTypeScript ä¿ç•™ `import()` è¯­å¥ï¼Œè¯¥è¯­å¥ç”¨äº Webpack Code Splittingã€‚
- è¿›ä¸€æ­¥äº†è§£æœ‰å…³ä¿¡æ¯ï¼Œæ¨èé˜…è¯»è¿™ç¯‡æ–‡ç« ï¼š[Dynamic Import Expressions and webpack 2 Code Splitting integration with TypeScript 2.4](https://blog.josequinto.com/2017/06/29/dynamic-import-expressions-and-webpack-code-splitting-integration-with-typescript-2-4/).
:::

## TypeScript ç±»å‹ç³»ç»Ÿ

### æ¦‚è§ˆ

#### TypeScript ç±»å‹ç³»ç»Ÿ

TypeScript ç±»å‹ç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®ç‚¹ï¼š
- TypeScript çš„ç±»å‹ç³»ç»Ÿè¢«è®¾è®¡ä¸ºå¯é€‰çš„ï¼Œå› æ­¤ï¼Œä½ çš„ JavaScript å°±æ˜¯ TypeScript;
- TypeScript ä¸ä¼šé˜»æ­¢ JavaScript çš„è¿è¡Œï¼Œå³ä½¿å­˜åœ¨ç±»å‹é”™è¯¯ä¹Ÿä¸ä¾‹å¤–ï¼Œè¿™èƒ½è®©ä½ çš„ JavaScript é€æ­¥è¿ç§»è‡³ TypeScriptã€‚

ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹å­¦ä¹  TypeScript ç±»å‹ç³»ç»Ÿçš„è¯­æ³•å§ï¼Œåœ¨è¿™ä¸€ç« èŠ‚ä¸­ï¼Œä½ å°†èƒ½ç»™ä½ çš„ä»£ç åŠ ä¸Šç±»å‹æ³¨è§£ï¼Œå¹¶ä¸”èƒ½çœ‹åˆ°å®ƒçš„ç›Šå¤„ã€‚è¿™å°†ä¸ºæˆ‘ä»¬è¿›ä¸€æ­¥äº†è§£ç±»å‹ç³»ç»Ÿåšé“ºå«ã€‚

#### åŸºæœ¬æ³¨è§£

å¦‚å‰æ–‡æ‰€æåŠï¼Œç±»å‹æ³¨è§£ä½¿ç”¨ `:TypeAnnotation` è¯­æ³•ã€‚åœ¨ç±»å‹å£°æ˜ç©ºé—´ä¸­å¯ç”¨çš„ä»»ä½•å†…å®¹éƒ½å¯ä»¥ç”¨ä½œç±»å‹æ³¨è§£ã€‚

åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨äº†å˜é‡ã€å‡½æ•°å‚æ•°ä»¥åŠå‡½æ•°è¿”å›å€¼çš„ç±»å‹æ³¨è§£ï¼š
```ts
const num: number = 123;
function identity(num: number): number {
  return num;
}
```

#### åŸå§‹ç±»å‹

JavaScript åŸå§‹ç±»å‹ä¹ŸåŒæ ·é€‚åº”äº TypeScript çš„ç±»å‹ç³»ç»Ÿï¼Œå› æ­¤ `string`ã€`number`ã€`boolean` ä¹Ÿå¯ä»¥è¢«ç”¨ä½œç±»å‹æ³¨è§£ï¼š
```ts
let num: number;
let str: string;
let bool: boolean;

num = 123;
num = 123.456;
num = '123'; // Error

str = '123';
str = 123; // Error

bool = true;
bool = false;
bool = 'false'; // Error
```

#### æ•°ç»„

TypeScript ä¸ºæ•°ç»„æä¾›äº†ä¸“ç”¨çš„ç±»å‹è¯­æ³•ï¼Œå› æ­¤ä½ å¯ä»¥å¾ˆè½»æ˜“çš„æ³¨è§£æ•°ç»„ã€‚å®ƒä½¿ç”¨åç¼€ `[]`ï¼Œ æ¥ç€ä½ å¯ä»¥æ ¹æ®éœ€è¦è¡¥å……ä»»ä½•æœ‰æ•ˆçš„ç±»å‹æ³¨è§£ï¼ˆå¦‚ï¼š`:boolean[]`ï¼‰ã€‚å®ƒèƒ½è®©ä½ å®‰å…¨çš„ä½¿ç”¨ä»»ä½•æœ‰å…³æ•°ç»„çš„æ“ä½œï¼Œè€Œä¸”å®ƒä¹Ÿèƒ½é˜²æ­¢ä¸€äº›ç±»ä¼¼äºèµ‹å€¼é”™è¯¯ç±»å‹ç»™æˆå‘˜çš„è¡Œä¸ºã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
let boolArray: boolean[];

boolArray = [true, false];
console.log(boolArray[0]); // true
console.log(boolArray.length); // 2

boolArray[1] = true;
boolArray = [false, false];

boolArray[0] = 'false'; // Error
boolArray = 'false'; // Error
boolArray = [true, 'false']; // Error
```

#### æ¥å£

æ¥å£æ˜¯ TypeScript çš„ä¸€ä¸ªæ ¸å¿ƒçŸ¥è¯†ï¼Œå®ƒèƒ½åˆå¹¶ä¼—å¤šç±»å‹å£°æ˜è‡³ä¸€ä¸ªç±»å‹å£°æ˜ï¼š
```ts
interface Name {
  first: string;
  second: string;
}

let name: Name;
name = {
  first: 'John',
  second: 'Doe'
};

name = {
  // Error: 'Second is missing'
  first: 'John'
};

name = {
  // Error: 'Second is the wrong type'
  first: 'John',
  second: 1337
};
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠç±»å‹æ³¨è§£ï¼š`first: string` + `second: string` åˆå¹¶åˆ°äº†ä¸€ä¸ªæ–°çš„ç±»å‹æ³¨è§£ `Name` é‡Œï¼Œè¿™æ ·èƒ½å¼ºåˆ¶å¯¹æ¯ä¸ªæˆå‘˜è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚æ¥å£åœ¨ TypeScript æ‹¥æœ‰å¼ºå¤§çš„åŠ›é‡ï¼Œç¨åï¼Œæˆ‘ä»¬å°†ä¼šç”¨ä¸€ä¸ªå†…å®¹ä¸“é—¨é˜è¿°å¦‚ä½•æ›´å¥½çš„ä½¿ç”¨å®ƒã€‚

#### å†…è”ç±»å‹æ³¨è§£

ä¸åˆ›å»ºä¸€ä¸ªæ¥å£ä¸åŒï¼Œä½ å¯ä»¥ä½¿ç”¨å†…è”æ³¨è§£è¯­æ³•æ³¨è§£ä»»ä½•å†…å®¹ï¼š`:{ /*Structure*/ }`ï¼š
```ts
let name: {
  first: string;
  second: string;
};

name = {
  first: 'John',
  second: 'Doe'
};

name = {
  // Error: 'Second is missing'
  first: 'John'
};

name = {
  // Error: 'Second is the wrong type'
  first: 'John',
  second: 1337
};
```

å†…è”ç±»å‹èƒ½ä¸ºä½ å¿«é€Ÿçš„æä¾›ä¸€ä¸ªç±»å‹æ³¨è§£ã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ çœå»ä¸ºç±»å‹èµ·åçš„éº»çƒ¦ï¼ˆä½ å¯èƒ½ä¼šä½¿ç”¨ä¸€ä¸ªå¾ˆç³Ÿç³•çš„åç§°ï¼‰ã€‚ç„¶è€Œï¼Œå¦‚æœä½ å‘ç°éœ€è¦å¤šæ¬¡ä½¿ç”¨ç›¸åŒçš„å†…è”æ³¨è§£æ—¶ï¼Œé‚£ä¹ˆè€ƒè™‘æŠŠå®ƒé‡æ„ä¸ºä¸€ä¸ªæ¥å£ï¼ˆæˆ–è€…æ˜¯ `type alias`ï¼Œå®ƒä¼šåœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†æåˆ°ï¼‰æ˜¯ä¸€ä¸ªä¸é”™çš„ä¸»æ„ã€‚

#### ç‰¹æ®Šç±»å‹

é™¤äº†è¢«æåˆ°çš„ä¸€äº›åŸå§‹ç±»å‹ï¼Œåœ¨ TypeScript ä¸­ï¼Œè¿˜å­˜åœ¨ä¸€äº›ç‰¹æ®Šçš„ç±»å‹ï¼Œå®ƒä»¬æ˜¯ `any`ã€ `null`ã€ `undefined` ä»¥åŠ `void`ã€‚

##### any

`any` ç±»å‹åœ¨ TypeScript ç±»å‹ç³»ç»Ÿä¸­å æœ‰ç‰¹æ®Šçš„åœ°ä½ã€‚å®ƒæä¾›ç»™ä½ ä¸€ä¸ªç±»å‹ç³»ç»Ÿçš„ã€Œåé—¨ã€,TypeScript å°†ä¼šæŠŠç±»å‹æ£€æŸ¥å…³é—­ã€‚åœ¨ç±»å‹ç³»ç»Ÿé‡Œ `any` èƒ½å¤Ÿå…¼å®¹æ‰€æœ‰çš„ç±»å‹ï¼ˆåŒ…æ‹¬å®ƒè‡ªå·±ï¼‰ã€‚å› æ­¤ï¼Œæ‰€æœ‰ç±»å‹éƒ½èƒ½è¢«èµ‹å€¼ç»™å®ƒï¼Œå®ƒä¹Ÿèƒ½è¢«èµ‹å€¼ç»™å…¶ä»–ä»»ä½•ç±»å‹ã€‚ä»¥ä¸‹æœ‰ä¸€ä¸ªè¯æ˜ä¾‹å­ï¼š
```ts
let power: any;

// èµ‹å€¼ä»»æ„ç±»å‹
power = '123';
power = 123;

// å®ƒä¹Ÿå…¼å®¹ä»»ä½•ç±»å‹
let num: number;
power = num;
num = power;
```

å½“ä½ æŠŠ JavaScript è¿ç§»è‡³ TypeScript æ—¶ï¼Œä½ å°†ä¼šç»å¸¸æ€§ä½¿ç”¨ `any`ã€‚ä½†ä½ å¿…é¡»å‡å°‘å¯¹å®ƒçš„ä¾èµ–ï¼Œå› ä¸ºä½ éœ€è¦ç¡®ä¿ç±»å‹å®‰å…¨ã€‚å½“ä½¿ç”¨ `any` æ—¶ï¼Œä½ åŸºæœ¬ä¸Šæ˜¯åœ¨å‘Šè¯‰ TypeScript ç¼–è¯‘å™¨ä¸è¦è¿›è¡Œä»»ä½•çš„ç±»å‹æ£€æŸ¥ã€‚

##### null å’Œ undefined

åœ¨ç±»å‹ç³»ç»Ÿä¸­ï¼ŒJavaScript ä¸­çš„ null å’Œ undefined å­—é¢é‡å’Œå…¶ä»–è¢«æ ‡æ³¨äº† `any` ç±»å‹çš„å˜é‡ä¸€æ ·ï¼Œéƒ½èƒ½è¢«èµ‹å€¼ç»™ä»»æ„ç±»å‹çš„å˜é‡ï¼Œå¦‚ä¸‹ä¾‹å­æ‰€ç¤ºï¼š
```ts
// strictNullChecks: false

let num: number;
let str: string;

// è¿™äº›ç±»å‹èƒ½è¢«èµ‹äºˆ
num = null;
str = undefined;
```

##### void

ä½¿ç”¨ `:void` æ¥è¡¨ç¤ºä¸€ä¸ªå‡½æ•°æ²¡æœ‰ä¸€ä¸ªè¿”å›å€¼
```ts
function log(message: string): void {
  console.log(message);
}
```

#### èŒƒå‹

åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œè®¸å¤šç®—æ³•å’Œæ•°æ®ç»“æ„å¹¶ä¸ä¼šä¾èµ–äºå¯¹è±¡çš„å®é™…ç±»å‹ã€‚ä½†æ˜¯ï¼Œä½ ä»ç„¶ä¼šæƒ³åœ¨æ¯ä¸ªå˜é‡é‡Œå¼ºåˆ¶æä¾›çº¦æŸã€‚ä¾‹å¦‚ï¼šåœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå®ƒæ¥å—ä¸€ä¸ªåˆ—è¡¨ï¼Œå¹¶ä¸”è¿”å›è¿™ä¸ªåˆ—è¡¨çš„åå‘æ’åºï¼Œè¿™é‡Œçš„çº¦æŸæ˜¯æŒ‡ä¼ å…¥è‡³å‡½æ•°çš„å‚æ•°ä¸å‡½æ•°çš„è¿”å›å€¼ï¼š
```ts
function reverse<T>(items: T[]): T[] {
  const toreturn = [];
  for (let i = items.length - 1; i >= 0; i--) {
    toreturn.push(items[i]);
  }
  return toreturn;
}

const sample = [1, 2, 3];
let reversed = reverse(sample);

console.log(reversed); // 3, 2, 1

// Safety
reversed[0] = '1'; // Error
reversed = ['1', '2']; // Error

reversed[0] = 1; // ok
reversed = [1, 2]; // ok
```

åœ¨ä¸Šä¸ªä¾‹å­ä¸­ï¼Œå‡½æ•° `reverse` æ¥å—ä¸€ä¸ªç±»å‹ä¸º `T`ï¼ˆæ³¨æ„åœ¨ `reverse<T>` ä¸­çš„ç±»å‹å‚æ•°ï¼‰ çš„æ•°ç»„ï¼ˆ`items: T[]`ï¼‰ï¼Œè¿”å›å€¼ä¸ºç±»å‹ `T` çš„ä¸€ä¸ªæ•°ç»„ï¼ˆæ³¨æ„ï¼š`T[]`ï¼‰ï¼Œå‡½æ•° `reverse` çš„è¿”å›å€¼ç±»å‹ä¸å®ƒæ¥å—çš„å‚æ•°çš„ç±»å‹ä¸€æ ·ã€‚å½“ä½ ä¼ å…¥ `const sample = [1, 2, 3]` æ—¶ï¼ŒTypeScript èƒ½æ¨æ–­å‡º `reverse` ä¸º `number[]` ç±»å‹ï¼Œä»è€Œèƒ½ç»™ä½ ç±»å‹å®‰å…¨ã€‚ä¸æ­¤ç›¸ä¼¼ï¼Œå½“ä½ ä¼ å…¥ä¸€ä¸ªç±»å‹ä¸º `string[]` ç±»å‹çš„æ•°ç»„æ—¶ï¼ŒTypeScript èƒ½æ¨æ–­ `reverse` ä¸º `string[]` ç±»å‹ï¼Œå¦‚ä¸‹ä¾‹å­æ‰€ç¤ºï¼š
```ts
const strArr = ['1', '2'];
let reversedStrs = reverse(strArr);

reversedStrs = [1, 2]; // Error
```

äº‹å®ä¸Šï¼ŒJavaScript æ•°ç»„å·²ç»æ‹¥æœ‰äº† reverse çš„æ–¹æ³•ï¼ŒTypeScript ä¹Ÿç¡®å®ä½¿ç”¨äº†æ³›å‹æ¥å®šä¹‰å…¶ç»“æ„ï¼š
```ts
interface Array<T> {
  reverse(): T[];
}
```

æ„å‘³ç€ï¼Œå½“ä½ åœ¨æ•°ç»„ä¸Šè°ƒç”¨ `.reverse` æ–¹æ³•æ—¶ï¼Œå°†ä¼šè·å¾—ç±»å‹å®‰å…¨ï¼š
```ts
let numArr = [1, 2];
let reversedNums = numArr.reverse();

reversedNums = ['1', '2']; // Error
```

å½“ç¨ååœ¨ [ç¯å¢ƒå£°æ˜](#ç¯å¢ƒå£°æ˜) ç« èŠ‚ä¸­æåŠ `lib.d.ts` æ—¶ï¼Œæˆ‘ä»¬ä¼šè®¨è®ºæ›´å¤šå…³äº `Array<T>` çš„ä¿¡æ¯ã€‚

#### è”åˆç±»å‹

åœ¨ JavaScript ä¸­ï¼Œä½ å¯èƒ½å¸Œæœ›å±æ€§ä¸ºå¤šç§ç±»å‹ä¹‹ä¸€ï¼Œå¦‚å­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ã€‚è¿™æ­£æ˜¯ TypeScript ä¸­è”åˆç±»å‹èƒ½æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ï¼ˆå®ƒä½¿ç”¨ `|` ä½œä¸ºæ ‡è®°ï¼Œå¦‚ `string | number`ï¼‰ã€‚å…³äºè”åˆç±»å‹ï¼Œä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯ä¸€ä¸ªå¯ä»¥æ¥å—å­—ç¬¦ä¸²æ•°ç»„æˆ–å•ä¸ªå­—ç¬¦ä¸²çš„å‡½æ•°ï¼š
```ts
function formatCommandline(command: string[] | string) {
  let line = '';
  if (typeof command === 'string') {
    line = command.trim();
  } else {
    line = command.join(' ').trim();
  }

  // Do stuff with line: string
}
```

#### äº¤å‰ç±»å‹

åœ¨ JavaScript ä¸­ï¼Œ `extend` æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„æ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œä½ å¯ä»¥ä»ä¸¤ä¸ªå¯¹è±¡ä¸­åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ–°å¯¹è±¡æ‹¥æœ‰ç€ä¸¤ä¸ªå¯¹è±¡æ‰€æœ‰çš„åŠŸèƒ½ã€‚äº¤å‰ç±»å‹å¯ä»¥è®©ä½ å®‰å…¨çš„ä½¿ç”¨æ­¤ç§æ¨¡å¼ï¼š
```ts
function extend<T extends object, U extends object>(first: T, second: U): T & U {
  const result = <T & U>{};
  for (let id in first) {
    (<T>result)[id] = first[id];
  }
  for (let id in second) {
    if (!result.hasOwnProperty(id)) {
      (<U>result)[id] = second[id];
    }
  }

  return result;
}

const x = extend({ a: 'hello' }, { b: 42 });

// ç°åœ¨ x æ‹¥æœ‰äº† a å±æ€§ä¸ b å±æ€§
const a = x.a;
const b = x.b;
```

#### å…ƒç»„ç±»å‹

JavaScript å¹¶ä¸æ”¯æŒå…ƒç»„ï¼Œå¼€å‘è€…ä»¬é€šå¸¸åªèƒ½ä½¿ç”¨æ•°ç»„æ¥è¡¨ç¤ºå…ƒç»„ã€‚è€Œ TypeScript æ”¯æŒå®ƒï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨ `:[typeofmember1, typeofmember2]` çš„å½¢å¼ï¼Œä¸ºå…ƒç»„æ·»åŠ ç±»å‹æ³¨è§£ï¼Œå…ƒç»„å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„æˆå‘˜ï¼Œç¤ºä¾‹ï¼š
```ts
let nameNumber: [string, number];

// Ok
nameNumber = ['Jenny', 221345];

// Error
nameNumber = ['Jenny', '221345'];
```

å°†å…¶ä¸ TypeScript ä¸­çš„è§£æ„ä¸€èµ·ä½¿ç”¨ï¼š
```ts
let nameNumber: [string, number];
nameNumber = ['Jenny', 322134];

const [name, num] = nameNumber;
```

#### ç±»å‹åˆ«å

TypeScript æä¾›äº†ä¸ºç±»å‹æ³¨è§£è®¾ç½®åˆ«åçš„ä¾¿æ·è¯­æ³•ï¼Œä½ å¯ä»¥ä½¿ç”¨ `type SomeName = someValidTypeAnnotation` æ¥åˆ›å»ºåˆ«åï¼š
```ts
type StrOrNum = string | number;

// ä½¿ç”¨
let sample: StrOrNum;
sample = 123;
sample = '123';

// ä¼šæ£€æŸ¥ç±»å‹
sample = true; // Error
```

ä¸æ¥å£ä¸åŒï¼Œä½ å¯ä»¥ä¸ºä»»æ„çš„ç±»å‹æ³¨è§£æä¾›ç±»å‹åˆ«åï¼ˆåœ¨è”åˆç±»å‹å’Œäº¤å‰ç±»å‹ä¸­æ¯”è¾ƒå®ç”¨ï¼‰ï¼Œä¸‹é¢æ˜¯ä¸€äº›èƒ½è®©ä½ ç†Ÿæ‚‰ç±»å‹åˆ«åè¯­æ³•çš„ç¤ºä¾‹ã€‚
```ts
type Text = string | { text: string };
type Coordinates = [number, number];
type Callback = (data: string) => void;
```

:::tip
- å¦‚æœä½ éœ€è¦ä½¿ç”¨ç±»å‹æ³¨è§£çš„å±‚æ¬¡ç»“æ„ï¼Œè¯·ä½¿ç”¨æ¥å£ã€‚å®ƒèƒ½ä½¿ç”¨ `implements` å’Œ `extends`
- ä¸ºä¸€ä¸ªç®€å•çš„å¯¹è±¡ç±»å‹ï¼ˆå¦‚ä¸Šé¢ä¾‹å­ä¸­çš„ Coordinatesï¼‰ä½¿ç”¨ç±»å‹åˆ«åï¼Œåªéœ€è¦ç»™å®ƒä¸€ä¸ªè¯­ä¹‰åŒ–çš„åå­—å³å¯ã€‚å¦å¤–ï¼Œå½“ä½ æƒ³ç»™è”åˆç±»å‹å’Œäº¤å‰ç±»å‹æä¾›ä¸€ä¸ªè¯­ä¹‰åŒ–çš„åç§°æ—¶ï¼Œä¸€ä¸ªç±»å‹åˆ«åå°†ä¼šæ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚
:::

#### æœ€å

ç°åœ¨ä½ å·²ç»èƒ½å¤Ÿä¸ºä½ çš„å¤§éƒ¨åˆ† JavaScript ä»£ç æ·»åŠ ç±»å‹æ³¨è§£ï¼Œæ¥ç€ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ TypeScript çš„ç±»å‹ç³»ç»Ÿå§ã€‚

### ä»JavaScript è¿ç§»

é¦–å…ˆï¼Œå‡è®¾å¦‚ä¸‹ï¼š
- ä½ äº†è§£ JavaScriptï¼›
- ä½ äº†è§£åœ¨é¡¹ç›®ä¸­å¸¸ç”¨çš„æ–¹å¼å’Œæ„å»ºå·¥å…·ï¼ˆå¦‚ï¼šwebpackï¼‰ã€‚

æœ‰äº†ä»¥ä¸Šå‡è®¾ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå°† JavaScript ä»£ç è¿ç§»è‡³ TypeScript åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š
- æ·»åŠ ä¸€ä¸ª `tsconfig.json` æ–‡ä»¶ï¼›
- æŠŠæ–‡ä»¶æ‰©å±•åä» `.js` æ”¹æˆ `.ts`ï¼Œå¼€å§‹ä½¿ç”¨ `any` æ¥å‡å°‘é”™è¯¯ï¼›
- å¼€å§‹åœ¨ TypeScript ä¸­å†™ä»£ç ï¼Œå°½å¯èƒ½çš„å‡å°‘ `any` çš„ä½¿ç”¨ï¼›
- å›åˆ°æ—§ä»£ç ï¼Œå¼€å§‹æ·»åŠ ç±»å‹æ³¨è§£ï¼Œå¹¶ä¿®å¤å·²è¯†åˆ«çš„é”™è¯¯ï¼›
- ä¸ºç¬¬ä¸‰æ–¹ JavaScript ä»£ç å®šä¹‰ç¯å¢ƒå£°æ˜ã€‚

è®©æˆ‘ä»¬è¿›ä¸€æ­¥è®¨è®ºå…¶ä¸­çš„å‡ ä¸ªå…³é”®ç‚¹ã€‚

è®°ä½ï¼šæ‰€æœ‰çš„ JavaScript ä»£ç éƒ½æ˜¯æœ‰æ•ˆçš„ TypeScript ä»£ç ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœè®© TypeScript ç¼–è¯‘å™¨ç¼–è¯‘ TypeScript é‡Œçš„ JavaScript ä»£ç ï¼Œç¼–è¯‘åçš„ç»“æœå°†ä¼šä¸åŸå§‹çš„ JavaScript ä»£ç ä¸€æ¨¡ä¸€æ ·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠŠæ–‡ä»¶æ‰©å±•åä» `.js` æ”¹æˆ `.ts` å°†ä¸ä¼šé€ æˆä»»ä½•è´Ÿé¢çš„å½±å“ã€‚

#### å‡å°‘é”™è¯¯

ä»£ç è¢«è¿ç§»è‡³ TypeScript åï¼ŒTypeScript å°†ä¼šç«‹å³å¯¹ä½ çš„ä»£ç è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œä½ çš„ JavaScript ä»£ç å¯èƒ½å¹¶ä¸åƒæƒ³è±¡ä¸­é‚£æ ·æ•´é½äº†ï¼Œå› æ­¤ä½ å¯èƒ½ä¼šæ”¶åˆ°ä¸€äº›æŠ¥é”™ä¿¡æ¯ã€‚è¿™æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ any æ¥è§£å†³å¤§éƒ¨åˆ†çš„æŠ¥é”™é—®é¢˜ï¼š
```ts
let foo = 123;
let bar = 'hey';

bar = foo; // Error: ä¸èƒ½æŠŠ number ç±»å‹èµ‹å€¼ç»™ string ç±»å‹
```

è™½ç„¶è¿™äº›é”™è¯¯æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ ¹æ®è¿™äº›é”™è¯¯æ‰€æ¨æ–­å‡ºçš„ä¿¡æ¯æ¯”ä»£ç åº“çš„ä¸åŒéƒ¨åˆ†çš„åŸå§‹ä½œè€…æƒ³è±¡çš„æ›´å¥½ï¼Œä½†æ˜¯ä½ çš„é‡ç‚¹æ˜¯åœ¨é€æ­¥æ›´æ–°æ—§ä»£ç åº“çš„åŒæ—¶ï¼Œç”¨ TypeScript ç¼–å†™æ–°ä»£ç ã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥ä½¿ç”¨ç±»å‹æ–­è¨€æ¥å‡å°‘æ­¤é”™è¯¯ï¼š
```ts
let foo = 123;
let bar = 'hey';

bar = foo as any; // ok
```

ä»å¦ä¸€æ–¹é¢æ¥è¯´ï¼Œä½ å¯èƒ½æƒ³ç”¨ any ç”¨ä½œç±»å‹æ³¨è§£ï¼š
```ts
function foo() {
  return 1;
}

let bar = 'hey';
bar = foo(); // Error: ä¸èƒ½æŠŠä¸€ä¸ª number ç±»å‹èµ‹å€¼ç»™ string ç±»å‹
```

å‡å°‘è¿™ç§é”™è¯¯ï¼š
```ts
function foo(): any {
  // æ·»åŠ  'any'
  return 1;
}

let bar = 'hey';
bar = foo();
```

:::info
ä½¿ç”¨æ­¤ç§æ–¹å¼æ¥å‡å°‘é”™è¯¯æ˜¯å±é™©çš„ï¼Œä½†æ˜¯å®ƒå…è®¸ä½ å°†æ³¨æ„åŠ›è½¬ç§»åˆ°ä½ çš„æ–° TypeScript ä»£ç é”™è¯¯ä¸Šã€‚å½“ä½ è¿›è¡Œä¸‹ä¸€æ­¥å‰ï¼Œæœ€å¥½è¦ç•™ä¸‹ `// TODO` çš„æ³¨é‡Šã€‚
:::

#### ç¬¬ä¸‰æ–¹ä»£ç 

ä½ å¯ä»¥å°†ä½ çš„ JavaScript ä»£ç æ”¹æˆ TypeScript ä»£ç ï¼Œä½†æ˜¯ä½ ä¸èƒ½è®©æ•´ä¸ªä¸–ç•Œéƒ½ä½¿ç”¨ TypeScriptã€‚è¿™æ­£æ˜¯ TypeScript ç¯å¢ƒå£°æ˜æ”¯æŒçš„åœ°æ–¹ã€‚æˆ‘å»ºè®®ä½ ä»¥åˆ›å»ºä¸€ä¸ª `vendor.d.ts` æ–‡ä»¶ä½œä¸ºå¼€å§‹ï¼ˆ`.d.ts` æ–‡ä»¶æ‰©å±•åæŒ‡å®šè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå£°æ˜æ–‡ä»¶ï¼‰ï¼Œç„¶åæˆ‘å‘æ–‡ä»¶é‡Œæ·»åŠ ä¸œè¥¿ã€‚æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªé’ˆå¯¹äºç‰¹å®šåº“çš„å£°æ˜æ–‡ä»¶ï¼Œå¦‚ä¸º jquery åˆ›å»º `jquery.d.ts` æ–‡ä»¶ã€‚
:::tip
å‡ ä¹æ’åå‰ 90% çš„ JavaScript åº“çš„å£°æ˜æ–‡ä»¶å­˜åœ¨äº [DefinitelyTyped](https://github.com/DefinitelyTyped/DefinitelyTyped) ä»“åº“é‡Œï¼Œåœ¨åˆ›å»ºè‡ªå·±å®šä¹‰çš„å£°æ˜æ–‡ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å»ºè®®ä½ å…ˆå»ä»“åº“ä¸­å¯»æ‰¾æ˜¯å¦æœ‰å¯¹åº”çš„å£°æ˜æ–‡ä»¶ã€‚å°½ç®¡å¦‚æ­¤ï¼Œåˆ›å»ºä¸€ä¸ªå£°æ˜æ–‡ä»¶è¿™ç§å¿«é€Ÿä½†ä¸å¥½çš„æ–¹å¼æ˜¯å‡å°ä½¿ç”¨ TypeScript åˆå§‹é˜»åŠ›çš„é‡è¦æ­¥éª¤
:::

æ ¹æ® `jquery` çš„ä½¿ç”¨ï¼Œä½ å¯ä»¥éå¸¸ç®€å•å¿«é€Ÿçš„ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå®šä¹‰ï¼š
```ts
declare var $: any;
```

æœ‰æ—¶ï¼Œä½ å¯èƒ½æƒ³åœ¨æŸäº›å†…å®¹ï¼ˆå¦‚ `jQuery`ï¼‰ä¸Šæ·»åŠ æ˜¾å¼çš„æ³¨è§£ï¼Œå¹¶ä¸”ä½ ä¼šåœ¨ç±»å‹å£°æ˜ç©ºé—´ä¸­ä½¿ç”¨å®ƒã€‚ä½ å¯ä»¥é€šè¿‡ type å…³é”®å­—å¿«é€Ÿçš„å®ç°å®ƒï¼š
```ts
declare type JQuery = any;
declare var $: JQuery;
```

è¿™æä¾›ç»™ä½ ä¸€ä¸ªæ›´æ¸…æ™°çš„ä½¿ç”¨æ¨¡å¼ã€‚

ä¸€ä¸ªé«˜è´¨é‡çš„ jquery.d.ts å·²ç»åœ¨ DefinitelyTyped ä¸­å­˜åœ¨ã€‚ç°åœ¨ä½ å·²ç»çŸ¥é“å¦‚ä½•åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹ JavaScript æ¨¡å—æ—¶ï¼Œå¿«é€Ÿå…‹æœä» JavaScript è‡³ TypeScript çš„é˜»åŠ›äº†ã€‚åœ¨æ¥ä¸‹å»çš„ç« èŠ‚ï¼Œæˆ‘ä»¬å°†ä¼šè®¨è®ºç¯å¢ƒå£°æ˜ã€‚

#### ç¬¬ä¸‰æ–¹çš„ NPM æ¨¡å—

ä¸å…¨å±€å˜é‡å£°æ˜ç›¸ä¼¼ï¼Œä½ å¯ä»¥å¿«é€Ÿçš„å®šä¹‰ä¸€ä¸ªå…¨å±€æ¨¡å—ï¼Œå¦‚ï¼šå¯¹äº jqueryï¼Œå¦‚æœä½ æƒ³æŠŠå®ƒä½œä¸ºä¸€ä¸ªæ¨¡å—æ¥ä½¿ç”¨ï¼ˆ[NPM(https://www.npmjs.com/package/jquery)]ï¼‰ï¼Œå¯ä»¥è‡ªå·±é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š
```ts
declare module 'jquery';
```

ç„¶åä½ å°±å¯ä»¥åœ¨å¿…è¦æ—¶å¯¼å…¥å®ƒï¼š
```ts
import * as $ from 'jquery';
```

:::tip
å†ä¸€æ¬¡è¯´æ˜ï¼Œä¸€ä¸ªé«˜è´¨é‡çš„ `jquery.d.ts` å·²ç»åœ¨ [DefinitelyTyped](https://github.com/DefinitelyTyped/DefinitelyTyped) ä¸­å­˜åœ¨ï¼Œä½†æ˜¯å¯èƒ½åœ¨ä½ çš„åŒ…é‡Œæ²¡æœ‰ï¼Œé‚£ä¹ˆï¼Œä½ ç°åœ¨æœ‰ä¸€ä¸ªç®€å•å¿«é€Ÿçš„æ–¹å¼æ¥ç»§ç»­è¿ç§»ã€‚
:::

#### é¢å¤–çš„é JavaScript èµ„æº

åœ¨ TypeScript ä¸­ï¼Œç”šè‡³å¯ä»¥å…è®¸ä½ å¯¼å…¥ä»»ä½•æ–‡ä»¶ï¼Œä¾‹å¦‚ `.css` æ–‡ä»¶ï¼ˆå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ webpack æ ·å¼åŠ è½½å™¨æˆ– css æ¨¡å—ï¼‰ï¼Œä½ åªè¦æ·»åŠ å¦‚ä¸‹ä»£ç ï¼ˆæ”¾åœ¨ `global.d.ts`ï¼‰ï¼š
```ts
import * as $ from 'jquery';
```

ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨ `import * as foo from './some/file.css'`ã€‚

ä¸æ­¤ç›¸ä¼¼ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨ html æ¨¡ç‰ˆï¼ˆä¾‹å¦‚ï¼šangularï¼‰ï¼Œä½ å¯ä»¥ï¼š
```ts
declare module '*.html';
```

### @types

æ¯«æ— ç–‘é—®ï¼Œ[DefinitelyTyped](https://github.com/DefinitelyTyped/DefinitelyTyped) æ˜¯ TypeScript æœ€å¤§çš„ä¼˜åŠ¿ä¹‹ä¸€ï¼Œç¤¾åŒºå·²ç»è®°å½•äº† 90% çš„é¡¶çº§ JavaScript åº“ã€‚

è¿™æ„å‘³ç€ï¼Œä½ å¯ä»¥éå¸¸é«˜æ•ˆåœ°ä½¿ç”¨è¿™äº›åº“ï¼Œè€Œæ— é¡»åœ¨å•ç‹¬çš„çª—å£æ‰“å¼€ç›¸åº”æ–‡æ¡£ä»¥ç¡®ä¿è¾“å…¥çš„æ­£ç¡®æ€§ã€‚

#### ä½¿ç”¨ `@types`

ä½ å¯ä»¥é€šè¿‡ `npm` æ¥å®‰è£…ä½¿ç”¨ `@types`ï¼Œä¾‹å¦‚ä¸º `jquery` æ·»åŠ å£°æ˜æ–‡ä»¶ï¼š
```shell
npm install @types/jquery --save-dev
```

`@types` æ”¯æŒå…¨å±€å’Œæ¨¡å—ç±»å‹å®šä¹‰ã€‚

##### å…¨å±€ `@types`

é»˜è®¤æƒ…å†µä¸‹ï¼ŒTypeScript ä¼šè‡ªåŠ¨åŒ…å«æ”¯æŒå…¨å±€ä½¿ç”¨çš„ä»»ä½•å£°æ˜å®šä¹‰ã€‚ä¾‹å¦‚ï¼Œå¯¹äº jqueryï¼Œä½ åº”è¯¥èƒ½å¤Ÿåœ¨é¡¹ç›®ä¸­å¼€å§‹å…¨å±€ä½¿ç”¨ `$`ã€‚

##### æ¨¡å— `@types`

å®‰è£…å®Œä¹‹åï¼Œä¸éœ€è¦ç‰¹åˆ«çš„é…ç½®ï¼Œä½ å°±å¯ä»¥åƒä½¿ç”¨æ¨¡å—ä¸€æ ·ä½¿ç”¨å®ƒï¼š
```ts
import * as $ from 'jquery';

// ç°åœ¨ä½ å¯ä»¥æ­¤æ¨¡å—ä¸­ä»»æ„ä½¿ç”¨$äº† :)
```

#### æ§åˆ¶å…¨å±€

å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºæŸäº›å›¢é˜Ÿè€Œè¨€ï¼Œæ‹¥æœ‰å…è®¸å…¨å±€ä½¿ç”¨çš„å®šä¹‰æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å› æ­¤ï¼Œä½ å¯ä»¥é€šè¿‡é…ç½® `tsconfig.json` çš„ `compilerOptions.types` é€‰é¡¹ï¼Œå¼•å…¥æœ‰æ„ä¹‰çš„ç±»å‹ï¼š
```json
{
  "compilerOptions": {
    "types" : [
      "jquery"
    ]
  }
}
```

å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œé€šè¿‡é…ç½® `compilerOptions.types: [ "jquery" ]` åï¼Œåªå…è®¸ä½¿ç”¨ `jquery` çš„ `@types` åŒ…ï¼Œå³ä½¿è¿™ä¸ªäººå®‰è£…äº†å¦ä¸€ä¸ªå£°æ˜æ–‡ä»¶ï¼Œæ¯”å¦‚ `npm install @types/node`ï¼Œå®ƒçš„å…¨å±€å˜é‡ï¼ˆä¾‹å¦‚ `process`ï¼‰ä¹Ÿä¸ä¼šæ³„æ¼åˆ°ä½ çš„ä»£ç ä¸­ï¼Œç›´åˆ°ä½ å°†å®ƒä»¬æ·»åŠ åˆ° `tsconfig.json` ç±»å‹é€‰é¡¹ã€‚

### ç¯å¢ƒå£°æ˜

> TypeScript çš„è®¾è®¡ç›®æ ‡ä¹‹ä¸€æ˜¯è®©ä½ åœ¨ TypeScript ä¸­å®‰å…¨ã€è½»æ¾åœ°ä½¿ç”¨ç°æœ‰çš„ JavaScript åº“ï¼ŒTypeScript é€šè¿‡å£°æ˜æ–‡ä»¶æ¥åšåˆ°è¿™ä¸€ç‚¹

ç¯å¢ƒå£°æ˜å…è®¸ä½ å®‰å…¨åœ°ä½¿ç”¨ç°æœ‰çš„ JavaScript åº“ï¼Œå¹¶ä¸”èƒ½è®©ä½ çš„ JavaScriptã€CoffeeScript æˆ–è€…å…¶ä»–éœ€è¦ç¼–è¯‘æˆ JavaScript çš„è¯­è¨€é€æ­¥è¿ç§»è‡³ TypeScriptã€‚

å­¦ä¹ ä¸ºç¬¬ä¸‰æ–¹ JavaScript åº“ç¼–å†™ç¯å¢ƒå£°æ˜ï¼Œæ˜¯ä¸€ç§ä¸º TypeScript å†™æ³¨è§£æ¯”è¾ƒå¥½çš„å®è·µæ–¹å¼

#### å£°æ˜æ–‡ä»¶

ä½ å¯ä»¥é€šè¿‡ declare å…³é”®å­—æ¥å‘Šè¯‰ TypeScriptï¼Œä½ æ­£åœ¨è¯•å›¾è¡¨è¿°ä¸€ä¸ªå…¶ä»–åœ°æ–¹å·²ç»å­˜åœ¨çš„ä»£ç ï¼Œå¦‚ï¼šå†™åœ¨ JavaScriptã€CoffeeScript æˆ–è€…æ˜¯åƒæµè§ˆå™¨å’Œ Node.js è¿è¡Œç¯å¢ƒé‡Œçš„ä»£ç ï¼š
```ts
foo = 123; // Error: 'foo' is not defined
```

å’Œï¼š
```ts
declare var foo: any;
foo = 123; // allow
```

ä½ å¯ä»¥é€‰æ‹©æŠŠè¿™äº›å£°æ˜æ”¾å…¥ `.ts` æˆ–è€… `.d.ts` é‡Œã€‚åœ¨ä½ å®é™…çš„é¡¹ç›®é‡Œï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ åº”è¯¥æŠŠå£°æ˜æ”¾å…¥ç‹¬ç«‹çš„ .`d.ts` é‡Œï¼ˆå¯ä»¥ä»ä¸€ä¸ªå‘½åä¸º `global.d.ts` æˆ–è€… `vendor.d.ts` æ–‡ä»¶å¼€å§‹ï¼‰ã€‚

å¦‚æœä¸€ä¸ªæ–‡ä»¶æœ‰æ‰©å±•å `.d.ts`ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªæ ¹çº§åˆ«çš„å£°æ˜éƒ½å¿…é¡»ä»¥ `declare` å…³é”®å­—ä½œä¸ºå‰ç¼€ã€‚è¿™æœ‰åˆ©äºè®©å¼€å‘è€…æ¸…æ¥šçš„çŸ¥é“ï¼Œåœ¨è¿™é‡Œ TypeScript å°†ä¸ä¼šæŠŠå®ƒç¼–è¯‘æˆä»»ä½•ä»£ç ï¼ŒåŒæ—¶å¼€å‘è€…éœ€è¦ç¡®ä¿è¿™äº›åœ¨ç¼–è¯‘æ—¶å­˜åœ¨ã€‚

:::tip
- ç¯å¢ƒå£°æ˜å°±å¥½åƒä½ ä¸ç¼–è¯‘å™¨ä¹‹é—´çš„ä¸€ä¸ªçº¦å®šï¼Œå¦‚æœåœ¨ç¼–è¯‘æ—¶å®ƒä»¬ä¸å­˜åœ¨ï¼Œä½†æ˜¯ä½ å´ä½¿ç”¨äº†å®ƒä»¬ï¼Œç¨‹åºå°†ä¼šåœ¨æ²¡æœ‰è­¦å‘Šçš„æƒ…å†µä¸‹ä¸­æ–­ã€‚
- ç¯å¢ƒå£°æ˜å°±å¥½åƒæ˜¯ä¸€ä¸ªæ–‡æ¡£ã€‚å¦‚æœæºæ–‡ä»¶æ›´æ–°äº†ï¼Œä½ åº”è¯¥åŒæ­¥æ›´æ–°ã€‚æ‰€ä»¥ï¼Œå½“ä½ åœ¨è¿è¡Œæ—¶æœ‰æ–°çš„è¡Œä¸ºæ—¶ï¼Œå¦‚æœæ²¡æœ‰å»æ›´æ–°ç¯å¢ƒå£°æ˜ï¼Œç¼–è¯‘å™¨å°†ä¼šæŠ¥é”™ã€‚
:::

#### å˜é‡

å½“ä½ æƒ³å‘Šè¯‰ TypeScript ç¼–è¾‘å™¨å…³äº process å˜é‡æ—¶ï¼Œä½ å¯ä»¥è¿™ä¹ˆåšï¼š
```ts
declare let process: any;
```

:::tip
ä½ å¹¶ä¸éœ€è¦ä¸º `process` åšè¿™äº›ï¼Œå› ä¸ºè¿™å·²ç»å­˜åœ¨äºç¤¾åŒºç»´æŠ¤çš„ [`node.d.ts`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/node/index.d.ts)
:::

è¿™å…è®¸ä½ ä½¿ç”¨ `process`ï¼Œå¹¶èƒ½æˆåŠŸé€šè¿‡ TypeScript çš„ç¼–è¯‘ï¼š
```ts
process.exit();
```

æˆ‘ä»¬æ¨èå°½å¯èƒ½çš„ä½¿ç”¨æ¥å£ï¼Œä¾‹å¦‚ï¼š
```ts
interface Process {
  exit(code?: number): void;
}

declare let process: Process;
```

å› ä¸ºè¿™å…è®¸å…¶ä»–äººæ‰©å……è¿™äº›å…¨å±€å˜é‡ï¼Œå¹¶ä¸”ä¼šå‘Šè¯‰ TypeScript æœ‰å…³äºè¿™äº›å£°æ˜çš„ä¿®æ”¹ã€‚ä¾‹å¦‚ï¼šè€ƒè™‘åˆ°ä»¥ä¸‹æƒ…å†µï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ª `exitWithLogging` å‡½æ•°è‡³ `process`ï¼š
```ts
interface Process {
  exitWithLogging(code?: number): void;
}

process.exitWithLogging = function() {
  console.log('exiting');
  process.exit.apply(process, arguments);
};
```

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ›´è¯¦ç»†çš„äº†è§£æ¥å£ã€‚

### æ¥å£

æ¥å£è¿è¡Œæ—¶çš„å½±å“ä¸º 0ã€‚åœ¨ TypeScript æ¥å£ä¸­æœ‰å¾ˆå¤šæ–¹å¼æ¥å£°æ˜å˜é‡çš„ç»“æ„ã€‚

ä¸‹é¢ä¸¤ä¸ªæ˜¯ç­‰æ•ˆçš„å£°æ˜, ç¤ºä¾‹ A ä½¿ç”¨å†…è”æ³¨è§£ï¼Œç¤ºä¾‹ B ä½¿ç”¨æ¥å£å½¢å¼ï¼š
```ts
// ç¤ºä¾‹ A
declare const myPoint: { x: number; y: number };

// ç¤ºä¾‹ B
interface Point {
  x: number;
  y: number;
}
declare const myPoint: Point;
```

ç¤ºä¾‹ B çš„å¥½å¤„åœ¨äºï¼Œå¦‚æœæœ‰äººåˆ›å»ºäº†ä¸€ä¸ªåŸºäº `myPoint` çš„åº“æ¥æ·»åŠ æ–°æˆå‘˜, é‚£ä¹ˆä»–å¯ä»¥è½»æ¾å°†æ­¤æˆå‘˜æ·»åŠ åˆ° `myPoint` çš„ç°æœ‰å£°æ˜ä¸­:
```ts
// Lib a.d.ts
interface Point {
  x: number,
  y: number
}
declare const myPoint: Point

// Lib b.d.ts
interface Point {
  z: number
}

// Your code
myPoint.z // Allowed!
```

TypeScript æ¥å£æ˜¯å¼€æ”¾å¼çš„ï¼Œè¿™æ˜¯ TypeScript çš„ä¸€ä¸ªé‡è¦åŸåˆ™ï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨æ¥å£æ¥æ¨¡ä»¿ JavaScript çš„å¯æ‰©å±•æ€§ã€‚

#### ç±»å¯ä»¥å®ç°æ¥å£

å¦‚æœä½ å¸Œæœ›åœ¨ç±»ä¸­ä½¿ç”¨å¿…é¡»è¦è¢«éµå¾ªçš„æ¥å£ï¼ˆç±»ï¼‰æˆ–åˆ«äººå®šä¹‰çš„å¯¹è±¡ç»“æ„ï¼Œå¯ä»¥ä½¿ç”¨ `implements` å…³é”®å­—æ¥ç¡®ä¿å…¶å…¼å®¹æ€§ï¼š
```ts
interface Point {
  x: number;
  y: number;
}

class MyPoint implements Point {
  x: number;
  y: number; // Same as Point
}
```

åŸºæœ¬ä¸Šï¼Œåœ¨ `implements`ï¼ˆå®ç°ï¼‰ å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè¯¥å¤–éƒ¨ `Point` æ¥å£çš„ä»»ä½•æ›´æ”¹éƒ½å°†å¯¼è‡´ä»£ç åº“ä¸­çš„ç¼–è¯‘é”™è¯¯ï¼Œå› æ­¤å¯ä»¥è½»æ¾åœ°ä½¿å…¶ä¿æŒåŒæ­¥ï¼š
```ts
interface Point {
  x: number;
  y: number;
  z: number; // New member
}

class MyPoint implements Point {
  // ERROR : missing member `z`
  x: number;
  y: number;
}

```

æ³¨æ„ï¼Œ`implements` é™åˆ¶äº†ç±»å®ä¾‹çš„ç»“æ„ï¼Œå¦‚ä¸‹æ‰€ç¤º:
```ts
let foo: Point = new MyPoint();
```

ä½†åƒ `foo: Point = MyPoint` è¿™æ ·çš„ä»£ç ï¼Œä¸å…¶å¹¶ä¸æ˜¯ä¸€å›äº‹ã€‚

#### æ³¨æ„

##### å¹¶éæ¯ä¸ªæ¥å£éƒ½æ˜¯å¾ˆå®¹æ˜“å®ç°çš„

æ¥å£æ—¨åœ¨å£°æ˜ JavaScript ä¸­å¯èƒ½å­˜åœ¨çš„ä»»æ„ç»“æ„ã€‚

æ€è€ƒä»¥ä¸‹ä¾‹å­ï¼Œå¯ä»¥ä½¿ç”¨ `new` è°ƒç”¨æŸäº›å†…å®¹ï¼š
```ts
interface Crazy {
  new (): {
    hello: number;
  };
}
```

ä½ å¯èƒ½ä¼šæœ‰ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼š
```ts
class CrazyClass implements Crazy {
  constructor() {
    return { hello: 123 };
  }
}

// Because
const crazy = new CrazyClass(); // crazy would be { hello:123 }

// è¿è¡ŒæŠ¥é”™ï¼Œå› ä¸ºTSç±»å‹æ£€æŸ¥ä¸ä¼šå¯¹constructoræ£€æŸ¥ï¼Œåªä¼šæ£€æŸ¥å’Œå®ä¾‹ç›¸å…³çš„å±æ€§å’Œæ–¹æ³•
```

:::tip æ­£å¸¸è¿è¡Œ
```ts
interface Crazy {
  new (): {
    hello: number;
  };
}
interface ICrazyClass {
  hello: number;
}
class CrazyClass implements Crazy {
  hello: number
  constructor() {
    this.hello = 123
  }
}

function ct1(ct: Crazy) {
  return new ct()
}

// Because
const crazy = ct1(CrazyClass);
```
:::

ä½ å¯ä»¥ä½¿ç”¨æ¥å£å£°æ˜æ‰€æœ‰â€œç–¯ç‹‚çš„â€çš„ JavaScript ä»£ç ï¼Œç”šè‡³å¯ä»¥å®‰å…¨åœ°åœ¨ TypeScript ä¸­ä½¿ç”¨å®ƒä»¬ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ TypeScript ç±»æ¥å®ç°å®ƒä»¬ã€‚

### æšä¸¾

æšä¸¾æ˜¯ç»„ç»‡æ”¶é›†æœ‰å…³è”å˜é‡çš„ä¸€ç§æ–¹å¼ï¼Œè®¸å¤šç¨‹åºè¯­è¨€ï¼ˆå¦‚ï¼šc/c#/Javaï¼‰éƒ½æœ‰æšä¸¾æ•°æ®ç±»å‹ã€‚ä¸‹é¢æ˜¯å®šä¹‰ä¸€ä¸ª TypeScript æšä¸¾ç±»å‹çš„æ–¹å¼ï¼š
```ts
enum CardSuit {
  Clubs,
  Diamonds,
  Hearts,
  Spades
}

// ç®€å•çš„ä½¿ç”¨æšä¸¾ç±»å‹
let Card = CardSuit.Clubs;

// ç±»å‹å®‰å…¨
Card = 'not a member of card suit'; // Error: string ä¸èƒ½èµ‹å€¼ç»™ `CardSuit` ç±»å‹
```

è¿™äº›æšä¸¾ç±»å‹çš„å€¼éƒ½æ˜¯æ•°å­—ç±»å‹ï¼Œå› æ­¤å®ƒä»¬è¢«ç§°ä¸ºæ•°å­—ç±»å‹æšä¸¾ã€‚

#### æ•°å­—ç±»å‹æšä¸¾ä¸æ•°å­—ç±»å‹

æ•°å­—ç±»å‹æšä¸¾ï¼Œå…è®¸æˆ‘ä»¬å°†æ•°å­—ç±»å‹æˆ–è€…å…¶ä»–ä»»ä½•ä¸æ•°å­—ç±»å‹å…¼å®¹çš„ç±»å‹èµ‹å€¼ç»™æšä¸¾ç±»å‹çš„å®ä¾‹ã€‚
```ts
enum Color {
  Red,
  Green,
  Blue
}

let col = Color.Red;
col = 0; // æœ‰æ•ˆçš„ï¼Œè¿™ä¹Ÿæ˜¯ Color.Red
```

#### æ•°å­—ç±»å‹æšä¸¾ä¸è‡ªè´ŸåºŠç±»å‹

åœ¨æˆ‘ä»¬ç»§ç»­æ·±å…¥å­¦ä¹ æšä¸¾ç±»å‹ä¹‹å‰ï¼Œå…ˆæ¥çœ‹çœ‹å®ƒç¼–è¯‘çš„ JavaScript å§ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ TypeScript æšä¸¾ç±»å‹ï¼š
```ts
enum Tristate {
  False,
  True,
  Unknown
}
```

å…¶è¢«ç¼–è¯‘æˆ JavaScript åå¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
var Tristate;
(function(Tristate) {
  Tristate[(Tristate['False'] = 0)] = 'False';
  Tristate[(Tristate['True'] = 1)] = 'True';
  Tristate[(Tristate['Unknown'] = 2)] = 'Unknown';
})(Tristate || (Tristate = {}));
```

å…ˆè®©æˆ‘ä»¬èšç„¦ `Tristate[Tristate['False'] = 0] = 'False'` è¿™è¡Œä»£ç ï¼Œå…¶ä¸­ `Tristate['False'] = 0`çš„æ„æ€æ˜¯å°† `Tristate` å¯¹è±¡é‡Œçš„ `False` æˆå‘˜å€¼è®¾ç½®ä¸º `0`ã€‚æ³¨æ„ï¼ŒJavaScript èµ‹å€¼è¿ç®—ç¬¦è¿”å›çš„å€¼æ˜¯è¢«èµ‹äºˆçš„å€¼ï¼ˆåœ¨æ­¤ä¾‹å­ä¸­æ˜¯ `0`ï¼‰ï¼Œå› æ­¤ä¸‹ä¸€æ¬¡ JavaScript è¿è¡Œæ—¶æ‰§è¡Œçš„ä»£ç æ˜¯ `Tristate[0] = 'False'`ã€‚æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ `Tristate` å˜é‡æ¥æŠŠå­—ç¬¦ä¸²æšä¸¾ç±»å‹æ”¹é€ æˆä¸€ä¸ªæ•°å­—æˆ–è€…æ˜¯æ•°å­—ç±»å‹çš„æšä¸¾ç±»å‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
enum Tristate {
  False,
  True,
  Unknown
}

console.log(Tristate[0]); // 'False'
console.log(Tristate['False']); // 0
console.log(Tristate[Tristate.False]); // 'False' because `Tristate.False == 0`
```

#### æ”¹å˜ä¸æ•°å­—æšä¸¾å…³è”çš„æ•°å­—

é»˜è®¤æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ªæšä¸¾å€¼æ˜¯ `0`ï¼Œç„¶åæ¯ä¸ªåç»­å€¼ä¾æ¬¡é€’å¢ 1ï¼š
```ts
enum Color {
  Red, // 0
  Green, // 1
  Blue // 2
}
```

ä½†æ˜¯ï¼Œä½ å¯ä»¥é€šè¿‡ç‰¹å®šçš„èµ‹å€¼æ¥æ”¹å˜ç»™ä»»ä½•æšä¸¾æˆå‘˜å…³è”çš„æ•°å­—ï¼Œå¦‚ä¸‹ä¾‹å­ï¼Œæˆ‘ä»¬ä» 3 å¼€å§‹ä¾æ¬¡é€’å¢ï¼š
```ts
enum Color {
  DarkRed = 3, // 3
  DarkGreen, // 4
  DarkBlue // 5
}
```

:::tip
æˆ‘é€šå¸¸ç”¨ `= 1` åˆå§‹åŒ–ï¼Œå› ä¸ºåœ¨æšä¸¾ç±»å‹å€¼é‡Œï¼Œå®ƒèƒ½è®©ä½ åšä¸€ä¸ªå®‰å…¨å¯é çš„æ£€æŸ¥ã€‚
:::

#### ä½¿ç”¨æ•°å­—ç±»å‹ä½œä¸ºæ ‡å¿—

æšä¸¾çš„ä¸€ä¸ªå¾ˆå¥½ç”¨é€”æ˜¯ä½¿ç”¨æšä¸¾ä½œä¸ºæ ‡å¿—ã€‚è¿™äº›æ ‡å¿—å…è®¸ä½ æ£€æŸ¥ä¸€ç»„æ¡ä»¶ä¸­çš„æŸä¸ªæ¡ä»¶æ˜¯å¦ä¸ºçœŸã€‚è€ƒè™‘å¦‚ä¸‹ä»£ç ä¾‹å­ï¼Œæˆ‘ä»¬æœ‰ä¸€ç»„å…³äº animals çš„å±æ€§ï¼š
```ts
enum AnimalFlags {
  None        = 0,
  HasClaws    = 1 << 0,
  CanFly      = 1 << 1,
  EatsFish    = 1 << 2,
  Endangered  = 1 << 3
}
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å·¦ç§»çš„ä½è¿ç®—ç¬¦ï¼Œå°†æ•°å­— `1` çš„äºŒè¿›åˆ¶å‘å·¦ç§»åŠ¨ä½ç½®å¾—åˆ°æ•°å­— `0001`ã€`0010`ã€`0100` å’Œ `1000`ï¼ˆæ¢æˆåè¿›åˆ¶ç»“æœæ˜¯ï¼š1, 2, 4, 8ï¼‰ã€‚å½“ä½ åœ¨ä½¿ç”¨è¿™ç§æ ‡è®°çš„æ—¶å€™ï¼Œè¿™äº›ä½è¿ç®—ç¬¦ `|` (æˆ–)ã€`&` ï¼ˆå’Œï¼‰ã€`~ `ï¼ˆéï¼‰å°†ä¼šæ˜¯ä½ æœ€å¥½çš„æœ‹å‹ï¼š
```ts
enum AnimalFlags {
  None        = 0,
  HasClaws    = 1 << 0,
  CanFly      = 1 << 1
}

interface Animal {
  flags: AnimalFlags;
  [key: string]: any;
}

function printAnimalAbilities(animal: Animal) {
  var animalFlags = animal.flags;
  if (animalFlags & AnimalFlags.HasClaws) {
    console.log('animal has claws');
  }
  if (animalFlags & AnimalFlags.CanFly) {
    console.log('animal can fly');
  }
  if (animalFlags == AnimalFlags.None) {
    console.log('nothing');
  }
}

var animal = { flags: AnimalFlags.None };
printAnimalAbilities(animal); // nothing
animal.flags |= AnimalFlags.HasClaws;
printAnimalAbilities(animal); // animal has claws
animal.flags &= ~AnimalFlags.HasClaws;
printAnimalAbilities(animal); // nothing
animal.flags |= AnimalFlags.HasClaws | AnimalFlags.CanFly;
printAnimalAbilities(animal); // animal has claws, animal can fly
```

åœ¨è¿™é‡Œï¼š
- æˆ‘ä»¬ä½¿ç”¨ `|=` æ¥æ·»åŠ ä¸€ä¸ªæ ‡å¿—ï¼›
- ç»„åˆä½¿ç”¨ `&=` å’Œ `~` æ¥æ¸…ç†ä¸€ä¸ªæ ‡å¿—ï¼›
- `|` æ¥åˆå¹¶æ ‡å¿—ã€‚

```ts
enum AnimalFlags {
  None        = 0,
  HasClaws    = 1 << 0,
  CanFly      = 1 << 1,
  EatsFish    = 1 << 2,
  Endangered  = 1 << 3,

  EndangeredFlyingClawedFishEating = HasClaws | CanFly | EatsFish | Endangered
}
```

#### å­—ç¬¦ä¸²æšä¸¾

åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬åªçœ‹åˆ°äº†æ•°å­—ç±»å‹çš„æšä¸¾ï¼Œå®é™…ä¸Šï¼Œæšä¸¾ç±»å‹çš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚
```ts
export enum EvidenceTypeEnum {
  UNKNOWN = '',
  PASSPORT_VISA = 'passport_visa',
  PASSPORT = 'passport',
  SIGHTED_STUDENT_CARD = 'sighted_tertiary_edu_id',
  SIGHTED_KEYPASS_CARD = 'sighted_keypass_card',
  SIGHTED_PROOF_OF_AGE_CARD = 'sighted_proof_of_age_card'
}
```

è¿™äº›å¯ä»¥æ›´å®¹æ˜“è¢«å¤„ç†å’Œè°ƒè¯•ï¼Œå› ä¸ºå®ƒä»¬æä¾›æœ‰æ„ä¹‰/å¯è°ƒè¯•çš„å­—ç¬¦ä¸²ã€‚

ä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬ç”¨äºç®€å•çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼š
```ts
// Where `someStringFromBackend` will be '' | 'passport_visa' | 'passport' ... etc.
const someStringFromBackend: string = "passport"
const value = someStringFromBackend as EvidenceTypeEnum;

// Sample use in code
if (value === EvidenceTypeEnum.PASSPORT) {
  console.log('You provided a passport');
  console.log(value); // `passport`
}
```

#### å¸¸é‡æšä¸¾

```ts
enum Tristate {
  False,
  True,
  Unknown
}

const lie = Tristate.False;
```

`const lie = Tristate.False` ä¼šè¢«ç¼–è¯‘æˆ JavaScript `let lie = Tristate.False` (æ˜¯çš„ï¼Œç¼–è¯‘åä¸ç¼–è¯‘å‰ï¼Œå‡ ä¹ç›¸åŒ)ã€‚è¿™æ„å‘³ç€åœ¨è¿è¡Œæ‰§è¡Œæ—¶ï¼Œå®ƒå°†ä¼šæŸ¥æ‰¾å˜é‡ `Tristate` å’Œ `Tristate.False`ã€‚åœ¨æ­¤å¤„è·å¾—æ€§èƒ½æå‡çš„ä¸€ä¸ªå°æŠ€å·§æ˜¯ä½¿ç”¨å¸¸é‡æšä¸¾ï¼š
```ts
const enum Tristate {
  False,
  True,
  Unknown
}

const lie = Tristate.False;
```

å°†ä¼šè¢«ç¼–è¯‘æˆï¼š
```ts
let lie = 0;
```

ç¼–è¯‘å™¨å°†ä¼šï¼š
- å†…è”æšä¸¾çš„ä»»ä½•ç”¨æ³•ï¼ˆ`0` è€Œä¸æ˜¯ `Tristate.False`ï¼‰ï¼›
- ä¸ä¼šä¸ºæšä¸¾ç±»å‹ç¼–è¯‘æˆä»»ä½• JavaScriptï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿è¡Œæ—¶æ²¡æœ‰ `Tristate` å˜é‡ï¼‰ï¼Œå› ä¸ºå®ƒä½¿ç”¨å†…è”è¯­æ³•ã€‚

##### å¸¸é‡æšä¸¾ `preserveConstEnums` é€‰é¡¹

ä½¿ç”¨å†…è”è¯­æ³•å¯¹æ€§èƒ½æœ‰æ˜æ˜¾çš„æå‡ä½œç”¨ã€‚è¿è¡Œæ—¶æ²¡æœ‰ `Tristate` å˜é‡çš„äº‹å®ï¼Œæ˜¯å› ä¸ºç¼–è¯‘å™¨å¸®åŠ©ä½ æŠŠä¸€äº›åœ¨è¿è¡Œæ—¶æ²¡æœ‰ç”¨åˆ°çš„ä¸ç¼–è¯‘æˆ JavaScriptã€‚ç„¶è€Œï¼Œä½ å¯èƒ½æƒ³è®©ç¼–è¯‘å™¨ä»ç„¶æŠŠæšä¸¾ç±»å‹ç¼–è¯‘æˆ JavaScriptï¼Œç”¨äºå¦‚ä¸Šä¾‹å­ä¸­ä»å­—ç¬¦ä¸²åˆ°æ•°å­—ï¼Œæˆ–è€…æ˜¯ä»æ•°å­—åˆ°å­—ç¬¦ä¸²çš„æŸ¥æ‰¾ã€‚åœ¨è¿™ç§æƒ…æ™¯ä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ç¼–è¯‘é€‰é¡¹ `--preserveConstEnums`ï¼Œå®ƒä¼šç¼–è¯‘å‡º `var Tristate` çš„å®šä¹‰ï¼Œå› æ­¤ä½ åœ¨è¿è¡Œæ—¶ï¼Œæ‰‹åŠ¨ä½¿ç”¨ `Tristate['False']` å’Œ `Tristate[0]`ã€‚å¹¶ä¸”è¿™ä¸ä¼šä»¥ä»»ä½•æ–¹å¼å½±å“å†…è”ã€‚

#### æœ‰é™æ€æ–¹æ³•çš„æšä¸¾

ä½ å¯ä»¥ä½¿ç”¨ `enum` + `namespace` çš„å£°æ˜çš„æ–¹å¼å‘æšä¸¾ç±»å‹æ·»åŠ é™æ€æ–¹æ³•ã€‚å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å°†é™æ€æˆå‘˜ `isBusinessDay` æ·»åŠ åˆ°æšä¸¾ä¸Šï¼š
```ts
enum Weekday {
  Monday,
  Tuesday,
  Wednesday,
  Thursday,
  Friday,
  Saturday,
  Sunday
}

namespace Weekday {
  export function isBusinessDay(day: Weekday) {
    switch (day) {
      case Weekday.Saturday:
      case Weekday.Sunday:
        return false;
      default:
        return true;
    }
  }
}

const mon = Weekday.Monday;
const sun = Weekday.Sunday;

console.log(Weekday.isBusinessDay(mon)); // true
console.log(Weekday.isBusinessDay(sun));
```

#### å¼€æ”¾å¼æšä¸¾

:::tip
ä½ åªæœ‰åœ¨ä¸ä½¿ç”¨æ¨¡å—æ—¶ï¼Œå¼€æ”¾å¼çš„æšä¸¾æ‰æœ‰æ„ä¹‰ï¼Œä½ åº”è¯¥ä½¿ç”¨æ¨¡å—ï¼Œå› æ­¤è¿™éƒ¨åˆ†åœ¨æ–‡ç« æœ€åã€‚
:::

è®©æˆ‘ä»¬å†ä¸€æ¬¡çœ‹çœ‹ç¼–è¯‘æˆ JavaScript çš„æšä¸¾æ˜¯ä»€ä¹ˆæ ·å­ï¼š
```ts
var Tristate;
(function(Tristate) {
  Tristate[(Tristate['False'] = 0)] = 'False';
  Tristate[(Tristate['True'] = 1)] = 'True';
  Tristate[(Tristate['Unknown'] = 2)] = 'Unknown';
})(Tristate || (Tristate = {}));
```

æˆ‘ä»¬å·²ç»è§£é‡Šäº† `Tristate[Tristate['False'] = 0] = 'False'` éƒ¨åˆ†ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹åŒ…è£¹å‡½æ•° `(function (Tristate) { /* code here */})(Tristate || (Tristate = {}))`ï¼Œç‰¹åˆ«æ˜¯ `(Tristate || (Tristate = {}))` éƒ¨åˆ†ã€‚è¿™æ•è·äº†ä¸€ä¸ªå±€éƒ¨å˜é‡ `TriState`ï¼Œå®ƒè¦ä¹ˆæŒ‡å‘å·²ç»å®šä¹‰çš„ `TriState` å€¼ï¼Œè¦ä¹ˆä½¿ç”¨ä¸€ä¸ªæ–°çš„ç©ºå¯¹è±¡æ¥åˆå§‹åŒ–å®ƒã€‚

è¿™æ„å‘³ç€ä½ å¯ä»¥è·¨å¤šä¸ªæ–‡ä»¶æ‹†åˆ†ï¼ˆå’Œæ‰©å±•ï¼‰æšä¸¾å®šä¹‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œä½ å¯ä»¥æŠŠ `Color` çš„å®šä¹‰æ‹†åˆ†è‡³ä¸¤ä¸ªå—ä¸­ï¼š
```ts
enum Color {
  Red,
  Green,
  Blue
}

enum Color {
  DarkRed = 3,
  DarkGreen,
  DarkBlue
}
```

:::tip
ä½ åº”è¯¥åœ¨æšä¸¾çš„å»¶ç»­å—ä¸­ï¼Œé‡æ–°åˆå§‹åŒ–ç¬¬ä¸€ä¸ªæˆå‘˜ï¼ˆæ­¤å¤„ä¸º `DarkRed = 3`ï¼‰ï¼Œä½¿ç”Ÿæˆçš„ä»£ç ä¸ç ´åå…ˆå‰å®šä¹‰çš„å€¼ï¼ˆå³0ã€1...ç­‰å€¼ï¼‰ã€‚å¦‚æœæ‚¨ä»ç„¶ä¸è¿™æ ·åšï¼ŒTypeScript å°†ä¼šå‘å‡ºè­¦å‘Šï¼ˆé”™è¯¯ä¿¡æ¯ï¼š`In an enum with multiple declarations, only one declaration can omit an initializer for its first enum element.`ï¼‰ã€‚
:::

### `lib.d.ts`

å½“ä½ å®‰è£… `TypeScript` æ—¶ï¼Œä¼šé¡ºå¸¦å®‰è£…ä¸€ä¸ª `lib.d.ts` å£°æ˜æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å« JavaScript è¿è¡Œæ—¶ä»¥åŠ DOM ä¸­å­˜åœ¨å„ç§å¸¸è§çš„ç¯å¢ƒå£°æ˜ã€‚
- å®ƒè‡ªåŠ¨åŒ…å«åœ¨ `TypeScript` é¡¹ç›®çš„ç¼–è¯‘ä¸Šä¸‹æ–‡ä¸­ï¼›
- å®ƒèƒ½è®©ä½ å¿«é€Ÿå¼€å§‹ä¹¦å†™ç»è¿‡ç±»å‹æ£€æŸ¥çš„ JavaScript ä»£ç ã€‚

ä½ å¯ä»¥é€šè¿‡æŒ‡å®š `--noLib` çš„ç¼–è¯‘å™¨å‘½ä»¤è¡Œæ ‡å¿—ï¼ˆæˆ–è€…åœ¨ `tsconfig.json` ä¸­æŒ‡å®šé€‰é¡¹ `noLib: true`ï¼‰ä»ä¸Šä¸‹æ–‡ä¸­æ’é™¤æ­¤æ–‡ä»¶ã€‚

#### ä½¿ç”¨ä¾‹å­

çœ‹å¦‚ä¸‹ä¾‹å­ï¼š
```ts
const foo = 123;
const bar = foo.toString();
```

è¿™æ®µä»£ç çš„ç±»å‹æ£€æŸ¥æ­£å¸¸ï¼Œå› ä¸º `lib.d.ts` ä¸ºæ‰€æœ‰ JavaScript å¯¹è±¡å®šä¹‰äº† `toString` æ–¹æ³•ã€‚

å¦‚æœä½ åœ¨ `noLib` é€‰é¡¹ä¸‹ï¼Œä½¿ç”¨ç›¸åŒçš„ä»£ç ï¼Œè¿™å°†ä¼šå‡ºç°ç±»å‹æ£€æŸ¥é”™è¯¯ï¼š
```ts
const foo = 123;
const bar = foo.toString(); // Error: å±æ€§ toString ä¸å­˜åœ¨ç±»å‹ number ä¸Š
```

ç°åœ¨ä½ å·²ç»ç†è§£äº† `lib.d.ts` çš„é‡è¦æ€§ï¼Œè‡³äºå®ƒçš„å†…å®¹æ˜¯æ€ä¹ˆæ ·çš„ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°†ä¼šè§£é‡Šã€‚

#### è§‚å¯Ÿ `lib.d.ts` çš„å†…å®¹

`lib.d.ts` çš„å†…å®¹ä¸»è¦æ˜¯ä¸€äº›å˜é‡å£°æ˜ï¼ˆå¦‚ï¼š`window`ã€`document`ã€`math`ï¼‰å’Œä¸€äº›ç±»ä¼¼çš„æ¥å£å£°æ˜ï¼ˆå¦‚ï¼š`Window`ã€`Document`ã€`Math`ï¼‰ã€‚

å¯»æ‰¾ä»£ç ç±»å‹ï¼ˆå¦‚ï¼š`Math.floor`ï¼‰çš„æœ€ç®€å•æ–¹å¼æ˜¯ä½¿ç”¨ IDE çš„ `F12`ï¼ˆè·³è½¬åˆ°å®šä¹‰ï¼‰ã€‚

è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå˜é‡å£°æ˜çš„ç¤ºä¾‹ï¼Œå¦‚ `window` è¢«å®šä¹‰ä¸ºï¼š
```ts
declare var window: Window;
```

è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ `declare var`ï¼Œåé¢è·Ÿä¸€ä¸ªå˜é‡åç§°ï¼ˆ`window`ï¼‰å’Œä¸€ä¸ªç”¨æ¥ç±»å‹æ³¨è§£çš„æ¥å£ï¼ˆ`Window`ï¼‰ï¼Œè¿™äº›å˜é‡é€šå¸¸æŒ‡å‘ä¸€äº›å…¨å±€çš„æ¥å£ï¼Œä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ `Window` æ¥å£çš„ä¸€å°éƒ¨åˆ†ï¼š
```ts
interface Window
  extends EventTarget,
    WindowTimers,
    WindowSessionStorage,
    WindowLocalStorage,
    WindowConsole,
    GlobalEventHandlers,
    IDBEnvironment,
    WindowBase64 {
  animationStartTime: number;
  applicationCache: ApplicationCache;
  clientInformation: Navigator;
  closed: boolean;
  crypto: Crypto;
  // so on and so forth...
}
```

ä½ å¯ä»¥åœ¨è¿™äº›æ¥å£é‡Œçœ‹åˆ°å¤§é‡çš„ç±»å‹ä¿¡æ¯ï¼Œå½“ä½ ä¸ä½¿ç”¨ TypeScript æ—¶ï¼Œä½ éœ€è¦å°†å®ƒä»¬ä¿å­˜åœ¨ä½ çš„å¤§è„‘é‡Œã€‚ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨ `intellisense` ä¹‹ç±»ä¸œè¥¿ï¼Œä»è€Œå¯ä»¥å‡å°‘å¯¹çŸ¥è¯†çš„è®°å¿†ã€‚

ä½¿ç”¨è¿™äº›å…¨å±€å˜é‡æ˜¯æœ‰åˆ©çš„ã€‚åœ¨ä¸æ›´æ”¹ `lib.d.ts` çš„æƒ…å†µä¸‹ï¼Œå®ƒå¯ä»¥è®©ä½ æ·»åŠ é¢å¤–çš„å±æ€§ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»‹ç»è¿™äº›æ¦‚å¿µã€‚

#### ä¿®æ”¹åŸå§‹ç±»å‹

åœ¨ TypeScript ä¸­ï¼Œæ¥å£æ˜¯å¼€æ”¾å¼çš„ï¼Œè¿™æ„å‘³ç€å½“ä½ æƒ³ä½¿ç”¨ä¸å­˜åœ¨çš„æˆå‘˜æ—¶ï¼Œåªéœ€è¦å°†å®ƒä»¬æ·»åŠ è‡³ `lib.d.ts` ä¸­çš„æ¥å£å£°æ˜ä¸­å³å¯ï¼ŒTypeScript å°†ä¼šè‡ªåŠ¨æ¥æ”¶å®ƒã€‚æ³¨æ„ï¼Œä½ éœ€è¦åœ¨[å…¨å±€æ¨¡å—](#å…¨å±€æ¨¡å—)ä¸­åšè¿™äº›ä¿®æ”¹ï¼Œä»¥ä½¿è¿™äº›æ¥å£ä¸ `lib.d.ts` ç›¸å…³è”ã€‚æˆ‘ä»¬æ¨èä½ åˆ›å»ºä¸€ä¸ªç§°ä¸º `global.d.ts` çš„ç‰¹æ®Šæ–‡ä»¶ã€‚

è¿™é‡Œæœ‰æˆ‘ä»¬éœ€è¦æ·»åŠ è‡³ `Window`ï¼Œ`Math`ï¼Œ`Date` çš„ä¸€äº›ä¾‹å­ï¼š

##### Window

ä»…ä»…æ˜¯æ·»åŠ è‡³ `Window` æ¥å£ï¼š
```ts
interface Window {
  helloWorld(): void;
}
```

è¿™å°†å…è®¸ä½ ä»¥ç±»å‹å®‰å…¨çš„å½¢å¼ä½¿ç”¨å®ƒï¼š
```ts
// Add it at runtime
window.helloWorld = () => console.log('hello world');

// Call it
window.helloWorld();

// æ»¥ç”¨ä¼šå¯¼è‡´é”™è¯¯
window.helloWorld('gracius'); // Error: æä¾›çš„å‚æ•°ä¸ç›®æ ‡ä¸åŒ¹é…
```

##### Math

å…¨å±€å˜é‡ `Math` åœ¨ `lib.d.ts` ä¸­è¢«å®šä¹‰ä¸ºï¼š
```ts
/** An intrinsic object that provides basic mathematics functionality and constants. */
declare var Math: Math;
```

å³å˜é‡ Math æ˜¯ Math çš„ä¸€ä¸ªå®ä¾‹ï¼ŒMath æ¥å£è¢«å®šä¹‰ä¸ºï¼š
```ts
interface Math {
  E: number;
  LN10: number;
  // others ...
}
```

å½“ä½ æƒ³åœ¨ `Math` å…¨å±€å˜é‡ä¸Šæ·»åŠ ä½ éœ€è¦çš„å±æ€§æ—¶ï¼Œä½ åªéœ€è¦æŠŠå®ƒæ·»åŠ åˆ° `Math` çš„å…¨å±€æ¥å£ä¸Šå³å¯ï¼Œä¾‹å¦‚ï¼šåœ¨[seedrandom Project](https://www.npmjs.com/package/seedrandom)é¡¹ç›®é‡Œï¼Œå®ƒæ·»åŠ äº† `seedrandom` å‡½æ•°è‡³å…¨å±€çš„ `Math` å¯¹è±¡ä¸Šï¼Œè¿™å¾ˆå®¹æ˜“è¢«å£°æ˜ï¼š
```ts
interface Math {
  seedrandom(seed?: string): void;
}
```

ä½ å¯ä»¥åƒä¸‹é¢ä¸€æ ·ä½¿ç”¨å®ƒï¼š
```ts
Math.seedrandom();

Math.seedrandom('Any string you want');
```

##### Date

å¦‚æœä½ åœ¨ `lib.d.ts` ä¸­å¯»æ‰¾ `Date` å®šä¹‰çš„å£°æ˜ï¼Œä½ å°†ä¼šæ‰¾åˆ°å¦‚ä¸‹ä»£ç ï¼š
```ts
declare var Date: DateConstructor;
```

æ¥å£ `DateConstructor` ä¸ä¸Šæ–‡ä¸­ `Math` å’Œ `Window` æ¥å£ä¸€æ ·ï¼Œå®ƒæ¶µç›–äº†å¯ä»¥ä½¿ç”¨çš„ `Date` å…¨å±€å˜é‡çš„æˆå‘˜ï¼ˆå¦‚ï¼š`Date.now()`ï¼‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜åŒ…å«äº†å¯ä»¥è®©ä½ åˆ›å»º `Date` å®ä¾‹çš„æ„é€ å‡½æ•°ç­¾åï¼ˆå¦‚ï¼š`new Date()`ï¼‰ã€‚`DateConstructor` æ¥å£çš„ä¸€éƒ¨åˆ†ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
interface DateConstructor {
  new (): Date;
  // ä¸€äº›å…¶ä»–çš„æ„é€ å‡½æ•°ç­¾å

  now(): number;

  // å…¶ä»–æˆå‘˜å‡½æ•°
}
```

åœ¨ [datejs](https://github.com/abritinthebay/datejs) é‡Œï¼Œå®ƒåœ¨ Date çš„å…¨å±€å˜é‡ä»¥åŠ Date å®ä¾‹ä¸ŠåŒæ—¶æ·»åŠ äº†æˆå‘˜ï¼Œå› æ­¤è¿™ä¸ªåº“çš„ TypeScript å®šä¹‰çœ‹èµ·æ¥åƒå¦‚ä¸‹æ‰€ç¤ºï¼ˆç¤¾åŒºå·²ç»[å®šä¹‰](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/datejs/index.d.ts)å¥½äº†ï¼‰ï¼š
```ts
// DateJS å…¬å¼€çš„é™æ€æ–¹æ³•
interface DateConstructor {
  /** Gets a date that is set to the current date. The time is set to the start of the day (00:00 or 12:00 AM) */
  today(): Date;
  // ... so on and so forth
}

// DateJS å…¬å¼€çš„å®ä¾‹æ–¹æ³•
interface Date {
  /** Adds the specified number of milliseconds to this instance. */
  addMilliseconds(milliseconds: number): Date;
  // ... so on and so forth
}
```

è¿™å…è®¸ä½ åœ¨ç±»å‹å®‰å…¨çš„æƒ…å†µä¸‹åšï¼š
```ts
const today = Date.today();
const todayAfter1second = today.addMilliseconds(1000);
```

##### string

å¦‚æœä½ åœ¨ `lib.d.ts` é‡Œå¯»æ‰¾ `string`ï¼Œä½ å°†ä¼šæ‰¾åˆ°ä¸ `Date` ç›¸ç±»ä¼¼çš„å†…å®¹ï¼ˆå…¨å±€å˜é‡ `String`ï¼ŒStringConstructor æ¥å£ï¼Œ`String` æ¥å£ï¼‰ã€‚ä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ`String` æ¥å£ä¹Ÿä¼šå½±å“å­—ç¬¦ä¸²å­—é¢é‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
interface String {
  endsWith(suffix: string): boolean;
}

String.prototype.endsWith = function(suffix: string): boolean {
  const str: string = this;
  return str && str.indexOf(suffix, str.length - suffix.length) !== -1;
};

console.log('foo bar'.endsWith('bas')); // false
console.log('foo bas'.endsWith('bas')); // true
```

##### ç»ˆæ string

åŸºäºå¯ç»´æŠ¤æ€§ï¼Œæˆ‘ä»¬æ¨èåˆ›å»ºä¸€ä¸ª `global.d.ts` æ–‡ä»¶ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ `declare global { /* global namespace */ }`ï¼Œä»æ–‡ä»¶æ¨¡å—ä¸­è¿›å…¥å…¨å±€å‘½åç©ºé—´ï¼š
```ts
// ç¡®ä¿æ˜¯æ¨¡å—
export {};

declare global {
  interface String {
    endsWith(suffix: string): boolean;
  }
}

String.prototype.endsWith = function(suffix: string): boolean {
  const str: string = this;
  return str && str.indexOf(suffix, str.length - suffix.length) !== -1;
};

console.log('foo bar'.endsWith('bas')); // false
console.log('foo bas'.endsWith('bas')); // true
```

#### ä½¿ç”¨ä½ è‡ªå·±å®šä¹‰çš„ lib.d.ts

æ­£å¦‚ä¸Šæ–‡æ‰€è¯´ï¼Œä½¿ç”¨ `--noLib` ç¼–è¯‘é€‰é¡¹ä¼šå¯¼è‡´ TypeScript æ’é™¤è‡ªåŠ¨åŒ…å«çš„ `lib.d.ts` æ–‡ä»¶ã€‚ä¸ºä»€ä¹ˆè¿™ä¸ªåŠŸèƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œæˆ‘ä¾‹ä¸¾äº†ä¸€äº›å¸¸è§åŸå› ï¼š
- è¿è¡Œçš„ JavaScript ç¯å¢ƒä¸åŸºäºæ ‡å‡†æµè§ˆå™¨è¿è¡Œæ—¶ç¯å¢ƒæœ‰å¾ˆå¤§ä¸åŒï¼›
- ä½ å¸Œæœ›åœ¨ä»£ç é‡Œä¸¥æ ¼çš„æ§åˆ¶å…¨å±€å˜é‡ï¼Œä¾‹å¦‚ï¼š`lib.d.ts` å°† `item` å®šä¹‰ä¸ºå…¨å±€å˜é‡ï¼Œä½ ä¸å¸Œæœ›å®ƒæ³„æ¼åˆ°ä½ çš„ä»£ç é‡Œã€‚

ä¸€æ—¦ä½ æ’é™¤äº†é»˜è®¤çš„ `lib.d.ts` æ–‡ä»¶ï¼Œä½ å°±å¯ä»¥åœ¨ç¼–è¯‘ä¸Šä¸‹æ–‡ä¸­åŒ…å«ä¸€ä¸ªå‘½åç›¸ä¼¼çš„æ–‡ä»¶ï¼ŒTypeScript å°†æå–è¯¥æ–‡ä»¶è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚

:::tip
å°å¿ƒä½¿ç”¨ `--noLib` é€‰é¡¹ï¼Œä¸€æ—¦ä½ ä½¿ç”¨äº†å®ƒï¼Œå½“ä½ æŠŠä½ çš„é¡¹ç›®åˆ†äº«ç»™å…¶ä»–äººæ—¶ï¼Œå®ƒä»¬ä¹Ÿå°†è¢«è¿«ä½¿ç”¨ `--noLib` é€‰é¡¹ï¼Œæ›´ç³Ÿç³•çš„æ˜¯ï¼Œå¦‚æœå°†è¿™äº›ä»£ç æ”¾å…¥ä½ çš„é¡¹ç›®ä¸­ï¼Œä½ å¯èƒ½éœ€è¦å°†å®ƒä»¬ç§»æ¤åˆ°åŸºäºä½ çš„ä»£ç çš„ `lib` ä¸­ã€‚
:::

#### ç¼–è¯‘ç›®æ ‡å¯¹ `lib.d.ts` çš„å½±å“

è®¾ç½®ç¼–è¯‘ç›®æ ‡ä¸º `es6` æ—¶ï¼Œèƒ½å¯¼è‡´ `lib.d.ts` åŒ…å«æ›´å¤šåƒ Promise ç°ä»£ï¼ˆes6ï¼‰å†…å®¹çš„ç¯å¢ƒå£°æ˜ã€‚ç¼–è¯‘å™¨ç›®æ ‡çš„è¿™ç§ä½œç”¨ï¼Œæ”¹å˜äº†ä»£ç çš„ç¯å¢ƒï¼Œè¿™å¯¹æŸäº›äººæ¥è¯´æ˜¯ç†æƒ³çš„ï¼Œä½†æ˜¯è¿™å¯¹å¦å¤–ä¸€äº›äººæ¥è¯´é€ æˆäº†å›°æ‰°ï¼Œå› ä¸ºå®ƒå°†ç¼–è¯‘å‡ºçš„ä»£ç ä¸ç¯å¢ƒæ··ä¸ºä¸€è°ˆã€‚

å½“ä½ æƒ³å¯¹ç¯å¢ƒè¿›è¡Œæ›´ç»†ç²’çš„æ§åˆ¶æ—¶ï¼Œä½ åº”è¯¥ä½¿ç”¨æˆ‘ä»¬æ¥ä¸‹æ¥å°†è¦è®¨è®ºçš„ `--lib` é€‰é¡¹ã€‚

#### `--lib` é€‰é¡¹

æœ‰æ—¶ï¼Œä½ æƒ³è¦è§£è€¦ç¼–è¯‘ç›®æ ‡ï¼ˆå³ç”Ÿæˆçš„ JavaScript ç‰ˆæœ¬ï¼‰å’Œç¯å¢ƒåº“æ”¯æŒä¹‹é—´çš„å…³ç³»ã€‚ä¾‹å¦‚å¯¹äº Promiseï¼Œä½ çš„ç¼–è¯‘ç›®æ ‡æ˜¯ `--target es5`ï¼Œä½†æ˜¯ä½ ä»ç„¶æƒ³ä½¿ç”¨å®ƒï¼Œè¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ `lib` å¯¹å®ƒè¿›è¡Œæ§åˆ¶ã€‚

:::tip
ä½¿ç”¨ --lib é€‰é¡¹å¯ä»¥å°†ä»»ä½• lib ä¸ --target è§£è€¦ã€‚
:::

ä½ å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæˆ–è€…åœ¨ `tsconfig.json` ä¸­æä¾›æ­¤é€‰é¡¹ï¼ˆæ¨èï¼‰ï¼š

##### å‘½ä»¤è¡Œ

```shell
tsc --target es5 --lib dom,es6
```

##### config.json

```json
"compilerOptions": {
  "lib": ["dom", "es6"]
}
```

`lib` åˆ†ç±»å¦‚ä¸‹ï¼š
- JavaScript åŠŸèƒ½
  - es5
  - es6
  - es2015
  - es7
  - es2016
  - es2017
  - esnext
- è¿è¡Œç¯å¢ƒ
  - dom
  - dom.iterable
  - webworker
  - scripthost
- ESNext åŠŸèƒ½é€‰é¡¹
  - es2015.core
  - es2015.collection
  - es2015.generator
  - es2015.iterable
  - es2015.promise
  - es2015.proxy
  - es2015.reflect
  - es2015.symbol
  - es2015.symbol.wellknown
  - es2016.array.include
  - es2017.object
  - es2017.sharedmemory
  - esnext.asynciterable

:::tip
`--lib` é€‰é¡¹æä¾›éå¸¸ç²¾ç»†çš„æ§åˆ¶ï¼Œå› æ­¤ä½ æœ€æœ‰å¯èƒ½ä»è¿è¡Œç¯å¢ƒä¸ JavaScript åŠŸèƒ½ç±»åˆ«ä¸­åˆ†åˆ«é€‰æ‹©ä¸€é¡¹ï¼Œå¦‚æœä½ æ²¡æœ‰æŒ‡å®š `--lib`ï¼Œåˆ™ä¼šå¯¼å…¥é»˜è®¤åº“ï¼š

- `--target` é€‰é¡¹ä¸º es5 æ—¶ï¼Œä¼šå¯¼å…¥ es5, dom, scripthostã€‚
- `--target` é€‰é¡¹ä¸º es6 æ—¶ï¼Œä¼šå¯¼å…¥ es6, dom, dom.iterable, scripthostã€‚
:::

æˆ‘ä¸ªäººçš„æ¨èï¼š
```json
"compilerOptions": {
  "target": "es5",
  "lib": ["es6", "dom"]
}
```

åŒ…æ‹¬ä½¿ç”¨ Symbol çš„ ES5 ä½¿ç”¨ä¾‹å­ï¼š
```json
"compilerOptions": {
  "target": "es5",
  "lib": ["es5", "dom", "scripthost", "es2015.symbol"]
}
```

#### åœ¨æ—§çš„ JavaScript å¼•æ“æ—¶ä½¿ç”¨ Polyfill

è¦ä½¿ç”¨ä¸€äº›æ–°åŠŸèƒ½å¦‚ `Map`ã€`Set`ã€`Promise`ï¼ˆéšç€æ—¶é—´æ¨ç§»ä¼šå˜åŒ–ï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨ç°ä»£çš„ `lib` é€‰é¡¹ï¼Œå¹¶ä¸”éœ€è¦å®‰è£… `core-js`ï¼š
```shell
npm install core-js --save-dev
```

æ¥ç€ï¼Œåœ¨ä½ çš„é¡¹ç›®é‡Œå¯¼å…¥å®ƒï¼š
```ts
import 'core-js';
```

### å‡½æ•°

å‡½æ•°ç±»å‹åœ¨ TypeScript ç±»å‹ç³»ç»Ÿä¸­æ‰®æ¼”ç€éå¸¸é‡è¦çš„è§’è‰²ï¼Œå®ƒä»¬æ˜¯å¯ç»„åˆç³»ç»Ÿçš„æ ¸å¿ƒæ„å»ºå—ã€‚

#### å‚æ•°æ³¨è§£

ä½ å¯ä»¥æ³¨è§£å‡½æ•°å‚æ•°ï¼Œå°±åƒä½ å¯ä»¥æ³¨è§£å…¶ä»–å˜é‡ä¸€æ ·:
```ts
// variable annotation
let sampleVariable: { bar: number };

// function parameter annotation
function foo(sampleParameter: { bar: number }) {}
```

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†å†…è”ç±»å‹æ³¨è§£ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨æ¥å£ç­‰å…¶ä»–æ–¹å¼ã€‚

##### è¿”å›ç±»å‹æ³¨è§£

ä½ å¯ä»¥åœ¨å‡½æ•°å‚æ•°åˆ—è¡¨ä¹‹åä½¿ç”¨ä¸å˜é‡ç›¸åŒçš„æ ·å¼æ¥æ³¨è§£è¿”å›ç±»å‹ï¼Œå¦‚ä¾‹å­ä¸­ `ï¼šFoo`ï¼š
```ts
interface Foo {
  foo: string;
}

// Return type annotated as `: Foo`
function foo(sample: Foo): Foo {
  return sample;
}
```

æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ª `interface`ï¼Œä½†ä½ å¯ä»¥è‡ªç”±åœ°ä½¿ç”¨å…¶ä»–æ³¨è§£æ–¹å¼ï¼Œä¾‹å¦‚å†…è”æ³¨è§£ã€‚

é€šå¸¸ï¼Œä½ ä¸éœ€è¦æ³¨è§£å‡½æ•°çš„è¿”å›ç±»å‹ï¼Œå› ä¸ºå®ƒå¯ä»¥ç”±ç¼–è¯‘å™¨æ¨æ–­ï¼š
```ts
interface Foo {
  foo: string;
}

function foo(sample: Foo) {
  return sample; // inferred return type 'Foo'
}
```

ä½†æ˜¯ï¼Œæ·»åŠ è¿™äº›æ³¨è§£ä»¥å¸®åŠ©è§£å†³é”™è¯¯æç¤ºé€šå¸¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œä¾‹å¦‚ï¼š
```ts
function foo() {
  return { fou: 'John Doe' }; // You might not find this misspelling of `foo` till it's too late
}

sendAsJSON(foo());
```

å¦‚æœä½ ä¸æ‰“ç®—ä»å‡½æ•°è¿”å›ä»»ä½•å†…å®¹ï¼Œåˆ™å¯ä»¥å°†å…¶æ ‡æ³¨ä¸ºï¼š`void` ã€‚ä½ é€šå¸¸å¯ä»¥åˆ é™¤ `void`ï¼Œ TypeScript èƒ½æ¨å¯¼å‡ºæ¥ï¼š

##### å¯é€‰å‚æ•°

ä½ å¯ä»¥å°†å‚æ•°æ ‡è®°ä¸ºå¯é€‰:
```ts
function foo(bar: number, bas?: string): void {
  // ..
}

foo(123);
foo(123, 'hello');
```

æˆ–è€…ï¼Œå½“è°ƒç”¨è€…æ²¡æœ‰æä¾›è¯¥å‚æ•°æ—¶ï¼Œä½ å¯ä»¥æä¾›ä¸€ä¸ªé»˜è®¤å€¼ï¼ˆåœ¨å‚æ•°å£°æ˜åä½¿ç”¨ `= someValue` ï¼‰ï¼š
```ts
function foo(bar: number, bas: string = 'hello') {
  console.log(bar, bas);
}

foo(123); // 123, hello
foo(123, 'world'); // 123, world
```

##### é‡è½½

TypeScript å…è®¸ä½ å£°æ˜å‡½æ•°é‡è½½ã€‚è¿™å¯¹äºæ–‡æ¡£ + ç±»å‹å®‰å…¨æ¥è¯´å¾ˆå®ç”¨ã€‚è¯·æ€è€ƒä»¥ä¸‹ä»£ç ï¼š
```ts
function padding(a: number, b?: number, c?: number, d?: any) {
  if (b === undefined && c === undefined && d === undefined) {
    b = c = d = a;
  } else if (c === undefined && d === undefined) {
    c = a;
    d = b;
  }
  return {
    top: a,
    right: b,
    bottom: c,
    left: d
  };
}
```

å¦‚æœä»”ç»†æŸ¥çœ‹ä»£ç ï¼Œå°±ä¼šå‘ç° aï¼Œbï¼Œcï¼Œd çš„å€¼ä¼šæ ¹æ®ä¼ å…¥çš„å‚æ•°æ•°é‡è€Œå˜åŒ–ã€‚æ­¤å‡½æ•°ä¹Ÿåªéœ€è¦ 1 ä¸ªï¼Œ2 ä¸ªæˆ– 4 ä¸ªå‚æ•°ã€‚å¯ä»¥ä½¿ç”¨å‡½æ•°é‡è½½æ¥*å¼ºåˆ¶*å’Œ*è®°å½•*è¿™äº›çº¦æŸã€‚ä½ åªéœ€å¤šæ¬¡å£°æ˜å‡½æ•°å¤´ã€‚æœ€åä¸€ä¸ªå‡½æ•°å¤´æ˜¯åœ¨å‡½æ•°ä½“å†…å®é™…å¤„äºæ´»åŠ¨çŠ¶æ€ä½†ä¸å¯ç”¨äºå¤–éƒ¨ã€‚

å¦‚ä¸‹æ‰€ç¤º:
```ts
// é‡è½½
function padding(all: number);
function padding(topAndBottom: number, leftAndRight: number);
function padding(top: number, right: number, bottom: number, left: number);
// Actual implementation that is a true representation of all the cases the function body needs to handle
function padding(a: number, b?: number, c?: number, d?: number) {
  if (b === undefined && c === undefined && d === undefined) {
    b = c = d = a;
  } else if (c === undefined && d === undefined) {
    c = a;
    d = b;
  }
  return {
    top: a,
    right: b,
    bottom: c,
    left: d
  };
}
```

è¿™é‡Œå‰ä¸‰ä¸ªå‡½æ•°å¤´å¯æœ‰æ•ˆè°ƒç”¨ `padding`:
```ts
padding(1); // Okay: all
padding(1, 1); // Okay: topAndBottom, leftAndRight
padding(1, 1, 1, 1); // Okay: top, right, bottom, left

padding(1, 1, 1); // Error: Not a part of the available overloads
```

å½“ç„¶ï¼Œæœ€ç»ˆå£°æ˜ï¼ˆä»å‡½æ•°å†…éƒ¨çœ‹åˆ°çš„çœŸæ­£å£°æ˜ï¼‰ä¸æ‰€æœ‰é‡è½½å…¼å®¹æ˜¯å¾ˆé‡è¦çš„ã€‚è¿™æ˜¯å› ä¸ºè¿™æ˜¯å‡½æ•°ä½“éœ€è¦è€ƒè™‘çš„å‡½æ•°è°ƒç”¨çš„çœŸå®æ€§è´¨ã€‚

:::tip
TypeScript ä¸­çš„å‡½æ•°é‡è½½æ²¡æœ‰ä»»ä½•è¿è¡Œæ—¶å¼€é”€ã€‚å®ƒåªå…è®¸ä½ è®°å½•å¸Œæœ›è°ƒç”¨å‡½æ•°çš„æ–¹å¼ï¼Œå¹¶ä¸”ç¼–è¯‘å™¨ä¼šæ£€æŸ¥å…¶ä½™ä»£ç ã€‚
:::

##### å‡½æ•°å£°æ˜

> å¿«é€Ÿå¼€å§‹ï¼šç±»å‹æ³¨è§£æ˜¯ä½ æè¿°ç°æœ‰å®ç°ç±»å‹çš„ä¸€ç§æ–¹å¼

åœ¨æ²¡æœ‰æä¾›å‡½æ•°å®ç°çš„æƒ…å†µä¸‹ï¼Œæœ‰ä¸¤ç§å£°æ˜å‡½æ•°ç±»å‹çš„æ–¹å¼:
```ts
type LongHand = {
  (a: number): number;
};

type ShortHand = (a: number) => number;
```

ä¸Šé¢ä»£ç ä¸­çš„ä¸¤ä¸ªä¾‹å­å®Œå…¨ç›¸åŒã€‚ä½†æ˜¯ï¼Œå½“ä½ æƒ³ä½¿ç”¨å‡½æ•°é‡è½½æ—¶ï¼Œåªèƒ½ç”¨ç¬¬ä¸€ç§æ–¹å¼:
```ts
type LongHandAllowsOverloadDeclarations = {
  (a: number): number;
  (a: string): string;
};
```

### å¯è°ƒç”¨çš„

ä½ å¯ä»¥ä½¿ç”¨ç±»å‹åˆ«åæˆ–è€…æ¥å£æ¥è¡¨ç¤ºä¸€ä¸ªå¯è¢«è°ƒç”¨çš„ç±»å‹æ³¨è§£ï¼š
```ts
interface ReturnString {
  (): string;
}
```

å®ƒå¯ä»¥è¡¨ç¤ºä¸€ä¸ªè¿”å›å€¼ä¸º `string` çš„å‡½æ•°ï¼š
```ts
declare const foo: ReturnString;

const bar = foo(); // bar è¢«æ¨æ–­ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚
```

#### ä¸€ä¸ªå®é™…çš„ä¾‹å­

å½“ç„¶ï¼Œåƒè¿™æ ·ä¸€ä¸ªå¯è¢«è°ƒç”¨çš„ç±»å‹æ³¨è§£ï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®å®é™…æ¥ä¼ é€’ä»»ä½•å‚æ•°ã€å¯é€‰å‚æ•°ä»¥åŠ rest å‚æ•°ï¼Œè¿™æœ‰ä¸€ä¸ªç¨å¾®å¤æ‚çš„ä¾‹å­ï¼š
```ts
interface Complex {
  (foo: string, bar?: number, ...others: boolean[]): number;
}
```

ä¸€ä¸ªæ¥å£å¯æä¾›å¤šç§è°ƒç”¨ç­¾åï¼Œç”¨ä»¥ç‰¹æ®Šçš„å‡½æ•°é‡è½½ï¼š
```ts
interface Overloaded {
  (foo: string): string;
  (foo: number): number;
}

// å®ç°æ¥å£çš„ä¸€ä¸ªä¾‹å­ï¼š
function stringOrNumber(foo: number): number;
function stringOrNumber(foo: string): string;
function stringOrNumber(foo: any): any {
  if (typeof foo === 'number') {
    return foo * foo;
  } else if (typeof foo === 'string') {
    return `hello ${foo}`;
  }
}

const overloaded: Overloaded = stringOrNumber;

// ä½¿ç”¨
const str = overloaded(''); // str è¢«æ¨æ–­ä¸º 'string'
const num = overloaded(123); // num è¢«æ¨æ–­ä¸º 'number'
```

è¿™ä¹Ÿå¯ä»¥ç”¨äºå†…è”æ³¨è§£ä¸­ï¼š
```ts
let overloaded: {
  (foo: string): string;
  (foo: number): number;
};
```

#### ç®­å¤´å‡½æ•°

ä¸ºäº†ä½¿æŒ‡å®šå¯è°ƒç”¨çš„ç±»å‹ç­¾åæ›´å®¹æ˜“ï¼ŒTypeScript ä¹Ÿå…è®¸ä½ ä½¿ç”¨ç®€å•çš„ç®­å¤´å‡½æ•°ç±»å‹æ³¨è§£ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªä»¥ number ç±»å‹ä¸ºå‚æ•°ï¼Œä»¥ string ç±»å‹ä¸ºè¿”å›å€¼çš„å‡½æ•°ä¸­ï¼Œä½ å¯ä»¥è¿™ä¹ˆå†™ï¼š
```ts
const simple: (foo: number) => string = foo => foo.toString();
```

:::tip
å®ƒä»…ä»…åªèƒ½ä½œä¸ºç®€å•çš„ç®­å¤´å‡½æ•°ï¼Œä½ æ— æ³•ä½¿ç”¨é‡è½½ã€‚å¦‚æœæƒ³ä½¿ç”¨é‡è½½ï¼Œä½ å¿…é¡»ä½¿ç”¨å®Œæ•´çš„ `{ (someArgs): someReturn }` çš„è¯­æ³•
:::

#### å¯å®ä¾‹åŒ–

å¯å®ä¾‹åŒ–ä»…ä»…æ˜¯å¯è°ƒç”¨çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå®ƒä½¿ç”¨ `new` ä½œä¸ºå‰ç¼€ã€‚å®ƒæ„å‘³ç€ä½ éœ€è¦ä½¿ç”¨ `new` å…³é”®å­—å»è°ƒç”¨å®ƒï¼š
```ts
interface CallMeWithNewToGetString {
  new (): string;
}

// ä½¿ç”¨
declare const Foo: CallMeWithNewToGetString;
const bar = new Foo(); // bar è¢«æ¨æ–­ä¸º string ç±»å‹
```

### ç±»å‹æ–­è¨€

TypeScript å…è®¸ä½ è¦†ç›–å®ƒçš„æ¨æ–­ï¼Œå¹¶ä¸”èƒ½ä»¥ä½ ä»»ä½•ä½ æƒ³è¦çš„æ–¹å¼åˆ†æå®ƒï¼Œè¿™ç§æœºåˆ¶è¢«ç§°ä¸ºã€Œç±»å‹æ–­è¨€ã€ã€‚TypeScript ç±»å‹æ–­è¨€ç”¨æ¥å‘Šè¯‰ç¼–è¯‘å™¨ä½ æ¯”å®ƒæ›´äº†è§£è¿™ä¸ªç±»å‹ï¼Œå¹¶ä¸”å®ƒä¸åº”è¯¥å†å‘å‡ºé”™è¯¯ã€‚

ç±»å‹æ–­è¨€çš„ä¸€ä¸ªå¸¸è§ç”¨ä¾‹æ˜¯å½“ä½ ä» JavaScript è¿ç§»åˆ° TypeScript æ—¶ï¼š
```ts
const foo = {};
foo.bar = 123; // Error: 'bar' å±æ€§ä¸å­˜åœ¨äº â€˜{}â€™
foo.bas = 'hello'; // Error: 'bas' å±æ€§ä¸å­˜åœ¨äº '{}'
```

è¿™é‡Œçš„ä»£ç å‘å‡ºäº†é”™è¯¯è­¦å‘Šï¼Œå› ä¸º `foo` çš„ç±»å‹æ¨æ–­ä¸º `{}`ï¼Œå³æ²¡æœ‰å±æ€§çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œä½ ä¸èƒ½åœ¨å®ƒçš„å±æ€§ä¸Šæ·»åŠ  `bar` æˆ– `bas`ï¼Œä½ å¯ä»¥é€šè¿‡ç±»å‹æ–­è¨€æ¥é¿å…æ­¤é—®é¢˜ï¼š
```ts
interface Foo {
  bar: number;
  bas: string;
}

const foo = {} as Foo;
foo.bar = 123;
foo.bas = 'hello';
```

#### `as foo` ä¸ `<foo>`

æœ€åˆçš„æ–­è¨€è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
let foo: any;
let bar = <string>foo; // ç°åœ¨ bar çš„ç±»å‹æ˜¯ 'string'
```

ç„¶è€Œï¼Œå½“ä½ åœ¨ JSX ä¸­ä½¿ç”¨ `<foo>` çš„æ–­è¨€è¯­æ³•æ—¶ï¼Œè¿™ä¼šä¸ JSX çš„è¯­æ³•å­˜åœ¨æ­§ä¹‰ï¼š
```ts
let foo = <string>bar;</string>;
```

å› æ­¤ï¼Œä¸ºäº†ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬å»ºè®®ä½ ä½¿ç”¨ `as foo` çš„è¯­æ³•æ¥ä¸ºç±»å‹æ–­è¨€ã€‚

#### ç±»å‹æ–­è¨€ä¸ç±»å‹è½¬æ¢

å®ƒä¹‹æ‰€ä»¥ä¸è¢«ç§°ä¸ºã€Œç±»å‹è½¬æ¢ã€ï¼Œæ˜¯å› ä¸ºè½¬æ¢é€šå¸¸æ„å‘³ç€æŸç§è¿è¡Œæ—¶çš„æ”¯æŒã€‚ä½†æ˜¯ï¼Œç±»å‹æ–­è¨€çº¯ç²¹æ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶è¯­æ³•ï¼ŒåŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§ä¸ºç¼–è¯‘å™¨æä¾›å…³äºå¦‚ä½•åˆ†æä»£ç çš„æ–¹æ³•ã€‚

#### ç±»å‹æ–­è¨€è¢«è®¤ä¸ºæ˜¯æœ‰å®³çš„

åœ¨å¾ˆå¤šæƒ…æ™¯ä¸‹ï¼Œæ–­è¨€èƒ½è®©ä½ æ›´å®¹æ˜“çš„ä»é—ç•™é¡¹ç›®ä¸­è¿ç§»ï¼ˆç”šè‡³å°†å…¶ä»–ä»£ç ç²˜è´´å¤åˆ¶åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼‰ï¼Œç„¶è€Œï¼Œä½ åº”è¯¥å°å¿ƒè°¨æ…çš„ä½¿ç”¨æ–­è¨€ã€‚è®©æˆ‘ä»¬ç”¨æœ€åˆçš„ä»£ç ä½œä¸ºç¤ºä¾‹ï¼Œå¦‚æœä½ æ²¡æœ‰æŒ‰çº¦å®šæ·»åŠ å±æ€§ï¼ŒTypeScript ç¼–è¯‘å™¨å¹¶ä¸ä¼šå¯¹æ­¤å‘å‡ºé”™è¯¯è­¦å‘Šï¼š
```ts
interface Foo {
  bar: number;
  bas: string;
}

const foo = {} as Foo;

// ahhh, å¿˜è®°äº†ä»€ä¹ˆï¼Ÿ
```

å¦å¤–ä¸€ä¸ªå¸¸è§çš„æƒ³æ³•æ˜¯ä½¿ç”¨ç±»å‹æ–­è¨€æ¥æä¾›ä»£ç çš„æç¤ºï¼š
```ts
interface Foo {
  bar: number;
  bas: string;
}

const foo = <Foo>{
  // ç¼–è¯‘å™¨å°†ä¼šæä¾›å…³äº Foo å±æ€§çš„ä»£ç æç¤º
  // ä½†æ˜¯å¼€å‘äººå‘˜ä¹Ÿå¾ˆå®¹æ˜“å¿˜è®°æ·»åŠ æ‰€æœ‰çš„å±æ€§
  // åŒæ ·ï¼Œå¦‚æœ Foo è¢«é‡æ„ï¼Œè¿™æ®µä»£ç ä¹Ÿå¯èƒ½è¢«ç ´åï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªæ–°çš„å±æ€§è¢«æ·»åŠ ï¼‰ã€‚
};
```

è¿™ä¹Ÿä¼šå­˜åœ¨ä¸€ä¸ªåŒæ ·çš„é—®é¢˜ï¼Œå¦‚æœä½ å¿˜è®°äº†æŸä¸ªå±æ€§ï¼Œç¼–è¯‘å™¨åŒæ ·ä¹Ÿä¸ä¼šå‘å‡ºé”™è¯¯è­¦å‘Šã€‚ä½¿ç”¨ä¸€ç§æ›´å¥½çš„æ–¹å¼ï¼š
```ts
interface Foo {
  bar: number;
  bas: string;
}

const foo: Foo = {
  // ç¼–è¯‘å™¨å°†ä¼šæä¾› Foo å±æ€§çš„ä»£ç æç¤º
};
```

åœ¨æŸäº›æƒ…æ™¯ä¸‹ï¼Œä½ å¯èƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„å˜é‡ï¼Œä½†è‡³å°‘ï¼Œä½ ä¸ä¼šä½¿ç”¨ä¸€ä¸ªæ‰¿è¯ºï¼ˆå¯èƒ½æ˜¯å‡çš„ï¼‰ï¼Œè€Œæ˜¯ä¾é ç±»å‹æ¨æ–­æ¥æ£€æŸ¥ä½ çš„ä»£ç ã€‚

#### åŒé‡æ–­è¨€

ç±»å‹æ–­è¨€ï¼Œå°½ç®¡æˆ‘ä»¬å·²ç»è¯æ˜äº†å®ƒå¹¶ä¸æ˜¯é‚£ä¹ˆå®‰å…¨ï¼Œä½†å®ƒä¹Ÿè¿˜æ˜¯æœ‰ç”¨æ­¦ä¹‹åœ°ã€‚å¦‚ä¸‹ä¸€ä¸ªéå¸¸å®ç”¨çš„ä¾‹å­æ‰€ç¤ºï¼Œå½“ä½¿ç”¨è€…äº†è§£ä¼ å…¥å‚æ•°æ›´å…·ä½“çš„ç±»å‹æ—¶ï¼Œç±»å‹æ–­è¨€èƒ½æŒ‰é¢„æœŸå·¥ä½œï¼š
```ts
function handler(event: Event) {
  const mouseEvent = event as MouseEvent;
}
```

ç„¶è€Œï¼Œå¦‚ä¸‹ä¾‹å­ä¸­çš„ä»£ç å°†ä¼šæŠ¥é”™ï¼Œå°½ç®¡ä½¿ç”¨è€…å·²ç»ä½¿ç”¨äº†ç±»å‹æ–­è¨€ï¼š
```ts
function handler(event: Event) {
  const element = event as HTMLElement; // Error: 'Event' å’Œ 'HTMLElement' ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½ä¸èƒ½èµ‹å€¼ç»™å¦å¤–ä¸€ä¸ª
}
```

å¦‚æœä½ ä»ç„¶æƒ³ä½¿ç”¨é‚£ä¸ªç±»å‹ï¼Œä½ å¯ä»¥ä½¿ç”¨åŒé‡æ–­è¨€ã€‚é¦–å…ˆæ–­è¨€æˆå…¼å®¹æ‰€æœ‰ç±»å‹çš„ `any`ï¼Œç¼–è¯‘å™¨å°†ä¸ä¼šæŠ¥é”™ï¼š
```ts
function handler(event: Event) {
  const element = (event as any) as HTMLElement; // ok
}
```

##### TypeScript æ˜¯æ€ä¹ˆç¡®å®šå•ä¸ªåˆ¤æ–­æ˜¯å¦è¶³å¤Ÿ

å½“ `S` ç±»å‹æ˜¯ `T` ç±»å‹çš„å­é›†ï¼Œæˆ–è€… `T` ç±»å‹æ˜¯ `S` ç±»å‹çš„å­é›†æ—¶ï¼Œ`S` èƒ½è¢«æˆåŠŸæ–­è¨€æˆ `T`ã€‚è¿™æ˜¯ä¸ºäº†åœ¨è¿›è¡Œç±»å‹æ–­è¨€æ—¶æä¾›é¢å¤–çš„å®‰å…¨æ€§ï¼Œå®Œå…¨æ¯«æ— æ ¹æ®çš„æ–­è¨€æ˜¯å±é™©çš„ï¼Œå¦‚æœä½ æƒ³è¿™ä¹ˆåšï¼Œä½ å¯ä»¥ä½¿ç”¨ `any`ã€‚

### Freshness

ä¸ºäº†èƒ½è®©æ£€æŸ¥å¯¹è±¡å­—é¢é‡ç±»å‹æ›´å®¹æ˜“ï¼ŒTypeScript æä¾› ã€Œ[Freshness](https://github.com/Microsoft/TypeScript/pull/3823)ã€ çš„æ¦‚å¿µï¼ˆå®ƒä¹Ÿè¢«ç§°ä¸ºæ›´ä¸¥æ ¼çš„å¯¹è±¡å­—é¢é‡æ£€æŸ¥ï¼‰ç”¨æ¥ç¡®ä¿å¯¹è±¡å­—é¢é‡åœ¨ç»“æ„ä¸Šç±»å‹å…¼å®¹ã€‚

ç»“æ„ç±»å‹éå¸¸æ–¹ä¾¿ã€‚è€ƒè™‘å¦‚ä¸‹ä¾‹å­ä»£ç ï¼Œå®ƒå¯ä»¥è®©ä½ éå¸¸ä¾¿åˆ©çš„ä» JavaScript è¿ç§»è‡³ TypeScriptï¼Œå¹¶ä¸”ä¼šæä¾›ç±»å‹å®‰å…¨ï¼š
```ts
function logName(something: { name: string }) {
  console.log(something.name);
}

const person = { name: 'matt', job: 'being awesome' };
const animal = { name: 'cow', diet: 'vegan, but has milk of own specie' };
const randow = { note: `I don't have a name property` };

logName(person); // ok
logName(animal); // ok
logName(randow); // Error: æ²¡æœ‰ `name` å±æ€§
```

ä½†æ˜¯ï¼Œç»“æ„ç±»å‹æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå®ƒèƒ½è¯¯å¯¼ä½ è®¤ä¸ºæŸäº›ä¸œè¥¿æ¥æ”¶çš„æ•°æ®æ¯”å®ƒå®é™…çš„å¤šã€‚å¦‚ä¸‹ä¾‹ï¼ŒTypeScript å‘å‡ºé”™è¯¯è­¦å‘Šï¼š
```ts
function logName(something: { name: string }) {
  console.log(something.name);
}

logName({ name: 'matt' }); // ok
logName({ name: 'matt', job: 'being awesome' }); // Error: å¯¹è±¡å­—é¢é‡åªèƒ½æŒ‡å®šå·²çŸ¥å±æ€§ï¼Œ`job` å±æ€§åœ¨è¿™é‡Œå¹¶ä¸å­˜åœ¨ã€‚
```

:::warning
è¯·æ³¨æ„ï¼Œè¿™ç§é”™è¯¯æç¤ºï¼Œåªä¼šå‘ç”Ÿåœ¨å¯¹è±¡å­—é¢é‡ä¸Šã€‚
:::

å¦‚æœæ²¡æœ‰è¿™ç§é”™è¯¯æç¤ºï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå»å¯»æ‰¾å‡½æ•°çš„è°ƒç”¨ `logName({ name: 'matt', job: 'being awesome' })`ï¼Œç»§è€Œä¼šè®¤ä¸º `logName` å¯èƒ½ä¼šä½¿ç”¨ `job` å±æ€§åšä¸€äº›äº‹æƒ…ï¼Œç„¶è€Œå®é™…ä¸Š `logName` å¹¶æ²¡æœ‰ä½¿ç”¨å®ƒã€‚

å¦å¤–ä¸€ä¸ªä½¿ç”¨æ¯”è¾ƒå¤šçš„åœºæ™¯æ˜¯ä¸å…·æœ‰å¯é€‰æˆå‘˜çš„æ¥å£ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„å¯¹è±¡å­—é¢é‡æ£€æŸ¥ï¼Œå½“ä½ è¾“å…¥é”™è¯¯å•è¯çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šå‘å‡ºé”™è¯¯è­¦å‘Šï¼š
```ts
function logIfHasName(something: { name?: string }) {
  if (something.name) {
    console.log(something.name);
  }
}

const person = { name: 'matt', job: 'being awesome' };
const animal = { name: 'cow', diet: 'vegan, but has milk of own species' };

logIfHasName(person); // okay
logIfHasName(animal); // okay

logIfHasName({ neme: 'I just misspelled name to neme' }); // Error: å¯¹è±¡å­—é¢é‡åªèƒ½æŒ‡å®šå·²çŸ¥å±æ€§ï¼Œ`neme` å±æ€§ä¸å­˜åœ¨ã€‚
```

ä¹‹æ‰€ä»¥åªå¯¹å¯¹è±¡å­—é¢é‡è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‚£äº›å®é™…ä¸Šå¹¶æ²¡æœ‰è¢«ä½¿ç”¨åˆ°çš„å±æ€§æœ‰å¯èƒ½ä¼šæ‹¼å†™é”™è¯¯æˆ–è€…ä¼šè¢«è¯¯ç”¨ã€‚

#### å…è®¸é¢å¤–çš„å±æ€§

ä¸€ä¸ªç±»å‹èƒ½å¤ŸåŒ…å«ç´¢å¼•ç­¾åï¼Œä»¥æ˜ç¡®è¡¨æ˜å¯ä»¥ä½¿ç”¨é¢å¤–çš„å±æ€§ï¼š
```ts
let x: { foo: number, [x: string]: any };

x = { foo: 1, baz: 2 }; // ok, 'baz' å±æ€§åŒ¹é…äºç´¢å¼•ç­¾å
```

#### ç”¨ä¾‹: React State

Facebook ReactJS ä¸ºå¯¹è±¡çš„ Freshness æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„ç”¨ä¾‹ï¼Œé€šå¸¸åœ¨ç»„ä»¶ä¸­ï¼Œä½ åªä½¿ç”¨å°‘é‡å±æ€§ï¼Œè€Œä¸æ˜¯ä¼ å…¥æ‰€æœ‰ï¼Œæ¥è°ƒç”¨ `setState`ï¼š
```ts
// å‡è®¾
interface State {
  foo: string;
  bar: string;
}

// ä½ å¯èƒ½æƒ³åšï¼š
this.setState({ foo: 'Hello' }); // Error: æ²¡æœ‰å±æ€§ 'bar'

// å› ä¸º state åŒ…å« 'foo' ä¸ 'bar'ï¼ŒTypeScript ä¼šå¼ºåˆ¶ä½ è¿™ä¹ˆåšï¼š
this.setState({ foo: 'Hello', bar: this.state.bar });
```

å¦‚æœä½ æƒ³ä½¿ç”¨ Freshnessï¼Œä½ å¯èƒ½éœ€è¦å°†æ‰€æœ‰æˆå‘˜æ ‡è®°ä¸ºå¯é€‰ï¼Œè¿™ä»ç„¶ä¼šæ•æ‰åˆ°æ‹¼å†™é”™è¯¯ï¼š
```ts
// å‡è®¾
interface State {
  foo?: string;
  bar?: string;
}

// ä½ å¯èƒ½æƒ³åš
this.setState({ foo: 'Hello' }); // Yay works fine!

// ç”±äº Freshnessï¼Œä½ ä¹Ÿå¯ä»¥é˜²æ­¢é”™åˆ«å­—
this.setState({ foos: 'Hello' }}; // Error: å¯¹è±¡åªèƒ½æŒ‡å®šå·²çŸ¥å±æ€§

// ä»ç„¶ä¼šæœ‰ç±»å‹æ£€æŸ¥
this.setState({ foo: 123 }}; // Error: æ— æ³•å°† number ç±»å‹èµ‹å€¼ç»™ string ç±»å‹
```

### ç±»å‹ä¿æŠ¤

ç±»å‹ä¿æŠ¤å…è®¸ä½ ä½¿ç”¨æ›´å°èŒƒå›´ä¸‹çš„å¯¹è±¡ç±»å‹ã€‚

#### typeof

TypeScript ç†ŸçŸ¥ JavaScript ä¸­ `instanceof` å’Œ `typeof` è¿ç®—ç¬¦çš„ç”¨æ³•ã€‚å¦‚æœä½ åœ¨ä¸€ä¸ªæ¡ä»¶å—ä¸­ä½¿ç”¨è¿™äº›ï¼ŒTypeScript å°†ä¼šæ¨å¯¼å‡ºåœ¨æ¡ä»¶å—ä¸­çš„çš„å˜é‡ç±»å‹ã€‚å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼ŒTypeScript å°†ä¼šè¾¨åˆ« `string` ä¸Šæ˜¯å¦å­˜åœ¨ç‰¹å®šçš„å‡½æ•°ï¼Œä»¥åŠæ˜¯å¦å‘ç”Ÿäº†æ‹¼å†™é”™è¯¯ï¼š
```ts
function doSome(x: number | string) {
  if (typeof x === 'string') {
    // åœ¨è¿™ä¸ªå—ä¸­ï¼ŒTypeScript çŸ¥é“ `x` çš„ç±»å‹å¿…é¡»æ˜¯ `string`
    console.log(x.subtr(1)); // Error: 'subtr' æ–¹æ³•å¹¶æ²¡æœ‰å­˜åœ¨äº `string` ä¸Š
    console.log(x.substr(1)); // ok
  }

  x.substr(1); // Error: æ— æ³•ä¿è¯ `x` æ˜¯ `string` ç±»å‹
}
```

#### instanceof

è¿™æœ‰ä¸€ä¸ªå…³äº `class` å’Œ `instanceof` çš„ä¾‹å­ï¼š
```ts
class Foo {
  foo = 123;
  common = '123';
}

class Bar {
  bar = 123;
  common = '123';
}

function doStuff(arg: Foo | Bar) {
  if (arg instanceof Foo) {
    console.log(arg.foo); // ok
    console.log(arg.bar); // Error
  }
  if (arg instanceof Bar) {
    console.log(arg.foo); // Error
    console.log(arg.bar); // ok
  }
}

doStuff(new Foo());
doStuff(new Bar());
```

TypeScript ç”šè‡³èƒ½å¤Ÿç†è§£ `else`ã€‚å½“ä½ ä½¿ç”¨ `if` æ¥ç¼©å°ç±»å‹æ—¶ï¼ŒTypeScript çŸ¥é“åœ¨å…¶ä»–å—ä¸­çš„ç±»å‹å¹¶ä¸æ˜¯ `if` ä¸­çš„ç±»å‹ï¼š
```ts
class Foo {
  foo = 123;
}

class Bar {
  bar = 123;
}

function doStuff(arg: Foo | Bar) {
  if (arg instanceof Foo) {
    console.log(arg.foo); // ok
    console.log(arg.bar); // Error
  } else {
    // è¿™ä¸ªå—ä¸­ï¼Œä¸€å®šæ˜¯ 'Bar'
    console.log(arg.foo); // Error
    console.log(arg.bar); // ok
  }
}

doStuff(new Foo());
doStuff(new Bar());
```

#### in

`in` æ“ä½œç¬¦å¯ä»¥å®‰å…¨çš„æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡ä¸Šæ˜¯å¦å­˜åœ¨ä¸€ä¸ªå±æ€§ï¼Œå®ƒé€šå¸¸ä¹Ÿè¢«ä½œä¸ºç±»å‹ä¿æŠ¤ä½¿ç”¨ï¼š
```ts
interface A {
  x: number;
}

interface B {
  y: string;
}

function doStuff(q: A | B) {
  if ('x' in q) {
    // q: A
  } else {
    // q: B
  }
}
```

#### å­—é¢é‡ç±»å‹ä¿æŠ¤

å½“ä½ åœ¨è”åˆç±»å‹é‡Œä½¿ç”¨å­—é¢é‡ç±»å‹æ—¶ï¼Œä½ å¯ä»¥æ£€æŸ¥å®ƒä»¬æ˜¯å¦æœ‰åŒºåˆ«ï¼š
```ts
type Foo = {
  kind: 'foo'; // å­—é¢é‡ç±»å‹
  foo: number;
};

type Bar = {
  kind: 'bar'; // å­—é¢é‡ç±»å‹
  bar: number;
};

function doStuff(arg: Foo | Bar) {
  if (arg.kind === 'foo') {
    console.log(arg.foo); // ok
    console.log(arg.bar); // Error
  } else {
    // ä¸€å®šæ˜¯ Bar
    console.log(arg.foo); // Error
    console.log(arg.bar); // ok
  }
}
```

#### ä½¿ç”¨å®šä¹‰çš„ç±»å‹ä¿æŠ¤

JavaScript å¹¶æ²¡æœ‰å†…ç½®éå¸¸ä¸°å¯Œçš„ã€è¿è¡Œæ—¶çš„è‡ªæˆ‘æ£€æŸ¥æœºåˆ¶ã€‚å½“ä½ åœ¨ä½¿ç”¨æ™®é€šçš„ JavaScript å¯¹è±¡æ—¶ï¼ˆä½¿ç”¨ç»“æ„ç±»å‹ï¼Œæ›´æœ‰ç›Šå¤„ï¼‰ï¼Œä½ ç”šè‡³æ— æ³•è®¿é—® `instanceof` å’Œ `typeof`ã€‚åœ¨è¿™ç§æƒ…æ™¯ä¸‹ï¼Œä½ å¯ä»¥åˆ›å»º*ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å‹ä¿æŠ¤å‡½æ•°*ï¼Œè¿™ä»…ä»…æ˜¯ä¸€ä¸ªè¿”å›å€¼ä¸ºç±»ä¼¼äº`someArgumentName is SomeType` çš„å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š
```ts
// ä»…ä»…æ˜¯ä¸€ä¸ª interface
interface Foo {
  foo: number;
  common: string;
}

interface Bar {
  bar: number;
  common: string;
}

// ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ç±»å‹ä¿æŠ¤ï¼
function isFoo(arg: Foo | Bar): arg is Foo {
  return (arg as Foo).foo !== undefined;
}

// ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ç±»å‹ä¿æŠ¤ä½¿ç”¨ç”¨ä¾‹ï¼š
function doStuff(arg: Foo | Bar) {
  if (isFoo(arg)) {
    console.log(arg.foo); // ok
    console.log(arg.bar); // Error
  } else {
    console.log(arg.foo); // Error
    console.log(arg.bar); // ok
  }
}

doStuff({ foo: 123, common: '123' });
doStuff({ bar: 123, common: '123' });
```

### å­—é¢é‡ç±»å‹

å­—é¢é‡æ˜¯ JavaScript æœ¬èº«æä¾›çš„ä¸€ä¸ªå‡†ç¡®å˜é‡ã€‚

#### å­—ç¬¦ä¸²å­—é¢é‡

ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ä½œä¸ºä¸€ä¸ªç±»å‹ï¼š
```ts
let foo: 'Hello';
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè¢«ç§°ä¸º `foo` å˜é‡ï¼Œå®ƒä»…æ¥æ”¶ä¸€ä¸ªå­—é¢é‡å€¼ä¸º `Hello` çš„å˜é‡ï¼š
```ts
let foo: 'Hello';
foo = 'Bar'; // Error: 'bar' ä¸èƒ½èµ‹å€¼ç»™ç±»å‹ 'Hello'
```

å®ƒä»¬æœ¬èº«å¹¶ä¸æ˜¯å¾ˆå®ç”¨ï¼Œä½†æ˜¯å¯ä»¥åœ¨ä¸€ä¸ªè”åˆç±»å‹ä¸­ç»„åˆåˆ›å»ºä¸€ä¸ªå¼ºå¤§çš„ï¼ˆå®ç”¨çš„ï¼‰æŠ½è±¡ï¼š
```ts
type CardinalDirection = 'North' | 'East' | 'South' | 'West';

function move(distance: number, direction: CardinalDirection) {
  // ...
}

move(1, 'North'); // ok
move(1, 'Nurth'); // Error
```

#### å…¶ä»–å­—é¢é‡ç±»å‹

TypeScript åŒæ ·ä¹Ÿæä¾› `boolean` å’Œ `number` çš„å­—é¢é‡ç±»å‹ï¼š
```ts
type OneToFive = 1 | 2 | 3 | 4 | 5;
type Bools = true | false;
```

#### æ¨æ–­

é€šå¸¸ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªç±»ä¼¼äº `Type string is not assignable to type 'foo'` çš„é”™è¯¯ï¼Œå¦‚ä¸‹ï¼š
```ts
function iTakeFoo(foo: 'foo') {}
const test = {
  someProp: 'foo'
};

iTakeFoo(test.someProp); // Error: Argument of type string is not assignable to parameter of type 'foo'
```

è¿™æ˜¯ç”±äº `test` è¢«æ¨æ–­ä¸º `{ someProp: string }`ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸€ä¸ªç®€å•çš„ç±»å‹æ–­è¨€æ¥å‘Šè¯‰ TypeScript ä½ æƒ³æ¨æ–­çš„å­—é¢é‡ï¼š
```ts
function iTakeFoo(foo: 'foo') {}

type Test = {
  someProp: 'foo';
};

const test: Test = {
  // æ¨æ–­ `someProp` æ°¸è¿œæ˜¯ 'foo'
  someProp: 'foo'
};

iTakeFoo(test.someProp); // ok
```

#### ä½¿ç”¨ç”¨ä¾‹

TypeScript æšä¸¾ç±»å‹æ˜¯åŸºäºæ•°å­—çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨å¸¦å­—ç¬¦ä¸²å­—é¢é‡çš„è”åˆç±»å‹ï¼Œæ¥æ¨¡æ‹Ÿä¸€ä¸ªåŸºäºå­—ç¬¦ä¸²çš„æšä¸¾ç±»å‹ï¼Œå°±å¥½åƒä¸Šæ–‡ä¸­æå‡ºçš„ `CardinalDirection`ã€‚ä½ ç”šè‡³å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‡½æ•°æ¥ç”Ÿæˆ `key: value` çš„ç»“æ„ï¼š
```ts
// ç”¨äºåˆ›å»ºå­—ç¬¦ä¸²åˆ—è¡¨æ˜ å°„è‡³ `K: V` çš„å‡½æ•°
function strEnum<T extends string>(o: Array<T>): { [K in T]: K } {
  return o.reduce((res, key) => {
    res[key] = key;
    return res;
  }, Object.create(null));
}
```

ç„¶åï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ `keyof`ã€`typeof` æ¥ç”Ÿæˆå­—ç¬¦ä¸²çš„è”åˆç±»å‹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œå…¨çš„ä¾‹å­ï¼š
```ts
// ç”¨äºåˆ›å»ºå­—ç¬¦ä¸²åˆ—è¡¨æ˜ å°„è‡³ `K: V` çš„å‡½æ•°
function strEnum<T extends string>(o: Array<T>): { [K in T]: K } {
  return o.reduce((res, key) => {
    res[key] = key;
    return res;
  }, Object.create(null));
}

// åˆ›å»º K: V
const Direction = strEnum(['North', 'South', 'East', 'West']);

// åˆ›å»ºä¸€ä¸ªç±»å‹
type Direction = keyof typeof Direction;

// ç®€å•çš„ä½¿ç”¨
let sample: Direction;

sample = Direction.North; // Okay
sample = 'North'; // Okay
sample = 'AnythingElse'; // ERROR!
```

#### è¾¨æè”åˆç±»å‹

æˆ‘ä»¬å°†ä¼šåœ¨æ­¤ä¹¦çš„ç¨åç« èŠ‚è®²è§£å®ƒã€‚

### readonly

TypeScript ç±»å‹ç³»ç»Ÿå…è®¸ä½ åœ¨ä¸€ä¸ªæ¥å£é‡Œä½¿ç”¨ `readonly` æ¥æ ‡è®°å±æ€§ã€‚å®ƒèƒ½è®©ä½ ä»¥ä¸€ç§æ›´å®‰å…¨çš„æ–¹å¼å·¥ä½œï¼ˆä¸å¯é¢„æœŸçš„æ”¹å˜æ˜¯å¾ˆç³Ÿç³•çš„ï¼‰ï¼š
```ts
function foo(config: { readonly bar: number, readonly bas: number }) {
  // ..
}

const config = { bar: 123, bas: 123 };
foo(config);

// ç°åœ¨ä½ èƒ½å¤Ÿç¡®ä¿ 'config' ä¸èƒ½å¤Ÿè¢«æ”¹å˜äº†
```

å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ `interface` å’Œ `type` é‡Œä½¿ç”¨ `readonly`ï¼š
```ts
type Foo = {
  readonly bar: number;
  readonly bas: number;
};

// åˆå§‹åŒ–
const foo: Foo = { bar: 123, bas: 456 };

// ä¸èƒ½è¢«æ”¹å˜
foo.bar = 456; // Error: foo.bar ä¸ºä»…è¯»å±æ€§
```

ä½ ä¹Ÿèƒ½æŒ‡å®šä¸€ä¸ªç±»çš„å±æ€§ä¸ºåªè¯»ï¼Œç„¶ååœ¨å£°æ˜æ—¶æˆ–è€…æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–å®ƒä»¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
class Foo {
  readonly bar = 1; // OK
  readonly baz: string;
  constructor() {
    this.baz = 'hello'; // OK
  }
}
```

#### Readonly

è¿™æœ‰ä¸€ä¸ª `Readonly` çš„æ˜ å°„ç±»å‹ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªæ³›å‹ `T`ï¼Œç”¨æ¥æŠŠå®ƒçš„æ‰€æœ‰å±æ€§æ ‡è®°ä¸ºåªè¯»ç±»å‹ï¼š
```ts
type Foo = {
  bar: number;
  bas: number;
};

type FooReadonly = Readonly<Foo>;

const foo: Foo = { bar: 123, bas: 456 };
const fooReadonly: FooReadonly = { bar: 123, bas: 456 };

foo.bar = 456; // ok
fooReadonly.bar = 456; // Error: bar å±æ€§åªè¯»
```

#### å…¶ä»–çš„ä½¿ç”¨ç”¨ä¾‹

##### ReactJS

`ReactJS` æ˜¯ä¸€ä¸ªå–œæ¬¢ç”¨ä¸å˜æ•°æ®çš„åº“ï¼Œä½ å¯ä»¥æ ‡è®°ä½ çš„ `Props` å’Œ `State` ä¸ºä¸å¯å˜æ•°æ®ï¼š
```ts
interface Props {
  readonly foo: number;
}

interface State {
  readonly bar: number;
}

export class Something extends React.Component<Props, State> {
  someMethod() {
    // ä½ å¯ä»¥æ”¾å¿ƒï¼Œæ²¡æœ‰äººä¼šåƒä¸‹é¢è¿™ä¹ˆåš
    this.props.foo = 123; // Error: props æ˜¯ä¸å¯å˜çš„
    this.state.baz = 456; // Error: ä½ åº”è¯¥ä½¿ç”¨ this.setState()
  }
}
```

ç„¶è€Œï¼Œä½ å¹¶æ²¡æœ‰å¿…è¦è¿™ä¹ˆåšï¼Œ`React` çš„å£°æ˜æ–‡ä»¶å·²ç»æ ‡è®°è¿™äº›ä¸º `readonly`ï¼ˆé€šè¿‡ä¼ å…¥æ³›å‹å‚æ•°è‡³ä¸€ä¸ªå†…éƒ¨åŒ…è£…ï¼Œæ¥æŠŠæ¯ä¸ªå±æ€§æ ‡è®°ä¸º `readonly`ï¼Œå¦‚ä¸Šä¾‹å­æ‰€ç¤ºï¼‰ï¼Œ
```ts
export class Something extends React.Component<{ foo: number }, { baz: number }> {
  someMethod() {
    this.props.foo = 123; // Error: props æ˜¯ä¸å¯å˜çš„
    this.state.baz = 456; // Error: ä½ åº”è¯¥ä½¿ç”¨ this.setState()
  }
}
```

##### ç»å¯¹çš„ä¸å¯å˜

ä½ ç”šè‡³å¯ä»¥æŠŠç´¢å¼•ç­¾åæ ‡è®°ä¸ºåªè¯»ï¼š
```ts
interface Foo {
  readonly [x: number]: number;
}

// ä½¿ç”¨

const foo: Foo = { 0: 123, 2: 345 };
console.log(foo[0]); // okï¼ˆè¯»å–ï¼‰
foo[0] = 456; // Error: å±æ€§åªè¯»
```

å¦‚æœä½ æƒ³ä»¥ä¸å˜çš„æ–¹å¼ä½¿ç”¨åŸç”Ÿ JavaScript æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨ TypeScript æä¾›çš„ `ReadonlyArray<T>` æ¥å£ï¼š
```ts
let foo: ReadonlyArray<number> = [1, 2, 3];
console.log(foo[0]); // ok
foo.push(4); // Error: ReadonlyArray ä¸Šä¸å­˜åœ¨ `push`ï¼Œå› ä¸ºä»–ä¼šæ”¹å˜æ•°ç»„
foo = foo.concat(4); // ok, åˆ›å»ºäº†ä¸€ä¸ªå¤åˆ¶
```

##### è‡ªåŠ¨æ¨æ–­

åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨èƒ½æŠŠä¸€äº›ç‰¹å®šçš„å±æ€§æ¨æ–­ä¸º `readonly`ï¼Œä¾‹å¦‚åœ¨ä¸€ä¸ª `class` ä¸­ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªåªå«æœ‰ `getter` ä½†æ˜¯æ²¡æœ‰ `setter` çš„å±æ€§ï¼Œä»–èƒ½è¢«æ¨æ–­ä¸ºåªè¯»ï¼š
```ts
class Person {
  firstName: string = 'John';
  lastName: string = 'Doe';

  get fullName() {
    return this.firstName + this.lastName;
  }
}

const person = new Person();

console.log(person.fullName); // John Doe
person.fullName = 'Dear Reader'; // Error, fullName åªè¯»
```

#### ä¸ `const` çš„ä¸åŒ

`const`
- ç”¨äºå˜é‡ï¼›
- å˜é‡ä¸èƒ½é‡æ–°èµ‹å€¼ç»™å…¶ä»–ä»»ä½•äº‹ç‰©ã€‚

`readonly`
- ç”¨äºå±æ€§ï¼›
- ç”¨äºåˆ«åï¼Œå¯ä»¥ä¿®æ”¹å±æ€§ï¼›

ç®€å•çš„ä¾‹å­ 1ï¼š
```ts
const foo = 123; // å˜é‡
let bar: {
  readonly bar: number; // å±æ€§
};
```

ç®€å•çš„ä¾‹å­ 2ï¼š
```ts
const foo: {
  readonly bar: number;
} = {
  bar: 123
};

function iMutateFoo(foo: { bar: number }) {
  foo.bar = 456;
}

iMutateFoo(foo);
console.log(foo.bar); // 456
```

`readonly` èƒ½ç¡®ä¿â€œæˆ‘â€ä¸èƒ½ä¿®æ”¹å±æ€§ï¼Œä½†æ˜¯å½“ä½ æŠŠè¿™ä¸ªå±æ€§äº¤ç»™å…¶ä»–å¹¶æ²¡æœ‰è¿™ç§ä¿è¯çš„ä½¿ç”¨è€…ï¼ˆå…è®¸å‡ºäºç±»å‹å…¼å®¹æ€§çš„åŸå› ï¼‰ï¼Œä»–ä»¬èƒ½æ”¹å˜å®ƒã€‚å½“ç„¶ï¼Œå¦‚æœ `iMutateFoo` æ˜ç¡®çš„è¡¨ç¤ºï¼Œä»–ä»¬çš„å‚æ•°ä¸å¯ä¿®æ”¹ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šå‘å‡ºé”™è¯¯è­¦å‘Šï¼š
```ts
interface Foo {
  readonly bar: number;
}

let foo: Foo = {
  bar: 123
};

function iTakeFoo(foo: Foo) {
  foo.bar = 456; // Error: bar å±æ€§åªè¯»
}

iTakeFoo(foo);
```

### èŒƒå‹

è®¾è®¡æ³›å‹çš„å…³é”®ç›®çš„æ˜¯åœ¨æˆå‘˜ä¹‹é—´æä¾›æœ‰æ„ä¹‰çš„çº¦æŸï¼Œè¿™äº›æˆå‘˜å¯ä»¥æ˜¯ï¼š
- ç±»çš„å®ä¾‹æˆå‘˜
- ç±»çš„æ–¹æ³•
- å‡½æ•°å‚æ•°
- å‡½æ•°è¿”å›å€¼

#### åŠ¨æœºå’Œç¤ºä¾‹

ä¸‹é¢æ˜¯å¯¹ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„â€”â€”é˜Ÿåˆ—ï¼Œåœ¨ `TypeScript` å’Œ `JavaScript` ä¸­çš„ç®€å•å®ç°ã€‚
```ts
class Queue {
  private data = [];
  push = item => this.data.push(item);
  pop = () => this.data.shift();
}
```

åœ¨ä¸Šè¿°ä»£ç ä¸­å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå®ƒå…è®¸ä½ å‘é˜Ÿåˆ—ä¸­æ·»åŠ ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œå½“ç„¶ï¼Œå½“æ•°æ®è¢«å¼¹å‡ºé˜Ÿåˆ—æ—¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»»æ„ç±»å‹ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œçœ‹èµ·æ¥äººä»¬å¯ä»¥å‘é˜Ÿåˆ—ä¸­æ·»åŠ  `string` ç±»å‹çš„æ•°æ®ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œè¯¥ç”¨æ³•å‡å®šçš„æ˜¯åªæœ‰ `number` ç±»å‹ä¼šè¢«æ·»åŠ åˆ°é˜Ÿåˆ—é‡Œã€‚
```ts
class Queue {
  private data = [];
  push = item => this.data.push(item);
  pop = () => this.data.shift();
}

const queue = new Queue();

queue.push(0);
queue.push('1'); // Oopsï¼Œä¸€ä¸ªé”™è¯¯

// ä¸€ä¸ªä½¿ç”¨è€…ï¼Œèµ°å…¥äº†è¯¯åŒº
console.log(queue.pop().toPrecision(1));
console.log(queue.pop().toPrecision(1)); // RUNTIME ERROR
```

ä¸€ä¸ªè§£å†³çš„åŠæ³•ï¼ˆäº‹å®ä¸Šï¼Œè¿™ä¹Ÿæ˜¯ä¸æ”¯æŒæ³›å‹ç±»å‹çš„å”¯ä¸€è§£å†³åŠæ³•ï¼‰æ˜¯ä¸ºè¿™äº›çº¦æŸåˆ›å»ºç‰¹æ®Šç±»ï¼Œå¦‚å¿«é€Ÿåˆ›å»ºæ•°å­—ç±»å‹çš„é˜Ÿåˆ—ï¼š
```ts
class QueueNumber {
  private data = [];
  push = (item: number) => this.data.push(item);
  pop = (): number => this.data.shift();
}

const queue = new QueueNumber();

queue.push(0);
queue.push('1'); // Error: ä¸èƒ½æ¨å…¥ä¸€ä¸ª `string` ç±»å‹ï¼Œåªèƒ½æ˜¯ `number` ç±»å‹

// å¦‚æœè¯¥é”™è¯¯å¾—åˆ°ä¿®å¤ï¼Œå…¶ä»–å°†ä¸ä¼šå‡ºç°é—®é¢˜
```

å½“ç„¶ï¼Œå¿«é€Ÿä¹Ÿæ„å‘³ç€ç—›è‹¦ã€‚ä¾‹å¦‚å½“ä½ æƒ³åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²çš„é˜Ÿåˆ—æ—¶ï¼Œä½ å°†ä¸å¾—ä¸å†æ¬¡ä¿®æ”¹ç›¸å½“å¤§çš„ä»£ç ã€‚æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„ä¸€ç§æ–¹å¼æ˜¯æ— è®ºä»€ä¹ˆç±»å‹è¢«æ¨å…¥é˜Ÿåˆ—ï¼Œè¢«æ¨å‡ºçš„ç±»å‹éƒ½ä¸æ¨å…¥ç±»å‹ä¸€æ ·ã€‚å½“ä½ ä½¿ç”¨æ³›å‹æ—¶ï¼Œè¿™ä¼šå¾ˆå®¹æ˜“ï¼š
```ts
// åˆ›å»ºä¸€ä¸ªæ³›å‹ç±»
class Queue<T> {
  private data: T[] = [];
  push = (item: T) => this.data.push(item);
  pop = (): T | undefined => this.data.shift();
}

// ç®€å•çš„ä½¿ç”¨
const queue = new Queue<number>();
queue.push(0);
queue.push('1'); // Errorï¼šä¸èƒ½æ¨å…¥ä¸€ä¸ª `string`ï¼Œåªæœ‰ number ç±»å‹è¢«å…è®¸
```

å¦å¤–ä¸€ä¸ªæˆ‘ä»¬è§è¿‡çš„ä¾‹å­ï¼šä¸€ä¸ª `reverse` å‡½æ•°ï¼Œç°åœ¨åœ¨è¿™ä¸ªå‡½æ•°é‡Œæä¾›äº†å‡½æ•°å‚æ•°ä¸å‡½æ•°è¿”å›å€¼çš„çº¦æŸï¼š
```ts
function reverse<T>(items: T[]): T[] {
  const toreturn = [];
  for (let i = items.length - 1; i >= 0; i--) {
    toreturn.push(items[i]);
  }
  return toreturn;
}

const sample = [1, 2, 3];
let reversed = reverse(sample);

reversed[0] = '1'; // Error
reversed = ['1', '2']; // Error

reversed[0] = 1; // ok
reversed = [1, 2]; // ok
```

åœ¨æ­¤ç« èŠ‚ä¸­ï¼Œä½ å·²ç»äº†è§£åœ¨ç±»å’Œå‡½æ•°ä¸Šä½¿ç”¨æ³›å‹çš„ä¾‹å­ã€‚ä¸€ä¸ªå€¼å¾—è¡¥å……ä¸€ç‚¹çš„æ˜¯ï¼Œä½ å¯ä»¥ä¸ºåˆ›å»ºçš„æˆå‘˜å‡½æ•°æ·»åŠ æ³›å‹ï¼š
```ts
class Utility {
  reverse<T>(items: T[]): T[] {
    const toreturn = [];
    for (let i = items.length; i >= 0; i--) {
      toreturn.push(items[i]);
    }
    return toreturn;
  }
}
```

:::tip
ä½ å¯ä»¥éšæ„è°ƒç”¨æ³›å‹å‚æ•°ï¼Œå½“ä½ ä½¿ç”¨ç®€å•çš„æ³›å‹æ—¶ï¼Œæ³›å‹å¸¸ç”¨ `T`ã€`U`ã€`V` è¡¨ç¤ºã€‚å¦‚æœåœ¨ä½ çš„å‚æ•°é‡Œï¼Œä¸æ­¢æ‹¥æœ‰ä¸€ä¸ªæ³›å‹ï¼Œä½ åº”è¯¥ä½¿ç”¨ä¸€ä¸ªæ›´è¯­ä¹‰åŒ–åç§°ï¼Œå¦‚ `TKey` å’Œ `TValue` ï¼ˆé€šå¸¸æƒ…å†µä¸‹ï¼Œä»¥ `T` ä½œä¸ºæ³›å‹çš„å‰ç¼€ï¼Œåœ¨å…¶ä»–è¯­è¨€å¦‚ C++ é‡Œï¼Œä¹Ÿè¢«ç§°ä¸ºæ¨¡æ¿ï¼‰
:::

#### è¯¯ç”¨çš„æ³›å‹

æˆ‘è§è¿‡å¼€å‘è€…ä½¿ç”¨æ³›å‹ä»…ä»…æ˜¯ä¸ºäº†å®ƒçš„ hackã€‚å½“ä½ ä½¿ç”¨å®ƒæ—¶ï¼Œä½ åº”è¯¥é—®é—®è‡ªå·±ï¼šä½ æƒ³ç”¨å®ƒæ¥æä¾›ä»€ä¹ˆæ ·çš„çº¦æŸã€‚å¦‚æœä½ ä¸èƒ½å¾ˆå¥½çš„å›ç­”å®ƒï¼Œä½ å¯èƒ½ä¼šè¯¯ç”¨æ³›å‹ï¼Œå¦‚ï¼š
```ts
declare function foo<T>(arg: T): void;
```

åœ¨è¿™é‡Œï¼Œæ³›å‹å®Œå…¨æ²¡æœ‰å¿…è¦ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»…ç”¨äºå•ä¸ªå‚æ•°çš„ä½ç½®ï¼Œä½¿ç”¨å¦‚ä¸‹æ–¹å¼å¯èƒ½æ›´å¥½ï¼š
```ts
declare function foo(arg: any): void;
```

#### è®¾è®¡æ¨¡å¼ï¼šæ–¹ä¾¿é€šç”¨

è€ƒè™‘å¦‚ä¸‹å‡½æ•°ï¼š
```ts
declare function parse<T>(name: string): T;
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ³›å‹ `T` åªåœ¨ä¸€ä¸ªåœ°æ–¹è¢«ä½¿ç”¨äº†ï¼Œå®ƒå¹¶æ²¡æœ‰åœ¨æˆå‘˜ä¹‹é—´æä¾›çº¦æŸ `T`ã€‚è¿™ç›¸å½“äºä¸€ä¸ªå¦‚ä¸‹çš„ç±»å‹æ–­è¨€ï¼š
```ts
declare function parse(name: string): any;

const something = parse('something') as TypeOfSomething;
```

ä»…ä½¿ç”¨ä¸€æ¬¡çš„æ³›å‹å¹¶ä¸æ¯”ä¸€ä¸ªç±»å‹æ–­è¨€æ¥çš„å®‰å…¨ã€‚å®ƒä»¬éƒ½ç»™ä½ ä½¿ç”¨ API æä¾›äº†ä¾¿åˆ©ã€‚

å¦ä¸€ä¸ªæ˜æ˜¾çš„ä¾‹å­æ˜¯ï¼Œä¸€ä¸ªç”¨äºåŠ è½½ json è¿”å›å€¼å‡½æ•°ï¼Œå®ƒè¿”å›ä½ ä»»ä½•ä¼ å…¥ç±»å‹çš„ `Promise`ï¼š
```ts
const getJSON = <T>(config: { url: string; headers?: { [key: string]: string } }): Promise<T> => {
  const fetchConfig = {
    method: 'GET',
    Accept: 'application/json',
    'Content-Type': 'application/json',
    ...(config.headers || {})
  };
  return fetch(config.url, fetchConfig).then<T>(response => response.json());
};
```

##### é…åˆ axios ä½¿ç”¨

é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šæŠŠåç«¯è¿”å›æ•°æ®æ ¼å¼å•ç‹¬æ”¾å…¥ä¸€ä¸ª interface é‡Œï¼š
```ts
// è¯·æ±‚æ¥å£æ•°æ®
export interface ResponseData<T = any> {
  /**
   * çŠ¶æ€ç 
   * @type { number }
   */
  code: number;

  /**
   * æ•°æ®
   * @type { T }
   */
  result: T;

  /**
   * æ¶ˆæ¯
   * @type { string }
   */
  message: string;
}
```

å½“æˆ‘ä»¬æŠŠ API å•ç‹¬æŠ½ç¦»æˆå•ä¸ªæ¨¡å—æ—¶ï¼š
```ts
// åœ¨ axios.ts æ–‡ä»¶ä¸­å¯¹ axios è¿›è¡Œäº†å¤„ç†ï¼Œä¾‹å¦‚æ·»åŠ é€šç”¨é…ç½®ã€æ‹¦æˆªå™¨ç­‰
import Ax from './axios';

import { ResponseData } from './interface.ts';

export function getUser<T>() {
  return Ax.get<ResponseData<T>>('/somepath')
    .then(res => res.data)
    .catch(err => console.error(err));
}
```

æ¥ç€æˆ‘ä»¬å†™å…¥è¿”å›çš„æ•°æ®ç±»å‹ `User`ï¼Œè¿™å¯ä»¥è®© TypeScript é¡ºåˆ©æ¨æ–­å‡ºæˆ‘ä»¬æƒ³è¦çš„ç±»å‹ï¼š
```ts
interface User {
  name: string;
  age: number;
}

async function test() {
  // user è¢«æ¨æ–­å‡ºä¸º
  // {
  //  code: number,
  //  result: { name: string, age: number },
  //  message: string
  // }
  const user = await getUser<User>();
}
```

### ç±»å‹æ¨æ–­

TypeScript èƒ½æ ¹æ®ä¸€äº›ç®€å•çš„è§„åˆ™æ¨æ–­ï¼ˆæ£€æŸ¥ï¼‰å˜é‡çš„ç±»å‹ï¼Œä½ å¯ä»¥é€šè¿‡å®è·µï¼Œå¾ˆå¿«çš„äº†è§£å®ƒä»¬ã€‚

#### å®šä¹‰å˜é‡

å˜é‡çš„ç±»å‹ï¼Œç”±å®šä¹‰æ¨æ–­ï¼š
```ts
let foo = 123; // foo æ˜¯ 'number'
let bar = 'hello'; // bar æ˜¯ 'string'

foo = bar; // Error: ä¸èƒ½å°† 'string' èµ‹å€¼ç»™ `number`
```

è¿™æ˜¯ä¸€ä¸ªä»å³å‘å·¦æµåŠ¨ç±»å‹çš„ç¤ºä¾‹ã€‚

#### å‡½æ•°è¿”å›ç±»å‹

è¿”å›ç±»å‹èƒ½è¢« `return` è¯­å¥æ¨æ–­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œæ¨æ–­å‡½æ•°è¿”å›ä¸ºä¸€ä¸ªæ•°å­—ï¼š
```ts
function add(a: number, b: number) {
  return a + b;
}
```

è¿™æ˜¯ä¸€ä¸ªä»åº•éƒ¨æµå‡ºç±»å‹çš„ä¾‹å­ã€‚

#### èµ‹å€¼

å‡½æ•°å‚æ•°ç±»å‹/è¿”å›å€¼ä¹Ÿèƒ½é€šè¿‡èµ‹å€¼æ¥æ¨æ–­ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œ`foo` çš„ç±»å‹æ˜¯ `Adder`ï¼Œä»–èƒ½è®© `foo` çš„å‚æ•° `a`ã€`b` æ˜¯ `number` ç±»å‹ã€‚
```ts
type Adder = (a: number, b: number) => number;
let foo: Adder = (a, b) => a + b;
```

è¿™ä¸ªäº‹å®å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¥è¯æ˜ï¼ŒTypeScript ä¼šå‘å‡ºæ­£å¦‚ä½ æœŸæœ›å‘å‡ºçš„é”™è¯¯è­¦å‘Šï¼š
```ts
type Adder = (a: number, b: number) => number;
let foo: Adder = (a, b) => {
  a = 'hello'; // Errorï¼šä¸èƒ½æŠŠ 'string' ç±»å‹èµ‹å€¼ç»™ 'number' ç±»å‹
  return a + b;
};
```

è¿™æ˜¯ä¸€ä¸ªä»å·¦å‘å³æµåŠ¨ç±»å‹çš„ç¤ºä¾‹ã€‚

å¦‚æœä½ åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”å‡½æ•°å‚æ•°ä¸ºä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç›¸åŒçš„èµ‹å€¼è§„åˆ™ä¹Ÿé€‚ç”¨äºå®ƒã€‚ä» `argument` è‡³ `parameter` åªæ˜¯å˜é‡èµ‹å€¼çš„å¦ä¸€ç§å½¢å¼ã€‚
```ts
type Adder = (a: number, b: number) => number;
function iTakeAnAdder(adder: Adder) {
  return adder(1, 2);
}

iTakeAnAdder((a, b) => {
  a = 'hello'; // Error: ä¸èƒ½æŠŠ 'string' ç±»å‹èµ‹å€¼ç»™ 'number' ç±»å‹
  return a + b;
});
```

#### ç»“æ„åŒ–

è¿™äº›ç®€å•çš„è§„åˆ™ä¹Ÿé€‚ç”¨äºç»“æ„åŒ–çš„å­˜åœ¨ï¼ˆå¯¹è±¡å­—é¢é‡ï¼‰ï¼Œä¾‹å¦‚åœ¨ä¸‹é¢è¿™ç§æƒ…å†µä¸‹ foo çš„ç±»å‹è¢«æ¨æ–­ä¸º { a: number, b: number }ï¼š
```ts
const foo = {
  a: 123,
  b: 456
};

foo.a = 'hello'; // Errorï¼šä¸èƒ½æŠŠ 'string' ç±»å‹èµ‹å€¼ç»™ 'number' ç±»å‹
```

æ•°ç»„ä¹Ÿä¸€æ ·ï¼š
```ts
const bar = [1, 2, 3];
bar[0] = 'hello'; // Errorï¼šä¸èƒ½æŠŠ 'string' ç±»å‹èµ‹å€¼ç»™ 'number' ç±»å‹
```

#### è§£æ„

è¿™äº›ä¹Ÿé€‚ç”¨äºè§£æ„ä¸­ï¼š
```ts
const foo = {
  a: 123,
  b: 456
};
let { a } = foo;

a = 'hello'; // Errorï¼šä¸èƒ½æŠŠ 'string' ç±»å‹èµ‹å€¼ç»™ 'number' ç±»å‹
```

æ•°ç»„ä¸­ï¼š
```ts
const bar = [1, 2];
let [a, b] = bar;

a = 'hello'; // Errorï¼šä¸èƒ½æŠŠ 'string' ç±»å‹èµ‹å€¼ç»™ 'number' ç±»å‹
```

å¦‚æœå‡½æ•°å‚æ•°èƒ½å¤Ÿè¢«æ¨æ–­å‡ºæ¥ï¼Œé‚£ä¹ˆè§£æ„äº¦æ˜¯å¦‚æ­¤ã€‚åœ¨å¦‚ä¸‹ä¾‹å­ä¸­ï¼Œå‡½æ•°å‚æ•°èƒ½å¤Ÿè¢«è§£æ„ä¸º `a/b` æˆå‘˜ï¼š
```ts
type Adder = (number: { a: number; b: number }) => number;
function iTakeAnAdder(adder: Adder) {
  return adder({ a: 1, b: 2 });
}

iTakeAnAdder(({ a, b }) => {
  // a, b çš„ç±»å‹èƒ½è¢«æ¨æ–­å‡ºæ¥
  a = 'hello'; // Errorï¼šä¸èƒ½æŠŠ 'string' ç±»å‹èµ‹å€¼ç»™ 'number' ç±»å‹
  return a + b;
});
```
#### ç±»å‹ä¿æŠ¤

åœ¨å‰é¢ç« èŠ‚[ç±»å‹ä¿æŠ¤](#ç±»å‹ä¿æŠ¤)ä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“å®ƒå¦‚ä½•å¸®åŠ©æˆ‘ä»¬æ”¹å˜å’Œç¼©å°ç±»å‹èŒƒå›´ï¼ˆç‰¹åˆ«æ˜¯åœ¨è”åˆç±»å‹ä¸‹ï¼‰ã€‚ç±»å‹ä¿æŠ¤åªæ˜¯ä¸€ä¸ªå—ä¸­å˜é‡å¦ä¸€ç§æ¨æ–­å½¢å¼ã€‚

#### è­¦å‘Š

##### å°å¿ƒä½¿ç”¨å‡½æ•°

å¦‚æœç±»å‹ä¸èƒ½è¢«èµ‹å€¼æ¨æ–­å‡ºæ¥ï¼Œç±»å‹ä¹Ÿå°†ä¸ä¼šæµå…¥å‡½æ•°å‚æ•°ä¸­ã€‚ä¾‹å¦‚å¦‚ä¸‹çš„ä¸€ä¸ªä¾‹å­ï¼Œç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“ `foo` çš„ç±»å‹ï¼Œæ‰€å®ƒä¹Ÿå°±ä¸èƒ½æ¨æ–­å‡º `a` æˆ–è€… `b` çš„ç±»å‹ã€‚
```ts
const foo = (a, b) => {
  /* do something */
};
```

ç„¶è€Œï¼Œå¦‚æœ `foo` æ·»åŠ äº†ç±»å‹æ³¨è§£ï¼Œå‡½æ•°å‚æ•°ä¹Ÿå°±èƒ½è¢«æ¨æ–­ï¼ˆ`a`ï¼Œ`b` éƒ½èƒ½è¢«æ¨æ–­ä¸º `number` ç±»å‹ï¼‰ï¼š
```ts
type TwoNumberFunction = (a: number, b: number) => void;
const foo: TwoNumberFunction = (a, b) => {
  /* do something */
};
```

##### å°å¿ƒä½¿ç”¨è¿”å›å€¼

å°½ç®¡ TypeScript ä¸€èˆ¬æƒ…å†µä¸‹èƒ½æ¨æ–­å‡½æ•°çš„è¿”å›å€¼ï¼Œä½†æ˜¯å®ƒå¯èƒ½å¹¶ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚ä¾‹å¦‚å¦‚ä¸‹çš„ `foo` å‡½æ•°ï¼Œå®ƒçš„è¿”å›å€¼ä¸º `any`ï¼š
```ts
function foo(a: number, b: number) {
  return a + addOne(b);
}

// ä¸€äº›ä½¿ç”¨ JavaScript åº“çš„ç‰¹æ®Šå‡½æ•°
function addOne(a) {
  return a + 1;
}
```

è¿™æ˜¯å› ä¸ºè¿”å›å€¼çš„ç±»å‹è¢«ä¸€ä¸ªç¼ºå°‘ç±»å‹å®šä¹‰çš„ `addOne` å‡½æ•°æ‰€å½±å“ï¼ˆ`a` æ˜¯ `any`ï¼Œæ‰€ä»¥ `addOne` è¿”å›å€¼ä¸º `any`ï¼Œ`foo` çš„è¿”å›å€¼æ˜¯ä¹Ÿæ˜¯ `any`ï¼‰ã€‚

:::tip
æˆ‘å‘ç°æœ€ç®€å•çš„æ–¹å¼æ˜¯æ˜ç¡®çš„å†™ä¸Šå‡½æ•°è¿”å›å€¼ï¼Œæ¯•ç«Ÿè¿™äº›æ³¨è§£æ˜¯ä¸€ä¸ªå®šç†ï¼Œè€Œå‡½æ•°æ˜¯æ³¨è§£çš„ä¸€ä¸ªè¯æ®ã€‚
:::

è¿™é‡Œè¿˜æœ‰ä¸€äº›å…¶ä»–å¯ä»¥æƒ³è±¡çš„æƒ…æ™¯ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¥½æ¶ˆæ¯æ˜¯æœ‰ç¼–è¯‘å™¨é€‰é¡¹ `noImplicitAny` å¯ä»¥æ•è·è¿™äº› bugã€‚

##### `noImplicitAny`

é€‰é¡¹ `noImplicitAny` ç”¨æ¥å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå½“æ— æ³•æ¨æ–­ä¸€ä¸ªå˜é‡æ—¶å‘å‡ºä¸€ä¸ªé”™è¯¯ï¼ˆæˆ–è€…åªèƒ½æ¨æ–­ä¸ºä¸€ä¸ªéšå¼çš„ `any` ç±»å‹ï¼‰ï¼Œä½ å¯ä»¥ï¼š
- é€šè¿‡æ˜¾å¼æ·»åŠ  `:any` çš„ç±»å‹æ³¨è§£ï¼Œæ¥è®©å®ƒæˆä¸ºä¸€ä¸ª `any` ç±»å‹ï¼›
- é€šè¿‡ä¸€äº›æ›´æ­£ç¡®çš„ç±»å‹æ³¨è§£æ¥å¸®åŠ© TypeScript æ¨æ–­ç±»å‹ã€‚

### ç±»å‹å…¼å®¹æ€§

ç±»å‹å…¼å®¹æ€§ç”¨äºç¡®å®šä¸€ä¸ªç±»å‹æ˜¯å¦èƒ½èµ‹å€¼ç»™å…¶ä»–ç±»å‹ã€‚

å¦‚ `string` ç±»å‹ä¸ `number` ç±»å‹ä¸å…¼å®¹ï¼š
```ts
let str: string = 'Hello';
let num: number = 123;

str = num; // Error: 'number' ä¸èƒ½èµ‹å€¼ç»™ 'string'
num = str; // Error: 'string' ä¸èƒ½èµ‹å€¼ç»™ 'number'
```

#### å®‰å…¨æ€§

TypeScript ç±»å‹ç³»ç»Ÿè®¾è®¡æ¯”è¾ƒæ–¹ä¾¿ï¼Œå®ƒå…è®¸ä½ æœ‰ä¸€äº›ä¸æ­£ç¡®çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼šä»»ä½•ç±»å‹éƒ½èƒ½è¢«èµ‹å€¼ç»™ `any`ï¼Œè¿™æ„å‘³ç€å‘Šè¯‰ç¼–è¯‘å™¨ä½ å¯ä»¥åšä»»ä½•ä½ æƒ³åšçš„äº‹æƒ…ï¼š
```ts
let foo: any = 123;
foo = 'hello';

foo.toPrecision(3);
```

#### ç»“æ„åŒ–

TypeScript å¯¹è±¡æ˜¯ä¸€ç§ç»“æ„ç±»å‹ï¼Œè¿™æ„å‘³ç€åªè¦ç»“æ„åŒ¹é…ï¼Œåç§°ä¹Ÿå°±æ— å…³ç´§è¦äº†ï¼š
```ts
interface Point {
  x: number;
  y: number;
}

class Point2D {
  constructor(public x: number, public y: number) {}
}

let p: Point;

// ok, å› ä¸ºæ˜¯ç»“æ„åŒ–çš„ç±»å‹
p = new Point2D(1, 2);
```

è¿™å…è®¸ä½ åŠ¨æ€åˆ›å»ºå¯¹è±¡ï¼ˆå°±å¥½åƒä½ åœ¨ `vanilla JS` ä¸­ä½¿ç”¨ä¸€æ ·ï¼‰ï¼Œå¹¶ä¸”å®ƒå¦‚æœèƒ½è¢«æ¨æ–­ï¼Œè¯¥å¯¹è±¡ä»ç„¶å…·æœ‰å®‰å…¨æ€§ã€‚
```ts
interface Point2D {
  x: number;
  y: number;
}

interface Point3D {
  x: number;
  y: number;
  z: number;
}

const point2D: Point2D = { x: 0, y: 10 };
const point3D: Point3D = { x: 0, y: 10, z: 20 };
function iTakePoint2D(point: Point2D) {
  /* do something */
}

iTakePoint2D(point2D); // ok, å®Œå…¨åŒ¹é…
iTakePoint2D(point3D); // é¢å¤–çš„ä¿¡æ¯ï¼Œæ²¡å…³ç³»
iTakePoint2D({ x: 0 }); // Error: æ²¡æœ‰ 'y'
```

#### å˜ä½“

å¯¹ç±»å‹å…¼å®¹æ€§æ¥è¯´ï¼Œå˜ä½“æ˜¯ä¸€ä¸ªåˆ©äºç†è§£å’Œé‡è¦çš„æ¦‚å¿µã€‚

å¯¹ä¸€ä¸ªç®€å•ç±»å‹ `Base` å’Œ Child æ¥è¯´ï¼Œå¦‚æœ `Child` æ˜¯ `Base` çš„å­ç±»ï¼Œ`Child` çš„å®ä¾‹èƒ½è¢«èµ‹å€¼ç»™ `Base` ç±»å‹çš„å˜é‡ã€‚
:::tip
è¿™æ˜¯å¤šæ€æ€§ã€‚
:::

åœ¨ç”± `Base` å’Œ `Child` ç»„åˆçš„å¤æ‚ç±»å‹çš„ç±»å‹å…¼å®¹æ€§ä¸­ï¼Œå®ƒå–å†³äºç›¸åŒåœºæ™¯ä¸‹çš„ `Base` ä¸ Child çš„å˜ä½“ï¼š
- åå˜ï¼ˆCovariantï¼‰ï¼šåªåœ¨åŒä¸€ä¸ªæ–¹å‘ï¼›
- é€†å˜ï¼ˆContravariantï¼‰ï¼šåªåœ¨ç›¸åçš„æ–¹å‘ï¼›
- åŒå‘åå˜ï¼ˆBivariantï¼‰ï¼šåŒ…æ‹¬åŒä¸€ä¸ªæ–¹å‘å’Œä¸åŒæ–¹å‘ï¼›
- ä¸å˜ï¼ˆInvariantï¼‰ï¼šå¦‚æœç±»å‹ä¸å®Œå…¨ç›¸åŒï¼Œåˆ™å®ƒä»¬æ˜¯ä¸å…¼å®¹çš„ã€‚

:::tip
å¯¹äºå­˜åœ¨å®Œå…¨å¯å˜æ•°æ®çš„å¥å…¨çš„ç±»å‹ç³»ç»Ÿï¼ˆå¦‚ JavaScriptï¼‰ï¼Œ`Invariant` æ˜¯ä¸€ä¸ªå”¯ä¸€çš„æœ‰æ•ˆå¯é€‰å±æ€§ï¼Œä½†æ˜¯å¦‚æˆ‘ä»¬æ‰€è®¨è®ºçš„ï¼Œ*ä¾¿åˆ©æ€§*è¿«ä½¿æˆ‘ä»¬ä½œå‡ºä¸€äº›ä¸æ˜¯å¾ˆå®‰å…¨çš„é€‰æ‹©ã€‚
:::

å…³äºåå˜å’Œé€†å˜çš„æ›´å¤šå†…å®¹ï¼Œè¯·å‚è€ƒï¼š[åå˜ä¸é€†å˜](#åå˜ä¸é€†å˜)

#### å‡½æ•°

å½“ä½ åœ¨æ¯”è¾ƒä¸¤ä¸ªå‡½æ•°æ—¶ï¼Œè¿™æœ‰ä¸€äº›ä½ éœ€è¦è€ƒè™‘åˆ°çš„äº‹æƒ…ã€‚

##### è¿”å›ç±»å‹

åå˜ï¼ˆCovariantï¼‰ï¼šè¿”å›ç±»å‹å¿…é¡»åŒ…å«è¶³å¤Ÿçš„æ•°æ®ã€‚
```ts
interface Point2D {
  x: number;
  y: number;
}
interface Point3D {
  x: number;
  y: number;
  z: number;
}

let iMakePoint2D = (): Point2D => ({ x: 0, y: 0 });
let iMakePoint3D = (): Point3D => ({ x: 0, y: 0, z: 0 });

iMakePoint2D = iMakePoint3D;
iMakePoint3D = iMakePoint2D; // ERROR: Point2D ä¸èƒ½èµ‹å€¼ç»™ Point3D
```

##### å‚æ•°æ•°é‡

æ›´å°‘çš„å‚æ•°æ•°é‡æ˜¯å¥½çš„ï¼ˆå¦‚ï¼šå‡½æ•°èƒ½å¤Ÿé€‰æ‹©æ€§çš„å¿½ç•¥ä¸€äº›å¤šä½™çš„å‚æ•°ï¼‰ï¼Œä½†æ˜¯ä½ å¾—ä¿è¯æœ‰è¶³å¤Ÿçš„å‚æ•°è¢«ä½¿ç”¨äº†ï¼š
```ts
const iTakeSomethingAndPassItAnErr = (x: (err: Error, data: any) => void) => {
  /* åšä¸€äº›å…¶ä»–çš„ */
};

iTakeSomethingAndPassItAnErr(() => null); // ok
iTakeSomethingAndPassItAnErr(err => null); // ok
iTakeSomethingAndPassItAnErr((err, data) => null); // ok

// Error: å‚æ•°ç±»å‹ `(err: any, data: any, more: any) => null` ä¸èƒ½èµ‹å€¼ç»™å‚æ•°ç±»å‹ `(err: Error, data: any) => void`
iTakeSomethingAndPassItAnErr((err, data, more) => null);
```

##### å¯é€‰çš„å’Œ rest å‚æ•°

å¯é€‰çš„ï¼ˆé¢„å…ˆç¡®å®šçš„ï¼‰å’Œ Rest å‚æ•°ï¼ˆä»»ä½•æ•°é‡çš„å‚æ•°ï¼‰éƒ½æ˜¯å…¼å®¹çš„ï¼š
```ts
let foo = (x: number, y: number) => {};
let bar = (x?: number, y?: number) => {};
let bas = (...args: number[]) => {};

foo = bar = bas;
bas = bar = foo;
```

:::tip
å¯é€‰çš„ï¼ˆä¸Šä¾‹å­ä¸­çš„ `bar`ï¼‰ä¸ä¸å¯é€‰çš„ï¼ˆä¸Šä¾‹å­ä¸­çš„ `foo`ï¼‰ä»…åœ¨é€‰é¡¹ä¸º `strictNullChecks` ä¸º `false` æ—¶å…¼å®¹ã€‚
:::

##### å‡½æ•°å‚æ•°ç±»å‹

åŒå‘åå˜ï¼ˆBivariantï¼‰ï¼šæ—¨åœ¨æ”¯æŒå¸¸è§çš„äº‹ä»¶å¤„ç†æ–¹æ¡ˆã€‚
```ts
// äº‹ä»¶ç­‰çº§
interface Event {
  timestamp: number;
}
interface MouseEvent extends Event {
  x: number;
  y: number;
}
interface KeyEvent extends Event {
  keyCode: number;
}

// ç®€å•çš„äº‹ä»¶ç›‘å¬
enum EventType {
  Mouse,
  Keyboard
}
function addEventListener(eventType: EventType, handler: (n: Event) => void) {
  // ...
}

// ä¸å®‰å…¨ï¼Œä½†æ˜¯æœ‰ç”¨ï¼Œå¸¸è§ã€‚å‡½æ•°å‚æ•°çš„æ¯”è¾ƒæ˜¯åŒå‘åå˜ã€‚
addEventListener(EventType.Mouse, (e: MouseEvent) => console.log(e.x + ',' + e.y));

// åœ¨å®‰å…¨æƒ…æ™¯ä¸‹çš„ä¸€ç§ä¸å¥½æ–¹æ¡ˆ
addEventListener(EventType.Mouse, (e: Event) => console.log((<MouseEvent>e).x + ',' + (<MouseEvent>e).y));
addEventListener(EventType.Mouse, <(e: Event) => void>((e: MouseEvent) => console.log(e.x + ',' + e.y)));

// ä»ç„¶ä¸å…è®¸æ˜ç¡®çš„é”™è¯¯ï¼Œå¯¹å®Œå…¨ä¸å…¼å®¹çš„ç±»å‹ä¼šå¼ºåˆ¶æ£€æŸ¥
addEventListener(EventType.Mouse, (e: number) => console.log(e));
```

åŒæ ·çš„ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠ `Array<Child>` èµ‹å€¼ç»™ `Array<Base>` ï¼ˆåå˜ï¼‰ï¼Œå› ä¸ºå‡½æ•°æ˜¯å…¼å®¹çš„ã€‚æ•°ç»„çš„åå˜éœ€è¦æ‰€æœ‰çš„å‡½æ•° `Array<Child>` éƒ½èƒ½èµ‹å€¼ç»™ `Array<Base>`ï¼Œä¾‹å¦‚ `push(t: Child)` èƒ½è¢«èµ‹å€¼ç»™ `push(t: Base)`ï¼Œè¿™éƒ½å¯ä»¥é€šè¿‡å‡½æ•°å‚æ•°åŒå‘åå˜å®ç°ã€‚

ä¸‹é¢çš„ä»£ç å¯¹äºå…¶ä»–è¯­è¨€çš„å¼€å‘è€…æ¥è¯´ï¼Œå¯èƒ½ä¼šæ„Ÿåˆ°å¾ˆå›°æƒ‘ï¼Œå› ä¸ºä»–ä»¬è®¤ä¸ºæ˜¯æœ‰é”™è¯¯çš„ï¼Œå¯æ˜¯ Typescript å¹¶ä¸ä¼šæŠ¥é”™ï¼š
```ts
interface Point2D {
  x: number;
  y: number;
}
interface Point3D {
  x: number;
  y: number;
  z: number;
}

let iTakePoint2D = (point: Point2D) => {};
let iTakePoint3D = (point: Point3D) => {};

iTakePoint3D = iTakePoint2D; // ok, è¿™æ˜¯åˆç†çš„
iTakePoint2D = iTakePoint3D; // okï¼Œä¸ºä»€ä¹ˆï¼Ÿ
```

#### æšä¸¾

- æšä¸¾ä¸æ•°å­—ç±»å‹ç›¸äº’å…¼å®¹
```ts
enum Status {
  Ready,
  Waiting
}

let status = Status.Ready;
let num = 0;

status = num;
num = status;
```

- æ¥è‡ªäºä¸åŒæšä¸¾çš„æšä¸¾å˜é‡ï¼Œè¢«è®¤ä¸ºæ˜¯ä¸å…¼å®¹çš„ï¼š
```ts
enum Status {
  Ready,
  Waiting
}
enum Color {
  Red,
  Blue,
  Green
}

let status = Status.Ready;
let color = Color.Red;

status = color; // Error
```

#### ç±»

- ä»…ä»…åªæœ‰å®ä¾‹æˆå‘˜å’Œæ–¹æ³•ä¼šç›¸æ¯”è¾ƒï¼Œæ„é€ å‡½æ•°å’Œé™æ€æˆå‘˜ä¸ä¼šè¢«æ£€æŸ¥ã€‚
```ts
class Animal {
  feet: number;
  constructor(name: string, numFeet: number) {}
}

class Size {
  feet: number;
  constructor(meters: number) {}
}

let a: Animal;
let s: Size;

a = s; // OK
s = a; // OK
```

- ç§æœ‰çš„å’Œå—ä¿æŠ¤çš„æˆå‘˜å¿…é¡»æ¥è‡ªäºç›¸åŒçš„ç±»ã€‚
```ts
class Animal {
  protected feet: number;
}
class Cat extends Animal {}

let animal: Animal;
let cat: Cat;

animal = cat; // ok
cat = animal; // ok

class Size {
  protected feet: number;
}

let size: Size;

animal = size; // ERROR
size = animal; // ERROR
```

#### æ³›å‹

TypeScript ç±»å‹ç³»ç»ŸåŸºäºå˜é‡çš„ç»“æ„ï¼Œä»…å½“ç±»å‹å‚æ•°åœ¨è¢«ä¸€ä¸ªæˆå‘˜ä½¿ç”¨æ—¶ï¼Œæ‰ä¼šå½±å“å…¼å®¹æ€§ã€‚å¦‚ä¸‹ä¾‹å­ä¸­ï¼Œ`T` å¯¹å…¼å®¹æ€§æ²¡æœ‰å½±å“ï¼š
```ts
interface Empty<T> {}

let x: Empty<number>;
let y: Empty<string>;

x = y; // ok
```

å½“ `T` è¢«æˆå‘˜ä½¿ç”¨æ—¶ï¼Œå®ƒå°†åœ¨å®ä¾‹åŒ–æ³›å‹åå½±å“å…¼å®¹æ€§ï¼š
```ts
interface Empty<T> {
  data: T;
}

let x: Empty<number>;
let y: Empty<string>;

x = y; // Error
```

å¦‚æœå°šæœªå®ä¾‹åŒ–æ³›å‹å‚æ•°ï¼Œåˆ™åœ¨æ£€æŸ¥å…¼å®¹æ€§ä¹‹å‰å°†å…¶æ›¿æ¢ä¸º `any`ï¼š
```ts
let identity = function<T>(x: T): T {
  // ...
};

let reverse = function<U>(y: U): U {
  // ...
};

identity = reverse; // ok, å› ä¸º `(x: any) => any` åŒ¹é… `(y: any) => any`
```

ç±»ä¸­çš„æ³›å‹å…¼å®¹æ€§ä¸å‰æ–‡æ‰€æåŠä¸€è‡´ï¼š
```ts
class List<T> {
  add(val: T) {}
}

class Animal {
  name: string;
}
class Cat extends Animal {
  meow() {
    // ..
  }
}

const animals = new List<Animal>();
animals.add(new Animal()); // ok
animals.add(new Cat()); // ok

const cats = new List<Cat>();
cats.add(new Animal()); // Error
cats.add(new Cat()); // ok
```

#### è„šæ³¨ï¼šä¸å˜æ€§ (Invariance)

æˆ‘ä»¬è¯´è¿‡ï¼Œä¸å˜æ€§å¯èƒ½æ˜¯å”¯ä¸€ä¸€ä¸ªå¬èµ·æ¥åˆç†çš„é€‰é¡¹ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå…³äº `contra` å’Œ `co` çš„å˜ä½“ï¼Œè¢«è®¤ä¸ºå¯¹æ•°ç»„æ˜¯ä¸å®‰å…¨çš„ã€‚
```ts
class Animal {
  constructor(public name: string) {}
}
class Cat extends Animal {
  meow() {
    console.log('cat');
  }
}

let animal = new Animal('animal');
let cat = new Cat('cat');

// å¤šæ€
// Animal <= Cat

animal = cat; // ok
cat = animal; // ERROR: cat ç»§æ‰¿äº animal

// æ¼”ç¤ºæ¯ä¸ªæ•°ç»„å½¢å¼
let animalArr: Animal[] = [animal];
let catArr: Cat[] = [cat];

// æ˜æ˜¾çš„åå¤„ï¼Œé€†å˜
// Animal <= Cat
// Animal[] >= Cat[]
catArr = animalArr; // ok, å¦‚æœ‰æœ‰é€†å˜
catArr[0].meow(); // å…è®¸ï¼Œä½†æ˜¯ä¼šåœ¨è¿è¡Œæ—¶æŠ¥é”™

// å¦å¤–ä¸€ä¸ªåå¤„ï¼Œåå˜
// Animal <= Cat
// Animal[] <= Cat[]
animalArr = catArr; // okï¼Œåå˜

animalArr.push(new Animal('another animal')); // ä»…ä»…æ˜¯ push ä¸€ä¸ª animal è‡³ carArr é‡Œ
catArr.forEach(c => c.meow()); // å…è®¸ï¼Œä½†æ˜¯ä¼šåœ¨è¿è¡Œæ—¶æŠ¥é”™ã€‚
```

### Never

ç¨‹åºè¯­è¨€çš„è®¾è®¡ç¡®å®åº”è¯¥å­˜åœ¨ä¸€ä¸ªåº•éƒ¨ç±»å‹çš„æ¦‚å¿µï¼Œå½“ä½ åœ¨åˆ†æä»£ç æµçš„æ—¶å€™ï¼Œè¿™ä¼šæ˜¯ä¸€ä¸ªç†æ‰€å½“ç„¶å­˜åœ¨çš„ç±»å‹ã€‚TypeScript å°±æ˜¯è¿™æ ·ä¸€ç§åˆ†æä»£ç æµçš„è¯­è¨€ï¼ˆğŸ˜ï¼‰ï¼Œå› æ­¤å®ƒéœ€è¦ä¸€ä¸ªå¯é çš„ï¼Œä»£è¡¨æ°¸è¿œä¸ä¼šå‘ç”Ÿçš„ç±»å‹ã€‚

`never` ç±»å‹æ˜¯ TypeScript ä¸­çš„åº•å±‚ç±»å‹ã€‚å®ƒè‡ªç„¶è¢«åˆ†é…çš„ä¸€äº›ä¾‹å­ï¼š
- ä¸€ä¸ªä»æ¥ä¸ä¼šæœ‰è¿”å›å€¼çš„å‡½æ•°ï¼ˆå¦‚ï¼šå¦‚æœå‡½æ•°å†…å«æœ‰ `while(true) {}`ï¼‰ï¼›
- ä¸€ä¸ªæ€»æ˜¯ä¼šæŠ›å‡ºé”™è¯¯çš„å‡½æ•°ï¼ˆå¦‚ï¼š`function foo() { throw new Error('Not Implemented') }`ï¼Œ`foo` çš„è¿”å›ç±»å‹æ˜¯ `never`ï¼‰ï¼›

ä½ ä¹Ÿå¯ä»¥å°†å®ƒç”¨åšç±»å‹æ³¨è§£ï¼š
```ts
let foo: never; // ok
```

ä½†æ˜¯ï¼Œ`never` ç±»å‹ä»…èƒ½è¢«èµ‹å€¼ç»™å¦å¤–ä¸€ä¸ª `never`ï¼š
```ts
let foo: never = 123; // Error: number ç±»å‹ä¸èƒ½èµ‹å€¼ç»™ never ç±»å‹

// ok, ä½œä¸ºå‡½æ•°è¿”å›ç±»å‹çš„ never
let bar: never = (() => {
  throw new Error('Throw my hands in the air like I just dont care');
})();
```

å¾ˆæ£’ï¼Œç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å®ƒçš„å…³é”®ç”¨ä¾‹ã€‚

#### ç”¨ä¾‹ï¼šè¯¦ç»†çš„æ£€æŸ¥

```ts
function foo(x: string | number): boolean {
  if (typeof x === 'string') {
    return true;
  } else if (typeof x === 'number') {
    return false;
  }

  // å¦‚æœä¸æ˜¯ä¸€ä¸ª never ç±»å‹ï¼Œè¿™ä¼šæŠ¥é”™ï¼š
  // - ä¸æ˜¯æ‰€æœ‰æ¡ä»¶éƒ½æœ‰è¿”å›å€¼ ï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹ï¼‰
  // - æˆ–è€…æ£€æŸ¥åˆ°æ— æ³•è®¿é—®çš„ä»£ç 
  // ä½†æ˜¯ç”±äº TypeScript ç†è§£ `fail` å‡½æ•°è¿”å›ä¸º `never` ç±»å‹
  // å®ƒå¯ä»¥è®©ä½ è°ƒç”¨å®ƒï¼Œå› ä¸ºä½ å¯èƒ½ä¼šåœ¨è¿è¡Œæ—¶ç”¨å®ƒæ¥åšå®‰å…¨æˆ–è€…è¯¦ç»†çš„æ£€æŸ¥ã€‚
  return fail('Unexhaustive');
}

function fail(message: string): never {
  throw new Error(message);
}
```

`never` ä»…èƒ½è¢«èµ‹å€¼ç»™å¦å¤–ä¸€ä¸ª `never` ç±»å‹ï¼Œå› æ­¤ä½ å¯ä»¥ç”¨å®ƒæ¥è¿›è¡Œç¼–è¯‘æ—¶çš„å…¨é¢çš„æ£€æŸ¥ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨[è¾¨æè”åˆç±»å‹](#è¾¨æè”åˆç±»å‹)ä¸­è®²è§£å®ƒã€‚

#### ä¸ `void` çš„å·®å¼‚

ä¸€æ—¦æœ‰äººå‘Šè¯‰ä½ ï¼Œ`never` è¡¨ç¤ºä¸€ä¸ªä»æ¥ä¸ä¼šä¼˜é›…çš„è¿”å›çš„å‡½æ•°æ—¶ï¼Œä½ å¯èƒ½é©¬ä¸Šå°±ä¼šæƒ³åˆ°ä¸æ­¤ç±»ä¼¼çš„ `void`ï¼Œç„¶è€Œå®é™…ä¸Šï¼Œ`void` è¡¨ç¤ºæ²¡æœ‰ä»»ä½•ç±»å‹ï¼Œ`never` è¡¨ç¤ºæ°¸è¿œä¸å­˜åœ¨çš„å€¼çš„ç±»å‹ã€‚

å½“ä¸€ä¸ªå‡½æ•°è¿”å›ç©ºå€¼æ—¶ï¼Œå®ƒçš„è¿”å›å€¼ä¸º `void` ç±»å‹ï¼Œä½†æ˜¯ï¼Œå½“ä¸€ä¸ªå‡½æ•°æ°¸ä¸è¿”å›æ—¶ï¼ˆæˆ–è€…æ€»æ˜¯æŠ›å‡ºé”™è¯¯ï¼‰ï¼Œå®ƒçš„è¿”å›å€¼ä¸º `never` ç±»å‹ã€‚`void` ç±»å‹å¯ä»¥è¢«èµ‹å€¼ï¼ˆåœ¨ `strictNullChecking` ä¸º `false` æ—¶ï¼‰ï¼Œä½†æ˜¯é™¤äº† `never` æœ¬èº«ä»¥å¤–ï¼Œå…¶ä»–ä»»ä½•ç±»å‹ä¸èƒ½èµ‹å€¼ç»™ `never`ã€‚

### è¾¨æè”åˆç±»å‹

å½“ç±»ä¸­å«æœ‰[å­—é¢é‡æˆå‘˜](#å­—é¢é‡ç±»å‹)æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¯¥ç±»çš„å±æ€§æ¥è¾¨æè”åˆç±»å‹ã€‚

ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œè€ƒè™‘ `Square` å’Œ `Rectangle` çš„è”åˆç±»å‹ `Shape`ã€‚`Square` å’Œ `Rectangle`æœ‰å…±åŒæˆå‘˜ `kind`ï¼Œå› æ­¤ `kind` å­˜åœ¨äº `Shape` ä¸­ã€‚
```ts
interface Square {
  kind: 'square';
  size: number;
}

interface Rectangle {
  kind: 'rectangle';
  width: number;
  height: number;
}

type Shape = Square | Rectangle;
```

å¦‚æœä½ ä½¿ç”¨ç±»å‹ä¿æŠ¤é£æ ¼çš„æ£€æŸ¥ï¼ˆ`==`ã€`===`ã€`!=`ã€`!==`ï¼‰æˆ–è€…ä½¿ç”¨å…·æœ‰åˆ¤æ–­æ€§çš„å±æ€§ï¼ˆåœ¨è¿™é‡Œæ˜¯ `kind`ï¼‰ï¼ŒTypeScript å°†ä¼šè®¤ä¸ºä½ ä¼šä½¿ç”¨çš„å¯¹è±¡ç±»å‹ä¸€å®šæ˜¯æ‹¥æœ‰ç‰¹æ®Šå­—é¢é‡çš„ï¼Œå¹¶ä¸”å®ƒä¼šä¸ºä½ è‡ªåŠ¨æŠŠç±»å‹èŒƒå›´å˜å°ï¼š
```ts
function area(s: Shape) {
  if (s.kind === 'square') {
    // ç°åœ¨ TypeScript çŸ¥é“ s çš„ç±»å‹æ˜¯ Square
    // æ‰€ä»¥ä½ ç°åœ¨èƒ½å®‰å…¨ä½¿ç”¨å®ƒ
    return s.size * s.size;
  } else {
    // ä¸æ˜¯ä¸€ä¸ª square ï¼Ÿå› æ­¤ TypeScript å°†ä¼šæ¨ç®—å‡º s ä¸€å®šæ˜¯ Rectangle
    return s.width * s.height;
  }
}
```

#### è¯¦ç»†çš„æ£€æŸ¥

é€šå¸¸ï¼Œè”åˆç±»å‹çš„æˆå‘˜æœ‰ä¸€äº›è‡ªå·±çš„è¡Œä¸ºï¼ˆä»£ç ï¼‰ï¼š
```ts
interface Square {
  kind: 'square';
  size: number;
}

interface Rectangle {
  kind: 'rectangle';
  width: number;
  height: number;
}

// æœ‰äººä»…ä»…æ˜¯æ·»åŠ äº† `Circle` ç±»å‹
// æˆ‘ä»¬å¯èƒ½å¸Œæœ› TypeScript èƒ½åœ¨ä»»ä½•è¢«éœ€è¦çš„åœ°æ–¹æŠ›å‡ºé”™è¯¯
interface Circle {
  kind: 'circle';
  radius: number;
}

type Shape = Square | Rectangle | Circle;
```

ä¸€ä¸ªå¯èƒ½ä¼šè®©ä½ çš„ä»£ç å˜å·®çš„ä¾‹å­ï¼š
```ts
function area(s: Shape) {
  if (s.kind === 'square') {
    return s.size * s.size;
  } else if (s.kind === 'rectangle') {
    return s.width * s.height;
  }

  // å¦‚æœä½ èƒ½è®© TypeScript ç»™ä½ ä¸€ä¸ªé”™è¯¯ï¼Œè¿™æ˜¯ä¸æ˜¯å¾ˆæ£’ï¼Ÿ
}
```

ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„å‘ä¸‹æ€æƒ³ï¼Œæ¥ç¡®ä¿å—ä¸­çš„ç±»å‹è¢«æ¨æ–­ä¸ºä¸ `never` ç±»å‹å…¼å®¹çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªæ›´è¯¦ç»†çš„æ£€æŸ¥æ¥æ•è·é”™è¯¯ï¼š
```ts
function area(s: Shape) {
  if (s.kind === 'square') {
    return s.size * s.size;
  } else if (s.kind === 'rectangle') {
    return s.width * s.height;
  } else {
    // Error: 'Circle' ä¸èƒ½è¢«èµ‹å€¼ç»™ 'never'
    const _exhaustiveCheck: never = s;
  }
}
```

å®ƒå°†å¼ºåˆ¶ä½ æ·»åŠ ä¸€ç§æ–°çš„æ¡ä»¶ï¼š
```ts
function area(s: Shape) {
  if (s.kind === 'square') {
    return s.size * s.size;
  } else if (s.kind === 'rectangle') {
    return s.width * s.height;
  } else if (s.kind === 'circle') {
    return Math.PI * s.radius ** 2;
  } else {
    // ok
    const _exhaustiveCheck: never = s;
  }
}
```

#### Switch

:::tip
ä½ å¯ä»¥é€šè¿‡ `switch` æ¥å®ç°ä»¥ä¸Šä¾‹å­ã€‚
:::

```ts
function area(s: Shape) {
  switch (s.kind) {
    case 'square':
      return s.size * s.size;
    case 'rectangle':
      return s.width * s.height;
    case 'circle':
      return Math.PI * s.radius ** 2;
    default:
      const _exhaustiveCheck: never = s;
  }
}
```

#### strictNullChecks

å¦‚æœä½ ä½¿ç”¨ `strictNullChecks` é€‰é¡¹æ¥åšè¯¦ç»†çš„æ£€æŸ¥ï¼Œä½ åº”è¯¥è¿”å› `_exhaustiveCheck` å˜é‡ï¼ˆç±»å‹æ˜¯ `never`ï¼‰ï¼Œå¦åˆ™ TypeScript å¯èƒ½ä¼šæ¨æ–­è¿”å›å€¼ä¸º `undefined`ï¼š
```ts
function area(s: Shape) {
  switch (s.kind) {
    case 'square':
      return s.size * s.size;
    case 'rectangle':
      return s.width * s.height;
    case 'circle':
      return Math.PI * s.radius ** 2;
    default:
      const _exhaustiveCheck: never = s;
      return _exhaustiveCheck;
  }
}
```

#### Redux

Redux åº“æ­£æ˜¯ä½¿ç”¨çš„ä¸Šè¿°ä¾‹å­ã€‚

ä»¥ä¸‹æ˜¯æ·»åŠ äº† TypeScript ç±»å‹æ³¨è§£çš„[redux è¦ç‚¹](https://github.com/reduxjs/redux#the-gist)ã€‚
```ts
import { createStore } from 'redux';

type Action =
  | {
      type: 'INCREMENT';
    }
  | {
      type: 'DECREMENT';
    };

/**
 * This is a reducer, a pure function with (state, action) => state signature.
 * It describes how an action transforms the state into the next state.
 *
 * The shape of the state is up to you: it can be a primitive, an array, an object,
 * or even an Immutable.js data structure. The only important part is that you should
 * not mutate the state object, but return a new object if the state changes.
 *
 * In this example, we use a `switch` statement and strings, but you can use a helper that
 * follows a different convention (such as function maps) if it makes sense for your
 * project.
 */
function counter(state = 0, action: Action) {
  switch (action.type) {
    case 'INCREMENT':
      return state + 1;
    case 'DECREMENT':
      return state - 1;
    default:
      return state;
  }
}

// Create a Redux store holding the state of your app.
// Its API is { subscribe, dispatch, getState }.
let store = createStore(counter);

// You can use subscribe() to update the UI in response to state changes.
// Normally you'd use a view binding library (e.g. React Redux) rather than subscribe() directly.
// However it can also be handy to persist the current state in the localStorage.

store.subscribe(() => console.log(store.getState()));

// The only way to mutate the internal state is to dispatch an action.
// The actions can be serialized, logged or stored and later replayed.
store.dispatch({ type: 'INCREMENT' });
// 1
store.dispatch({ type: 'INCREMENT' });
// 2
store.dispatch({ type: 'DECREMENT' });
// 1
```

ä¸ TypeScript ä¸€èµ·ä½¿ç”¨å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢æ‹¼å†™é”™è¯¯ï¼Œå¹¶ä¸”èƒ½æé«˜é‡æ„å’Œä¹¦å†™æ–‡æ¡£åŒ–ä»£ç çš„èƒ½åŠ›ã€‚

### ç´¢å¼•ç­¾å

å¯ä»¥ç”¨å­—ç¬¦ä¸²è®¿é—® JavaScript ä¸­çš„å¯¹è±¡ï¼ˆTypeScript ä¸­ä¹Ÿä¸€æ ·ï¼‰ï¼Œç”¨æ¥ä¿å­˜å¯¹å…¶ä»–å¯¹è±¡çš„å¼•ç”¨ã€‚

ä¾‹å¦‚ï¼š
```ts
let foo: any = {};
foo['Hello'] = 'World';
console.log(foo['Hello']); // World
```

æˆ‘ä»¬åœ¨é”® `Hello` ä¸‹ä¿å­˜äº†ä¸€ä¸ªå­—ç¬¦ä¸² `World`ï¼Œé™¤å­—ç¬¦ä¸²å¤–ï¼Œå®ƒä¹Ÿå¯ä»¥ä¿å­˜ä»»æ„çš„ JavaScript å¯¹è±¡ï¼Œä¾‹å¦‚ä¸€ä¸ªç±»çš„å®ä¾‹ã€‚
```ts
class Foo {
  constructor(public message: string) {}
  log() {
    console.log(this.message);
  }
}

let foo: any = {};
foo['Hello'] = new Foo('World');
foo['Hello'].log(); // World
```

å½“ä½ ä¼ å…¥ä¸€ä¸ªå…¶ä»–å¯¹è±¡è‡³ç´¢å¼•ç­¾åæ—¶ï¼ŒJavaScript ä¼šåœ¨å¾—åˆ°ç»“æœä¹‹å‰ä¼šå…ˆè°ƒç”¨ `.toString` æ–¹æ³•ï¼š
```ts
let obj = {
  toString() {
    console.log('toString called');
    return 'Hello';
  }
};

let foo: any = {};
foo[obj] = 'World'; // toString called
console.log(foo[obj]); // toString called, World
console.log(foo['Hello']); // Worldorld
```

:::tip
åªè¦ç´¢å¼•ä½ç½®ä½¿ç”¨äº† `obj`ï¼Œ`toString` æ–¹æ³•éƒ½å°†ä¼šè¢«è°ƒç”¨ã€‚
:::

æ•°ç»„æœ‰ç‚¹ç¨å¾®ä¸åŒï¼Œå¯¹äºä¸€ä¸ª `number` ç±»å‹çš„ç´¢å¼•ç­¾åï¼ŒJavaScript å¼•æ“å°†ä¼šå°è¯•å»ä¼˜åŒ–ï¼ˆè¿™å–å†³äºå®ƒæ˜¯å¦æ˜¯ä¸€ä¸ªçœŸçš„æ•°ç»„ã€å­˜å‚¨çš„é¡¹ç›®ç»“æ„æ˜¯å¦åŒ¹é…ç­‰ï¼‰ã€‚å› æ­¤ï¼Œ`number` åº”è¯¥è¢«è€ƒè™‘ä½œä¸ºä¸€ä¸ªæœ‰æ•ˆçš„å¯¹è±¡è®¿é—®å™¨ï¼ˆè¿™ä¸ `string` ä¸åŒï¼‰ï¼Œå¦‚ä¸‹ä¾‹å­ï¼š
```ts
let foo = ['World'];
console.log(foo[0]); // World
```

å› æ­¤ï¼Œè¿™å°±æ˜¯ JavaScriptã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ TypeScript å¯¹è¿™äº›æ¦‚å¿µæ›´ä¼˜é›…çš„å¤„ç†ã€‚

#### TypeScript ç´¢å¼•ç­¾å

JavaScript åœ¨ä¸€ä¸ªå¯¹è±¡ç±»å‹çš„ç´¢å¼•ç­¾åä¸Šä¼šéšå¼è°ƒç”¨ Â· æ–¹æ³•ï¼Œè€Œåœ¨ TypeScript ä¸­ï¼Œä¸ºé˜²æ­¢åˆå­¦è€…ç ¸ä¼¤è‡ªå·±çš„è„šï¼ˆæˆ‘æ€»æ˜¯çœ‹åˆ° stackoverflow ä¸Šæœ‰å¾ˆå¤š JavaScript ä½¿ç”¨è€…éƒ½ä¼šè¿™æ ·ã€‚ï¼‰ï¼Œå®ƒå°†ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚
```ts
const obj = {
  toString() {
    return 'Hello';
  }
};

const foo: any = {};

// ERROR: ç´¢å¼•ç­¾åå¿…é¡»ä¸º string, number....
foo[obj] = 'World';

// FIX: TypeScript å¼ºåˆ¶ä½ å¿…é¡»æ˜ç¡®è¿™ä¹ˆåšï¼š
foo[obj.toString()] = 'World';
```

å¼ºåˆ¶ç”¨æˆ·å¿…é¡»æ˜ç¡®çš„å†™å‡º `toString()` çš„åŸå› æ˜¯ï¼šåœ¨å¯¹è±¡ä¸Šé»˜è®¤æ‰§è¡Œçš„ `toString` æ–¹æ³•æ˜¯æœ‰å®³çš„ã€‚ä¾‹å¦‚ v8 å¼•æ“ä¸Šæ€»æ˜¯ä¼šè¿”å› `[object Object]`
```ts
let foo = ['World'];
console.log(foo[0]); // World
```

å½“ç„¶ï¼Œæ•°å­—ç±»å‹æ˜¯è¢«å…è®¸çš„ï¼Œè¿™æ˜¯å› ä¸ºï¼š
- éœ€è¦å¯¹æ•°ç»„ / å…ƒç»„å®Œç¾çš„æ”¯æŒï¼›
- å³ä½¿ä½ åœ¨ä¸Šä¾‹ä¸­ä½¿ç”¨ `number` ç±»å‹çš„å€¼æ¥æ›¿ä»£ `obj`ï¼Œ`number` ç±»å‹é»˜è®¤çš„ `toString` æ–¹æ³•å®ç°çš„å¾ˆå‹å¥½ï¼ˆä¸æ˜¯ `[object Object]`ï¼‰ã€‚

å¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
console.log((1).toString()); // 1
console.log((2).toString()); // 2
```

å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ç»“è®ºï¼š
:::tip
TypeScript çš„ç´¢å¼•ç­¾åå¿…é¡»æ˜¯ `string` æˆ–è€… `number`ã€‚

`symbols` ä¹Ÿæ˜¯æœ‰æ•ˆçš„ï¼ŒTypeScript æ”¯æŒå®ƒã€‚åœ¨æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä¼šè®²è§£å®ƒã€‚
:::

#### å£°æ˜ä¸€ä¸ªç´¢å¼•ç­¾å

åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨ `any` æ¥è®© TypeScript å…è®¸æˆ‘ä»¬å¯ä»¥åšä»»æ„æˆ‘ä»¬æƒ³åšçš„äº‹æƒ…ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç¡®çš„æŒ‡å®šç´¢å¼•ç­¾åã€‚ä¾‹å¦‚ï¼šå‡è®¾ä½ æƒ³ç¡®è®¤å­˜å‚¨åœ¨å¯¹è±¡ä¸­ä»»ä½•å†…å®¹éƒ½ç¬¦åˆ `{ message: string }` çš„ç»“æ„ï¼Œä½ å¯ä»¥é€šè¿‡ `[index: string]: { message: string }` æ¥å®ç°ã€‚
```ts
const foo: {
  [index: string]: { message: string };
} = {};

// å‚¨å­˜çš„ä¸œè¥¿å¿…é¡»ç¬¦åˆç»“æ„
// ok
foo['a'] = { message: 'some message' };

// Error, å¿…é¡»åŒ…å« `message`
foo['a'] = { messages: 'some message' };

// è¯»å–æ—¶ï¼Œä¹Ÿä¼šæœ‰ç±»å‹æ£€æŸ¥
// ok
foo['a'].message;

// Error: messages ä¸å­˜åœ¨
foo['a'].messages;
```

:::tip
ç´¢å¼•ç­¾åçš„åç§°ï¼ˆå¦‚ï¼š`{ [index: string]: { message: string } }` é‡Œçš„ `index` ï¼‰é™¤äº†å¯è¯»æ€§å¤–ï¼Œå¹¶æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚ä¾‹å¦‚ï¼šå¦‚æœæœ‰ä¸€ä¸ªç”¨æˆ·åï¼Œä½ å¯ä»¥ä½¿ç”¨ `{ username: string}: { message: string }`ï¼Œè¿™æœ‰åˆ©äºä¸‹ä¸€ä¸ªå¼€å‘è€…ç†è§£ä½ çš„ä»£ç ã€‚
:::

`number` ç±»å‹çš„ç´¢å¼•ä¹Ÿæ”¯æŒï¼š`{ [count: number]: 'SomeOtherTypeYouWantToStoreEgRebate' }`ã€‚

#### æ‰€æœ‰æˆå‘˜éƒ½å¿…é¡»ç¬¦åˆå­—ç¬¦ä¸²çš„ç´¢å¼•ç­¾å

å½“ä½ å£°æ˜ä¸€ä¸ªç´¢å¼•ç­¾åæ—¶ï¼Œæ‰€æœ‰æ˜ç¡®çš„æˆå‘˜éƒ½å¿…é¡»ç¬¦åˆç´¢å¼•ç­¾åï¼š
```ts
// ok
interface Foo {
  [key: string]: number;
  x: number;
  y: number;
}

// Error
interface Bar {
  [key: string]: number;
  x: number;
  y: string; // Error: y å±æ€§å¿…é¡»ä¸º number ç±»å‹
}
```

è¿™å¯ä»¥ç»™ä½ æä¾›å®‰å…¨æ€§ï¼Œä»»ä½•ä»¥å­—ç¬¦ä¸²çš„è®¿é—®éƒ½èƒ½å¾—åˆ°ç›¸åŒç»“æœã€‚
```ts
interface Foo {
  [key: string]: number;
  x: number;
}

let foo: Foo = {
  x: 1,
  y: 2
};

// ç›´æ¥
foo['x']; // number

// é—´æ¥
const x = 'x';
foo[x]; // number
```

#### ä½¿ç”¨ä¸€ç»„æœ‰é™çš„å­—ç¬¦ä¸²å­—é¢é‡

ä¸€ä¸ªç´¢å¼•ç­¾åå¯ä»¥é€šè¿‡æ˜ å°„ç±»å‹æ¥ä½¿ç´¢å¼•å­—ç¬¦ä¸²ä¸ºè”åˆç±»å‹ä¸­çš„ä¸€å‘˜ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
type Index = 'a' | 'b' | 'c';
type FromIndex = { [k in Index]?: number };

const good: FromIndex = { b: 1, c: 2 };

// Error:
// `{ b: 1, c: 2, d: 3 }` ä¸èƒ½åˆ†é…ç»™ 'FromIndex'
// å¯¹è±¡å­—é¢é‡åªèƒ½æŒ‡å®šå·²çŸ¥ç±»å‹ï¼Œ'd' ä¸å­˜åœ¨ 'FromIndex' ç±»å‹ä¸Š
const bad: FromIndex = { b: 1, c: 2, d: 3 };
```

è¿™é€šå¸¸ä¸ `keyof/typeof` ä¸€èµ·ä½¿ç”¨ï¼Œæ¥è·å–å˜é‡çš„ç±»å‹ï¼Œåœ¨ä¸‹ä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Šå®ƒã€‚

å˜é‡çš„è§„åˆ™ä¸€èˆ¬å¯ä»¥å»¶è¿Ÿè¢«æ¨æ–­ï¼š
```ts
type FromSomeIndex<K extends string> = { [key in K]: number };
```

#### åŒæ—¶æ‹¥æœ‰ `string` å’Œ `number` ç±»å‹çš„ç´¢å¼•ç­¾å

è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹ï¼Œä½†æ˜¯ TypeScript æ”¯æŒå®ƒã€‚

`string` ç±»å‹çš„ç´¢å¼•ç­¾åæ¯” `number` ç±»å‹çš„ç´¢å¼•ç­¾åæ›´ä¸¥æ ¼ã€‚è¿™æ˜¯æ•…æ„è®¾è®¡ï¼Œå®ƒå…è®¸ä½ æœ‰å¦‚ä¸‹ç±»å‹ï¼š
```ts
interface ArrStr {
  [key: string]: string | number; // å¿…é¡»åŒ…æ‹¬æ‰€ç”¨æˆå‘˜ç±»å‹
  [index: number]: string; // å­—ç¬¦ä¸²ç´¢å¼•ç±»å‹çš„å­çº§

  // example
  length: number;
}
```

#### è®¾è®¡æ¨¡å¼ï¼šç´¢å¼•ç­¾åçš„åµŒå¥—

:::tip
æ·»åŠ ç´¢å¼•ç­¾åæ—¶ï¼Œéœ€è¦è€ƒè™‘çš„ APIã€‚
:::

åœ¨ JavaScript ç¤¾åŒºä½ å°†ä¼šè§åˆ°å¾ˆå¤šæ»¥ç”¨ç´¢å¼•ç­¾åçš„ APIã€‚å¦‚ JavaScript åº“ä¸­ä½¿ç”¨ CSS çš„å¸¸è§æ¨¡å¼ï¼š
```ts
interface NestedCSS {
  color?: string; // strictNullChecks=false æ—¶ç´¢å¼•ç­¾åå¯ä¸º undefined
  [selector: string]: string | NestedCSS;
}

const example: NestedCSS = {
  color: 'red',
  '.subclass': {
    color: 'blue'
  }
};
```

å°½é‡ä¸è¦ä½¿ç”¨è¿™ç§æŠŠå­—ç¬¦ä¸²ç´¢å¼•ç­¾åä¸æœ‰æ•ˆå˜é‡æ··åˆä½¿ç”¨ã€‚å¦‚æœå±æ€§åç§°ä¸­æœ‰æ‹¼å†™é”™è¯¯ï¼Œè¿™ä¸ªé”™è¯¯ä¸ä¼šè¢«æ•è·åˆ°ï¼š
```ts
const failsSilently: NestedCSS = {
  colour: 'red' // 'colour' ä¸ä¼šè¢«æ•æ‰åˆ°é”™è¯¯
};
```

å–è€Œä»£ä¹‹ï¼Œæˆ‘ä»¬æŠŠç´¢å¼•ç­¾ååˆ†ç¦»åˆ°è‡ªå·±çš„å±æ€§é‡Œï¼Œå¦‚å‘½åä¸º `nest`ï¼ˆæˆ–è€… `children`ã€`subnodes` ç­‰ï¼‰ï¼š
```ts
interface NestedCSS {
  color?: string;
  nest?: {
    [selector: string]: NestedCSS;
  };
}

const example: NestedCSS = {
  color: 'red',
  nest: {
    '.subclass': {
      color: 'blue'
    }
  }
}

const failsSliently: NestedCSS = {
  colour: 'red'  // TS Error: æœªçŸ¥å±æ€§ 'colour'
}
```

#### ç´¢å¼•ç­¾åä¸­æ’é™¤æŸäº›å±æ€§

æœ‰æ—¶ï¼Œä½ éœ€è¦æŠŠå±æ€§åˆå¹¶è‡³ç´¢å¼•ç­¾åï¼ˆè™½ç„¶æˆ‘ä»¬å¹¶ä¸å»ºè®®è¿™ä¹ˆåšï¼Œä½ åº”è¯¥ä½¿ç”¨ä¸Šæ–‡ä¸­æåˆ°çš„åµŒå¥—ç´¢å¼•ç­¾åçš„å½¢å¼ï¼‰ï¼Œå¦‚ä¸‹ä¾‹å­ï¼š
```ts
type FieldState = {
  value: string;
};

type FromState = {
  isValid: boolean; // Error: ä¸ç¬¦åˆç´¢å¼•ç­¾å
  [filedName: string]: FieldState;
};
```

TypeScript ä¼šæŠ¥é”™ï¼Œå› ä¸ºæ·»åŠ çš„ç´¢å¼•ç­¾åï¼Œå¹¶ä¸å…¼å®¹å®ƒåŸæœ‰çš„ç±»å‹ï¼Œä½¿ç”¨äº¤å‰ç±»å‹å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼š
```ts
type FieldState = {
  value: string;
};

type FormState = { isValid: boolean } & { [fieldName: string]: FieldState };
```

è¯·æ³¨æ„å°½ç®¡ä½ å¯ä»¥å£°æ˜å®ƒè‡³ä¸€ä¸ªå·²å­˜åœ¨çš„ TypeScript ç±»å‹ä¸Šï¼Œä½†æ˜¯ä½ ä¸èƒ½åˆ›å»ºå¦‚ä¸‹çš„å¯¹è±¡ï¼š
```ts
type FieldState = {
  value: string;
};

type FormState = { isValid: boolean } & { [fieldName: string]: FieldState };

// å°†å®ƒç”¨äºä»æŸäº›åœ°æ–¹è·å–çš„ JavaScript å¯¹è±¡
declare const foo: FormState;

const isValidBool = foo.isValid;
const somethingFieldState = foo['something'];

// ä½¿ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå°†ä¸ä¼šå·¥ä½œ
const bar: FormState = {
  // 'isValid' ä¸èƒ½èµ‹å€¼ç»™ 'FieldState'
  isValid: false
};
```

### æµåŠ¨çš„ç±»å‹

TypeScript ç±»å‹ç³»ç»Ÿéå¸¸å¼ºå¤§ï¼Œå®ƒæ”¯æŒå…¶ä»–ä»»ä½•å•ä¸€è¯­è¨€æ— æ³•å®ç°çš„ç±»å‹æµåŠ¨å’Œç±»å‹ç‰‡æ®µã€‚

è¿™æ˜¯å› ä¸º TypeScript çš„è®¾è®¡ç›®çš„ä¹‹ä¸€æ˜¯è®©ä½ æ— ç¼ä¸åƒ JavaScript è¿™ç±»é«˜åŠ¨æ€çš„è¯­è¨€ä¸€èµ·å·¥ä½œã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä»‹ç»ä¸€äº›åœ¨ TypeScript ä¸­ä½¿ç”¨ç§»åŠ¨ç±»å‹çš„æŠ€å·§ã€‚

å…³é”®çš„åŠ¨æœºï¼šå½“ä½ æ”¹å˜äº†å…¶ä¸­ä¸€ä¸ªæ—¶ï¼Œå…¶ä»–ç›¸å…³çš„ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œå¹¶ä¸”å½“æœ‰äº‹æƒ…å˜ç³Ÿç³•æ—¶ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªå‹å¥½çš„æç¤ºï¼Œå°±å¥½åƒä¸€ä¸ªè¢«ç²¾å¿ƒè®¾è®¡è¿‡çš„çº¦æŸç³»ç»Ÿã€‚

#### å¤åˆ¶ç±»å‹å’Œå€¼

å¦‚æœä½ æƒ³ç§»åŠ¨ä¸€ä¸ªç±»ï¼Œä½ å¯èƒ½ä¼šæƒ³è¦åšä»¥ä¸‹äº‹æƒ…ï¼š
```ts
class Foo {}

const Bar = Foo;

let bar: Bar; // Error: ä¸èƒ½æ‰¾åˆ°åç§° 'Bar'
```

è¿™ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸º `const` ä»…ä»…æ˜¯å¤åˆ¶äº† `Foo` åˆ°ä¸€ä¸ªå˜é‡å£°æ˜ç©ºé—´ï¼Œå› æ­¤ä½ æ— æ³•æŠŠ `Bar` å½“ä½œä¸€ä¸ªç±»å‹å£°æ˜ä½¿ç”¨ã€‚æ­£ç¡®çš„æ–¹å¼æ˜¯ä½¿ç”¨ `import` å…³é”®å­—ï¼Œè¯·æ³¨æ„ï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨ `namespace` æˆ–è€… `modules`ï¼Œä½¿ç”¨ `import` æ˜¯ä½ å”¯ä¸€èƒ½ç”¨çš„æ–¹å¼ï¼š
```ts
namespace importing {
  export class Foo {}
}

import Bar = importing.Foo;
let bar: Bar; // ok
```

è¿™ä¸ª `import` æŠ€å·§ï¼Œä»…é€‚åˆäºç±»å‹å’Œå˜é‡ã€‚

#### æ•è·å˜é‡çš„ç±»å‹

ä½ å¯ä»¥é€šè¿‡ `typeof` æ“ä½œç¬¦åœ¨ç±»å‹æ³¨è§£ä¸­ä½¿ç”¨å˜é‡ã€‚è¿™å…è®¸ä½ å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œä¸€ä¸ªå˜é‡çš„ç±»å‹ä¸å…¶ä»–ç±»å‹ç›¸åŒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
let foo = 123;
let bar: typeof foo; // 'bar' ç±»å‹ä¸ 'foo' ç±»å‹ç›¸åŒï¼ˆåœ¨è¿™é‡Œæ˜¯ï¼š 'number'ï¼‰

bar = 456; // ok
bar = '789'; // Error: 'string' ä¸èƒ½åˆ†é…ç»™ 'number' ç±»å‹
```

#### æ•è·ç±»æˆå‘˜çš„ç±»å‹

ä¸æ•è·å˜é‡çš„ç±»å‹ç›¸ä¼¼ï¼Œä½ ä»…ä»…æ˜¯éœ€è¦å£°æ˜ä¸€ä¸ªå˜é‡ç”¨æ¥æ•è·åˆ°çš„ç±»å‹ï¼š
```ts
class Foo {
  foo: number; // æˆ‘ä»¬æƒ³è¦æ•è·çš„ç±»å‹
}

declare let _foo: Foo;

// ä¸ä¹‹å‰åšæ³•ç›¸åŒ
let bar: typeof _foo.foo;
```

#### æ•è·å­—ç¬¦ä¸²ç±»å‹

è®¸å¤š JavaScript åº“å’Œæ¡†æ¶éƒ½ä½¿ç”¨åŸå§‹çš„ JavaScript å­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥ä½¿ç”¨ `const` å®šä¹‰ä¸€ä¸ªå˜é‡æ•è·å®ƒçš„ç±»å‹ï¼š
```ts
// æ•è·å­—ç¬¦ä¸²çš„ç±»å‹ä¸å€¼
const foo = 'Hello World';

// ä½¿ç”¨ä¸€ä¸ªæ•è·çš„ç±»å‹
let bar: typeof foo;

// bar ä»…èƒ½è¢«èµ‹å€¼ 'Hello World'
bar = 'Hello World'; // ok
bar = 'anything else'; // Error
```

åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œ`bar` æœ‰å­—é¢é‡ç±»å‹ `Hello World`ï¼Œæˆ‘ä»¬åœ¨[å­—é¢é‡ç±»å‹](#å­—é¢é‡ç±»å‹)ç« èŠ‚å·²ç»æ·±å…¥è®¨è®ºã€‚

#### æ•è·é”®çš„åç§°

keyof æ“ä½œç¬¦èƒ½è®©ä½ æ•è·ä¸€ä¸ªç±»å‹çš„é”®ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥æ•è·å˜é‡çš„é”®åç§°ï¼Œåœ¨é€šè¿‡ä½¿ç”¨ typeof æ¥è·å–ç±»å‹ä¹‹åï¼š
```ts
const colors = {
  red: 'red',
  blue: 'blue'
};

type Colors = keyof typeof colors;

let color: Colors; // color çš„ç±»å‹æ˜¯ 'red' | 'blue'
color = 'red'; // ok
color = 'blue'; // ok
color = 'anythingElse'; // Error
```

è¿™å…è®¸ä½ å¾ˆå®¹æ˜“åœ°æ‹¥æœ‰åƒå­—ç¬¦ä¸²æšä¸¾+å¸¸é‡è¿™æ ·çš„ç±»å‹ï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºã€‚

### å¼‚å¸¸å¤„ç†

JavaScript æœ‰ä¸€ä¸ª `Error` ç±»ï¼Œç”¨äºå¤„ç†å¼‚å¸¸ã€‚ä½ å¯ä»¥é€šè¿‡ `throw` å…³é”®å­—æ¥æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ç„¶åé€šè¿‡ `try/catch` å—æ¥æ•è·æ­¤é”™è¯¯ï¼š
```ts
try {
  throw new Error('Something bad happened');
} catch (e) {
  console.log(e);
}
```

#### é”™è¯¯çš„å­ç±»å‹

é™¤å†…ç½®çš„ `Error` ç±»å¤–ï¼Œè¿˜æœ‰ä¸€äº›é¢å¤–çš„å†…ç½®é”™è¯¯ï¼Œå®ƒä»¬ç»§æ‰¿è‡ª `Error` ç±»ï¼š

##### RangeError

å½“æ•°å­—ç±»å‹å˜é‡æˆ–è€…å‚æ•°è¶…å‡ºå…¶æœ‰æ•ˆèŒƒå›´æ—¶ï¼Œå‡ºç° `RangeError` çš„é”™è¯¯æç¤ºï¼š
```ts
// ä½¿ç”¨è¿‡å¤šå‚æ•°è°ƒç”¨ console
console.log.apply(console, new Array(1000000000)); // RangeError: æ•°ç»„é•¿åº¦æ— æ•ˆ
```

##### ReferenceError

å½“å¼•ç”¨æ— æ•ˆæ—¶ï¼Œä¼šå‡ºç° `ReferenceError` çš„é”™è¯¯æç¤ºï¼š
```ts
'use strict';
console.log(notValidVar); // ReferenceError: notValidVar æœªå®šä¹‰
```

##### SyntaxError

å½“è§£ææ— æ•ˆ JavaScript ä»£ç æ—¶ï¼Œä¼šå‡ºç° `SyntaxError` çš„é”™è¯¯æç¤ºï¼š
```ts
1 *** 3   // SyntaxError: æ— æ•ˆçš„æ ‡è®° *
```

##### TypeError

å˜é‡æˆ–è€…å‚æ•°ä¸æ˜¯æœ‰æ•ˆç±»å‹æ—¶ï¼Œä¼šå‡ºç° `TypeError` çš„é”™è¯¯æç¤ºï¼š
```ts
'1.2'.toPrecision(1); // TypeError: '1.2'.toPrecision ä¸æ˜¯å‡½æ•°ã€‚

```

##### URIError

å½“ä¼ å…¥æ— æ•ˆå‚æ•°è‡³ `encodeURI()` å’Œ `decodeURI()` æ—¶ï¼Œä¼šå‡ºç° `URIError` çš„é”™è¯¯æç¤ºï¼š
```ts
decodeURI('%'); // URIError: URL å¼‚å¸¸
```

#### ä½¿ç”¨ `Error`

JavaScript åˆå­¦è€…å¯èƒ½æœ‰æ—¶å€™ä»…ä»…æ˜¯æŠ›å‡ºä¸€ä¸ªåŸå§‹å­—ç¬¦ä¸²ï¼š
```ts
let foo = ['World'];
console.log(foo[0]); // World
```

**ä¸è¦è¿™ä¹ˆåšï¼Œ**ä½¿ç”¨ `Error` å¯¹è±¡çš„åŸºæœ¬å¥½å¤„æ˜¯ï¼Œå®ƒèƒ½è‡ªåŠ¨è·Ÿè¸ªå †æ ˆçš„å±æ€§æ„å»ºä»¥åŠç”Ÿæˆä½ç½®ã€‚

åŸå§‹å­—ç¬¦ä¸²ä¼šå¯¼è‡´æå·®çš„è°ƒè¯•ä½“éªŒï¼Œå¹¶ä¸”åœ¨åˆ†ææ—¥å¿—æ—¶ï¼Œå°†ä¼šå˜å¾—é”™ç»¼å¤æ‚ã€‚

#### ä½ å¹¶ä¸éœ€è¦ `throw` æŠ›å‡ºä¸€ä¸ªé”™è¯¯

ä¼ é€’ä¸€ä¸ª `Error` å¯¹è±¡æ˜¯æ²¡é—®é¢˜çš„ï¼Œè¿™ç§æ–¹å¼åœ¨ `Node.js` å›è°ƒå‡½æ•°ä¸­éå¸¸å¸¸è§ï¼Œå®ƒç”¨ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºé”™è¯¯å¯¹è±¡è¿›è¡Œå›è°ƒå¤„ç†
```ts
function myFunction (callback: (e: Error)) {
  doSomethingAsync(function () {
    if (somethingWrong) {
      callback(new Error('This is my error'));
    } else {
      callback();
    }
  })
}
```

#### ä¼˜ç§€çš„ç”¨ä¾‹

ã€ŒExceptions should be exceptionalã€æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­å¸¸ç”¨ç”¨è¯­ã€‚è¿™é‡Œæœ‰ä¸€äº›åŸå› è¯´æ˜åœ¨ JavaScript(TypeScript) ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

##### ä¸æ¸…æ¥šä»å“ªé‡ŒæŠ›å‡ºé”™è¯¯

è€ƒè™‘å¦‚ä¸‹ä»£ç å—ï¼š
```ts
try {
  const foo = runTask1();
  const bar = runTask2();
} catch (e) {
  console.log('Error:', e);
}
```

ä¸‹ä¸€ä¸ªå¼€å‘è€…å¯èƒ½å¹¶ä¸æ¸…æ¥šå“ªä¸ªå‡½æ•°å¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯ã€‚åœ¨æ²¡æœ‰é˜…è¯» `task1/task2` ä»£ç ä»¥åŠä»–ä»¬å¯èƒ½ä¼šè°ƒç”¨çš„å‡½æ•°æ—¶ï¼Œå¯¹ä»£ç  `review` çš„äººå‘˜å¯èƒ½ä¹Ÿä¸ä¼šçŸ¥é“é”™è¯¯ä¼šä»å“ªé‡ŒæŠ›å‡ºã€‚

##### ä¼˜é›…çš„é”™è¯¯æ•è·

ä½ å¯ä»¥é€šè¿‡ä¸ºæ¯ä¸ªå¯èƒ½æŠ›å‡ºé”™è¯¯çš„ä»£ç æ˜¾å¼æ•è·ï¼Œæ¥ä½¿å…¶ä¼˜é›…ï¼š
```ts
try {
  const foo = runTask1();
} catch (e) {
  console.log('Error:', e);
}

try {
  const bar = runTask2();
} catch (e) {
  console.log('Error:', e);
}
```

ä½†æ˜¯ç°åœ¨ï¼Œå¦‚æœä½ æƒ³ä»ç¬¬ä¸€ä¸ªä»»åŠ¡ä¸­ä¼ é€’å˜é‡åˆ°ç¬¬äºŒä¸ªä»»åŠ¡ä¸­ï¼Œä»£ç ä¼šå˜çš„æ··ä¹±ï¼ˆæ³¨æ„ï¼šfoo å˜é‡éœ€è¦ç”¨ let æ˜¾å¼æ³¨è§£å®ƒï¼Œå› ä¸ºå®ƒä¸èƒ½ä» `runTask1` ä¸­è¿”å›å‡ºæ¥ï¼‰ï¼š
```ts
let foo = ['World'];
console.log(foo[0]); // World
```

##### æ²¡æœ‰åœ¨ç±»å‹ç³»ç»Ÿä¸­å¾ˆå¥½çš„è¡¨ç¤º

è€ƒè™‘å¦‚ä¸‹å‡½æ•°ï¼š
```ts
function validate(value: number) {
  if (value < 0 || value > 100) {
    throw new Error('Invalid value');
  }
}
```

åœ¨è¿™ç§æƒ…å¢ƒä¸‹ä½¿ç”¨ `Error` ä¸æ˜¯ä¸€ä¸ªå¥½çš„ä¸»æ„ã€‚å› ä¸ºæ²¡æœ‰ç”¨æ¥éªŒè¯å‡½æ•°çš„ç±»å‹å®šä¹‰ï¼ˆå¦‚ï¼š`(value: number) => void`ï¼‰ï¼Œå–è€Œä»£ä¹‹ä¸€ä¸ªæ›´å¥½çš„æ–¹å¼æ˜¯åˆ›å»ºä¸€ä¸ªéªŒè¯æ–¹æ³•ï¼š
```ts
function validate(
  value: number
): {
  error?: string;
} {
  if (value < 0 || value > 100) {
    return { error: 'Invalid value' };
  }
}
```

ç°åœ¨å®ƒå…·æœ‰ç±»å‹å®šä¹‰äº†ã€‚

:::tip
é™¤éä½ æƒ³ç”¨ä»¥éå¸¸é€šç”¨ï¼ˆtry/catchï¼‰çš„æ–¹å¼å¤„ç†é”™è¯¯ï¼Œå¦åˆ™ä¸è¦æŠ›å‡ºé”™è¯¯ã€‚
:::

### æ··åˆ

TypeScript (å’Œ JavaScript) ç±»åªèƒ½ä¸¥æ ¼çš„å•ç»§æ‰¿ï¼Œå› æ­¤ä½ ä¸èƒ½åšï¼š
```ts
class User extends Tagged, Timestamped { // ERROR : ä¸èƒ½å¤šé‡ç»§æ‰¿
  // ..
}
```

ä»å¯é‡ç”¨ç»„ä»¶æ„å»ºç±»çš„å¦ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡åŸºç±»æ¥æ„å»ºå®ƒä»¬ï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºæ··åˆã€‚

è¿™ä¸ªä¸»æ„æ˜¯ç®€å•çš„ï¼Œé‡‡ç”¨å‡½æ•° B æ¥å—ä¸€ä¸ªç±» Aï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå¸¦æœ‰æ–°åŠŸèƒ½çš„ç±»çš„æ–¹å¼æ¥æ›¿ä»£ A ç±»æ‰©å±• B æ¥è·å– B ä¸Šçš„åŠŸèƒ½ï¼Œå‰è€…ä¸­çš„ B å³æ˜¯æ··åˆã€‚

:::tip
ã€Œæ··åˆã€æ˜¯ä¸€ä¸ªå‡½æ•°ï¼š
- ä¼ å…¥ä¸€ä¸ªæ„é€ å‡½æ•°ï¼›
- åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ–°åŠŸèƒ½ï¼Œå¹¶ä¸”æ‰©å±•æ„é€ å‡½æ•°çš„æ–°ç±»ï¼›
- è¿”å›è¿™ä¸ªæ–°ç±»ã€‚
:::

ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼š
```ts
// æ‰€æœ‰ mixins éƒ½éœ€è¦
type Constructor<T = {}> = new (...args: any[]) => T;

/////////////
// mixins ä¾‹å­
////////////

// æ·»åŠ å±æ€§çš„æ··åˆä¾‹å­
function TimesTamped<TBase extends Constructor>(Base: TBase) {
  return class extends Base {
    timestamp = Date.now();
  };
}

// æ·»åŠ å±æ€§å’Œæ–¹æ³•çš„æ··åˆä¾‹å­
function Activatable<TBase extends Constructor>(Base: TBase) {
  return class extends Base {
    isActivated = false;

    activate() {
      this.isActivated = true;
    }

    deactivate() {
      this.isActivated = false;
    }
  };
}

///////////
// ç»„åˆç±»
///////////

// ç®€å•çš„ç±»
class User {
  name = '';
}

// æ·»åŠ  TimesTamped çš„ User
const TimestampedUser = TimesTamped(User);

// Tina TimesTamped å’Œ Activatable çš„ç±»
const TimestampedActivatableUser = TimesTamped(Activatable(User));

//////////
// ä½¿ç”¨ç»„åˆç±»
//////////

const timestampedUserExample = new TimestampedUser();
console.log(timestampedUserExample.timestamp);

const timestampedActivatableUserExample = new TimestampedActivatableUser();
console.log(timestampedActivatableUserExample.timestamp);
console.log(timestampedActivatableUserExample.isActivated);
```

è®©æˆ‘ä»¬åˆ†è§£è¿™ä¸ªä¾‹å­ã€‚

#### åˆ›å»ºä¸€ä¸ªæ„é€ å‡½æ•°

æ··åˆæ¥å—ä¸€ä¸ªç±»ï¼Œå¹¶ä¸”ä½¿ç”¨æ–°åŠŸèƒ½æ‰©å±•å®ƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰æ„é€ å‡½æ•°çš„ç±»å‹ï¼š
```ts
type Constructor<T = {}> = new (...args: any[]) => T;

```

#### æ‰©å±•ä¸€ä¸ªç±»å¹¶ä¸”è¿”å›å®ƒ

```ts
// æ·»åŠ å±æ€§çš„æ··åˆä¾‹å­
function TimesTamped<TBase extends Constructor>(Base: TBase) {
  return class extends Base {
    timestamp = Date.now();
  };
}
```

### ThisType

é€šè¿‡ `ThisType` æˆ‘ä»¬å¯ä»¥åœ¨å¯¹è±¡å­—é¢é‡ä¸­é”®å…¥ `this`ï¼Œå¹¶æä¾›é€šè¿‡ä¸Šä¸‹æ–‡ç±»å‹æ§åˆ¶ `this` ç±»å‹çš„ä¾¿æ·æ–¹å¼ã€‚å®ƒåªæœ‰åœ¨ `--noImplicitThis` çš„é€‰é¡¹ä¸‹æ‰æœ‰æ•ˆã€‚

ç°åœ¨ï¼Œåœ¨å¯¹è±¡å­—é¢é‡æ–¹æ³•ä¸­çš„ `this` ç±»å‹ï¼Œå°†ç”±ä»¥ä¸‹å†³å®šï¼š
- å¦‚æœè¿™ä¸ªæ–¹æ³•æ˜¾å¼æŒ‡å®šäº† `this` å‚æ•°ï¼Œé‚£ä¹ˆ `this` å…·æœ‰è¯¥å‚æ•°çš„ç±»å‹ã€‚ï¼ˆä¸‹ä¾‹å­ä¸­ `bar`ï¼‰
- å¦åˆ™ï¼Œå¦‚æœæ–¹æ³•ç”±å¸¦ `this` å‚æ•°çš„ç­¾åè¿›è¡Œä¸Šä¸‹æ–‡é”®å…¥ï¼Œé‚£ä¹ˆ `this` å…·æœ‰è¯¥å‚æ•°çš„ç±»å‹ã€‚ï¼ˆä¸‹ä¾‹å­ä¸­ `foo`ï¼‰
- å¦åˆ™ï¼Œå¦‚æœ `--noImplicitThis` é€‰é¡¹å·²ç»å¯ç”¨ï¼Œå¹¶ä¸”å¯¹è±¡å­—é¢é‡ä¸­åŒ…å«ç”± `ThisType<T>` é”®å…¥çš„ä¸Šä¸‹æ–‡ç±»å‹ï¼Œé‚£ä¹ˆ `this` çš„ç±»å‹ä¸º `T`ã€‚
- å¦åˆ™ï¼Œå¦‚æœ `--noImplicitThis` é€‰é¡¹å·²ç»å¯ç”¨ï¼Œå¹¶ä¸”å¯¹è±¡å­—é¢é‡ä¸­ä¸åŒ…å«ç”± `ThisType<T>` é”®å…¥çš„ä¸Šä¸‹æ–‡ç±»å‹ï¼Œé‚£ä¹ˆ `this` çš„ç±»å‹ä¸ºè¯¥ä¸Šä¸‹æ–‡ç±»å‹ã€‚
- å¦åˆ™ï¼Œå¦‚æœ `--noImplicitThis` é€‰é¡¹å·²ç»å¯ç”¨ï¼Œ`this` å…·æœ‰è¯¥å¯¹è±¡å­—é¢é‡çš„ç±»å‹ã€‚
- å¦åˆ™ï¼Œ`this` çš„ç±»å‹ä¸º `any`ã€‚

ä¸€äº›ä¾‹å­ï¼š
```ts
// Compile with --noImplicitThis

type Point = {
  x: number;
  y: number;
  moveBy(dx: number, dy: number): void;
};

let p: Point = {
  x: 10,
  y: 20,
  moveBy(dx, dy) {
    this.x += dx; // this has type Point
    this.y += dy; // this has type Point
  }
};

let foo = {
  x: 'hello',
  f(n: number) {
    this; // { x: string, f(n: number): void }
  }
};

let bar = {
  x: 'hello',
  f(this: { message: string }) {
    this; // { message: string }
  }
};
```

ç±»ä¼¼çš„æ–¹å¼ï¼Œå½“ä½¿ç”¨ `--noImplicitThis` æ—¶ï¼Œå‡½æ•°è¡¨è¾¾å¼èµ‹å€¼ç»™ `obj.xxx` æˆ–è€… `obj[xxx]` çš„ç›®æ ‡æ—¶ï¼Œåœ¨å‡½æ•°ä¸­ `this` çš„ç±»å‹å°†ä¼šæ˜¯ `obj`ï¼š
```ts
// Compile with --noImplicitThis

obj.f = function(n) {
  return this.x - n; // 'this' has same type as 'obj'
};

obj['f'] = function(n) {
  return this.x - n; // 'this' has same type as 'obj'
};
```

é€šè¿‡ API è½¬æ¢å‚æ•°çš„å½¢å¼æ¥ç”Ÿæˆ `this` çš„å€¼çš„æƒ…æ™¯ä¸‹ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„ `ThisType<T>` æ ‡è®°æ¥å£ï¼Œå¯ç”¨äºåœ¨ä¸Šä¸‹æ–‡ä¸­è¡¨æ˜è½¬æ¢åçš„ç±»å‹ã€‚å°¤å…¶æ˜¯å½“å­—é¢é‡ä¸­çš„ä¸Šä¸‹æ–‡ç±»å‹ä¸º `ThisType<T>` æˆ–è€…æ˜¯åŒ…å« `ThisType<T>` çš„äº¤é›†æ—¶ï¼Œæ˜¾å¾—å°¤ä¸ºæœ‰æ•ˆï¼Œå¯¹è±¡å­—é¢é‡æ–¹æ³•ä¸­ `this` çš„ç±»å‹å³ä¸º `T`ã€‚
```ts
// Compile with --noImplicitThis

type ObjectDescriptor<D, M> = {
  data?: D;
  methods?: M & ThisType<D & M>; // Type of 'this' in methods is D & M
};

function makeObject<D, M>(desc: ObjectDescriptor<D, M>): D & M {
  let data: object = desc.data || {};
  let methods: object = desc.methods || {};
  return { ...data, ...methods } as D & M;
}

let obj = makeObject({
  data: { x: 0, y: 0 },
  methods: {
    moveBy(dx: number, dy: number) {
      this.x += dx; // Strongly typed this
      this.y += dy; // Strongly typed this
    }
  }
});

obj.x = 10;
obj.y = 20;
obj.moveBy(5, 5);
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ`makeObject` å‚æ•°ä¸­çš„å¯¹è±¡å±æ€§ `methods` å…·æœ‰åŒ…å« `ThisType<D & M>` çš„ä¸Šä¸‹æ–‡ç±»å‹ï¼Œå› æ­¤å¯¹è±¡ä¸­ `methods` å±æ€§ä¸‹çš„æ–¹æ³•çš„ `this` ç±»å‹ä¸º `{ x: number, y: number } & { moveBy(dx: number, dy: number): number }`ã€‚

`ThisType<T>` çš„æ¥å£ï¼Œåœ¨ `lib.d.ts` åªæ˜¯è¢«å£°æ˜ä¸ºç©ºçš„æ¥å£ï¼Œé™¤äº†å¯ä»¥åœ¨å¯¹è±¡å­—é¢é‡ä¸Šä¸‹æ–‡ä¸­å¯ä»¥è¢«è¯†åˆ«ä»¥å¤–ï¼Œè¯¥æ¥å£çš„ä½œç”¨ç­‰åŒäºä»»æ„ç©ºæ¥å£ã€‚

## TypeScript ç¼–è¯‘åŸç†

### æ¦‚è§ˆ

TypeScript ç¼–è¯‘å™¨æºæ–‡ä»¶ä½äº [`src/compiler`](https://github.com/Microsoft/TypeScript/tree/master/src/compiler) ç›®å½•ä¸‹

> è¯‘æ³¨ï¼šTypescript Deep Dive ä½¿ç”¨çš„æºç åº”ä¸º 2016 å¹´ä»¥å‰çš„æºç ã€‚å­¦ä¹ æ—¶è¯·å¯¹ç…§ç°æœ‰çš„æºç 

å®ƒåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªå…³é”®éƒ¨åˆ†ï¼š
- Scanner æ‰«æå™¨ï¼ˆ`scanner.ts`ï¼‰
- Parser è§£æå™¨ï¼ˆ`parser.tsï¼‰`
- Binder ç»‘å®šå™¨ï¼ˆ`binder.tsï¼‰`
- Checker æ£€æŸ¥å™¨ï¼ˆ`checker.ts`ï¼‰
- Emitter å‘å°„å™¨ï¼ˆ`emitter.ts`ï¼‰

æ¯ä¸ªéƒ¨åˆ†åœ¨æºæ–‡ä»¶ä¸­å‡æœ‰ç‹¬ç«‹æ–‡ä»¶ï¼Œæœ¬ç« ç¨åä¼šå¯¹è¿™äº›éƒ¨åˆ†åšè§£é‡Šã€‚

#### BYOTS

æˆ‘ä»¬æœ‰ä¸ªåä¸º [Bring Your Own TypeScript (BYOTS)](https://github.com/basarat/byots) çš„é¡¹ç›®ï¼Œé€šè¿‡æš´éœ²å†…éƒ¨æ¥å£è®©ç¼–è¯‘å™¨ API ä½¿ç”¨èµ·æ¥æ›´ç®€å•ã€‚ä½ å¯ä»¥åœ¨å…¨å±€èŒƒå›´ä¸Šæš´éœ²ä½  TypeScript åº”ç”¨çš„æœ¬åœ°å˜é‡ã€‚

#### è¯­æ³•å’Œè¯­ä¹‰

**è¯­æ³•**æ­£ç¡®å¹¶ä¸æ„å‘³ç€è¯­ä¹‰ä¸Šä¹Ÿæ­£ç¡®ã€‚ä¸‹é¢çš„ TypeScript ä»£ç ï¼Œè¯­æ³•åˆæ³•ï¼Œä½†æ˜¯è¯­ä¹‰å´ä¸æ­£ç¡®
```ts
var foo: number = 'not a number';
```

`è¯­ä¹‰` ä»è‡ªç„¶è¯­è¨€è§’åº¦æ„å‘³ç€æœ‰æ„ä¹‰ï¼Œç†è§£è¿™ä¸ªæ¦‚å¿µå¯¹ä½ å¾ˆæœ‰ç”¨ã€‚

#### å¤„ç†æ¦‚è§ˆ

ä»¥ä¸‹æ¼”ç¤ºç®€å•è¯´æ˜ TypeScript ç¼–è¯‘å™¨å¦‚ä½•å°†ä¸Šè¿°å‡ ä¸ªå…³é”®éƒ¨åˆ†ç»„åˆåœ¨ä¸€èµ·ï¼š
```shell
SourceCodeï¼ˆæºç ï¼‰ ~~ æ‰«æå™¨ ~~> Token æµ
```
```shell
Token æµ ~~ è§£æå™¨ ~~> ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰
```
```shell
AST ~~ ç»‘å®šå™¨ ~~> Symbolsï¼ˆç¬¦å·ï¼‰
```

ç¬¦å·ï¼ˆ`Symbol`ï¼‰æ˜¯ TypeScript è¯­ä¹‰ç³»ç»Ÿçš„ä¸»è¦æ„é€ å—ã€‚å¦‚ä¸Šæ‰€ç¤ºï¼Œç¬¦å·æ˜¯ç»‘å®šçš„ç»“æœã€‚ç¬¦å·å°† AST ä¸­çš„å£°æ˜èŠ‚ç‚¹ä¸ç›¸åŒå®ä½“çš„å…¶ä»–å£°æ˜ç›¸è¿ã€‚

ç¬¦å·å’Œ AST æ˜¯æ£€æŸ¥å™¨ç”¨æ¥éªŒè¯æºä»£ç è¯­ä¹‰çš„
```shell
AST + ç¬¦å· ~~ æ£€æŸ¥å™¨ ~~> ç±»å‹éªŒè¯
```

æœ€åï¼Œéœ€è¦è¾“å‡º JavaScript æ—¶ï¼š
```shell
AST + æ£€æŸ¥å™¨ ~~ å‘å°„å™¨ ~~> JavaScript ä»£ç 
```

TypeScript ç¼–è¯‘å™¨ä¸­è¿˜æœ‰ä¸€äº›å…¶ä»–æ–‡ä»¶ï¼Œä¸ºæˆ‘ä»¬æ¥ä¸‹æ¥ä»‹ç»çš„å¾ˆå¤šå…³é”®éƒ¨åˆ†æä¾›å®ç”¨å·¥å…·ã€‚

#### æ–‡ä»¶ï¼šUtilities

`core.ts` ï¼šTypeScript ç¼–è¯‘å™¨ä½¿ç”¨çš„æ ¸å¿ƒå·¥å…·é›†ï¼Œé‡è¦çš„æœ‰ï¼š
- `let objectAllocator: ObjectAllocator` æ˜¯ä¸€ä¸ªå®šä¹‰ä¸ºå…¨å±€å•ä¾‹çš„å˜é‡ã€‚æä¾›ä»¥ä¸‹å®šä¹‰ï¼š
  - `getNodeConstructor`ï¼ˆèŠ‚ç‚¹ä¼šåœ¨è§£æå™¨ / AST ä¸­ä»‹ç»ï¼‰
  - `getSymbolConstructor`ï¼ˆç¬¦å·ä¼šåœ¨ç»‘å®šå™¨ä¸­ä»‹ç»ï¼‰
  - `getTypeConstructor`ï¼ˆç±»å‹ä¼šåœ¨æ£€æŸ¥å™¨ä¸­ä»‹ç»ï¼‰
  - `getSignatureConstructor`ï¼ˆç­¾åæ˜¯ç´¢å¼•ï¼Œè°ƒç”¨å’Œæ„é€ ç­¾åï¼‰

#### æ–‡ä»¶ï¼šå…³é”®æ•°æ®ç»“æ„

`types.ts` åŒ…å«æ•´ä¸ªç¼–è¯‘å™¨ä¸­ä½¿ç”¨çš„å…³é”®æ•°æ®ç»“æ„å’Œæ¥å£ï¼Œè¿™é‡Œåˆ—å‡ºä¸€äº›å…³é”®éƒ¨åˆ†ï¼š
- `SyntaxKind` AST èŠ‚ç‚¹ç±»å‹é€šè¿‡ `SyntaxKind` æšä¸¾è¿›è¡Œè¯†åˆ«
- `TypeChecker` ç±»å‹æ£€æŸ¥å™¨æä¾›æ­¤æ¥å£
- `CompilerHost` ç”¨äºç¨‹åºï¼ˆProgramï¼‰å’Œç³»ç»Ÿä¹‹é—´çš„äº¤äº’
- `Node` AST èŠ‚ç‚¹

#### æ–‡ä»¶ï¼šç³»ç»Ÿ

`system.ts`ï¼ŒTypeScript ç¼–è¯‘å™¨ä¸æ“ä½œç³»ç»Ÿçš„æ‰€æœ‰äº¤äº’å‡é€šè¿‡ `System` æ¥å£è¿›è¡Œã€‚æ¥å£åŠå…¶å®ç°ï¼ˆ`WScript` å’Œ `Node`ï¼‰ å‡å®šä¹‰åœ¨ `system.ts` ä¸­ã€‚ä½ å¯ä»¥å°†å…¶è§†ä¸º**æ“ä½œç¯å¢ƒï¼ˆOE, Operating Environmentï¼‰**ã€‚

ç°åœ¨å¯¹ä¸»è¦æ–‡ä»¶æœ‰ä¸€ä¸ªæ•´ä½“äº†è§£äº†ï¼Œæˆ‘ä»¬ç»§ç»­ä»‹ç»ç¨‹åºï¼ˆ`Program`ï¼‰çš„æ¦‚å¿µ

### ç¨‹åº

ç¨‹åºå®šä¹‰åœ¨ `program.ts` ä¸­ã€‚[ç¼–è¯‘ä¸Šä¸‹æ–‡](#ç¼–è¯‘ä¸Šä¸‹æ–‡)åœ¨ TypeScript ç¼–è¯‘å™¨ä¸­è¢«è§†ä¸ºä¸€ä¸ª `Program`ï¼Œå®ƒåŒ…å« `SourceFile` å’Œç¼–è¯‘é€‰é¡¹

#### `CompilerHost` çš„ä½¿ç”¨

CompilerHost æ˜¯ä¸æ“ä½œç¯å¢ƒï¼ˆOE, Operating Enviornmentï¼‰è¿›è¡Œäº¤äº’çš„æœºåˆ¶ï¼š

`Program` -ä½¿ç”¨-> `CompilerHost` -ä½¿ç”¨-> `System`

ç”¨ `CompilerHost` ä½œä¸­é—´å±‚çš„åŸå› æ˜¯å¯ä»¥è®©æ¥å£å¯¹ `Program` çš„éœ€æ±‚è¿›è¡Œç»†ç²’åº¦çš„è°ƒæ•´ï¼Œè€Œæ— éœ€è€ƒè™‘æ“ä½œç¯å¢ƒçš„éœ€æ±‚ã€‚ï¼ˆä¾‹å¦‚ï¼š`Program` æ— éœ€å…³å¿ƒ `System` çš„ `fileExists` å‡½æ•°ï¼‰

å¯¹`System`è€Œè¨€è¿˜æœ‰å…¶ä»–çš„ä½¿ç”¨è€…ï¼ˆæ¯”å¦‚æµ‹è¯•ï¼‰

#### SourceFile

ç¨‹åºæœ‰ä¸ª APIï¼Œç”¨äºè·å– SourceFileï¼š`getSourceFiles(): SourceFile[];`ã€‚å¾—åˆ°çš„æ¯ä¸ªå…ƒç´ å‡æ˜¯ä¸€æ£µæŠ½è±¡è¯­æ³•æ ‘çš„æ ¹èŠ‚ç‚¹ï¼ˆç§°åš `SourceFile`ï¼‰

### æŠ½è±¡è¯­æ³•æ ‘

#### Node èŠ‚ç‚¹

èŠ‚ç‚¹æ˜¯æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ çš„åŸºæœ¬æ„é€ å—ã€‚è¯­æ³•ä¸Šï¼Œé€šå¸¸ `Node` è¡¨ç¤ºéæœ«ç«¯ï¼ˆnon-terminalsï¼‰èŠ‚ç‚¹ã€‚ä½†æ˜¯ï¼Œæœ‰äº›æœ«ç«¯èŠ‚ç‚¹ï¼Œå¦‚ï¼šæ ‡è¯†ç¬¦å’Œå­—é¢é‡ä¹Ÿä¼šä¿ç•™åœ¨æ ‘ä¸­ã€‚

AST èŠ‚ç‚¹æ–‡æ¡£ç”±ä¸¤ä¸ªå…³é”®éƒ¨åˆ†æ„æˆã€‚ä¸€æ˜¯èŠ‚ç‚¹çš„ `SyntaxKind` æšä¸¾ï¼Œç”¨äºæ ‡è¯† AST ä¸­çš„ç±»å‹ã€‚äºŒæ˜¯å…¶æ¥å£ï¼Œå³å®ä¾‹åŒ– AST æ—¶èŠ‚ç‚¹æä¾›çš„ APIã€‚

è¿™é‡Œæ˜¯ `interface Node` çš„ä¸€äº›å…³é”®æˆå‘˜ï¼š
- `TextRange` æ ‡è¯†è¯¥èŠ‚ç‚¹åœ¨æºæ–‡ä»¶ä¸­çš„èµ·æ­¢ä½ç½®ã€‚
- `parent?: Node` å½“å‰èŠ‚ç‚¹ï¼ˆåœ¨ AST ä¸­ï¼‰çš„çˆ¶èŠ‚ç‚¹

`Node` è¿˜æœ‰ä¸€äº›å…¶ä»–çš„æˆå‘˜ï¼Œæ ‡å¿—ï¼ˆflagsï¼‰å’Œä¿®é¥°ç¬¦ï¼ˆmodifiersï¼‰ç­‰ã€‚ä½ å¯ä»¥åœ¨æºç ä¸­æœç´¢ `interface Node` æ¥æŸ¥çœ‹ï¼Œè€Œä¸Šé¢æåˆ°å¯¹èŠ‚ç‚¹çš„éå†æ˜¯éå¸¸é‡è¦çš„ã€‚

##### SourceFile

- `SyntaxKind.SourceFile`
- `interface SourceFile`

æ¯ä¸ª `SourceFile` éƒ½æ˜¯ä¸€æ£µ AST çš„é¡¶çº§èŠ‚ç‚¹ï¼Œå®ƒä»¬åŒ…å«åœ¨ `Program` ä¸­ã€‚

#### AST æŠ€å·§ï¼šè®¿é—®å­èŠ‚ç‚¹

æœ‰ä¸ªå·¥å…·å‡½æ•° `ts.forEachChild`ï¼Œå¯ä»¥ç”¨æ¥è®¿é—® AST ä»»ä¸€èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚

ä¸‹é¢æ˜¯ç®€åŒ–çš„ä»£ç ç‰‡æ®µï¼Œç”¨äºæ¼”ç¤ºå¦‚ä½•å·¥ä½œï¼š
```ts
export function forEachChild<T>(node: Node, cbNode: (node: Node) => T, cbNodeArray?: (nodes: Node[]) => T): T {
  if (!node) {
      return;
  }
  switch (node.kind) {
    case SyntaxKind.BinaryExpression:
      return visitNode(cbNode, (<BinaryExpression>node).left) ||
        visitNode(cbNode, (<BinaryExpression>node).operatorToken) ||
        visitNode(cbNode, (<BinaryExpression>node).right);
    case SyntaxKind.IfStatement:
      return visitNode(cbNode, (<IfStatement>node).expression) ||
        visitNode(cbNode, (<IfStatement>node).thenStatement) ||
        visitNode(cbNode, (<IfStatement>node).elseStatement);

    // .... æ›´å¤š
```

è¯¥å‡½æ•°ä¸»è¦æ£€æŸ¥ `node.kind` å¹¶æ®æ­¤åˆ¤æ–­ node çš„æ¥å£ï¼Œç„¶ååœ¨å…¶å­èŠ‚ç‚¹ä¸Šè°ƒç”¨ `cbNode`ã€‚ä½†æ˜¯ï¼Œè¦æ³¨æ„è¯¥å‡½æ•°ä¸ä¼šä¸º**æ‰€æœ‰**å­èŠ‚ç‚¹è°ƒç”¨ `visitNode`ï¼ˆä¾‹å¦‚ï¼šSyntaxKind.SemicolonTokenï¼‰ã€‚æƒ³è·å¾—æŸ AST èŠ‚ç‚¹çš„**æ‰€æœ‰**å­èŠ‚ç‚¹ï¼Œåªè¦è°ƒç”¨è¯¥èŠ‚ç‚¹çš„æˆå‘˜å‡½æ•° `.getChildren`ã€‚

å¦‚ä¸‹å‡½æ•°ä¼šæ‰“å° AST èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯ï¼š
```ts
function printAllChildren(node: ts.Node, depth = 0) {
  console.log(new Array(depth + 1).join('----'), ts.syntaxKindToName(node.kind), node.pos, node.end);
  depth++;
  node.getChildren().forEach(c => printAllChildren(c, depth));
}
```

æˆ‘ä»¬è¿›ä¸€æ­¥è®¨è®ºè§£æå™¨æ—¶ä¼šçœ‹åˆ°è¯¥å‡½æ•°çš„ä½¿ç”¨ç¤ºä¾‹ã€‚

#### AST æŠ€å·§ï¼šSyntaxKind æšä¸¾

`SyntaxKind` è¢«å®šä¹‰ä¸ºä¸€ä¸ªå¸¸é‡æšä¸¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
export const enum SyntaxKind {
  Unknown,
  EndOfFileToken,
  SingleLineCommentTrivia,
  // ... æ›´å¤š
```

è¿™æ˜¯ä¸ª[å¸¸é‡æšä¸¾](#å¸¸é‡æšä¸¾)ï¼Œæ–¹ä¾¿å†…è”ï¼ˆä¾‹å¦‚ï¼š`ts.SyntaxKind.EndOfFileToken` ä¼šå˜ä¸º `1`ï¼‰ï¼Œè¿™æ ·åœ¨ä½¿ç”¨ AST æ—¶å°±ä¸ä¼šæœ‰å¤„ç†å¼•ç”¨çš„é¢å¤–å¼€é”€ã€‚ä½†ç¼–è¯‘æ—¶éœ€è¦ä½¿ç”¨ --preserveConstEnums ç¼–è¯‘æ ‡å¿—ï¼Œä»¥ä¾¿æšä¸¾**åœ¨è¿è¡Œæ—¶ä»å¯ç”¨**ã€‚JavaScript ä¸­ä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨ `ts.SyntaxKind.EndOfFileToken`ã€‚å¦å¤–ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å‡½æ•°ï¼Œå°†æšä¸¾æˆå‘˜è½¬åŒ–ä¸ºå¯è¯»çš„å­—ç¬¦ä¸²ï¼š
```ts
export function syntaxKindToName(kind: ts.SyntaxKind) {
  return (<any>ts).SyntaxKind[kind];
}
```

#### AST æ‚é¡¹

æ‚é¡¹ï¼ˆTriviaï¼‰æ˜¯æŒ‡æºæ–‡æœ¬ä¸­å¯¹æ­£å¸¸ç†è§£ä»£ç ä¸å¤ªé‡è¦çš„éƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼šç©ºç™½ï¼Œæ³¨é‡Šï¼Œå†²çªæ ‡è®°ã€‚ï¼ˆä¸ºäº†ä¿æŒè½»é‡ï¼‰æ‚é¡¹**ä¸ä¼šå­˜å‚¨**åœ¨ AST ä¸­ã€‚ä½†æ˜¯å¯ä»¥è§†éœ€è¦ä½¿ç”¨ä¸€äº› `ts.*` API æ¥è·å–ã€‚

å±•ç¤ºè¿™äº› API å‰ï¼Œä½ éœ€è¦ç†è§£ä»¥ä¸‹å†…å®¹ï¼š

##### æ‚é¡¹æ‰€æœ‰æƒ

é€šå¸¸ï¼š
- token æ‹¥æœ‰å®ƒåé¢ åŒä¸€è¡Œ åˆ°ä¸‹ä¸€ä¸ª token ä¹‹å‰çš„æ‰€æœ‰æ‚é¡¹
- è¯¥è¡Œä¹‹åçš„æ³¨é‡Šéƒ½ä¸ä¸‹ä¸ªçš„ token ç›¸å…³

å¯¹äºæ–‡ä»¶ä¸­çš„å‰å¯¼ï¼ˆleadingï¼‰å’Œç»“æŸï¼ˆendingï¼‰æ³¨é‡Šï¼š
- æºæ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ª token æ‹¥æœ‰æ‰€æœ‰å¼€å§‹çš„æ‚é¡¹
- è€Œæ–‡ä»¶æœ€åçš„ä¸€äº›åˆ—æ‚é¡¹åˆ™é™„åŠ åˆ°æ–‡ä»¶ç»“æŸç¬¦ä¸Šï¼Œè¯¥ token é•¿åº¦ä¸º 0

##### æ‚é¡¹ API

æ³¨é‡Šåœ¨å¤šæ•°åŸºæœ¬ä½¿ç”¨ä¸­ï¼Œéƒ½æ˜¯è®©äººå…³æ³¨çš„æ‚é¡¹ã€‚èŠ‚ç‚¹çš„æ³¨é‡Šå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡½æ•°è·å–ï¼š
| å‡½æ•° | æè¿° |
| :-: | :-: |
| `ts.getLeadingCommentRanges` | ç»™å®šæºæ–‡æœ¬åŠå…¶ä½ç½®ï¼Œè¿”å›ç»™å®šä½ç½®åç¬¬ä¸€ä¸ªæ¢è¡Œç¬¦åˆ° token æœ¬èº«ä¹‹é—´çš„æ³¨é‡ŠèŒƒå›´ï¼ˆå¯èƒ½éœ€è¦ç»“åˆ `ts.Node.getFullStart` ä½¿ç”¨ï¼‰ã€‚ |
| `ts.getTrailingCommentRanges` | ç»™å®šæºæ–‡æœ¬åŠå…¶ä½ç½®ï¼Œè¿”å›ç»™å®šä½ç½®åç¬¬ä¸€ä¸ªæ¢è¡Œç¬¦ä¹‹å‰çš„æ³¨é‡ŠèŒƒå›´ï¼ˆå¯èƒ½éœ€è¦ç»“åˆ `ts.Node.getEnd` ä½¿ç”¨ï¼‰ã€‚ |

å‡è®¾ä¸‹é¢æ˜¯æŸä¸ªæºæ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼š
```ts
debugger;/*hello*/
    //bye
  /*hi*/    function
```

å¯¹ `function` `è€Œè¨€ï¼ŒgetLeadingCommentRanges` ä»…è¿”å›æœ€åçš„ä¸¤ä¸ªæ³¨é‡Š `//bye` å’Œ `/*hi*/`ã€‚ å¦å¤–ï¼Œè€Œåœ¨ `debugger` è¯­å¥ç»“æŸä½ç½®è°ƒç”¨ `getTrailingCommentRanges` ä¼šå¾—åˆ°æ³¨é‡Š `/*hello*/`ã€‚

##### Token Start å’Œ Full Start ä½ç½®

èŠ‚ç‚¹æœ‰æ‰€è°“çš„ "token start" å’Œ "full start" ä½ç½®ã€‚
- Token Startï¼šæ¯”è¾ƒè‡ªç„¶çš„ç‰ˆæœ¬ï¼Œå³æ–‡ä»¶ä¸­ä¸€ä¸ª token çš„æ–‡æœ¬å¼€å§‹çš„ä½ç½®ã€‚
- Full Startï¼šæ˜¯æŒ‡æ‰«æå™¨ä»ä¸Šä¸€ä¸ªé‡è¦ token å¼€å§‹æ‰«æçš„ä½ç½®ã€‚

AST èŠ‚ç‚¹æœ‰ `getStart` å’Œ `getFullStart` API ç”¨äºè·å–ä»¥ä¸Šä¸¤ç§ä½ç½®ï¼Œè¿˜æ˜¯è¿™ä¸ªä¾‹å­ï¼š
```ts
debugger;/*hello*/
    //bye
  /*hi*/    function
```

å¯¹ `function` è€Œè¨€ï¼Œtoken start å³ `function` çš„ä½ç½®ï¼Œè€Œ **full** start æ˜¯ `/*hello*/` çš„ä½ç½®ã€‚è¦æ³¨æ„ï¼Œfull start ç”šè‡³ä¼šåŒ…å«å‰ä¸€èŠ‚ç‚¹æ‹¥æœ‰çš„æ‚é¡¹ã€‚

### æ‰«æå™¨

TypeScript æ‰«æå™¨çš„æºç å‡ä½äº `scanner.ts`ã€‚åœ¨å†…éƒ¨ï¼Œç”±è§£æå™¨æ§åˆ¶æ‰«æå™¨å°†æºç è½¬åŒ–ä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚æœŸæœ›ç»“æœå¦‚ä¸‹ï¼š
```shell
SourceCode ~~ æ‰«æå™¨ ~~> Token æµ ~~ è§£æå™¨ ~~> AST
```

#### è§£æå™¨å¯¹æ‰«æå™¨çš„ä½¿ç”¨

ä¸ºé¿å…é‡å¤åˆ›å»ºæ‰«æå™¨é€ æˆçš„å¼€é”€ï¼Œ`parser.ts` ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ‰«æå™¨çš„**å•ä¾‹**ã€‚è§£æå™¨æ ¹æ®éœ€è¦ä½¿ç”¨ `initializeState` å‡½æ•°å‡†å¤‡è¯¥æ‰«æå™¨ã€‚

ä¸‹é¢æ˜¯è§£æå™¨ä¸­çš„å®é™…ä»£ç çš„ç®€åŒ–ç‰ˆï¼Œä½ å¯ä»¥è¿è¡Œå®ƒæ¼”ç¤ºä»¥ä¸Šæ¦‚å¿µ

`code/compiler/scanner/runScanner.ts`
```ts
import * as ts from 'ntypescript';

// å•ä¾‹æ‰«æå™¨
const scanner = ts.createScanner(ts.ScriptTarget.Latest, /* å¿½ç•¥æ‚é¡¹ */ true);

// æ­¤å‡½æ•°ä¸åˆå§‹åŒ–ä½¿ç”¨çš„ `initializeState` å‡½æ•°ç›¸ä¼¼
function initializeState(text: string) {
  scanner.setText(text);
  scanner.setOnError((message: ts.DiagnosticMessage, length: number) => {
    console.error(message);
  });
  scanner.setScriptTarget(ts.ScriptTarget.ES5);
  scanner.setLanguageVariant(ts.LanguageVariant.Standard);
}

// ä½¿ç”¨ç¤ºä¾‹
initializeState(
  `
var foo = 123;
`.trim()
);

// å¼€å§‹æ‰«æ
var token = scanner.scan();
while (token != ts.SyntaxKind.EndOfFileToken) {
  console.log(ts.formatSyntaxKind(token));
  token = scanner.scan();
}
```

è¯¥æ®µä»£ç è¾“å‡ºä»¥ä¸‹å†…å®¹ï¼š
```shell
VarKeyword
Identifier
FirstAssignment
FirstLiteralToken
SemicolonToken
```

#### æ‰«æå™¨çŠ¶æ€

è°ƒç”¨ `scan` åï¼Œæ‰«æå™¨æ›´æ–°å…¶å±€éƒ¨çŠ¶æ€ï¼ˆæ‰«æä½ç½®ï¼Œå½“å‰ token è¯¦æƒ…ç­‰ï¼‰ã€‚æ‰«æå™¨æä¾›äº†ä¸€ç»„å·¥å…·å‡½æ•°è·å–å½“å‰æ‰«æå™¨çŠ¶æ€ã€‚ä¸‹ä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ‰«æå™¨å¹¶ç”¨å®ƒè¯†åˆ« token ä»¥åŠ token åœ¨ä»£ç ä¸­çš„ä½ç½®ã€‚

`code/compiler/scanner/runScannerWithPosition.ts`
```ts
// ä½¿ç”¨ç¤ºä¾‹
initializeState(
  `
var foo = 123;
`.trim()
);

// å¼€å§‹æ‰«æ
var token = scanner.scan();
while (token != ts.SyntaxKind.EndOfFileToken) {
  let currentToken = ts.formatSyntaxKind(token);
  let tokenStart = scanner.getStartPos();
  token = scanner.scan();
  let tokenEnd = scanner.getStartPos();
  console.log(currentToken, tokenStart, tokenEnd);
}
```

è¯¥ä»£ç è¾“å‡ºä»¥ä¸‹å†…å®¹ï¼š
```shell
VarKeyword 0 3
Identifier 3 7
FirstAssignment 7 9
FirstLiteralToken 9 13
SemicolonToken 13 14
```

#### ç‹¬ç«‹æ‰«æå™¨

å³ä¾¿ TypeScript è§£æå™¨æœ‰å•ä¾‹æ‰«æå™¨ï¼Œä½ ä»å¯ä»¥ä½¿ç”¨ `createScanner` åˆ›å»ºç‹¬ç«‹çš„æ‰«æå™¨ï¼Œç„¶åå¯ä»¥ç”¨ `setText/setTextPos` éšæ„æ‰«ææ–‡ä»¶çš„ä¸åŒä½ç½®ã€‚

### è§£æå™¨

TypeScript è§£æå™¨ä»£ç å‡ä½äº parser.ts ä¸­ã€‚åœ¨å†…éƒ¨ï¼Œç”±è§£æå™¨æ§åˆ¶æ‰«æå™¨å°†æºç è½¬åŒ–ä¸º ASTã€‚å…¶æœŸæœ›ç»“æœå¦‚ä¸‹ï¼š
```shell
æºç  ~~ æ‰«æå™¨ ~~> Token æµ ~~ è§£æå™¨ ~~> AST
```

è§£æå™¨å®ç°åŸç†æ˜¯å•ä¾‹æ¨¡å¼ï¼ˆå…¶åŸå› ç±»ä¼¼æ‰«æå™¨ï¼Œå¦‚æœèƒ½é‡æ–°åˆå§‹åŒ–å°±ä¸é‡æ–°æ„å»ºï¼‰ã€‚å®é™…å®ç°æˆ `namespace Parser`ï¼ŒåŒ…å«è§£æå™¨çš„å„ç§çŠ¶æ€å˜é‡å’Œå•ä¾‹æ‰«æå™¨ï¼ˆ`const scanner`ï¼‰ã€‚è¯¥æ‰«æå™¨ç”±è§£æå™¨å‡½æ•°ç®¡ç†ã€‚

#### ç¨‹åºå¯¹è§£æå™¨çš„ä½¿ç”¨

è§£æå™¨ç”±ç¨‹åºé—´æ¥é©±åŠ¨ï¼ˆé€šè¿‡ä¹‹å‰æåˆ°è¿‡çš„ `CompilerHost`ï¼‰ã€‚åŸºæœ¬ä¸Šï¼Œç®€åŒ–çš„è°ƒç”¨æ ˆå¦‚ä¸‹æ‰€ç¤ºï¼š
```shell
ç¨‹åº ->
  CompilerHost.getSourceFile ->
    (å…¨å±€å‡½æ•° parser.ts).createSourceFile ->
      Parser.parseSourceFile
```

`parseSourceFile` ä¸ä»…å‡†å¤‡å¥½è§£æå™¨çš„çŠ¶æ€ï¼Œè¿˜è°ƒç”¨ `initializeState` å‡†å¤‡å¥½æ‰«æå™¨çš„çŠ¶æ€ã€‚ç„¶åä½¿ç”¨ `parseSourceFileWorker` ç»§ç»­è§£ææºä»£ç ã€‚

#### ä½¿ç”¨ç¤ºä¾‹

æ·±å…¥è§£æå™¨çš„å†…éƒ¨ä¹‹å‰ï¼Œè¿™é‡Œæœ‰ä¸ªä½¿ç”¨ TypeScript è§£æå™¨çš„ç¤ºä¾‹ï¼Œï¼ˆä½¿ç”¨ `ts.createSourceFile`ï¼‰è·å–ä¸€ä¸ªæºæ–‡ä»¶çš„ AST å¹¶æ‰“å°å®ƒã€‚

`code/compiler/parser/runParser.ts`
```ts
import * as ts from 'ntypescript';

function printAllChildren(node: ts.Node, depth = 0) {
  console.log(new Array(depth + 1).join('----'), ts.formatSyntaxKind(node.kind), node.pos, node.end);
  depth++;
  node.getChildren().forEach(c => printAllChildren(c, depth));
}

var sourceCode = `
var foo = 123;
`.trim();

var sourceFile = ts.createSourceFile('foo.ts', sourceCode, ts.ScriptTarget.ES5, true);
printAllChildren(sourceFile);
```

è¯¥æ®µä»£ç ä¼šæ‰“å°ä»¥ä¸‹å†…å®¹ï¼š
```ts
SourceFile 0 14
---- SyntaxList 0 14
-------- VariableStatement 0 14
------------ VariableDeclarationList 0 13
---------------- VarKeyword 0 3
---------------- SyntaxList 3 13
-------------------- VariableDeclaration 3 13
------------------------ Identifier 3 7
------------------------ FirstAssignment 7 9
------------------------ FirstLiteralToken 9 13
------------ SemicolonToken 13 14
---- EndOfFileToken 14 14
```

å¦‚æœæŠŠå¤´å‘å·¦å€¾ï¼Œè¿™ä¸ªçœ‹èµ·æ¥åƒæ£µï¼ˆå³ä¾§ï¼‰æ ‘

#### è§£æå™¨å‡½æ•°

å¦‚å‰æ‰€è¿°ï¼Œ`parseSourceFile` è®¾ç½®åˆå§‹çŠ¶æ€å¹¶å°†å·¥ä½œäº¤ç»™ `parseSourceFileWorker` å‡½æ•°ã€‚

##### `parseSourceFileWorker`

è¯¥å‡½æ•°å…ˆåˆ›å»ºä¸€ä¸ª `SourceFile` AST èŠ‚ç‚¹ï¼Œç„¶åä» `parseStatements` å‡½æ•°å¼€å§‹è§£ææºä»£ç ã€‚ä¸€æ—¦è¿”å›ç»“æœï¼Œå°±ç”¨é¢å¤–ä¿¡æ¯ï¼ˆä¾‹å¦‚ `nodeCount`, `identifierCount`ç­‰ï¼‰ å®Œå–„ `SourceFile` èŠ‚ç‚¹ã€‚

##### `parseStatements`

æ˜¯æœ€é‡è¦çš„ `parseXXX` ç³»å‡½æ•°ä¹‹ä¸€ï¼ˆæ¦‚å¿µæ¥ä¸‹æ¥ä»‹ç»ï¼‰ã€‚å®ƒæ ¹æ®æ‰«æå™¨è¿”å›çš„å½“å‰ token æ¥åˆ‡æ¢ï¼ˆè°ƒç”¨ç›¸åº”çš„ `parseXXX` å‡½æ•°ï¼‰ï¼Œä¾‹å¦‚ï¼šå¦‚æœå½“å‰ token æ˜¯ä¸€ä¸ª `SemicolonToken`ï¼ˆåˆ†å·æ ‡è®°ï¼‰ï¼Œå°±ä¼šè°ƒç”¨ `paserEmptyStatement` ä¸ºç©ºè¯­å¥åˆ›å»ºä¸€ä¸ª AST èŠ‚ç‚¹

##### èŠ‚ç‚¹åˆ›å»º

è§£æå™¨æœ‰ä¸€ç³»åˆ— `parseXXX` å‡½æ•°ç”¨æ¥åˆ›å»ºç›¸åº”ç±»å‹ä¸ºXXXçš„èŠ‚ç‚¹ï¼Œé€šå¸¸åœ¨ç›¸åº”ç±»å‹çš„èŠ‚ç‚¹å‡ºç°æ—¶è¢«ï¼ˆå…¶ä»–è§£æå™¨å‡½æ•°ï¼‰è°ƒç”¨ã€‚è¯¥è¿‡ç¨‹çš„å…¸å‹ç¤ºä¾‹æ˜¯è§£æç©ºè¯­å¥ï¼ˆä¾‹å¦‚ `;;;;;;`ï¼‰æ—¶è¦ç”¨çš„ `parseEmptyStatement()` å‡½æ•°ã€‚ä¸‹é¢æ˜¯å…¶å…¨éƒ¨ä»£ç ï¼š
```ts
function parseEmptyStatement(): Statement {
  let node = <Statement>createNode(SyntaxKind.EmptyStatement);
  parseExpected(SyntaxKind.SemicolonToken);
  return finishNode(node);
}
```

å®ƒå±•ç¤ºäº† 3 ä¸ªå…³é”®å‡½æ•° `createNode`, `parseExpected` å’Œ `finishNode`.

###### `createNode`

è§£æå™¨å‡½æ•° `function createNode(kind: SyntaxKind, pos?: number): Node` è´Ÿè´£åˆ›å»ºèŠ‚ç‚¹ï¼Œè®¾ç½®ä¼ å…¥çš„ `SyntaxKind`ï¼ˆè¯­æ³•ç±»åˆ«ï¼‰ï¼Œå’Œåˆå§‹ä½ç½®ï¼ˆé»˜è®¤ä½¿ç”¨å½“å‰æ‰«æå™¨çŠ¶æ€æä¾›çš„ä½ç½®ä¿¡æ¯ï¼‰ã€‚

###### `parseExpected`

è§£æå™¨çš„ `parseExpected` å‡½æ•° `function parseExpected(kind: SyntaxKind, diagnosticMessage?: DiagnosticMessage): boolean` ä¼šæ£€æŸ¥è§£æå™¨çŠ¶æ€ä¸­çš„å½“å‰ token æ˜¯å¦ä¸æŒ‡å®šçš„ `SyntaxKind` åŒ¹é…ã€‚å¦‚æœä¸åŒ¹é…ï¼Œåˆ™ä¼šå‘ä¼ å…¥çš„ `diagnosticMessage`ï¼ˆè¯Šæ–­æ¶ˆæ¯ï¼‰æŠ¥å‘Šï¼Œæœªä¼ å…¥åˆ™åˆ›å»ºæŸç§é€šç”¨å½¢å¼ `xxx expected`ã€‚è¯¥å‡½æ•°å†…éƒ¨ç”¨ `parseErrorAtPosition` å‡½æ•°ï¼ˆä½¿ç”¨æ‰«æä½ç½®ï¼‰æä¾›è‰¯å¥½çš„é”™è¯¯æŠ¥å‘Šã€‚

###### `finishNode`

è§£æå™¨çš„ `finishNode` å‡½æ•° `function finishNode<T extends Node>(node: T, end?: number): T` è®¾ç½®èŠ‚ç‚¹çš„ `end` ä½ç½®ï¼Œå¹¶æ·»åŠ ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ä¸Šä¸‹æ–‡æ ‡å¿—ï¼ˆ`parserContextFlags`ï¼‰ä»¥åŠè§£æè¯¥èŠ‚ç‚¹å‰å‡ºç°çš„é”™è¯¯ï¼ˆå¦‚æœæœ‰é”™çš„è¯ï¼Œå°±ä¸èƒ½åœ¨å¢é‡è§£æä¸­é‡ç”¨æ­¤ AST èŠ‚ç‚¹ï¼‰ã€‚

### ç»‘å®šå™¨

å¤§å¤šæ•°çš„ JavaScript è½¬è¯‘å™¨ï¼ˆtranspilerï¼‰éƒ½æ¯” TypeScript ç®€å•ï¼Œå› ä¸ºå®ƒä»¬å‡ ä¹æ²¡æä¾›ä»£ç åˆ†æçš„æ–¹æ³•ã€‚å…¸å‹çš„ JavaScript è½¬æ¢å™¨åªæœ‰ä»¥ä¸‹æµç¨‹ï¼š
```shell
æºç  ~~æ‰«æå™¨~~> Tokens ~~è§£æå™¨~~> AST ~~å‘å°„å™¨~~> JavaScript
```

ä¸Šè¿°æ¶æ„ç¡®å®å¯¹äºç®€åŒ– TypeScript ç”Ÿæˆ JavaScript çš„ç†è§£æœ‰å¸®åŠ©ï¼Œä½†ç¼ºå¤±äº†ä¸€ä¸ªå…³é”®åŠŸèƒ½ï¼Œå³ TypeScript çš„è¯­ä¹‰ç³»ç»Ÿã€‚ä¸ºäº†ååŠ©ï¼ˆæ£€æŸ¥å™¨æ‰§è¡Œï¼‰ç±»å‹æ£€æŸ¥ï¼Œç»‘å®šå™¨å°†æºç çš„å„éƒ¨åˆ†è¿æ¥æˆä¸€ä¸ªç›¸å…³çš„ç±»å‹ç³»ç»Ÿï¼Œä¾›æ£€æŸ¥å™¨ä½¿ç”¨ã€‚ç»‘å®šå™¨çš„ä¸»è¦èŒè´£æ˜¯åˆ›å»ºç¬¦å·ï¼ˆSymbolsï¼‰ã€‚

#### ç¬¦å·

ç¬¦å·å°† AST ä¸­çš„å£°æ˜èŠ‚ç‚¹ä¸å…¶å®ƒå£°æ˜è¿æ¥åˆ°ç›¸åŒçš„å®ä½“ä¸Šã€‚ç¬¦å·æ˜¯è¯­ä¹‰ç³»ç»Ÿçš„åŸºæœ¬æ„é€ å—ã€‚ç¬¦å·çš„æ„é€ å™¨å®šä¹‰åœ¨ `core.ts`ï¼ˆç»‘å®šå™¨å®é™…ä¸Šé€šè¿‡ `objectAllocator.getSymbolConstructor` æ¥è·å–æ„é€ å™¨ï¼‰ã€‚ä¸‹é¢æ˜¯ç¬¦å·æ„é€ å™¨ï¼š
```ts
function Symbol(flags: SymbolFlags, name: string) {
  this.flags = flags;
  this.name = name;
  this.declarations = undefined;
}
```

`SymbolFlags` ç¬¦å·æ ‡å¿—æ˜¯ä¸ªæ ‡å¿—æšä¸¾ï¼Œç”¨äºè¯†åˆ«é¢å¤–çš„ç¬¦å·ç±»åˆ«ï¼ˆä¾‹å¦‚ï¼šå˜é‡ä½œç”¨åŸŸæ ‡å¿— `FunctionScopedVariable` æˆ– `BlockScopedVariable` ç­‰ï¼‰

#### æ£€æŸ¥å™¨å¯¹ç»‘å®šå™¨çš„ä½¿ç”¨

å®é™…ä¸Šï¼Œç»‘å®šå™¨è¢«æ£€æŸ¥å™¨åœ¨å†…éƒ¨è°ƒç”¨ï¼Œè€Œæ£€æŸ¥å™¨åˆè¢«ç¨‹åºè°ƒç”¨ã€‚ç®€åŒ–çš„è°ƒç”¨æ ˆå¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
program.getTypeChecker ->
  ts.createTypeCheckerï¼ˆæ£€æŸ¥å™¨ä¸­ï¼‰->
    initializeTypeCheckerï¼ˆæ£€æŸ¥å™¨ä¸­ï¼‰ ->
      for each SourceFile `ts.bindSourceFile`ï¼ˆç»‘å®šå™¨ä¸­ï¼‰
      // followed by
      for each SourceFile `ts.mergeSymbolTable`ï¼ˆæ£€æŸ¥å™¨ä¸­ï¼‰
```

SourceFile æ˜¯ç»‘å®šå™¨çš„å·¥ä½œå•å…ƒï¼Œ`binder.ts` ç”± `checker.ts` é©±åŠ¨ã€‚

#### ç»‘å®šå™¨å‡½æ•°

`bindSourceFile` å’Œ `mergeSymbolTable` æ˜¯ä¸¤ä¸ªå…³é”®çš„ç»‘å®šå™¨å‡½æ•°ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ï¼š

##### `bindSourceFile`

è¯¥å‡½æ•°ä¸»è¦æ˜¯æ£€æŸ¥ `file.locals` æ˜¯å¦å®šä¹‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™äº¤ç»™ï¼ˆæœ¬åœ°å‡½æ•°ï¼‰ `bind` æ¥å¤„ç†ã€‚

æ³¨æ„ï¼š`locals` å®šä¹‰åœ¨èŠ‚ç‚¹ä¸Šï¼Œå…¶ç±»å‹ä¸º `SymbolTable`ã€‚`SourceFile` ä¹Ÿæ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆäº‹å®ä¸Šæ˜¯ AST ä¸­çš„æ ¹èŠ‚ç‚¹ï¼‰ã€‚

æç¤ºï¼šTypeScript ç¼–è¯‘å™¨å¤§é‡ä½¿ç”¨æœ¬åœ°å‡½æ•°ã€‚æœ¬åœ°å‡½æ•°å¾ˆå¯èƒ½ä½¿ç”¨æ¥è‡ªçˆ¶å‡½æ•°çš„å˜é‡ï¼ˆé€šè¿‡é—­åŒ…æ•è·ï¼‰ã€‚ä¾‹å¦‚ `bind` æ˜¯ `bindSourceFile` ä¸­çš„ä¸€ä¸ªæœ¬åœ°å‡½æ•°ï¼Œå®ƒæˆ–å®ƒè°ƒç”¨çš„å‡½æ•°ä¼šè®¾ç½® `symbolCount` å’Œ `classifiableNames` ç­‰çŠ¶æ€ï¼Œç„¶åå°†å…¶å­˜åœ¨è¿”å›çš„ `SourceFile` ä¸­

##### `bind`

bind èƒ½å¤„ç†ä»»ä¸€èŠ‚ç‚¹ï¼ˆä¸åªæ˜¯ `SourceFile`ï¼‰ï¼Œå®ƒåšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯åˆ†é… `node.parent`ï¼ˆå¦‚æœ `parent` å˜é‡å·²è®¾ç½®ï¼Œç»‘å®šå™¨åœ¨ `bindChildren` å‡½æ•°çš„å¤„ç†ä¸­ä»ä¼šå†æ¬¡è®¾ç½®ï¼‰ï¼Œ ç„¶åäº¤ç»™ `bindWorker` åšå¾ˆå¤šé‡æ´»ã€‚æœ€åè°ƒç”¨ `bindChildren`ï¼ˆè¯¥å‡½æ•°ç®€å•åœ°å°†ç»‘å®šå™¨çš„çŠ¶æ€ï¼ˆå¦‚ï¼š`parent`ï¼‰å­˜å…¥å‡½æ•°æœ¬åœ°å˜é‡ä¸­ï¼Œæ¥ç€åœ¨æ¯ä¸ªå­èŠ‚ç‚¹ä¸Šè°ƒç”¨ `bind`ï¼Œç„¶åå†å°†çŠ¶æ€è½¬å­˜å›ç»‘å®šå™¨ä¸­ï¼‰ã€‚ç°åœ¨æˆ‘ä»¬çœ‹ä¸‹ `bindWorker`ï¼Œä¸€ä¸ªæ›´æœ‰è¶£çš„å‡½æ•°ã€‚

##### bindWorker

è¯¥å‡½æ•°ä¾æ® `node.kind`ï¼ˆ`SyntaxKind`ç±»å‹ï¼‰è¿›è¡Œåˆ‡æ¢ï¼Œå¹¶å°†å·¥ä½œå§”æ‰˜ç»™åˆé€‚çš„ `bindXXX` å‡½æ•°ï¼ˆä¹Ÿå®šä¹‰åœ¨`binder.ts`ä¸­ï¼‰ã€‚ä¾‹å¦‚ï¼šå¦‚æœè¯¥èŠ‚ç‚¹æ˜¯ `SourceFile` åˆ™ï¼ˆæœ€ç»ˆä¸”ä»…å½“èŠ‚ç‚¹æ˜¯å¤–éƒ¨æ–‡ä»¶æ¨¡å—æ—¶ï¼‰è°ƒç”¨ `bindAnonymousDeclaration`

##### `bindXXX` å‡½æ•°

`bindXXX` ç³»å‡½æ•°æœ‰ä¸€äº›é€šç”¨çš„æ¨¡å¼å’Œå·¥å…·å‡½æ•°ã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„ä¸€ä¸ªæ˜¯ `createSymbol` å‡½æ•°ï¼Œå…¨éƒ¨ä»£ç å±•ç¤ºå¦‚ä¸‹ï¼š
```ts
function createSymbol(flags: SymbolFlags, name: string): Symbol {
  symbolCount++;
  return new Symbol(flags, name);
}
```

å¦‚æ‚¨æ‰€è§ï¼Œå®ƒç®€å•åœ°æ›´æ–° `symbolCount`ï¼ˆä¸€ä¸ª `bindSourceFile` çš„æœ¬åœ°å˜é‡ï¼‰ï¼Œå¹¶ä½¿ç”¨æŒ‡å®šçš„å‚æ•°åˆ›å»ºç¬¦å·ã€‚

#### ç»‘å®šå™¨å£°æ˜

##### ç¬¦å·ä¸å£°æ˜

èŠ‚ç‚¹å’Œç¬¦å·é—´çš„é“¾æ¥ç”±å‡ ä¸ªå‡½æ•°æ‰§è¡Œã€‚å…¶ä¸­ä¸€ä¸ªç”¨äºç»‘å®š `SourceFile` èŠ‚ç‚¹åˆ°æºæ–‡ä»¶ç¬¦å·ï¼ˆå¤–éƒ¨æ¨¡å—çš„æƒ…å†µä¸‹ï¼‰çš„å‡½æ•°æ˜¯ `addDeclarationToSymbol`

æ³¨æ„ï¼šå¤–éƒ¨æ¨¡å—æºæ–‡ä»¶çš„ç¬¦å·è®¾ç½®æ–¹å¼æ˜¯ `flags : SymbolFlags.ValueModule` å’Œ `name: '"' + removeFileExtension(file.fileName) + '"'`.
```ts
function addDeclarationToSymbol(symbol: Symbol, node: Declaration, symbolFlags: SymbolFlags) {
  symbol.flags |= symbolFlags;

  // åˆ›å»º AST èŠ‚ç‚¹åˆ° symbol çš„è¿æ¥
  node.symbol = symbol;

  if (!symbol.declarations) {
    symbol.declarations = [];
  }
  // å°†è¯¥èŠ‚ç‚¹æ·»åŠ ä¸ºè¯¥ç¬¦å·çš„ä¸€ä¸ªå£°æ˜
  symbol.declarations.push(node);

  if (symbolFlags & SymbolFlags.HasExports && !symbol.exports) {
    symbol.exports = {};
  }

  if (symbolFlags & SymbolFlags.HasMembers && !symbol.members) {
    symbol.members = {};
  }

  if (symbolFlags & SymbolFlags.Value && !symbol.valueDeclaration) {
    symbol.valueDeclaration = node;
  }
}
```

ä¸Šè¿°ä»£ç ä¸»è¦æ‰§è¡Œçš„æ“ä½œå¦‚ä¸‹ï¼š
- åˆ›å»ºä¸€ä¸ªä» AST èŠ‚ç‚¹åˆ°ç¬¦å·çš„é“¾æ¥ï¼ˆ`node.symbol`ï¼‰
- å°†èŠ‚ç‚¹æ·»åŠ ä¸ºè¯¥ç¬¦å·çš„ä¸€ä¸ªå£°æ˜

##### å£°æ˜

å£°æ˜å°±æ˜¯ä¸€ä¸ªæœ‰å¯é€‰çš„åå­—çš„èŠ‚ç‚¹ã€‚ä¸‹é¢æ˜¯ `types.ts` ä¸­çš„å®šä¹‰ï¼š
```ts
interface Declaration extends Node {
  _declarationBrand: any;
  name?: DeclarationName;
}
```

#### ç»‘å®šå™¨å®¹å™¨

AST çš„èŠ‚ç‚¹å¯ä»¥è¢«å½“ä½œå®¹å™¨ã€‚è¿™å†³å®šäº†èŠ‚ç‚¹åŠç›¸å…³ç¬¦å·çš„ `SymbolTables` çš„ç±»åˆ«ã€‚å®¹å™¨æ˜¯ä¸ªæŠ½è±¡æ¦‚å¿µï¼ˆæ²¡æœ‰ç›¸å…³çš„æ•°æ®ç»“æ„ï¼‰ã€‚è¯¥æ¦‚å¿µç”±ä¸€äº›ä¸œè¥¿å†³å®šï¼Œ`ContainerFlags` æšä¸¾æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚å‡½æ•° `getContainerFlags`ï¼ˆä½äº `binder.ts`ï¼‰ é©±åŠ¨æ­¤æ ‡å¿—ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
function getContainerFlags(node: Node): ContainerFlags {
  switch (node.kind) {
    case SyntaxKind.ClassExpression:
    case SyntaxKind.ClassDeclaration:
    case SyntaxKind.InterfaceDeclaration:
    case SyntaxKind.EnumDeclaration:
    case SyntaxKind.TypeLiteral:
    case SyntaxKind.ObjectLiteralExpression:
      return ContainerFlags.IsContainer;

    case SyntaxKind.CallSignature:
    case SyntaxKind.ConstructSignature:
    case SyntaxKind.IndexSignature:
    case SyntaxKind.MethodDeclaration:
    case SyntaxKind.MethodSignature:
    case SyntaxKind.FunctionDeclaration:
    case SyntaxKind.Constructor:
    case SyntaxKind.GetAccessor:
    case SyntaxKind.SetAccessor:
    case SyntaxKind.FunctionType:
    case SyntaxKind.ConstructorType:
    case SyntaxKind.FunctionExpression:
    case SyntaxKind.ArrowFunction:
    case SyntaxKind.ModuleDeclaration:
    case SyntaxKind.SourceFile:
    case SyntaxKind.TypeAliasDeclaration:
      return ContainerFlags.IsContainerWithLocals;

    case SyntaxKind.CatchClause:
    case SyntaxKind.ForStatement:
    case SyntaxKind.ForInStatement:
    case SyntaxKind.ForOfStatement:
    case SyntaxKind.CaseBlock:
      return ContainerFlags.IsBlockScopedContainer;

    case SyntaxKind.Block:
      // ä¸è¦å°†å‡½æ•°å†…éƒ¨çš„å—ç›´æ¥å½“åšå—ä½œç”¨åŸŸçš„å®¹å™¨ã€‚
      // æœ¬å—ä¸­çš„æœ¬åœ°å˜é‡åº”å½“ç½®äºå‡½æ•°ä¸­ï¼Œå¦åˆ™ä¸‹ä¾‹ä¸­çš„ 'x' ä¸ä¼šé‡æ–°å£°æ˜ä¸ºä¸€ä¸ªå—ä½œç”¨åŸŸçš„æœ¬åœ°å˜é‡ï¼š
      //
      //     function foo() {
      //         var x;
      //         let x;
      //     }
      //
      // å¦‚æœå°† 'var x' ç•™åœ¨å‡½æ•°ä¸­ï¼Œè€Œå°† 'let x' æ”¾åˆ°æœ¬å—ä¸­ï¼ˆå‡½æ•°å¤–ï¼‰ï¼Œå°±ä¸ä¼šæœ‰å†²çªäº†ã€‚
      //
      // å¦‚æœä¸åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ªæ–°çš„å—ä½œç”¨åŸŸå®¹å™¨ï¼Œ'var x' å’Œ 'let x' éƒ½ä¼šè¿›å…¥å‡½æ•°å®¹å™¨æœ¬åœ°ä¸­ï¼Œè¿™æ ·å°±ä¼šæœ‰ç¢°æ’å†²çªã€‚
      return isFunctionLike(node.parent) ? ContainerFlags.None : ContainerFlags.IsBlockScopedContainer;
  }

  return ContainerFlags.None;
}
```

è¯¥å‡½æ•°åªåœ¨ç»‘å®šå™¨å‡½æ•° `bindChildren` ä¸­è°ƒç”¨ï¼Œä¼šæ ¹æ® `getContainerFlags` çš„è¿è¡Œç»“æœå°†èŠ‚ç‚¹è®¾ä¸º `container` å’Œï¼ˆæˆ–ï¼‰ `blockScopedContainer`ã€‚å‡½æ•° `bindChildren` å¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
// æ‰€æœ‰å®¹å™¨èŠ‚ç‚¹éƒ½ä»¥å£°æ˜é¡ºåºä¿å­˜åœ¨ä¸€ä¸ªé“¾è¡¨ä¸­ã€‚
// ç±»å‹æ£€æŸ¥å™¨ä¸­çš„ getLocalNameOfContainer å‡½æ•°ä¼šä½¿ç”¨è¯¥é“¾è¡¨å¯¹å®¹å™¨ä½¿ç”¨çš„æœ¬åœ°åç§°çš„å”¯ä¸€æ€§åšéªŒè¯ã€‚
function bindChildren(node: Node) {
  // åœ¨é€’å½’åˆ°å­èŠ‚ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¦ä¿å­˜çˆ¶èŠ‚ç‚¹ï¼Œå®¹å™¨å’Œå—å®¹å™¨ã€‚å¤„ç†å®Œå¼¹å‡ºçš„å­èŠ‚ç‚¹åï¼Œå†å°†è¿™äº›å€¼å­˜å›åŸå¤„ã€‚
  let saveParent = parent;
  let saveContainer = container;
  let savedBlockScopeContainer = blockScopeContainer;

  // ç°åœ¨è¦å°†è¿™ä¸ªèŠ‚ç‚¹è®¾ä¸ºçˆ¶èŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¦é€’å½’å®ƒçš„å­èŠ‚ç‚¹ã€‚
  parent = node;

  // æ ¹æ®èŠ‚ç‚¹çš„ç±»å‹ï¼Œéœ€è¦å¯¹å½“å‰å®¹å™¨æˆ–å—å®¹å™¨è¿›è¡Œè°ƒæ•´ã€‚ å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯ä¸ªå®¹å™¨ï¼Œåˆ™è‡ªåŠ¨å°†å…¶è§†ä¸ºå½“å‰çš„å—å®¹å™¨ã€‚
  // ç”±äºæˆ‘ä»¬çŸ¥é“å®¹å™¨å¯èƒ½åŒ…å«æœ¬åœ°å˜é‡ï¼Œå› æ­¤æå‰åˆå§‹åŒ– .locals å­—æ®µã€‚
  // è¿™æ ·åšæ˜¯å› ä¸ºå¾ˆå¯èƒ½éœ€è¦å°†ä¸€äº›å­ï¼ˆèŠ‚ç‚¹ï¼‰ç½®å…¥ .locals ä¸­ï¼ˆä¾‹å¦‚ï¼šå‡½æ•°å‚æ•°æˆ–å˜é‡å£°æ˜ï¼‰ã€‚
  //
  // ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸ä¼šä¸»åŠ¨ä¸ºå—å®¹å™¨åˆ›å»º .localsï¼Œå› ä¸ºé€šå¸¸å—å®¹å™¨ä¸­ä¸ä¼šæœ‰å—ä½œç”¨åŸŸå˜é‡ã€‚
  // æˆ‘ä»¬ä¸æƒ³ä¸ºé‡åˆ°çš„æ¯ä¸ªå—éƒ½åˆ†é…ä¸€ä¸ªå¯¹è±¡ï¼Œå¤§å¤šæ•°æƒ…å†µæ²¡æœ‰å¿…è¦ã€‚
  //
  // æœ€åï¼Œå¦‚æœæ˜¯ä¸ªå—å®¹å™¨ï¼Œæˆ‘ä»¬å°±æ¸…ç†è¯¥å®¹å™¨ä¸­å¯èƒ½å­˜åœ¨çš„ .locals å¯¹è±¡ã€‚è¿™ç§æƒ…å†µå¸¸åœ¨å¢é‡ç¼–è¯‘åœºæ™¯ä¸­å‘ç”Ÿã€‚
  // ç”±äºæˆ‘ä»¬å¯ä»¥é‡ç”¨ä¸Šæ¬¡ç¼–è¯‘çš„èŠ‚ç‚¹ï¼Œè€Œè¯¥èŠ‚ç‚¹å¯èƒ½å·²ç»åˆ›å»ºäº† locals å¯¹è±¡ã€‚
  // å› æ­¤å¿…é¡»æ¸…ç†ï¼Œä»¥å…æ„å¤–åœ°ä»ä¸Šæ¬¡çš„ç¼–è¯‘ä¸­ç§»åŠ¨äº†è¿‡æ—¶çš„æ•°æ®ã€‚
  let containerFlags = getContainerFlags(node);
  if (containerFlags & ContainerFlags.IsContainer) {
    container = blockScopeContainer = node;

    if (containerFlags & ContainerFlags.HasLocals) {
      container.locals = {};
    }

    addToContainerChain(container);
  } else if (containerFlags & ContainerFlags.IsBlockScopedContainer) {
    blockScopeContainer = node;
    blockScopeContainer.locals = undefined;
  }

  forEachChild(node, bind);

  container = saveContainer;
  parent = saveParent;
  blockScopeContainer = savedBlockScopeContainer;
}
```

æ‚¨å¯èƒ½è¿˜è®°å¾—ç»‘å®šå™¨å‡½æ•°ä¸­çš„è¿™éƒ¨åˆ†ï¼š`bindChildren` ç”± `bind` å‡½æ•°è°ƒç”¨ã€‚æˆ‘ä»¬å¾—åˆ°è¿™æ ·çš„é€’å½’ç»‘å®šï¼š`bind` è°ƒç”¨ `bindChildren`ï¼Œè€Œ bindChildren åˆä¸ºå…¶æ¯ä¸ªå­èŠ‚ç‚¹è°ƒç”¨ `bind`

#### ç»‘å®šå™¨ç¬¦å·è¡¨

ç¬¦å·è¡¨ï¼ˆSymbolTableï¼‰æ˜¯ä»¥ä¸€ä¸ªç®€å•çš„ HashMap å®ç°çš„ï¼Œä¸‹é¢æ˜¯å…¶æ¥å£ï¼ˆ`types.ts`ï¼‰ï¼š
```ts
interface SymbolTable {
  [index: string]: Symbol;
}
```

ç¬¦å·è¡¨é€šè¿‡ç»‘å®šè¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™é‡Œæ˜¯ç¼–è¯‘å™¨ä½¿ç”¨çš„ä¸€äº›ç¬¦å·è¡¨ï¼š

èŠ‚ç‚¹ä¸Šï¼š
```ts
locals?: SymbolTable;                   // èŠ‚ç‚¹ç›¸å…³çš„æœ¬åœ°å˜é‡
```

ç¬¦å·ä¸Šï¼š
```ts
members?: SymbolTable;                  // ç±»ï¼Œæ¥å£æˆ–å­—é¢é‡å®ä¾‹æˆå‘˜
exports?: SymbolTable;                  // æ¨¡å—å¯¼å‡º
```

è¯·æ³¨æ„ï¼š`bindChildren` åŸºäº `ContainerFlags` åˆå§‹åŒ– `locals`ï¼ˆä¸º `{}`ï¼‰

##### ç¬¦å·è¡¨å¡«å……

ç¬¦å·è¡¨ä½¿ç”¨ç¬¦å·æ¥å¡«å……ï¼Œä¸»è¦æ˜¯é€šè¿‡è°ƒç”¨ declareSymbol æ¥è¿›è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºçš„æ˜¯è¯¥å‡½æ•°çš„å…¨éƒ¨ä»£ç ï¼š
```ts
/**
 * ä¸ºæŒ‡å®šçš„èŠ‚ç‚¹å£°æ˜ä¸€ä¸ªç¬¦å·å¹¶åŠ å…¥ symbolsã€‚æ ‡è¯†åå†²çªæ—¶æŠ¥å‘Šé”™è¯¯ã€‚
 * @param symbolTable - è¦å°†èŠ‚ç‚¹åŠ å…¥è¿›çš„ç¬¦å·è¡¨
 * @param parent - æŒ‡å®šèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„å£°æ˜
 * @param node - è¦æ·»åŠ åˆ°ç¬¦å·è¡¨çš„ï¼ˆèŠ‚ç‚¹ï¼‰å£°æ˜
 * @param includes - SymbolFlagsï¼ŒæŒ‡å®šèŠ‚ç‚¹é¢å¤–çš„å£°æ˜ç±»å‹ï¼ˆä¾‹å¦‚ï¼šexport, ambient ç­‰ï¼‰
 * @param excludes - ä¸èƒ½åœ¨ç¬¦å·è¡¨ä¸­å£°æ˜çš„æ ‡å¿—ï¼Œç”¨äºæŠ¥å‘Šç¦æ­¢çš„å£°æ˜
 */
function declareSymbol(
  symbolTable: SymbolTable,
  parent: Symbol,
  node: Declaration,
  includes: SymbolFlags,
  excludes: SymbolFlags
): Symbol {
  Debug.assert(!hasDynamicName(node));

  // é»˜è®¤å¯¼å‡ºçš„å‡½æ•°èŠ‚ç‚¹æˆ–ç±»èŠ‚ç‚¹çš„ç¬¦å·æ€»æ˜¯"default"
  let name = node.flags & NodeFlags.Default && parent ? 'default' : getDeclarationName(node);

  let symbol: Symbol;
  if (name !== undefined) {
    // æ£€æŸ¥ç¬¦å·è¡¨ä¸­æ˜¯å¦å·²æœ‰åŒåçš„ç¬¦å·ã€‚è‹¥æ²¡æœ‰ï¼Œåˆ›å»ºæ­¤åç§°çš„æ–°ç¬¦å·å¹¶åŠ å…¥è¡¨ä¸­ã€‚
    // æ³¨æ„ï¼Œæˆ‘ä»¬å°šæœªç»™æ–°ç¬¦å·æŒ‡å®šä»»ä½•æ ‡å¿—ã€‚è¿™å¯ä»¥ç¡®ä¿ä¸ä¼šå’Œä¼ å…¥çš„ excludes æ ‡å¿—èµ·å†²çªã€‚
    //
    // å¦‚æœå·²å­˜åœ¨çš„ä¸€ä¸ªç¬¦å·ï¼ŒæŸ¥çœ‹æ˜¯å¦ä¸è¦åˆ›å»ºçš„æ–°ç¬¦å·å†²çªã€‚
    // ä¾‹å¦‚ï¼šåŒä¸€ç¬¦å·è¡¨ä¸­ï¼Œ'var' ç¬¦å·å’Œ 'class' ç¬¦å·ä¼šå†²çªã€‚
    // å¦‚æœæœ‰å†²çªï¼ŒæŠ¥å‘Šè¯¥é—®é¢˜ç»™è¯¥ç¬¦å·çš„æ¯ä¸ªå£°æ˜ï¼Œç„¶åä¸ºè¯¥å£°æ˜åˆ›å»ºä¸€ä¸ªæ–°ç¬¦å·
    //
    // å¦‚æœæˆ‘ä»¬åˆ›å»ºçš„æ–°ç¬¦å·æ—¢æ²¡åœ¨ç¬¦å·è¡¨ä¸­é‡åä¹Ÿæ²¡å’Œç°æœ‰ç¬¦å·å†²çªï¼Œå°±å°†è¯¥èŠ‚ç‚¹æ·»åŠ ä¸ºæ–°ç¬¦å·çš„å”¯ä¸€å£°æ˜ã€‚
    //
    // å¦åˆ™ï¼Œå°±è¦ï¼ˆå°†æ–°ç¬¦å·ï¼‰åˆå¹¶è¿›å…¼å®¹çš„ç°æœ‰ç¬¦å·ä¸­ï¼ˆä¾‹å¦‚åŒä¸€å®¹å™¨ä¸­æœ‰å¤šä¸ªåŒåçš„ 'var' æ—¶ï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹è¦æŠŠè¯¥èŠ‚ç‚¹æ·»åŠ åˆ°ç¬¦å·çš„å£°æ˜åˆ—è¡¨ä¸­ã€‚
    symbol = hasProperty(symbolTable, name)
      ? symbolTable[name]
      : (symbolTable[name] = createSymbol(SymbolFlags.None, name));

    if (name && includes & SymbolFlags.Classifiable) {
      classifiableNames[name] = name;
    }

    if (symbol.flags & excludes) {
      if (node.name) {
        node.name.parent = node;
      }

      // æŠ¥å‘Šæ¯ä¸ªé‡å¤å£°æ˜çš„é”™è¯¯ä½ç½®
      // æŠ¥å‘Šä¹‹å‰é‡åˆ°çš„å£°æ˜é”™è¯¯
      let message =
        symbol.flags & SymbolFlags.BlockScopedVariable
          ? Diagnostics.Cannot_redeclare_block_scoped_variable_0
          : Diagnostics.Duplicate_identifier_0;
      forEach(symbol.declarations, declaration => {
        file.bindDiagnostics.push(
          createDiagnosticForNode(declaration.name || declaration, message, getDisplayName(declaration))
        );
      });
      file.bindDiagnostics.push(createDiagnosticForNode(node.name || node, message, getDisplayName(node)));

      symbol = createSymbol(SymbolFlags.None, name);
    }
  } else {
    symbol = createSymbol(SymbolFlags.None, '__missing');
  }

  addDeclarationToSymbol(symbol, node, includes);
  symbol.parent = parent;

  return symbol;
}
```

å¡«å……å“ªä¸ªç¬¦å·è¡¨ï¼Œç”±æ­¤å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å†³å®šã€‚ä¾‹å¦‚ï¼šæ·»åŠ å£°æ˜åˆ°ç±»å‹ä¸º `SyntaxKind.ClassDeclaration` æˆ– `SyntaxKind.ClassExpression` çš„å®¹å™¨æ—¶ï¼Œå°†ä¼šè°ƒç”¨ä¸‹é¢çš„å‡½æ•° `declareClassMember`:
```ts
function declareClassMember(node: Declaration, symbolFlags: SymbolFlags, symbolExcludes: SymbolFlags) {
  return node.flags & NodeFlags.Static
    ? declareSymbol(container.symbol.exports, container.symbol, node, symbolFlags, symbolExcludes)
    : declareSymbol(container.symbol.members, container.symbol, node, symbolFlags, symbolExcludes);
}
```

#### ç»‘å®šå™¨é”™è¯¯æŠ¥å‘Š

ç»‘å®šé”™è¯¯è¢«æ·»åŠ åˆ°æºæ–‡ä»¶çš„ `bindDiagnostics` åˆ—è¡¨ä¸­

ä¸€ä¸ªç»‘å®šæ—¶é”™è¯¯æ£€æµ‹çš„ä¾‹å­æ˜¯åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä½¿ç”¨ `eval` æˆ– `arguments` ä½œä¸ºå˜é‡åã€‚ä¸‹é¢å±•ç¤ºäº†ç›¸å…³çš„å…¨éƒ¨ä»£ç ï¼ˆå¤šä¸ªä½ç½®éƒ½ä¼šè°ƒç”¨`checkStrictModeEvalOrArguments`ï¼Œè°ƒç”¨æ ˆå‘è‡ª `bindWorker`ï¼Œè¯¥å‡½æ•°å¯¹ä¸åŒèŠ‚ç‚¹çš„ `SyntaxKind` è°ƒç”¨ä¸åŒçš„æ£€æŸ¥å‡½æ•°ï¼‰ï¼š
```ts
function checkStrictModeEvalOrArguments(contextNode: Node, name: Node) {
  if (name && name.kind === SyntaxKind.Identifier) {
    let identifier = <Identifier>name;
    if (isEvalOrArgumentsIdentifier(identifier)) {
      // é¦–å…ˆæ£€æŸ¥åå­—æ˜¯å¦åœ¨ç±»å£°æ˜æˆ–è€…ç±»è¡¨è¾¾å¼ä¸­ï¼Œå¦‚æœæ˜¯åˆ™ç»™å‡ºæ˜ç¡®æ¶ˆæ¯ï¼Œå¦åˆ™æŠ¥å‘Šä¸€èˆ¬æ€§é”™è¯¯
      let span = getErrorSpanForNode(file, name);
      file.bindDiagnostics.push(
        createFileDiagnostic(
          file,
          span.start,
          span.length,
          getStrictModeEvalOrArgumentsMessage(contextNode),
          identifier.text
        )
      );
    }
  }
}

function isEvalOrArgumentsIdentifier(node: Node): boolean {
  return (
    node.kind === SyntaxKind.Identifier &&
    ((<Identifier>node).text === 'eval' || (<Identifier>node).text === 'arguments')
  );
}

function getStrictModeEvalOrArgumentsMessage(node: Node) {
  // å‘ç”¨æˆ·æä¾›ç‰¹å®šæ¶ˆæ¯ï¼Œæœ‰åŠ©ä»–ä»¬ç†è§£ä¸ºä½•ä¼šå¤„äºä¸¥æ ¼æ¨¡å¼ã€‚
  if (getContainingClass(node)) {
    return Diagnostics.Invalid_use_of_0_Class_definitions_are_automatically_in_strict_mode;
  }

  if (file.externalModuleIndicator) {
    return Diagnostics.Invalid_use_of_0_Modules_are_automatically_in_strict_mode;
  }

  return Diagnostics.Invalid_use_of_0_in_strict_mode;
}
```

### æ£€æŸ¥å™¨

å¦‚å‰æ‰€è¿°ï¼Œ**æ£€æŸ¥å™¨**ä½¿å¾— TypeScript æ›´ç‹¬ç‰¹ï¼Œæ¯”**å…¶å®ƒ JavaScript è½¬è¯‘å™¨**æ›´å¼ºå¤§ã€‚æ£€æŸ¥å™¨ä½äº `checker.ts` ä¸­ï¼Œå½“å‰æœ‰ 23k è¡Œä»¥ä¸Šçš„ä»£ç ï¼ˆç¼–è¯‘å™¨ä¸­æœ€å¤§çš„éƒ¨åˆ†ï¼‰

#### ç¨‹åºå¯¹æ£€æŸ¥å™¨çš„ä½¿ç”¨

æ£€æŸ¥å™¨æ˜¯ç”±ç¨‹åºåˆå§‹åŒ–ï¼Œä¸‹é¢æ˜¯è°ƒç”¨æ ˆç¤ºæ„ï¼ˆç»‘å®šå™¨ä¸€èŠ‚ä¹Ÿå±•ç¤ºè¿‡ï¼‰ï¼š
```shell
program.getTypeChecker ->
  ts.createTypeCheckerï¼ˆæ£€æŸ¥å™¨ä¸­ï¼‰->
    initializeTypeCheckerï¼ˆæ£€æŸ¥å™¨ä¸­ï¼‰ ->
      for each SourceFile `ts.bindSourceFile`ï¼ˆç»‘å®šå™¨ä¸­ï¼‰
      // æ¥ç€
      for each SourceFile `ts.mergeSymbolTable`ï¼ˆæ£€æŸ¥å™¨ä¸­ï¼‰
```

#### ä¸å‘å°„å™¨çš„è”ç³»

çœŸæ­£çš„ç±»å‹æ£€æŸ¥ä¼šåœ¨è°ƒç”¨ getDiagnostics æ—¶æ‰å‘ç”Ÿã€‚è¯¥å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼ˆæ¯”å¦‚ç”± Program.emit è¯·æ±‚ï¼‰ï¼Œæ£€æŸ¥å™¨è¿”å›ä¸€ä¸ª EmitResolverï¼ˆç”±ç¨‹åºè°ƒç”¨æ£€æŸ¥å™¨çš„ getEmitResolver å‡½æ•°å¾—åˆ°ï¼‰ï¼ŒEmitResolver æ˜¯ createTypeChecker çš„ä¸€ä¸ªæœ¬åœ°å‡½æ•°çš„é›†åˆã€‚ä»‹ç»å‘å°„å™¨æ—¶è¿˜ä¼šå†æ¬¡æåˆ°ã€‚

ä¸‹é¢æ˜¯è¯¥è¿‡ç¨‹ç›´åˆ° checkSourceFile çš„è°ƒç”¨æ ˆï¼ˆcheckSourceFile æ˜¯ createTypeChecker çš„ä¸€ä¸ªæœ¬åœ°å‡½æ•°ï¼‰ï¼š
```shell
program.emit ->
  emitWorker (program local) ->
    createTypeChecker.getEmitResolver ->
      // ç¬¬ä¸€æ¬¡è°ƒç”¨ä¸‹é¢çš„å‡ ä¸ª createTypeChecker çš„æœ¬åœ°å‡½æ•°
      call getDiagnostics ->
          getDiagnosticsWorker ->
              checkSourceFile

      // æ¥ç€
      return resolver
      // é€šè¿‡å¯¹æœ¬åœ°å‡½æ•° createResolver() çš„è°ƒç”¨ï¼Œresolver å·²åœ¨ createTypeChecker ä¸­åˆå§‹åŒ–ã€‚
```

#### å…¨å±€å‘½åç©ºé—´åˆå¹¶

`initializeTypeChecker` ä¸­å­˜åœ¨ä»¥ä¸‹ä»£ç ï¼š
```ts
// åˆå§‹åŒ–å…¨å±€ç¬¦å·è¡¨ï¼ˆSymbolTableï¼‰ã€‚
forEach(host.getSourceFiles(), file => {
  if (!isExternalModule(file)) {
    mergeSymbolTable(globals, file.locals);
  }
});
```

åŸºæœ¬ä¸Šæ˜¯å°†æ‰€æœ‰çš„ `global` ç¬¦å·åˆå¹¶åˆ° `let globals: SymbolTable = {}` ç¬¦å·è¡¨ä¸­ï¼ˆä½äº `createTypeChecker` ä¸­ï¼‰ã€‚ `mergeSymbolTable` ä¸»è¦è°ƒç”¨ `mergeSymbol` å‡½æ•°ã€‚

#### æ£€æŸ¥å™¨é”™è¯¯æŠ¥å‘Š

æ£€æŸ¥å™¨ä½¿ç”¨æœ¬åœ°çš„ `error` å‡½æ•°æŠ¥å‘Šé”™è¯¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```ts
function error(location: Node, message: DiagnosticMessage, arg0?: any, arg1?: any, arg2?: any): void {
  let diagnostic = location
    ? createDiagnosticForNode(location, message, arg0, arg1, arg2)
    : createCompilerDiagnostic(message, arg0, arg1, arg2);
  diagnostics.add(diagnostic);
}
```

### å‘å°„å™¨

TypeScript ç¼–è¯‘å™¨æä¾›äº†ä¸¤ä¸ªå‘å°„å™¨ï¼š
- `emitter.ts`ï¼šå¯èƒ½æ˜¯ä½ æœ€æ„Ÿå…´è¶£çš„å‘å°„å™¨ï¼Œå®ƒæ˜¯ TS -> JavaScript çš„å‘å°„å™¨
- `declarationEmitter.ts`ï¼šè¿™ä¸ªå‘å°„å™¨ç”¨äºä¸º **TypeScript æºæ–‡ä»¶ï¼ˆ`.ts`ï¼‰** åˆ›å»º**å£°æ˜æ–‡ä»¶ï¼ˆ`.d.ts`ï¼‰**

æœ¬èŠ‚æˆ‘ä»¬ä»‹ç» `emitter.ts`

#### Promgram å¯¹å‘å°„å™¨çš„ä½œç”¨

Program æä¾›äº†ä¸€ä¸ª `emit` å‡½æ•°ã€‚è¯¥å‡½æ•°ä¸»è¦å°†åŠŸèƒ½å§”æ‰˜ç»™ `emitter.ts` ä¸­çš„ `emitFiles` å‡½æ•°ã€‚ä¸‹é¢æ˜¯è°ƒç”¨æ ˆï¼š
```shell
Program.emit ->
  `emitWorker` ï¼ˆåœ¨ program.ts ä¸­çš„ createProgramï¼‰ ->
    `emitFiles` ï¼ˆemitter.ts ä¸­çš„å‡½æ•°ï¼‰
```

`emitWorker`ï¼ˆé€šè¿‡ `emitFiles` å‚æ•°ï¼‰ç»™å‘å°„å™¨æä¾›ä¸€ä¸ª `EmitResolver`ã€‚ `EmitResolver` ç”±ç¨‹åºçš„ `TypeChecker` æä¾›ï¼ŒåŸºæœ¬ä¸Šå®ƒæ˜¯ä¸€ä¸ªæ¥è‡ª createChecker çš„æœ¬åœ°å‡½æ•°çš„å­é›†ã€‚

#### å‘å°„å™¨å‡½æ•°

##### `emitFiles`

å®šä¹‰åœ¨ `emitter.ts` ä¸­ï¼Œä¸‹é¢æ˜¯è¯¥å‡½æ•°çš„ç­¾åï¼š
```ts
// targetSourceFile å½“ç”¨æˆ·æƒ³å‘å°„é¡¹ç›®ä¸­çš„æŸä¸ªæ–‡ä»¶æ—¶æŒ‡å®šï¼Œä¿å­˜æ—¶ç¼–è¯‘ï¼ˆcompileOnSaveï¼‰åŠŸèƒ½ä½¿ç”¨æ­¤å‚æ•°
export function emitFiles(resolver: EmitResolver, host: EmitHost, targetSourceFile?: SourceFile): EmitResult {
```

`EmitHost` æ˜¯ `CompilerHost` çš„ç®€åŒ–ç‰ˆï¼ˆè¿è¡Œæ—¶ï¼Œå¾ˆå¤šç”¨ä¾‹å®é™…ä¸Šéƒ½æ˜¯ `CompilerHost`ï¼‰

`emitFiles` ä¸­çš„æœ€æœ‰è¶£çš„è°ƒç”¨æ ˆå¦‚ä¸‹æ‰€ç¤ºï¼š
```shell
emitFiles ->
  emitFile(jsFilePath, targetSourceFile) ->
    emitJavaScript(jsFilePath, targetSourceFile);
```

##### `emitJavaScript`

è¯¥å‡½æ•°æœ‰è‰¯å¥½çš„æ³¨é‡Šï¼Œæˆ‘ä»¬ä¸‹é¢ç»™å‡ºå®ƒï¼š
```ts
function emitJavaScript(jsFilePath: string, root?: SourceFile) {
  let writer = createTextWriter(newLine);
  let write = writer.write;
  let writeTextOfNode = writer.writeTextOfNode;
  let writeLine = writer.writeLine;
  let increaseIndent = writer.increaseIndent;
  let decreaseIndent = writer.decreaseIndent;

  let currentSourceFile: SourceFile;
  // å¯¼å‡ºå™¨å‡½æ•°çš„åç§°ï¼Œå¦‚æœæ–‡ä»¶æ˜¯ä¸ªç³»ç»Ÿå¤–éƒ¨æ¨¡å—çš„è¯
  // System.register([...], function (<exporter>) {...})
  // System æ¨¡å—ä¸­çš„å¯¼å‡ºåƒè¿™æ ·ï¼š
  // export var x; ... x = 1
  // =>
  // var x;... exporter("x", x = 1)
  let exportFunctionForFile: string;

  let generatedNameSet: Map<string> = {};
  let nodeToGeneratedName: string[] = [];
  let computedPropertyNamesToGeneratedNames: string[];

  let extendsEmitted = false;
  let decorateEmitted = false;
  let paramEmitted = false;
  let awaiterEmitted = false;
  let tempFlags = 0;
  let tempVariables: Identifier[];
  let tempParameters: Identifier[];
  let externalImports: (ImportDeclaration | ImportEqualsDeclaration | ExportDeclaration)[];
  let exportSpecifiers: Map<ExportSpecifier[]>;
  let exportEquals: ExportAssignment;
  let hasExportStars: boolean;

  /** å°†å‘å°„è¾“å‡ºå†™å…¥ç£ç›˜ */
  let writeEmittedFiles = writeJavaScriptFile;

  let detachedCommentsInfo: { nodePos: number; detachedCommentEndPos: number }[];

  let writeComment = writeCommentRange;

  /** å‘å°„ä¸€ä¸ªèŠ‚ç‚¹ */
  let emit = emitNodeWithoutSourceMap;

  /** åœ¨å‘å°„èŠ‚ç‚¹å‰è°ƒç”¨ */
  let emitStart = function(node: Node) {};

  /** å‘å°„ç»“ç‚¹å®Œæˆåè°ƒç”¨ */
  let emitEnd = function(node: Node) {};

  /** ä» startPos ä½ç½®å¼€å§‹ï¼Œä¸ºæŒ‡å®šçš„ token å‘å°„æ–‡æœ¬ã€‚é»˜è®¤å†™å…¥çš„æ–‡æœ¬ç”± tokenKind æä¾›ï¼Œ
   * ä½†æ˜¯å¦‚æœæä¾›äº†å¯é€‰çš„ emitFn å›è°ƒï¼Œå°†ä½¿ç”¨è¯¥å›è°ƒæ¥ä»£æ›¿é»˜è®¤æ–¹å¼å‘å°„æ–‡æœ¬ã€‚
   * @param tokenKind è¦æœç´¢å¹¶å‘å°„çš„ token çš„ç±»åˆ«
   * @param startPos æºç ä¸­æœç´¢ token çš„èµ·å§‹ä½ç½®
   * @param emitFn å¦‚æœç»™å‡ºï¼Œä¼šè¢«è°ƒç”¨æ¥è¿›è¡Œæ–‡æœ¬çš„å‘å°„ã€‚
   */
  let emitToken = emitTokenText;

  /** è¯¥å‡½æ•°ç”±äºèŠ‚ç‚¹çš„ç¼˜æ•…ï¼Œåœ¨è¢«å‘å°„çš„ä»£ç ä¸­çš„å‡½æ•°æˆ–ç±»ä¸­ï¼Œä¼šåœ¨å¯ç”¨è¯æ³•ä½œç”¨åŸŸå‰è¢«è°ƒç”¨
   * @param scopeDeclaration å¯åŠ¨è¯æ³•ä½œç”¨åŸŸçš„èŠ‚ç‚¹
   * @param scopeName å¯é€‰çš„ä½œç”¨åŸŸçš„åç§°ï¼Œé»˜è®¤ä»èŠ‚ç‚¹å£°æ˜ä¸­æ¨å¯¼
   */
  let scopeEmitStart = function(scopeDeclaration: Node, scopeName?: string) {};

  /** å‡ºäº†ä½œç”¨åŸŸåè°ƒç”¨ */
  let scopeEmitEnd = function() {};

  /** ä¼šè¢«ç¼–ç çš„ Sourcemap æ•°æ® */
  let sourceMapData: SourceMapData;

  if (compilerOptions.sourceMap || compilerOptions.inlineSourceMap) {
    initializeEmitterWithSourceMaps();
  }

  if (root) {
    // ä¸è¦ç›´æ¥è°ƒç”¨ emitï¼Œé‚£æ ·ä¸ä¼šè®¾ç½® currentSourceFile
    emitSourceFile(root);
  } else {
    forEach(host.getSourceFiles(), sourceFile => {
      if (!isExternalModuleOrDeclarationFile(sourceFile)) {
        emitSourceFile(sourceFile);
      }
    });
  }

  writeLine();
  writeEmittedFiles(writer.getText(), /*writeByteOrderMark*/ compilerOptions.emitBOM);
  return;

  /// ä¸€æ‰¹æœ¬åœ°å‡½æ•°
}
```

å®ƒä¸»è¦è®¾ç½®äº†ä¸€æ‰¹æœ¬åœ°å˜é‡å’Œå‡½æ•°ï¼ˆè¿™äº›å‡½æ•°æ„æˆ `emitter.ts` çš„å¤§éƒ¨åˆ†å†…å®¹ï¼‰ï¼Œæ¥ç€äº¤ç»™æœ¬åœ°å‡½æ•° `emitSourceFile` å‘å°„æ–‡æœ¬ã€‚`emitSourceFile` å‡½æ•°è®¾ç½® `currentSourceFile` ç„¶åäº¤ç»™æœ¬åœ°å‡½æ•° `emit` å»å¤„ç†ã€‚
```ts
function emitSourceFile(sourceFile: SourceFile): void {
  currentSourceFile = sourceFile;
  exportFunctionForFile = undefined;
  emit(sourceFile);
}
```

`emit` å‡½æ•°å¤„ç† **æ³¨é‡Š** å’Œ **å®é™… JavaScript** çš„å‘å°„ã€‚**å®é™… JavaScript** çš„å‘å°„æ˜¯ emitJavaScriptWorker å‡½æ•°çš„å·¥ä½œã€‚

##### `emitJavaScriptWorker`

å®Œæ•´çš„å‡½æ•°ï¼š
```ts
function emitJavaScriptWorker(node: Node) {
  // æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å¯ä»¥å¿½ç•¥ ScriptTarget å‘å°„
  switch (node.kind) {
    case SyntaxKind.Identifier:
      return emitIdentifier(<Identifier>node);
    case SyntaxKind.Parameter:
      return emitParameter(<ParameterDeclaration>node);
    case SyntaxKind.MethodDeclaration:
    case SyntaxKind.MethodSignature:
      return emitMethod(<MethodDeclaration>node);
    case SyntaxKind.GetAccessor:
    case SyntaxKind.SetAccessor:
      return emitAccessor(<AccessorDeclaration>node);
    case SyntaxKind.ThisKeyword:
      return emitThis(node);
    case SyntaxKind.SuperKeyword:
      return emitSuper(node);
    case SyntaxKind.NullKeyword:
      return write('null');
    case SyntaxKind.TrueKeyword:
      return write('true');
    case SyntaxKind.FalseKeyword:
      return write('false');
    case SyntaxKind.NumericLiteral:
    case SyntaxKind.StringLiteral:
    case SyntaxKind.RegularExpressionLiteral:
    case SyntaxKind.NoSubstitutionTemplateLiteral:
    case SyntaxKind.TemplateHead:
    case SyntaxKind.TemplateMiddle:
    case SyntaxKind.TemplateTail:
      return emitLiteral(<LiteralExpression>node);
    case SyntaxKind.TemplateExpression:
      return emitTemplateExpression(<TemplateExpression>node);
    case SyntaxKind.TemplateSpan:
      return emitTemplateSpan(<TemplateSpan>node);
    case SyntaxKind.JsxElement:
    case SyntaxKind.JsxSelfClosingElement:
      return emitJsxElement(<JsxElement | JsxSelfClosingElement>node);
    case SyntaxKind.JsxText:
      return emitJsxText(<JsxText>node);
    case SyntaxKind.JsxExpression:
      return emitJsxExpression(<JsxExpression>node);
    case SyntaxKind.QualifiedName:
      return emitQualifiedName(<QualifiedName>node);
    case SyntaxKind.ObjectBindingPattern:
      return emitObjectBindingPattern(<BindingPattern>node);
    case SyntaxKind.ArrayBindingPattern:
      return emitArrayBindingPattern(<BindingPattern>node);
    case SyntaxKind.BindingElement:
      return emitBindingElement(<BindingElement>node);
    case SyntaxKind.ArrayLiteralExpression:
      return emitArrayLiteral(<ArrayLiteralExpression>node);
    case SyntaxKind.ObjectLiteralExpression:
      return emitObjectLiteral(<ObjectLiteralExpression>node);
    case SyntaxKind.PropertyAssignment:
      return emitPropertyAssignment(<PropertyDeclaration>node);
    case SyntaxKind.ShorthandPropertyAssignment:
      return emitShorthandPropertyAssignment(<ShorthandPropertyAssignment>node);
    case SyntaxKind.ComputedPropertyName:
      return emitComputedPropertyName(<ComputedPropertyName>node);
    case SyntaxKind.PropertyAccessExpression:
      return emitPropertyAccess(<PropertyAccessExpression>node);
    case SyntaxKind.ElementAccessExpression:
      return emitIndexedAccess(<ElementAccessExpression>node);
    case SyntaxKind.CallExpression:
      return emitCallExpression(<CallExpression>node);
    case SyntaxKind.NewExpression:
      return emitNewExpression(<NewExpression>node);
    case SyntaxKind.TaggedTemplateExpression:
      return emitTaggedTemplateExpression(<TaggedTemplateExpression>node);
    case SyntaxKind.TypeAssertionExpression:
      return emit((<TypeAssertion>node).expression);
    case SyntaxKind.AsExpression:
      return emit((<AsExpression>node).expression);
    case SyntaxKind.ParenthesizedExpression:
      return emitParenExpression(<ParenthesizedExpression>node);
    case SyntaxKind.FunctionDeclaration:
    case SyntaxKind.FunctionExpression:
    case SyntaxKind.ArrowFunction:
      return emitFunctionDeclaration(<FunctionLikeDeclaration>node);
    case SyntaxKind.DeleteExpression:
      return emitDeleteExpression(<DeleteExpression>node);
    case SyntaxKind.TypeOfExpression:
      return emitTypeOfExpression(<TypeOfExpression>node);
    case SyntaxKind.VoidExpression:
      return emitVoidExpression(<VoidExpression>node);
    case SyntaxKind.AwaitExpression:
      return emitAwaitExpression(<AwaitExpression>node);
    case SyntaxKind.PrefixUnaryExpression:
      return emitPrefixUnaryExpression(<PrefixUnaryExpression>node);
    case SyntaxKind.PostfixUnaryExpression:
      return emitPostfixUnaryExpression(<PostfixUnaryExpression>node);
    case SyntaxKind.BinaryExpression:
      return emitBinaryExpression(<BinaryExpression>node);
    case SyntaxKind.ConditionalExpression:
      return emitConditionalExpression(<ConditionalExpression>node);
    case SyntaxKind.SpreadElementExpression:
      return emitSpreadElementExpression(<SpreadElementExpression>node);
    case SyntaxKind.YieldExpression:
      return emitYieldExpression(<YieldExpression>node);
    case SyntaxKind.OmittedExpression:
      return;
    case SyntaxKind.Block:
    case SyntaxKind.ModuleBlock:
      return emitBlock(<Block>node);
    case SyntaxKind.VariableStatement:
      return emitVariableStatement(<VariableStatement>node);
    case SyntaxKind.EmptyStatement:
      return write(';');
    case SyntaxKind.ExpressionStatement:
      return emitExpressionStatement(<ExpressionStatement>node);
    case SyntaxKind.IfStatement:
      return emitIfStatement(<IfStatement>node);
    case SyntaxKind.DoStatement:
      return emitDoStatement(<DoStatement>node);
    case SyntaxKind.WhileStatement:
      return emitWhileStatement(<WhileStatement>node);
    case SyntaxKind.ForStatement:
      return emitForStatement(<ForStatement>node);
    case SyntaxKind.ForOfStatement:
    case SyntaxKind.ForInStatement:
      return emitForInOrForOfStatement(<ForInStatement>node);
    case SyntaxKind.ContinueStatement:
    case SyntaxKind.BreakStatement:
      return emitBreakOrContinueStatement(<BreakOrContinueStatement>node);
    case SyntaxKind.ReturnStatement:
      return emitReturnStatement(<ReturnStatement>node);
    case SyntaxKind.WithStatement:
      return emitWithStatement(<WithStatement>node);
    case SyntaxKind.SwitchStatement:
      return emitSwitchStatement(<SwitchStatement>node);
    case SyntaxKind.CaseClause:
    case SyntaxKind.DefaultClause:
      return emitCaseOrDefaultClause(<CaseOrDefaultClause>node);
    case SyntaxKind.LabeledStatement:
      return emitLabelledStatement(<LabeledStatement>node);
    case SyntaxKind.ThrowStatement:
      return emitThrowStatement(<ThrowStatement>node);
    case SyntaxKind.TryStatement:
      return emitTryStatement(<TryStatement>node);
    case SyntaxKind.CatchClause:
      return emitCatchClause(<CatchClause>node);
    case SyntaxKind.DebuggerStatement:
      return emitDebuggerStatement(node);
    case SyntaxKind.VariableDeclaration:
      return emitVariableDeclaration(<VariableDeclaration>node);
    case SyntaxKind.ClassExpression:
      return emitClassExpression(<ClassExpression>node);
    case SyntaxKind.ClassDeclaration:
      return emitClassDeclaration(<ClassDeclaration>node);
    case SyntaxKind.InterfaceDeclaration:
      return emitInterfaceDeclaration(<InterfaceDeclaration>node);
    case SyntaxKind.EnumDeclaration:
      return emitEnumDeclaration(<EnumDeclaration>node);
    case SyntaxKind.EnumMember:
      return emitEnumMember(<EnumMember>node);
    case SyntaxKind.ModuleDeclaration:
      return emitModuleDeclaration(<ModuleDeclaration>node);
    case SyntaxKind.ImportDeclaration:
      return emitImportDeclaration(<ImportDeclaration>node);
    case SyntaxKind.ImportEqualsDeclaration:
      return emitImportEqualsDeclaration(<ImportEqualsDeclaration>node);
    case SyntaxKind.ExportDeclaration:
      return emitExportDeclaration(<ExportDeclaration>node);
    case SyntaxKind.ExportAssignment:
      return emitExportAssignment(<ExportAssignment>node);
    case SyntaxKind.SourceFile:
      return emitSourceFileNode(<SourceFile>node);
  }
}
```

é€šè¿‡ç®€å•åœ°è°ƒç”¨ç›¸åº”çš„ `emitXXX` å‡½æ•°æ¥å®Œæˆé€’å½’ï¼Œä¾‹å¦‚ `emitFunctionDeclaration`
```ts
function emitFunctionDeclaration(node: FunctionLikeDeclaration) {
  if (nodeIsMissing(node.body)) {
    return emitOnlyPinnedOrTripleSlashComments(node);
  }

  if (node.kind !== SyntaxKind.MethodDeclaration && node.kind !== SyntaxKind.MethodSignature) {
    // ä¼šæŠŠæ³¨é‡Šå½“åšæ–¹æ³•å£°æ˜çš„ä¸€éƒ¨åˆ†å»å‘å°„ã€‚
    emitLeadingComments(node);
  }

  // ç›®æ ‡ä¸º es6 ä¹‹å‰æ—¶ï¼Œä½¿ç”¨ function å…³é”®å­—æ¥å‘å°„ç±»å‡½æ•°ï¼ˆfunctions-likeï¼‰å£°æ˜ï¼ŒåŒ…æ‹¬ç®­å¤´å‡½æ•°
  // ç›®æ ‡ä¸º es6 æ—¶ï¼Œå¯ä»¥å‘å°„åŸç”Ÿçš„ ES6 ç®­å¤´å‡½æ•°ï¼Œå¹¶ä½¿ç”¨å®½ç®­å¤´ä»£æ›¿ function å…³é”®å­—.
  if (!shouldEmitAsArrowFunction(node)) {
    if (isES6ExportedDeclaration(node)) {
      write('export ');
      if (node.flags & NodeFlags.Default) {
        write('default ');
      }
    }

    write('function');
    if (languageVersion >= ScriptTarget.ES6 && node.asteriskToken) {
      write('*');
    }
    write(' ');
  }

  if (shouldEmitFunctionName(node)) {
    emitDeclarationName(node);
  }

  emitSignatureAndBody(node);
  if (
    languageVersion < ScriptTarget.ES6 &&
    node.kind === SyntaxKind.FunctionDeclaration &&
    node.parent === currentSourceFile &&
    node.name
  ) {
    emitExportMemberAssignments((<FunctionDeclaration>node).name);
  }
  if (node.kind !== SyntaxKind.MethodDeclaration && node.kind !== SyntaxKind.MethodSignature) {
    emitTrailingComments(node);
  }
}
```

#### å‘å°„å™¨æºæ˜ å°„ï¼ˆSourceMapsï¼‰

å¦‚å‰æ‰€è¿° `emitter.ts` ä¸­çš„å¤§éƒ¨åˆ†ä»£ç æ˜¯å‡½æ•° `emitJavaScript`ï¼ˆæˆ‘ä»¬ä¹‹å‰å±•ç¤ºè¿‡è¯¥å‡½æ•°çš„åˆå§‹åŒ–ä¾‹ç¨‹ï¼‰ã€‚ å®ƒä¸»è¦æ˜¯è®¾ç½®ä¸€æ‰¹æœ¬åœ°å˜é‡å¹¶äº¤ç»™ `emitSourceFile` å¤„ç†ã€‚ä¸‹é¢æˆ‘ä»¬å†çœ‹ä¸€éè¿™ä¸ªå‡½æ•°ï¼Œè¿™æ¬¡æˆ‘ä»¬é‡ç‚¹å…³æ³¨ `SourceMap` çš„éƒ¨åˆ†ï¼š
```ts
function emitJavaScript(jsFilePath: string, root?: SourceFile) {

    // æ— å…³ä»£ç  ........... å·²ç§»é™¤
    let writeComment = writeCommentRange;

    /** å°†å‘å°„çš„è¾“å‡ºå†™åˆ°ç£ç›˜ä¸Š */
    let writeEmittedFiles = writeJavaScriptFile;

    /** å‘å°„ä¸€ä¸ªèŠ‚ç‚¹ */
    let emit = emitNodeWithoutSourceMap;

    /** èŠ‚ç‚¹å‘å°„å‰è°ƒç”¨ */
    let emitStart = function (node: Node) { };

    /** èŠ‚ç‚¹å‘å°„å®Œæˆåè°ƒç”¨ */
    let emitEnd = function (node: Node) { };

    /** ä» startPos ä½ç½®å¼€å§‹ï¼Œä¸ºæŒ‡å®šçš„ token å‘å°„æ–‡æœ¬ã€‚é»˜è®¤å†™å…¥çš„æ–‡æœ¬ç”± tokenKind æä¾›ï¼Œ
      * ä½†æ˜¯å¦‚æœæä¾›äº†å¯é€‰çš„ emitFn å›è°ƒï¼Œå°†ä½¿ç”¨è¯¥å›è°ƒæ¥ä»£æ›¿é»˜è®¤æ–¹å¼å‘å°„æ–‡æœ¬ã€‚
      * @param tokenKind è¦æœç´¢å¹¶å‘å°„çš„ token çš„ç±»åˆ«
      * @param startPos æºç ä¸­æœç´¢ token çš„èµ·å§‹ä½ç½®
      * @param emitFn å¦‚æœç»™å‡ºï¼Œä¼šè¢«è°ƒç”¨æ¥è¿›è¡Œæ–‡æœ¬çš„å‘å°„ã€‚*/
    let emitToken = emitTokenText;

    /** è¯¥å‡½æ•°å› ä¸ºèŠ‚ç‚¹ï¼Œä¼šåœ¨å‘å°„çš„ä»£ç ä¸­äºå‡½æ•°æˆ–ç±»ä¸­å¯ç”¨è¯æ³•ä½œç”¨åŸŸå‰è°ƒç”¨
      * @param scopeDeclaration å¯åŠ¨è¯æ³•ä½œç”¨åŸŸçš„èŠ‚ç‚¹
      * @param scopeName å¯é€‰çš„ä½œç”¨åŸŸçš„åç§°ï¼Œè€Œä¸æ˜¯ä»èŠ‚ç‚¹å£°æ˜ä¸­æ¨å¯¼
      */
    let scopeEmitStart = function(scopeDeclaration: Node, scopeName?: string) { };

    /** å‡ºäº†ä½œç”¨åŸŸåè°ƒç”¨ */
    let scopeEmitEnd = function() { };

    /** ä¼šè¢«ç¼–ç çš„ Sourcemap æ•°æ® */
    let sourceMapData: SourceMapData;

    if (compilerOptions.sourceMap || compilerOptions.inlineSourceMap) {
        initializeEmitterWithSourceMaps();
    }

    if (root) {
        // ä¸è¦ç›´æ¥è°ƒç”¨ emitï¼Œé‚£æ ·ä¸ä¼šè®¾ç½® currentSourceFile
        emitSourceFile(root);
    }
    else {
        forEach(host.getSourceFiles(), sourceFile => {
            if (!isExternalModuleOrDeclarationFile(sourceFile)) {
                emitSourceFile(sourceFile);
            }
        });
    }

    writeLine();
    writeEmittedFiles(writer.getText(), /*writeByteOrderMark*/ compilerOptions.emitBOM);
    return;
```

é‡è¦çš„å‡½æ•°è°ƒç”¨ï¼š `initializeEmitterWithSourceMaps`ï¼Œè¯¥å‡½æ•°æ˜¯ `emitJavaScript` çš„æœ¬åœ°å‡½æ•°ï¼Œå®ƒè¦†ç›–äº†éƒ¨åˆ†å·²å®šä¹‰çš„æœ¬åœ°å‡½æ•°ã€‚ è¦†ç›–çš„å‡½æ•°å¯ä»¥åœ¨ `initalizeEmitterWithSourceMap` çš„åº•éƒ¨æ‰¾åˆ°ï¼š
```ts
// `initializeEmitterWithSourceMaps` å‡½æ•°çš„æœ€åéƒ¨åˆ†

writeEmittedFiles = writeJavaScriptAndSourceMapFile;
emit = emitNodeWithSourceMap;
emitStart = recordEmitNodeStartSpan;
emitEnd = recordEmitNodeEndSpan;
emitToken = writeTextWithSpanRecord;
scopeEmitStart = recordScopeNameOfNode;
scopeEmitEnd = recordScopeNameEnd;
writeComment = writeCommentRangeWithMap;
```

å°±æ˜¯è¯´å¤§éƒ¨åˆ†çš„å‘å°„å™¨ä»£ç ä¸å…³å¿ƒ `SourceMap`ï¼Œå®ƒä»¬ä»¥ç›¸åŒçš„æ–¹å¼ä½¿ç”¨è¿™äº›ï¼ˆå¸¦æˆ–ä¸å¸¦ SourceMap çš„ï¼‰æœ¬åœ°å‡½æ•°ã€‚

<cite>[-- ã€Šæ·±å…¥ç†è§£ TypeScriptã€‹](https://jkchao.github.io/typescript-book-chinese/project/compilationContext.html#tsconfig-json)</cite>
